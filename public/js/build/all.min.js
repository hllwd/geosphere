!function(t,e){"object"==typeof module&&"object"==typeof module.exports?module.exports=t.document?e(t,!0):function(t){if(!t.document)throw new Error("jQuery requires a window with a document");return e(t)}:e(t)}("undefined"!=typeof window?window:this,function(t,e){function n(t){var e=t.length,n=J.type(t);return"function"===n||J.isWindow(t)?!1:1===t.nodeType&&e?!0:"array"===n||0===e||"number"==typeof e&&e>0&&e-1 in t}function r(t,e,n){if(J.isFunction(e))return J.grep(t,function(t,r){return!!e.call(t,r,t)!==n});if(e.nodeType)return J.grep(t,function(t){return t===e!==n});if("string"==typeof e){if(se.test(e))return J.filter(e,t,n);e=J.filter(e,t)}return J.grep(t,function(t){return q.call(e,t)>=0!==n})}function i(t,e){for(;(t=t[e])&&1!==t.nodeType;);return t}function o(t){var e=de[t]={};return J.each(t.match(pe)||[],function(t,n){e[n]=!0}),e}function a(){Q.removeEventListener("DOMContentLoaded",a,!1),t.removeEventListener("load",a,!1),J.ready()}function s(){Object.defineProperty(this.cache={},0,{get:function(){return{}}}),this.expando=J.expando+Math.random()}function h(t,e,n){var r;if(void 0===n&&1===t.nodeType)if(r="data-"+e.replace(xe,"-$1").toLowerCase(),n=t.getAttribute(r),"string"==typeof n){try{n="true"===n?!0:"false"===n?!1:"null"===n?null:+n+""===n?+n:Ee.test(n)?J.parseJSON(n):n}catch(i){}ye.set(t,e,n)}else n=void 0;return n}function u(){return!0}function c(){return!1}function l(){try{return Q.activeElement}catch(t){}}function f(t,e){return J.nodeName(t,"table")&&J.nodeName(11!==e.nodeType?e:e.firstChild,"tr")?t.getElementsByTagName("tbody")[0]||t.appendChild(t.ownerDocument.createElement("tbody")):t}function p(t){return t.type=(null!==t.getAttribute("type"))+"/"+t.type,t}function d(t){var e=ke.exec(t.type);return e?t.type=e[1]:t.removeAttribute("type"),t}function m(t,e){for(var n=0,r=t.length;r>n;n++)ve.set(t[n],"globalEval",!e||ve.get(e[n],"globalEval"))}function g(t,e){var n,r,i,o,a,s,h,u;if(1===e.nodeType){if(ve.hasData(t)&&(o=ve.access(t),a=ve.set(e,o),u=o.events)){delete a.handle,a.events={};for(i in u)for(n=0,r=u[i].length;r>n;n++)J.event.add(e,i,u[i][n])}ye.hasData(t)&&(s=ye.access(t),h=J.extend({},s),ye.set(e,h))}}function v(t,e){var n=t.getElementsByTagName?t.getElementsByTagName(e||"*"):t.querySelectorAll?t.querySelectorAll(e||"*"):[];return void 0===e||e&&J.nodeName(t,e)?J.merge([t],n):n}function y(t,e){var n=e.nodeName.toLowerCase();"input"===n&&we.test(t.type)?e.checked=t.checked:("input"===n||"textarea"===n)&&(e.defaultValue=t.defaultValue)}function E(e,n){var r,i=J(n.createElement(e)).appendTo(n.body),o=t.getDefaultComputedStyle&&(r=t.getDefaultComputedStyle(i[0]))?r.display:J.css(i[0],"display");return i.detach(),o}function x(t){var e=Q,n=Be[t];return n||(n=E(t,e),"none"!==n&&n||(Ie=(Ie||J("<iframe frameborder='0' width='0' height='0'/>")).appendTo(e.documentElement),e=Ie[0].contentDocument,e.write(),e.close(),n=E(t,e),Ie.detach()),Be[t]=n),n}function T(t,e,n){var r,i,o,a,s=t.style;return n=n||We(t),n&&(a=n.getPropertyValue(e)||n[e]),n&&(""!==a||J.contains(t.ownerDocument,t)||(a=J.style(t,e)),Oe.test(a)&&Ue.test(e)&&(r=s.width,i=s.minWidth,o=s.maxWidth,s.minWidth=s.maxWidth=s.width=a,a=n.width,s.width=r,s.minWidth=i,s.maxWidth=o)),void 0!==a?a+"":a}function b(t,e){return{get:function(){return t()?void delete this.get:(this.get=e).apply(this,arguments)}}}function R(t,e){if(e in t)return e;for(var n=e[0].toUpperCase()+e.slice(1),r=e,i=Ze.length;i--;)if(e=Ze[i]+n,e in t)return e;return r}function w(t,e,n){var r=je.exec(e);return r?Math.max(0,r[1]-(n||0))+(r[2]||"px"):e}function _(t,e,n,r,i){for(var o=n===(r?"border":"content")?4:"width"===e?1:0,a=0;4>o;o+=2)"margin"===n&&(a+=J.css(t,n+be[o],!0,i)),r?("content"===n&&(a-=J.css(t,"padding"+be[o],!0,i)),"margin"!==n&&(a-=J.css(t,"border"+be[o]+"Width",!0,i))):(a+=J.css(t,"padding"+be[o],!0,i),"padding"!==n&&(a+=J.css(t,"border"+be[o]+"Width",!0,i)));return a}function H(t,e,n){var r=!0,i="width"===e?t.offsetWidth:t.offsetHeight,o=We(t),a="border-box"===J.css(t,"boxSizing",!1,o);if(0>=i||null==i){if(i=T(t,e,o),(0>i||null==i)&&(i=t.style[e]),Oe.test(i))return i;r=a&&(K.boxSizingReliable()||i===t.style[e]),i=parseFloat(i)||0}return i+_(t,e,n||(a?"border":"content"),r,o)+"px"}function M(t,e){for(var n,r,i,o=[],a=0,s=t.length;s>a;a++)r=t[a],r.style&&(o[a]=ve.get(r,"olddisplay"),n=r.style.display,e?(o[a]||"none"!==n||(r.style.display=""),""===r.style.display&&Re(r)&&(o[a]=ve.access(r,"olddisplay",x(r.nodeName)))):(i=Re(r),"none"===n&&i||ve.set(r,"olddisplay",i?n:J.css(r,"display"))));for(a=0;s>a;a++)r=t[a],r.style&&(e&&"none"!==r.style.display&&""!==r.style.display||(r.style.display=e?o[a]||"":"none"));return t}function S(t,e,n,r,i){return new S.prototype.init(t,e,n,r,i)}function C(){return setTimeout(function(){Ke=void 0}),Ke=J.now()}function A(t,e){var n,r=0,i={height:t};for(e=e?1:0;4>r;r+=2-e)n=be[r],i["margin"+n]=i["padding"+n]=t;return e&&(i.opacity=i.width=t),i}function L(t,e,n){for(var r,i=(nn[e]||[]).concat(nn["*"]),o=0,a=i.length;a>o;o++)if(r=i[o].call(n,e,t))return r}function P(t,e,n){var r,i,o,a,s,h,u,c,l=this,f={},p=t.style,d=t.nodeType&&Re(t),m=ve.get(t,"fxshow");n.queue||(s=J._queueHooks(t,"fx"),null==s.unqueued&&(s.unqueued=0,h=s.empty.fire,s.empty.fire=function(){s.unqueued||h()}),s.unqueued++,l.always(function(){l.always(function(){s.unqueued--,J.queue(t,"fx").length||s.empty.fire()})})),1===t.nodeType&&("height"in e||"width"in e)&&(n.overflow=[p.overflow,p.overflowX,p.overflowY],u=J.css(t,"display"),c="none"===u?ve.get(t,"olddisplay")||x(t.nodeName):u,"inline"===c&&"none"===J.css(t,"float")&&(p.display="inline-block")),n.overflow&&(p.overflow="hidden",l.always(function(){p.overflow=n.overflow[0],p.overflowX=n.overflow[1],p.overflowY=n.overflow[2]}));for(r in e)if(i=e[r],$e.exec(i)){if(delete e[r],o=o||"toggle"===i,i===(d?"hide":"show")){if("show"!==i||!m||void 0===m[r])continue;d=!0}f[r]=m&&m[r]||J.style(t,r)}else u=void 0;if(J.isEmptyObject(f))"inline"===("none"===u?x(t.nodeName):u)&&(p.display=u);else{m?"hidden"in m&&(d=m.hidden):m=ve.access(t,"fxshow",{}),o&&(m.hidden=!d),d?J(t).show():l.done(function(){J(t).hide()}),l.done(function(){var e;ve.remove(t,"fxshow");for(e in f)J.style(t,e,f[e])});for(r in f)a=L(d?m[r]:0,r,l),r in m||(m[r]=a.start,d&&(a.end=a.start,a.start="width"===r||"height"===r?1:0))}}function D(t,e){var n,r,i,o,a;for(n in t)if(r=J.camelCase(n),i=e[r],o=t[n],J.isArray(o)&&(i=o[1],o=t[n]=o[0]),n!==r&&(t[r]=o,delete t[n]),a=J.cssHooks[r],a&&"expand"in a){o=a.expand(o),delete t[r];for(n in o)n in t||(t[n]=o[n],e[n]=i)}else e[r]=i}function z(t,e,n){var r,i,o=0,a=en.length,s=J.Deferred().always(function(){delete h.elem}),h=function(){if(i)return!1;for(var e=Ke||C(),n=Math.max(0,u.startTime+u.duration-e),r=n/u.duration||0,o=1-r,a=0,h=u.tweens.length;h>a;a++)u.tweens[a].run(o);return s.notifyWith(t,[u,o,n]),1>o&&h?n:(s.resolveWith(t,[u]),!1)},u=s.promise({elem:t,props:J.extend({},e),opts:J.extend(!0,{specialEasing:{}},n),originalProperties:e,originalOptions:n,startTime:Ke||C(),duration:n.duration,tweens:[],createTween:function(e,n){var r=J.Tween(t,u.opts,e,n,u.opts.specialEasing[e]||u.opts.easing);return u.tweens.push(r),r},stop:function(e){var n=0,r=e?u.tweens.length:0;if(i)return this;for(i=!0;r>n;n++)u.tweens[n].run(1);return e?s.resolveWith(t,[u,e]):s.rejectWith(t,[u,e]),this}}),c=u.props;for(D(c,u.opts.specialEasing);a>o;o++)if(r=en[o].call(u,t,c,u.opts))return r;return J.map(c,L,u),J.isFunction(u.opts.start)&&u.opts.start.call(t,u),J.fx.timer(J.extend(h,{elem:t,anim:u,queue:u.opts.queue})),u.progress(u.opts.progress).done(u.opts.done,u.opts.complete).fail(u.opts.fail).always(u.opts.always)}function F(t){return function(e,n){"string"!=typeof e&&(n=e,e="*");var r,i=0,o=e.toLowerCase().match(pe)||[];if(J.isFunction(n))for(;r=o[i++];)"+"===r[0]?(r=r.slice(1)||"*",(t[r]=t[r]||[]).unshift(n)):(t[r]=t[r]||[]).push(n)}}function k(t,e,n,r){function i(s){var h;return o[s]=!0,J.each(t[s]||[],function(t,s){var u=s(e,n,r);return"string"!=typeof u||a||o[u]?a?!(h=u):void 0:(e.dataTypes.unshift(u),i(u),!1)}),h}var o={},a=t===bn;return i(e.dataTypes[0])||!o["*"]&&i("*")}function N(t,e){var n,r,i=J.ajaxSettings.flatOptions||{};for(n in e)void 0!==e[n]&&((i[n]?t:r||(r={}))[n]=e[n]);return r&&J.extend(!0,t,r),t}function V(t,e,n){for(var r,i,o,a,s=t.contents,h=t.dataTypes;"*"===h[0];)h.shift(),void 0===r&&(r=t.mimeType||e.getResponseHeader("Content-Type"));if(r)for(i in s)if(s[i]&&s[i].test(r)){h.unshift(i);break}if(h[0]in n)o=h[0];else{for(i in n){if(!h[0]||t.converters[i+" "+h[0]]){o=i;break}a||(a=i)}o=o||a}return o?(o!==h[0]&&h.unshift(o),n[o]):void 0}function I(t,e,n,r){var i,o,a,s,h,u={},c=t.dataTypes.slice();if(c[1])for(a in t.converters)u[a.toLowerCase()]=t.converters[a];for(o=c.shift();o;)if(t.responseFields[o]&&(n[t.responseFields[o]]=e),!h&&r&&t.dataFilter&&(e=t.dataFilter(e,t.dataType)),h=o,o=c.shift())if("*"===o)o=h;else if("*"!==h&&h!==o){if(a=u[h+" "+o]||u["* "+o],!a)for(i in u)if(s=i.split(" "),s[1]===o&&(a=u[h+" "+s[0]]||u["* "+s[0]])){a===!0?a=u[i]:u[i]!==!0&&(o=s[0],c.unshift(s[1]));break}if(a!==!0)if(a&&t["throws"])e=a(e);else try{e=a(e)}catch(l){return{state:"parsererror",error:a?l:"No conversion from "+h+" to "+o}}}return{state:"success",data:e}}function B(t,e,n,r){var i;if(J.isArray(e))J.each(e,function(e,i){n||Hn.test(t)?r(t,i):B(t+"["+("object"==typeof i?e:"")+"]",i,n,r)});else if(n||"object"!==J.type(e))r(t,e);else for(i in e)B(t+"["+i+"]",e[i],n,r)}function U(t){return J.isWindow(t)?t:9===t.nodeType&&t.defaultView}var O=[],W=O.slice,G=O.concat,j=O.push,q=O.indexOf,X={},Y=X.toString,Z=X.hasOwnProperty,K={},Q=t.document,$="2.1.1",J=function(t,e){return new J.fn.init(t,e)},te=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,ee=/^-ms-/,ne=/-([\da-z])/gi,re=function(t,e){return e.toUpperCase()};J.fn=J.prototype={jquery:$,constructor:J,selector:"",length:0,toArray:function(){return W.call(this)},get:function(t){return null!=t?0>t?this[t+this.length]:this[t]:W.call(this)},pushStack:function(t){var e=J.merge(this.constructor(),t);return e.prevObject=this,e.context=this.context,e},each:function(t,e){return J.each(this,t,e)},map:function(t){return this.pushStack(J.map(this,function(e,n){return t.call(e,n,e)}))},slice:function(){return this.pushStack(W.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(t){var e=this.length,n=+t+(0>t?e:0);return this.pushStack(n>=0&&e>n?[this[n]]:[])},end:function(){return this.prevObject||this.constructor(null)},push:j,sort:O.sort,splice:O.splice},J.extend=J.fn.extend=function(){var t,e,n,r,i,o,a=arguments[0]||{},s=1,h=arguments.length,u=!1;for("boolean"==typeof a&&(u=a,a=arguments[s]||{},s++),"object"==typeof a||J.isFunction(a)||(a={}),s===h&&(a=this,s--);h>s;s++)if(null!=(t=arguments[s]))for(e in t)n=a[e],r=t[e],a!==r&&(u&&r&&(J.isPlainObject(r)||(i=J.isArray(r)))?(i?(i=!1,o=n&&J.isArray(n)?n:[]):o=n&&J.isPlainObject(n)?n:{},a[e]=J.extend(u,o,r)):void 0!==r&&(a[e]=r));return a},J.extend({expando:"jQuery"+($+Math.random()).replace(/\D/g,""),isReady:!0,error:function(t){throw new Error(t)},noop:function(){},isFunction:function(t){return"function"===J.type(t)},isArray:Array.isArray,isWindow:function(t){return null!=t&&t===t.window},isNumeric:function(t){return!J.isArray(t)&&t-parseFloat(t)>=0},isPlainObject:function(t){return"object"!==J.type(t)||t.nodeType||J.isWindow(t)?!1:t.constructor&&!Z.call(t.constructor.prototype,"isPrototypeOf")?!1:!0},isEmptyObject:function(t){var e;for(e in t)return!1;return!0},type:function(t){return null==t?t+"":"object"==typeof t||"function"==typeof t?X[Y.call(t)]||"object":typeof t},globalEval:function(t){var e,n=eval;t=J.trim(t),t&&(1===t.indexOf("use strict")?(e=Q.createElement("script"),e.text=t,Q.head.appendChild(e).parentNode.removeChild(e)):n(t))},camelCase:function(t){return t.replace(ee,"ms-").replace(ne,re)},nodeName:function(t,e){return t.nodeName&&t.nodeName.toLowerCase()===e.toLowerCase()},each:function(t,e,r){var i,o=0,a=t.length,s=n(t);if(r){if(s)for(;a>o&&(i=e.apply(t[o],r),i!==!1);o++);else for(o in t)if(i=e.apply(t[o],r),i===!1)break}else if(s)for(;a>o&&(i=e.call(t[o],o,t[o]),i!==!1);o++);else for(o in t)if(i=e.call(t[o],o,t[o]),i===!1)break;return t},trim:function(t){return null==t?"":(t+"").replace(te,"")},makeArray:function(t,e){var r=e||[];return null!=t&&(n(Object(t))?J.merge(r,"string"==typeof t?[t]:t):j.call(r,t)),r},inArray:function(t,e,n){return null==e?-1:q.call(e,t,n)},merge:function(t,e){for(var n=+e.length,r=0,i=t.length;n>r;r++)t[i++]=e[r];return t.length=i,t},grep:function(t,e,n){for(var r,i=[],o=0,a=t.length,s=!n;a>o;o++)r=!e(t[o],o),r!==s&&i.push(t[o]);return i},map:function(t,e,r){var i,o=0,a=t.length,s=n(t),h=[];if(s)for(;a>o;o++)i=e(t[o],o,r),null!=i&&h.push(i);else for(o in t)i=e(t[o],o,r),null!=i&&h.push(i);return G.apply([],h)},guid:1,proxy:function(t,e){var n,r,i;return"string"==typeof e&&(n=t[e],e=t,t=n),J.isFunction(t)?(r=W.call(arguments,2),i=function(){return t.apply(e||this,r.concat(W.call(arguments)))},i.guid=t.guid=t.guid||J.guid++,i):void 0},now:Date.now,support:K}),J.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(t,e){X["[object "+e+"]"]=e.toLowerCase()});var ie=function(t){function e(t,e,n,r){var i,o,a,s,h,u,l,p,d,m;if((e?e.ownerDocument||e:B)!==P&&L(e),e=e||P,n=n||[],!t||"string"!=typeof t)return n;if(1!==(s=e.nodeType)&&9!==s)return[];if(z&&!r){if(i=ye.exec(t))if(a=i[1]){if(9===s){if(o=e.getElementById(a),!o||!o.parentNode)return n;if(o.id===a)return n.push(o),n}else if(e.ownerDocument&&(o=e.ownerDocument.getElementById(a))&&V(e,o)&&o.id===a)return n.push(o),n}else{if(i[2])return J.apply(n,e.getElementsByTagName(t)),n;if((a=i[3])&&T.getElementsByClassName&&e.getElementsByClassName)return J.apply(n,e.getElementsByClassName(a)),n}if(T.qsa&&(!F||!F.test(t))){if(p=l=I,d=e,m=9===s&&t,1===s&&"object"!==e.nodeName.toLowerCase()){for(u=_(t),(l=e.getAttribute("id"))?p=l.replace(xe,"\\$&"):e.setAttribute("id",p),p="[id='"+p+"'] ",h=u.length;h--;)u[h]=p+f(u[h]);d=Ee.test(t)&&c(e.parentNode)||e,m=u.join(",")}if(m)try{return J.apply(n,d.querySelectorAll(m)),n}catch(g){}finally{l||e.removeAttribute("id")}}}return M(t.replace(he,"$1"),e,n,r)}function n(){function t(n,r){return e.push(n+" ")>b.cacheLength&&delete t[e.shift()],t[n+" "]=r}var e=[];return t}function r(t){return t[I]=!0,t}function i(t){var e=P.createElement("div");try{return!!t(e)}catch(n){return!1}finally{e.parentNode&&e.parentNode.removeChild(e),e=null}}function o(t,e){for(var n=t.split("|"),r=t.length;r--;)b.attrHandle[n[r]]=e}function a(t,e){var n=e&&t,r=n&&1===t.nodeType&&1===e.nodeType&&(~e.sourceIndex||Y)-(~t.sourceIndex||Y);if(r)return r;if(n)for(;n=n.nextSibling;)if(n===e)return-1;return t?1:-1}function s(t){return function(e){var n=e.nodeName.toLowerCase();return"input"===n&&e.type===t}}function h(t){return function(e){var n=e.nodeName.toLowerCase();return("input"===n||"button"===n)&&e.type===t}}function u(t){return r(function(e){return e=+e,r(function(n,r){for(var i,o=t([],n.length,e),a=o.length;a--;)n[i=o[a]]&&(n[i]=!(r[i]=n[i]))})})}function c(t){return t&&typeof t.getElementsByTagName!==X&&t}function l(){}function f(t){for(var e=0,n=t.length,r="";n>e;e++)r+=t[e].value;return r}function p(t,e,n){var r=e.dir,i=n&&"parentNode"===r,o=O++;return e.first?function(e,n,o){for(;e=e[r];)if(1===e.nodeType||i)return t(e,n,o)}:function(e,n,a){var s,h,u=[U,o];if(a){for(;e=e[r];)if((1===e.nodeType||i)&&t(e,n,a))return!0}else for(;e=e[r];)if(1===e.nodeType||i){if(h=e[I]||(e[I]={}),(s=h[r])&&s[0]===U&&s[1]===o)return u[2]=s[2];if(h[r]=u,u[2]=t(e,n,a))return!0}}}function d(t){return t.length>1?function(e,n,r){for(var i=t.length;i--;)if(!t[i](e,n,r))return!1;return!0}:t[0]}function m(t,n,r){for(var i=0,o=n.length;o>i;i++)e(t,n[i],r);return r}function g(t,e,n,r,i){for(var o,a=[],s=0,h=t.length,u=null!=e;h>s;s++)(o=t[s])&&(!n||n(o,r,i))&&(a.push(o),u&&e.push(s));return a}function v(t,e,n,i,o,a){return i&&!i[I]&&(i=v(i)),o&&!o[I]&&(o=v(o,a)),r(function(r,a,s,h){var u,c,l,f=[],p=[],d=a.length,v=r||m(e||"*",s.nodeType?[s]:s,[]),y=!t||!r&&e?v:g(v,f,t,s,h),E=n?o||(r?t:d||i)?[]:a:y;if(n&&n(y,E,s,h),i)for(u=g(E,p),i(u,[],s,h),c=u.length;c--;)(l=u[c])&&(E[p[c]]=!(y[p[c]]=l));if(r){if(o||t){if(o){for(u=[],c=E.length;c--;)(l=E[c])&&u.push(y[c]=l);o(null,E=[],u,h)}for(c=E.length;c--;)(l=E[c])&&(u=o?ee.call(r,l):f[c])>-1&&(r[u]=!(a[u]=l))}}else E=g(E===a?E.splice(d,E.length):E),o?o(null,a,E,h):J.apply(a,E)})}function y(t){for(var e,n,r,i=t.length,o=b.relative[t[0].type],a=o||b.relative[" "],s=o?1:0,h=p(function(t){return t===e},a,!0),u=p(function(t){return ee.call(e,t)>-1},a,!0),c=[function(t,n,r){return!o&&(r||n!==S)||((e=n).nodeType?h(t,n,r):u(t,n,r))}];i>s;s++)if(n=b.relative[t[s].type])c=[p(d(c),n)];else{if(n=b.filter[t[s].type].apply(null,t[s].matches),n[I]){for(r=++s;i>r&&!b.relative[t[r].type];r++);return v(s>1&&d(c),s>1&&f(t.slice(0,s-1).concat({value:" "===t[s-2].type?"*":""})).replace(he,"$1"),n,r>s&&y(t.slice(s,r)),i>r&&y(t=t.slice(r)),i>r&&f(t))}c.push(n)}return d(c)}function E(t,n){var i=n.length>0,o=t.length>0,a=function(r,a,s,h,u){var c,l,f,p=0,d="0",m=r&&[],v=[],y=S,E=r||o&&b.find.TAG("*",u),x=U+=null==y?1:Math.random()||.1,T=E.length;for(u&&(S=a!==P&&a);d!==T&&null!=(c=E[d]);d++){if(o&&c){for(l=0;f=t[l++];)if(f(c,a,s)){h.push(c);break}u&&(U=x)}i&&((c=!f&&c)&&p--,r&&m.push(c))}if(p+=d,i&&d!==p){for(l=0;f=n[l++];)f(m,v,a,s);if(r){if(p>0)for(;d--;)m[d]||v[d]||(v[d]=Q.call(h));v=g(v)}J.apply(h,v),u&&!r&&v.length>0&&p+n.length>1&&e.uniqueSort(h)}return u&&(U=x,S=y),m};return i?r(a):a}var x,T,b,R,w,_,H,M,S,C,A,L,P,D,z,F,k,N,V,I="sizzle"+-new Date,B=t.document,U=0,O=0,W=n(),G=n(),j=n(),q=function(t,e){return t===e&&(A=!0),0},X="undefined",Y=1<<31,Z={}.hasOwnProperty,K=[],Q=K.pop,$=K.push,J=K.push,te=K.slice,ee=K.indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(this[e]===t)return e;return-1},ne="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",re="[\\x20\\t\\r\\n\\f]",ie="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",oe=ie.replace("w","w#"),ae="\\["+re+"*("+ie+")(?:"+re+"*([*^$|!~]?=)"+re+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+oe+"))|)"+re+"*\\]",se=":("+ie+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+ae+")*)|.*)\\)|)",he=new RegExp("^"+re+"+|((?:^|[^\\\\])(?:\\\\.)*)"+re+"+$","g"),ue=new RegExp("^"+re+"*,"+re+"*"),ce=new RegExp("^"+re+"*([>+~]|"+re+")"+re+"*"),le=new RegExp("="+re+"*([^\\]'\"]*?)"+re+"*\\]","g"),fe=new RegExp(se),pe=new RegExp("^"+oe+"$"),de={ID:new RegExp("^#("+ie+")"),CLASS:new RegExp("^\\.("+ie+")"),TAG:new RegExp("^("+ie.replace("w","w*")+")"),ATTR:new RegExp("^"+ae),PSEUDO:new RegExp("^"+se),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+re+"*(even|odd|(([+-]|)(\\d*)n|)"+re+"*(?:([+-]|)"+re+"*(\\d+)|))"+re+"*\\)|)","i"),bool:new RegExp("^(?:"+ne+")$","i"),needsContext:new RegExp("^"+re+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+re+"*((?:-\\d)?\\d*)"+re+"*\\)|)(?=[^-]|$)","i")},me=/^(?:input|select|textarea|button)$/i,ge=/^h\d$/i,ve=/^[^{]+\{\s*\[native \w/,ye=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,Ee=/[+~]/,xe=/'|\\/g,Te=new RegExp("\\\\([\\da-f]{1,6}"+re+"?|("+re+")|.)","ig"),be=function(t,e,n){var r="0x"+e-65536;return r!==r||n?e:0>r?String.fromCharCode(r+65536):String.fromCharCode(r>>10|55296,1023&r|56320)};try{J.apply(K=te.call(B.childNodes),B.childNodes),K[B.childNodes.length].nodeType}catch(Re){J={apply:K.length?function(t,e){$.apply(t,te.call(e))}:function(t,e){for(var n=t.length,r=0;t[n++]=e[r++];);t.length=n-1}}}T=e.support={},w=e.isXML=function(t){var e=t&&(t.ownerDocument||t).documentElement;return e?"HTML"!==e.nodeName:!1},L=e.setDocument=function(t){var e,n=t?t.ownerDocument||t:B,r=n.defaultView;return n!==P&&9===n.nodeType&&n.documentElement?(P=n,D=n.documentElement,z=!w(n),r&&r!==r.top&&(r.addEventListener?r.addEventListener("unload",function(){L()},!1):r.attachEvent&&r.attachEvent("onunload",function(){L()})),T.attributes=i(function(t){return t.className="i",!t.getAttribute("className")}),T.getElementsByTagName=i(function(t){return t.appendChild(n.createComment("")),!t.getElementsByTagName("*").length}),T.getElementsByClassName=ve.test(n.getElementsByClassName)&&i(function(t){return t.innerHTML="<div class='a'></div><div class='a i'></div>",t.firstChild.className="i",2===t.getElementsByClassName("i").length}),T.getById=i(function(t){return D.appendChild(t).id=I,!n.getElementsByName||!n.getElementsByName(I).length}),T.getById?(b.find.ID=function(t,e){if(typeof e.getElementById!==X&&z){var n=e.getElementById(t);return n&&n.parentNode?[n]:[]}},b.filter.ID=function(t){var e=t.replace(Te,be);return function(t){return t.getAttribute("id")===e}}):(delete b.find.ID,b.filter.ID=function(t){var e=t.replace(Te,be);return function(t){var n=typeof t.getAttributeNode!==X&&t.getAttributeNode("id");return n&&n.value===e}}),b.find.TAG=T.getElementsByTagName?function(t,e){return typeof e.getElementsByTagName!==X?e.getElementsByTagName(t):void 0}:function(t,e){var n,r=[],i=0,o=e.getElementsByTagName(t);if("*"===t){for(;n=o[i++];)1===n.nodeType&&r.push(n);return r}return o},b.find.CLASS=T.getElementsByClassName&&function(t,e){return typeof e.getElementsByClassName!==X&&z?e.getElementsByClassName(t):void 0},k=[],F=[],(T.qsa=ve.test(n.querySelectorAll))&&(i(function(t){t.innerHTML="<select msallowclip=''><option selected=''></option></select>",t.querySelectorAll("[msallowclip^='']").length&&F.push("[*^$]="+re+"*(?:''|\"\")"),t.querySelectorAll("[selected]").length||F.push("\\["+re+"*(?:value|"+ne+")"),t.querySelectorAll(":checked").length||F.push(":checked")}),i(function(t){var e=n.createElement("input");e.setAttribute("type","hidden"),t.appendChild(e).setAttribute("name","D"),t.querySelectorAll("[name=d]").length&&F.push("name"+re+"*[*^$|!~]?="),t.querySelectorAll(":enabled").length||F.push(":enabled",":disabled"),t.querySelectorAll("*,:x"),F.push(",.*:")})),(T.matchesSelector=ve.test(N=D.matches||D.webkitMatchesSelector||D.mozMatchesSelector||D.oMatchesSelector||D.msMatchesSelector))&&i(function(t){T.disconnectedMatch=N.call(t,"div"),N.call(t,"[s!='']:x"),k.push("!=",se)}),F=F.length&&new RegExp(F.join("|")),k=k.length&&new RegExp(k.join("|")),e=ve.test(D.compareDocumentPosition),V=e||ve.test(D.contains)?function(t,e){var n=9===t.nodeType?t.documentElement:t,r=e&&e.parentNode;return t===r||!(!r||1!==r.nodeType||!(n.contains?n.contains(r):t.compareDocumentPosition&&16&t.compareDocumentPosition(r)))}:function(t,e){if(e)for(;e=e.parentNode;)if(e===t)return!0;return!1},q=e?function(t,e){if(t===e)return A=!0,0;var r=!t.compareDocumentPosition-!e.compareDocumentPosition;return r?r:(r=(t.ownerDocument||t)===(e.ownerDocument||e)?t.compareDocumentPosition(e):1,1&r||!T.sortDetached&&e.compareDocumentPosition(t)===r?t===n||t.ownerDocument===B&&V(B,t)?-1:e===n||e.ownerDocument===B&&V(B,e)?1:C?ee.call(C,t)-ee.call(C,e):0:4&r?-1:1)}:function(t,e){if(t===e)return A=!0,0;var r,i=0,o=t.parentNode,s=e.parentNode,h=[t],u=[e];if(!o||!s)return t===n?-1:e===n?1:o?-1:s?1:C?ee.call(C,t)-ee.call(C,e):0;if(o===s)return a(t,e);for(r=t;r=r.parentNode;)h.unshift(r);for(r=e;r=r.parentNode;)u.unshift(r);for(;h[i]===u[i];)i++;return i?a(h[i],u[i]):h[i]===B?-1:u[i]===B?1:0},n):P},e.matches=function(t,n){return e(t,null,null,n)},e.matchesSelector=function(t,n){if((t.ownerDocument||t)!==P&&L(t),n=n.replace(le,"='$1']"),!(!T.matchesSelector||!z||k&&k.test(n)||F&&F.test(n)))try{var r=N.call(t,n);if(r||T.disconnectedMatch||t.document&&11!==t.document.nodeType)return r}catch(i){}return e(n,P,null,[t]).length>0},e.contains=function(t,e){return(t.ownerDocument||t)!==P&&L(t),V(t,e)},e.attr=function(t,e){(t.ownerDocument||t)!==P&&L(t);var n=b.attrHandle[e.toLowerCase()],r=n&&Z.call(b.attrHandle,e.toLowerCase())?n(t,e,!z):void 0;return void 0!==r?r:T.attributes||!z?t.getAttribute(e):(r=t.getAttributeNode(e))&&r.specified?r.value:null},e.error=function(t){throw new Error("Syntax error, unrecognized expression: "+t)},e.uniqueSort=function(t){var e,n=[],r=0,i=0;if(A=!T.detectDuplicates,C=!T.sortStable&&t.slice(0),t.sort(q),A){for(;e=t[i++];)e===t[i]&&(r=n.push(i));for(;r--;)t.splice(n[r],1)}return C=null,t},R=e.getText=function(t){var e,n="",r=0,i=t.nodeType;if(i){if(1===i||9===i||11===i){if("string"==typeof t.textContent)return t.textContent;for(t=t.firstChild;t;t=t.nextSibling)n+=R(t)}else if(3===i||4===i)return t.nodeValue}else for(;e=t[r++];)n+=R(e);return n},b=e.selectors={cacheLength:50,createPseudo:r,match:de,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(t){return t[1]=t[1].replace(Te,be),t[3]=(t[3]||t[4]||t[5]||"").replace(Te,be),"~="===t[2]&&(t[3]=" "+t[3]+" "),t.slice(0,4)},CHILD:function(t){return t[1]=t[1].toLowerCase(),"nth"===t[1].slice(0,3)?(t[3]||e.error(t[0]),t[4]=+(t[4]?t[5]+(t[6]||1):2*("even"===t[3]||"odd"===t[3])),t[5]=+(t[7]+t[8]||"odd"===t[3])):t[3]&&e.error(t[0]),t},PSEUDO:function(t){var e,n=!t[6]&&t[2];return de.CHILD.test(t[0])?null:(t[3]?t[2]=t[4]||t[5]||"":n&&fe.test(n)&&(e=_(n,!0))&&(e=n.indexOf(")",n.length-e)-n.length)&&(t[0]=t[0].slice(0,e),t[2]=n.slice(0,e)),t.slice(0,3))}},filter:{TAG:function(t){var e=t.replace(Te,be).toLowerCase();return"*"===t?function(){return!0}:function(t){return t.nodeName&&t.nodeName.toLowerCase()===e}},CLASS:function(t){var e=W[t+" "];return e||(e=new RegExp("(^|"+re+")"+t+"("+re+"|$)"))&&W(t,function(t){return e.test("string"==typeof t.className&&t.className||typeof t.getAttribute!==X&&t.getAttribute("class")||"")})},ATTR:function(t,n,r){return function(i){var o=e.attr(i,t);return null==o?"!="===n:n?(o+="","="===n?o===r:"!="===n?o!==r:"^="===n?r&&0===o.indexOf(r):"*="===n?r&&o.indexOf(r)>-1:"$="===n?r&&o.slice(-r.length)===r:"~="===n?(" "+o+" ").indexOf(r)>-1:"|="===n?o===r||o.slice(0,r.length+1)===r+"-":!1):!0}},CHILD:function(t,e,n,r,i){var o="nth"!==t.slice(0,3),a="last"!==t.slice(-4),s="of-type"===e;return 1===r&&0===i?function(t){return!!t.parentNode}:function(e,n,h){var u,c,l,f,p,d,m=o!==a?"nextSibling":"previousSibling",g=e.parentNode,v=s&&e.nodeName.toLowerCase(),y=!h&&!s;if(g){if(o){for(;m;){for(l=e;l=l[m];)if(s?l.nodeName.toLowerCase()===v:1===l.nodeType)return!1;d=m="only"===t&&!d&&"nextSibling"}return!0}if(d=[a?g.firstChild:g.lastChild],a&&y){for(c=g[I]||(g[I]={}),u=c[t]||[],p=u[0]===U&&u[1],f=u[0]===U&&u[2],l=p&&g.childNodes[p];l=++p&&l&&l[m]||(f=p=0)||d.pop();)if(1===l.nodeType&&++f&&l===e){c[t]=[U,p,f];break}}else if(y&&(u=(e[I]||(e[I]={}))[t])&&u[0]===U)f=u[1];else for(;(l=++p&&l&&l[m]||(f=p=0)||d.pop())&&((s?l.nodeName.toLowerCase()!==v:1!==l.nodeType)||!++f||(y&&((l[I]||(l[I]={}))[t]=[U,f]),l!==e)););return f-=i,f===r||f%r===0&&f/r>=0}}},PSEUDO:function(t,n){var i,o=b.pseudos[t]||b.setFilters[t.toLowerCase()]||e.error("unsupported pseudo: "+t);return o[I]?o(n):o.length>1?(i=[t,t,"",n],b.setFilters.hasOwnProperty(t.toLowerCase())?r(function(t,e){for(var r,i=o(t,n),a=i.length;a--;)r=ee.call(t,i[a]),t[r]=!(e[r]=i[a])}):function(t){return o(t,0,i)}):o}},pseudos:{not:r(function(t){var e=[],n=[],i=H(t.replace(he,"$1"));return i[I]?r(function(t,e,n,r){for(var o,a=i(t,null,r,[]),s=t.length;s--;)(o=a[s])&&(t[s]=!(e[s]=o))}):function(t,r,o){return e[0]=t,i(e,null,o,n),!n.pop()}}),has:r(function(t){return function(n){return e(t,n).length>0}}),contains:r(function(t){return function(e){return(e.textContent||e.innerText||R(e)).indexOf(t)>-1}}),lang:r(function(t){return pe.test(t||"")||e.error("unsupported lang: "+t),t=t.replace(Te,be).toLowerCase(),function(e){var n;do if(n=z?e.lang:e.getAttribute("xml:lang")||e.getAttribute("lang"))return n=n.toLowerCase(),n===t||0===n.indexOf(t+"-");while((e=e.parentNode)&&1===e.nodeType);return!1}}),target:function(e){var n=t.location&&t.location.hash;return n&&n.slice(1)===e.id},root:function(t){return t===D},focus:function(t){return t===P.activeElement&&(!P.hasFocus||P.hasFocus())&&!!(t.type||t.href||~t.tabIndex)},enabled:function(t){return t.disabled===!1},disabled:function(t){return t.disabled===!0},checked:function(t){var e=t.nodeName.toLowerCase();return"input"===e&&!!t.checked||"option"===e&&!!t.selected},selected:function(t){return t.parentNode&&t.parentNode.selectedIndex,t.selected===!0},empty:function(t){for(t=t.firstChild;t;t=t.nextSibling)if(t.nodeType<6)return!1;return!0},parent:function(t){return!b.pseudos.empty(t)},header:function(t){return ge.test(t.nodeName)},input:function(t){return me.test(t.nodeName)},button:function(t){var e=t.nodeName.toLowerCase();return"input"===e&&"button"===t.type||"button"===e},text:function(t){var e;return"input"===t.nodeName.toLowerCase()&&"text"===t.type&&(null==(e=t.getAttribute("type"))||"text"===e.toLowerCase())},first:u(function(){return[0]}),last:u(function(t,e){return[e-1]}),eq:u(function(t,e,n){return[0>n?n+e:n]}),even:u(function(t,e){for(var n=0;e>n;n+=2)t.push(n);return t}),odd:u(function(t,e){for(var n=1;e>n;n+=2)t.push(n);return t}),lt:u(function(t,e,n){for(var r=0>n?n+e:n;--r>=0;)t.push(r);return t}),gt:u(function(t,e,n){for(var r=0>n?n+e:n;++r<e;)t.push(r);return t})}},b.pseudos.nth=b.pseudos.eq;for(x in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})b.pseudos[x]=s(x);for(x in{submit:!0,reset:!0})b.pseudos[x]=h(x);return l.prototype=b.filters=b.pseudos,b.setFilters=new l,_=e.tokenize=function(t,n){var r,i,o,a,s,h,u,c=G[t+" "];if(c)return n?0:c.slice(0);for(s=t,h=[],u=b.preFilter;s;){(!r||(i=ue.exec(s)))&&(i&&(s=s.slice(i[0].length)||s),h.push(o=[])),r=!1,(i=ce.exec(s))&&(r=i.shift(),o.push({value:r,type:i[0].replace(he," ")}),s=s.slice(r.length));for(a in b.filter)!(i=de[a].exec(s))||u[a]&&!(i=u[a](i))||(r=i.shift(),o.push({value:r,type:a,matches:i}),s=s.slice(r.length));if(!r)break}return n?s.length:s?e.error(t):G(t,h).slice(0)},H=e.compile=function(t,e){var n,r=[],i=[],o=j[t+" "];if(!o){for(e||(e=_(t)),n=e.length;n--;)o=y(e[n]),o[I]?r.push(o):i.push(o);o=j(t,E(i,r)),o.selector=t}return o},M=e.select=function(t,e,n,r){var i,o,a,s,h,u="function"==typeof t&&t,l=!r&&_(t=u.selector||t);if(n=n||[],1===l.length){if(o=l[0]=l[0].slice(0),o.length>2&&"ID"===(a=o[0]).type&&T.getById&&9===e.nodeType&&z&&b.relative[o[1].type]){if(e=(b.find.ID(a.matches[0].replace(Te,be),e)||[])[0],!e)return n;u&&(e=e.parentNode),t=t.slice(o.shift().value.length)}for(i=de.needsContext.test(t)?0:o.length;i--&&(a=o[i],!b.relative[s=a.type]);)if((h=b.find[s])&&(r=h(a.matches[0].replace(Te,be),Ee.test(o[0].type)&&c(e.parentNode)||e))){if(o.splice(i,1),t=r.length&&f(o),!t)return J.apply(n,r),n;break}}return(u||H(t,l))(r,e,!z,n,Ee.test(t)&&c(e.parentNode)||e),n},T.sortStable=I.split("").sort(q).join("")===I,T.detectDuplicates=!!A,L(),T.sortDetached=i(function(t){return 1&t.compareDocumentPosition(P.createElement("div"))}),i(function(t){return t.innerHTML="<a href='#'></a>","#"===t.firstChild.getAttribute("href")})||o("type|href|height|width",function(t,e,n){return n?void 0:t.getAttribute(e,"type"===e.toLowerCase()?1:2)}),T.attributes&&i(function(t){return t.innerHTML="<input/>",t.firstChild.setAttribute("value",""),""===t.firstChild.getAttribute("value")})||o("value",function(t,e,n){return n||"input"!==t.nodeName.toLowerCase()?void 0:t.defaultValue}),i(function(t){return null==t.getAttribute("disabled")})||o(ne,function(t,e,n){var r;return n?void 0:t[e]===!0?e.toLowerCase():(r=t.getAttributeNode(e))&&r.specified?r.value:null}),e}(t);J.find=ie,J.expr=ie.selectors,J.expr[":"]=J.expr.pseudos,J.unique=ie.uniqueSort,J.text=ie.getText,J.isXMLDoc=ie.isXML,J.contains=ie.contains;var oe=J.expr.match.needsContext,ae=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,se=/^.[^:#\[\.,]*$/;J.filter=function(t,e,n){var r=e[0];return n&&(t=":not("+t+")"),1===e.length&&1===r.nodeType?J.find.matchesSelector(r,t)?[r]:[]:J.find.matches(t,J.grep(e,function(t){return 1===t.nodeType}))},J.fn.extend({find:function(t){var e,n=this.length,r=[],i=this;if("string"!=typeof t)return this.pushStack(J(t).filter(function(){for(e=0;n>e;e++)if(J.contains(i[e],this))return!0
}));for(e=0;n>e;e++)J.find(t,i[e],r);return r=this.pushStack(n>1?J.unique(r):r),r.selector=this.selector?this.selector+" "+t:t,r},filter:function(t){return this.pushStack(r(this,t||[],!1))},not:function(t){return this.pushStack(r(this,t||[],!0))},is:function(t){return!!r(this,"string"==typeof t&&oe.test(t)?J(t):t||[],!1).length}});var he,ue=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,ce=J.fn.init=function(t,e){var n,r;if(!t)return this;if("string"==typeof t){if(n="<"===t[0]&&">"===t[t.length-1]&&t.length>=3?[null,t,null]:ue.exec(t),!n||!n[1]&&e)return!e||e.jquery?(e||he).find(t):this.constructor(e).find(t);if(n[1]){if(e=e instanceof J?e[0]:e,J.merge(this,J.parseHTML(n[1],e&&e.nodeType?e.ownerDocument||e:Q,!0)),ae.test(n[1])&&J.isPlainObject(e))for(n in e)J.isFunction(this[n])?this[n](e[n]):this.attr(n,e[n]);return this}return r=Q.getElementById(n[2]),r&&r.parentNode&&(this.length=1,this[0]=r),this.context=Q,this.selector=t,this}return t.nodeType?(this.context=this[0]=t,this.length=1,this):J.isFunction(t)?"undefined"!=typeof he.ready?he.ready(t):t(J):(void 0!==t.selector&&(this.selector=t.selector,this.context=t.context),J.makeArray(t,this))};ce.prototype=J.fn,he=J(Q);var le=/^(?:parents|prev(?:Until|All))/,fe={children:!0,contents:!0,next:!0,prev:!0};J.extend({dir:function(t,e,n){for(var r=[],i=void 0!==n;(t=t[e])&&9!==t.nodeType;)if(1===t.nodeType){if(i&&J(t).is(n))break;r.push(t)}return r},sibling:function(t,e){for(var n=[];t;t=t.nextSibling)1===t.nodeType&&t!==e&&n.push(t);return n}}),J.fn.extend({has:function(t){var e=J(t,this),n=e.length;return this.filter(function(){for(var t=0;n>t;t++)if(J.contains(this,e[t]))return!0})},closest:function(t,e){for(var n,r=0,i=this.length,o=[],a=oe.test(t)||"string"!=typeof t?J(t,e||this.context):0;i>r;r++)for(n=this[r];n&&n!==e;n=n.parentNode)if(n.nodeType<11&&(a?a.index(n)>-1:1===n.nodeType&&J.find.matchesSelector(n,t))){o.push(n);break}return this.pushStack(o.length>1?J.unique(o):o)},index:function(t){return t?"string"==typeof t?q.call(J(t),this[0]):q.call(this,t.jquery?t[0]:t):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(t,e){return this.pushStack(J.unique(J.merge(this.get(),J(t,e))))},addBack:function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}}),J.each({parent:function(t){var e=t.parentNode;return e&&11!==e.nodeType?e:null},parents:function(t){return J.dir(t,"parentNode")},parentsUntil:function(t,e,n){return J.dir(t,"parentNode",n)},next:function(t){return i(t,"nextSibling")},prev:function(t){return i(t,"previousSibling")},nextAll:function(t){return J.dir(t,"nextSibling")},prevAll:function(t){return J.dir(t,"previousSibling")},nextUntil:function(t,e,n){return J.dir(t,"nextSibling",n)},prevUntil:function(t,e,n){return J.dir(t,"previousSibling",n)},siblings:function(t){return J.sibling((t.parentNode||{}).firstChild,t)},children:function(t){return J.sibling(t.firstChild)},contents:function(t){return t.contentDocument||J.merge([],t.childNodes)}},function(t,e){J.fn[t]=function(n,r){var i=J.map(this,e,n);return"Until"!==t.slice(-5)&&(r=n),r&&"string"==typeof r&&(i=J.filter(r,i)),this.length>1&&(fe[t]||J.unique(i),le.test(t)&&i.reverse()),this.pushStack(i)}});var pe=/\S+/g,de={};J.Callbacks=function(t){t="string"==typeof t?de[t]||o(t):J.extend({},t);var e,n,r,i,a,s,h=[],u=!t.once&&[],c=function(o){for(e=t.memory&&o,n=!0,s=i||0,i=0,a=h.length,r=!0;h&&a>s;s++)if(h[s].apply(o[0],o[1])===!1&&t.stopOnFalse){e=!1;break}r=!1,h&&(u?u.length&&c(u.shift()):e?h=[]:l.disable())},l={add:function(){if(h){var n=h.length;!function o(e){J.each(e,function(e,n){var r=J.type(n);"function"===r?t.unique&&l.has(n)||h.push(n):n&&n.length&&"string"!==r&&o(n)})}(arguments),r?a=h.length:e&&(i=n,c(e))}return this},remove:function(){return h&&J.each(arguments,function(t,e){for(var n;(n=J.inArray(e,h,n))>-1;)h.splice(n,1),r&&(a>=n&&a--,s>=n&&s--)}),this},has:function(t){return t?J.inArray(t,h)>-1:!(!h||!h.length)},empty:function(){return h=[],a=0,this},disable:function(){return h=u=e=void 0,this},disabled:function(){return!h},lock:function(){return u=void 0,e||l.disable(),this},locked:function(){return!u},fireWith:function(t,e){return!h||n&&!u||(e=e||[],e=[t,e.slice?e.slice():e],r?u.push(e):c(e)),this},fire:function(){return l.fireWith(this,arguments),this},fired:function(){return!!n}};return l},J.extend({Deferred:function(t){var e=[["resolve","done",J.Callbacks("once memory"),"resolved"],["reject","fail",J.Callbacks("once memory"),"rejected"],["notify","progress",J.Callbacks("memory")]],n="pending",r={state:function(){return n},always:function(){return i.done(arguments).fail(arguments),this},then:function(){var t=arguments;return J.Deferred(function(n){J.each(e,function(e,o){var a=J.isFunction(t[e])&&t[e];i[o[1]](function(){var t=a&&a.apply(this,arguments);t&&J.isFunction(t.promise)?t.promise().done(n.resolve).fail(n.reject).progress(n.notify):n[o[0]+"With"](this===r?n.promise():this,a?[t]:arguments)})}),t=null}).promise()},promise:function(t){return null!=t?J.extend(t,r):r}},i={};return r.pipe=r.then,J.each(e,function(t,o){var a=o[2],s=o[3];r[o[1]]=a.add,s&&a.add(function(){n=s},e[1^t][2].disable,e[2][2].lock),i[o[0]]=function(){return i[o[0]+"With"](this===i?r:this,arguments),this},i[o[0]+"With"]=a.fireWith}),r.promise(i),t&&t.call(i,i),i},when:function(t){var e,n,r,i=0,o=W.call(arguments),a=o.length,s=1!==a||t&&J.isFunction(t.promise)?a:0,h=1===s?t:J.Deferred(),u=function(t,n,r){return function(i){n[t]=this,r[t]=arguments.length>1?W.call(arguments):i,r===e?h.notifyWith(n,r):--s||h.resolveWith(n,r)}};if(a>1)for(e=new Array(a),n=new Array(a),r=new Array(a);a>i;i++)o[i]&&J.isFunction(o[i].promise)?o[i].promise().done(u(i,r,o)).fail(h.reject).progress(u(i,n,e)):--s;return s||h.resolveWith(r,o),h.promise()}});var me;J.fn.ready=function(t){return J.ready.promise().done(t),this},J.extend({isReady:!1,readyWait:1,holdReady:function(t){t?J.readyWait++:J.ready(!0)},ready:function(t){(t===!0?--J.readyWait:J.isReady)||(J.isReady=!0,t!==!0&&--J.readyWait>0||(me.resolveWith(Q,[J]),J.fn.triggerHandler&&(J(Q).triggerHandler("ready"),J(Q).off("ready"))))}}),J.ready.promise=function(e){return me||(me=J.Deferred(),"complete"===Q.readyState?setTimeout(J.ready):(Q.addEventListener("DOMContentLoaded",a,!1),t.addEventListener("load",a,!1))),me.promise(e)},J.ready.promise();var ge=J.access=function(t,e,n,r,i,o,a){var s=0,h=t.length,u=null==n;if("object"===J.type(n)){i=!0;for(s in n)J.access(t,e,s,n[s],!0,o,a)}else if(void 0!==r&&(i=!0,J.isFunction(r)||(a=!0),u&&(a?(e.call(t,r),e=null):(u=e,e=function(t,e,n){return u.call(J(t),n)})),e))for(;h>s;s++)e(t[s],n,a?r:r.call(t[s],s,e(t[s],n)));return i?t:u?e.call(t):h?e(t[0],n):o};J.acceptData=function(t){return 1===t.nodeType||9===t.nodeType||!+t.nodeType},s.uid=1,s.accepts=J.acceptData,s.prototype={key:function(t){if(!s.accepts(t))return 0;var e={},n=t[this.expando];if(!n){n=s.uid++;try{e[this.expando]={value:n},Object.defineProperties(t,e)}catch(r){e[this.expando]=n,J.extend(t,e)}}return this.cache[n]||(this.cache[n]={}),n},set:function(t,e,n){var r,i=this.key(t),o=this.cache[i];if("string"==typeof e)o[e]=n;else if(J.isEmptyObject(o))J.extend(this.cache[i],e);else for(r in e)o[r]=e[r];return o},get:function(t,e){var n=this.cache[this.key(t)];return void 0===e?n:n[e]},access:function(t,e,n){var r;return void 0===e||e&&"string"==typeof e&&void 0===n?(r=this.get(t,e),void 0!==r?r:this.get(t,J.camelCase(e))):(this.set(t,e,n),void 0!==n?n:e)},remove:function(t,e){var n,r,i,o=this.key(t),a=this.cache[o];if(void 0===e)this.cache[o]={};else{J.isArray(e)?r=e.concat(e.map(J.camelCase)):(i=J.camelCase(e),e in a?r=[e,i]:(r=i,r=r in a?[r]:r.match(pe)||[])),n=r.length;for(;n--;)delete a[r[n]]}},hasData:function(t){return!J.isEmptyObject(this.cache[t[this.expando]]||{})},discard:function(t){t[this.expando]&&delete this.cache[t[this.expando]]}};var ve=new s,ye=new s,Ee=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,xe=/([A-Z])/g;J.extend({hasData:function(t){return ye.hasData(t)||ve.hasData(t)},data:function(t,e,n){return ye.access(t,e,n)},removeData:function(t,e){ye.remove(t,e)},_data:function(t,e,n){return ve.access(t,e,n)},_removeData:function(t,e){ve.remove(t,e)}}),J.fn.extend({data:function(t,e){var n,r,i,o=this[0],a=o&&o.attributes;if(void 0===t){if(this.length&&(i=ye.get(o),1===o.nodeType&&!ve.get(o,"hasDataAttrs"))){for(n=a.length;n--;)a[n]&&(r=a[n].name,0===r.indexOf("data-")&&(r=J.camelCase(r.slice(5)),h(o,r,i[r])));ve.set(o,"hasDataAttrs",!0)}return i}return"object"==typeof t?this.each(function(){ye.set(this,t)}):ge(this,function(e){var n,r=J.camelCase(t);if(o&&void 0===e){if(n=ye.get(o,t),void 0!==n)return n;if(n=ye.get(o,r),void 0!==n)return n;if(n=h(o,r,void 0),void 0!==n)return n}else this.each(function(){var n=ye.get(this,r);ye.set(this,r,e),-1!==t.indexOf("-")&&void 0!==n&&ye.set(this,t,e)})},null,e,arguments.length>1,null,!0)},removeData:function(t){return this.each(function(){ye.remove(this,t)})}}),J.extend({queue:function(t,e,n){var r;return t?(e=(e||"fx")+"queue",r=ve.get(t,e),n&&(!r||J.isArray(n)?r=ve.access(t,e,J.makeArray(n)):r.push(n)),r||[]):void 0},dequeue:function(t,e){e=e||"fx";var n=J.queue(t,e),r=n.length,i=n.shift(),o=J._queueHooks(t,e),a=function(){J.dequeue(t,e)};"inprogress"===i&&(i=n.shift(),r--),i&&("fx"===e&&n.unshift("inprogress"),delete o.stop,i.call(t,a,o)),!r&&o&&o.empty.fire()},_queueHooks:function(t,e){var n=e+"queueHooks";return ve.get(t,n)||ve.access(t,n,{empty:J.Callbacks("once memory").add(function(){ve.remove(t,[e+"queue",n])})})}}),J.fn.extend({queue:function(t,e){var n=2;return"string"!=typeof t&&(e=t,t="fx",n--),arguments.length<n?J.queue(this[0],t):void 0===e?this:this.each(function(){var n=J.queue(this,t,e);J._queueHooks(this,t),"fx"===t&&"inprogress"!==n[0]&&J.dequeue(this,t)})},dequeue:function(t){return this.each(function(){J.dequeue(this,t)})},clearQueue:function(t){return this.queue(t||"fx",[])},promise:function(t,e){var n,r=1,i=J.Deferred(),o=this,a=this.length,s=function(){--r||i.resolveWith(o,[o])};for("string"!=typeof t&&(e=t,t=void 0),t=t||"fx";a--;)n=ve.get(o[a],t+"queueHooks"),n&&n.empty&&(r++,n.empty.add(s));return s(),i.promise(e)}});var Te=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,be=["Top","Right","Bottom","Left"],Re=function(t,e){return t=e||t,"none"===J.css(t,"display")||!J.contains(t.ownerDocument,t)},we=/^(?:checkbox|radio)$/i;!function(){var t=Q.createDocumentFragment(),e=t.appendChild(Q.createElement("div")),n=Q.createElement("input");n.setAttribute("type","radio"),n.setAttribute("checked","checked"),n.setAttribute("name","t"),e.appendChild(n),K.checkClone=e.cloneNode(!0).cloneNode(!0).lastChild.checked,e.innerHTML="<textarea>x</textarea>",K.noCloneChecked=!!e.cloneNode(!0).lastChild.defaultValue}();var _e="undefined";K.focusinBubbles="onfocusin"in t;var He=/^key/,Me=/^(?:mouse|pointer|contextmenu)|click/,Se=/^(?:focusinfocus|focusoutblur)$/,Ce=/^([^.]*)(?:\.(.+)|)$/;J.event={global:{},add:function(t,e,n,r,i){var o,a,s,h,u,c,l,f,p,d,m,g=ve.get(t);if(g)for(n.handler&&(o=n,n=o.handler,i=o.selector),n.guid||(n.guid=J.guid++),(h=g.events)||(h=g.events={}),(a=g.handle)||(a=g.handle=function(e){return typeof J!==_e&&J.event.triggered!==e.type?J.event.dispatch.apply(t,arguments):void 0}),e=(e||"").match(pe)||[""],u=e.length;u--;)s=Ce.exec(e[u])||[],p=m=s[1],d=(s[2]||"").split(".").sort(),p&&(l=J.event.special[p]||{},p=(i?l.delegateType:l.bindType)||p,l=J.event.special[p]||{},c=J.extend({type:p,origType:m,data:r,handler:n,guid:n.guid,selector:i,needsContext:i&&J.expr.match.needsContext.test(i),namespace:d.join(".")},o),(f=h[p])||(f=h[p]=[],f.delegateCount=0,l.setup&&l.setup.call(t,r,d,a)!==!1||t.addEventListener&&t.addEventListener(p,a,!1)),l.add&&(l.add.call(t,c),c.handler.guid||(c.handler.guid=n.guid)),i?f.splice(f.delegateCount++,0,c):f.push(c),J.event.global[p]=!0)},remove:function(t,e,n,r,i){var o,a,s,h,u,c,l,f,p,d,m,g=ve.hasData(t)&&ve.get(t);if(g&&(h=g.events)){for(e=(e||"").match(pe)||[""],u=e.length;u--;)if(s=Ce.exec(e[u])||[],p=m=s[1],d=(s[2]||"").split(".").sort(),p){for(l=J.event.special[p]||{},p=(r?l.delegateType:l.bindType)||p,f=h[p]||[],s=s[2]&&new RegExp("(^|\\.)"+d.join("\\.(?:.*\\.|)")+"(\\.|$)"),a=o=f.length;o--;)c=f[o],!i&&m!==c.origType||n&&n.guid!==c.guid||s&&!s.test(c.namespace)||r&&r!==c.selector&&("**"!==r||!c.selector)||(f.splice(o,1),c.selector&&f.delegateCount--,l.remove&&l.remove.call(t,c));a&&!f.length&&(l.teardown&&l.teardown.call(t,d,g.handle)!==!1||J.removeEvent(t,p,g.handle),delete h[p])}else for(p in h)J.event.remove(t,p+e[u],n,r,!0);J.isEmptyObject(h)&&(delete g.handle,ve.remove(t,"events"))}},trigger:function(e,n,r,i){var o,a,s,h,u,c,l,f=[r||Q],p=Z.call(e,"type")?e.type:e,d=Z.call(e,"namespace")?e.namespace.split("."):[];if(a=s=r=r||Q,3!==r.nodeType&&8!==r.nodeType&&!Se.test(p+J.event.triggered)&&(p.indexOf(".")>=0&&(d=p.split("."),p=d.shift(),d.sort()),u=p.indexOf(":")<0&&"on"+p,e=e[J.expando]?e:new J.Event(p,"object"==typeof e&&e),e.isTrigger=i?2:3,e.namespace=d.join("."),e.namespace_re=e.namespace?new RegExp("(^|\\.)"+d.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,e.result=void 0,e.target||(e.target=r),n=null==n?[e]:J.makeArray(n,[e]),l=J.event.special[p]||{},i||!l.trigger||l.trigger.apply(r,n)!==!1)){if(!i&&!l.noBubble&&!J.isWindow(r)){for(h=l.delegateType||p,Se.test(h+p)||(a=a.parentNode);a;a=a.parentNode)f.push(a),s=a;s===(r.ownerDocument||Q)&&f.push(s.defaultView||s.parentWindow||t)}for(o=0;(a=f[o++])&&!e.isPropagationStopped();)e.type=o>1?h:l.bindType||p,c=(ve.get(a,"events")||{})[e.type]&&ve.get(a,"handle"),c&&c.apply(a,n),c=u&&a[u],c&&c.apply&&J.acceptData(a)&&(e.result=c.apply(a,n),e.result===!1&&e.preventDefault());return e.type=p,i||e.isDefaultPrevented()||l._default&&l._default.apply(f.pop(),n)!==!1||!J.acceptData(r)||u&&J.isFunction(r[p])&&!J.isWindow(r)&&(s=r[u],s&&(r[u]=null),J.event.triggered=p,r[p](),J.event.triggered=void 0,s&&(r[u]=s)),e.result}},dispatch:function(t){t=J.event.fix(t);var e,n,r,i,o,a=[],s=W.call(arguments),h=(ve.get(this,"events")||{})[t.type]||[],u=J.event.special[t.type]||{};if(s[0]=t,t.delegateTarget=this,!u.preDispatch||u.preDispatch.call(this,t)!==!1){for(a=J.event.handlers.call(this,t,h),e=0;(i=a[e++])&&!t.isPropagationStopped();)for(t.currentTarget=i.elem,n=0;(o=i.handlers[n++])&&!t.isImmediatePropagationStopped();)(!t.namespace_re||t.namespace_re.test(o.namespace))&&(t.handleObj=o,t.data=o.data,r=((J.event.special[o.origType]||{}).handle||o.handler).apply(i.elem,s),void 0!==r&&(t.result=r)===!1&&(t.preventDefault(),t.stopPropagation()));return u.postDispatch&&u.postDispatch.call(this,t),t.result}},handlers:function(t,e){var n,r,i,o,a=[],s=e.delegateCount,h=t.target;if(s&&h.nodeType&&(!t.button||"click"!==t.type))for(;h!==this;h=h.parentNode||this)if(h.disabled!==!0||"click"!==t.type){for(r=[],n=0;s>n;n++)o=e[n],i=o.selector+" ",void 0===r[i]&&(r[i]=o.needsContext?J(i,this).index(h)>=0:J.find(i,this,null,[h]).length),r[i]&&r.push(o);r.length&&a.push({elem:h,handlers:r})}return s<e.length&&a.push({elem:this,handlers:e.slice(s)}),a},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(t,e){return null==t.which&&(t.which=null!=e.charCode?e.charCode:e.keyCode),t}},mouseHooks:{props:"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(t,e){var n,r,i,o=e.button;return null==t.pageX&&null!=e.clientX&&(n=t.target.ownerDocument||Q,r=n.documentElement,i=n.body,t.pageX=e.clientX+(r&&r.scrollLeft||i&&i.scrollLeft||0)-(r&&r.clientLeft||i&&i.clientLeft||0),t.pageY=e.clientY+(r&&r.scrollTop||i&&i.scrollTop||0)-(r&&r.clientTop||i&&i.clientTop||0)),t.which||void 0===o||(t.which=1&o?1:2&o?3:4&o?2:0),t}},fix:function(t){if(t[J.expando])return t;var e,n,r,i=t.type,o=t,a=this.fixHooks[i];for(a||(this.fixHooks[i]=a=Me.test(i)?this.mouseHooks:He.test(i)?this.keyHooks:{}),r=a.props?this.props.concat(a.props):this.props,t=new J.Event(o),e=r.length;e--;)n=r[e],t[n]=o[n];return t.target||(t.target=Q),3===t.target.nodeType&&(t.target=t.target.parentNode),a.filter?a.filter(t,o):t},special:{load:{noBubble:!0},focus:{trigger:function(){return this!==l()&&this.focus?(this.focus(),!1):void 0},delegateType:"focusin"},blur:{trigger:function(){return this===l()&&this.blur?(this.blur(),!1):void 0},delegateType:"focusout"},click:{trigger:function(){return"checkbox"===this.type&&this.click&&J.nodeName(this,"input")?(this.click(),!1):void 0},_default:function(t){return J.nodeName(t.target,"a")}},beforeunload:{postDispatch:function(t){void 0!==t.result&&t.originalEvent&&(t.originalEvent.returnValue=t.result)}}},simulate:function(t,e,n,r){var i=J.extend(new J.Event,n,{type:t,isSimulated:!0,originalEvent:{}});r?J.event.trigger(i,null,e):J.event.dispatch.call(e,i),i.isDefaultPrevented()&&n.preventDefault()}},J.removeEvent=function(t,e,n){t.removeEventListener&&t.removeEventListener(e,n,!1)},J.Event=function(t,e){return this instanceof J.Event?(t&&t.type?(this.originalEvent=t,this.type=t.type,this.isDefaultPrevented=t.defaultPrevented||void 0===t.defaultPrevented&&t.returnValue===!1?u:c):this.type=t,e&&J.extend(this,e),this.timeStamp=t&&t.timeStamp||J.now(),void(this[J.expando]=!0)):new J.Event(t,e)},J.Event.prototype={isDefaultPrevented:c,isPropagationStopped:c,isImmediatePropagationStopped:c,preventDefault:function(){var t=this.originalEvent;this.isDefaultPrevented=u,t&&t.preventDefault&&t.preventDefault()},stopPropagation:function(){var t=this.originalEvent;this.isPropagationStopped=u,t&&t.stopPropagation&&t.stopPropagation()},stopImmediatePropagation:function(){var t=this.originalEvent;this.isImmediatePropagationStopped=u,t&&t.stopImmediatePropagation&&t.stopImmediatePropagation(),this.stopPropagation()}},J.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(t,e){J.event.special[t]={delegateType:e,bindType:e,handle:function(t){var n,r=this,i=t.relatedTarget,o=t.handleObj;return(!i||i!==r&&!J.contains(r,i))&&(t.type=o.origType,n=o.handler.apply(this,arguments),t.type=e),n}}}),K.focusinBubbles||J.each({focus:"focusin",blur:"focusout"},function(t,e){var n=function(t){J.event.simulate(e,t.target,J.event.fix(t),!0)};J.event.special[e]={setup:function(){var r=this.ownerDocument||this,i=ve.access(r,e);i||r.addEventListener(t,n,!0),ve.access(r,e,(i||0)+1)},teardown:function(){var r=this.ownerDocument||this,i=ve.access(r,e)-1;i?ve.access(r,e,i):(r.removeEventListener(t,n,!0),ve.remove(r,e))}}}),J.fn.extend({on:function(t,e,n,r,i){var o,a;if("object"==typeof t){"string"!=typeof e&&(n=n||e,e=void 0);for(a in t)this.on(a,e,n,t[a],i);return this}if(null==n&&null==r?(r=e,n=e=void 0):null==r&&("string"==typeof e?(r=n,n=void 0):(r=n,n=e,e=void 0)),r===!1)r=c;else if(!r)return this;return 1===i&&(o=r,r=function(t){return J().off(t),o.apply(this,arguments)},r.guid=o.guid||(o.guid=J.guid++)),this.each(function(){J.event.add(this,t,r,n,e)})},one:function(t,e,n,r){return this.on(t,e,n,r,1)},off:function(t,e,n){var r,i;if(t&&t.preventDefault&&t.handleObj)return r=t.handleObj,J(t.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler),this;if("object"==typeof t){for(i in t)this.off(i,e,t[i]);return this}return(e===!1||"function"==typeof e)&&(n=e,e=void 0),n===!1&&(n=c),this.each(function(){J.event.remove(this,t,n,e)})},trigger:function(t,e){return this.each(function(){J.event.trigger(t,e,this)})},triggerHandler:function(t,e){var n=this[0];return n?J.event.trigger(t,e,n,!0):void 0}});var Ae=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,Le=/<([\w:]+)/,Pe=/<|&#?\w+;/,De=/<(?:script|style|link)/i,ze=/checked\s*(?:[^=]|=\s*.checked.)/i,Fe=/^$|\/(?:java|ecma)script/i,ke=/^true\/(.*)/,Ne=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,Ve={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};Ve.optgroup=Ve.option,Ve.tbody=Ve.tfoot=Ve.colgroup=Ve.caption=Ve.thead,Ve.th=Ve.td,J.extend({clone:function(t,e,n){var r,i,o,a,s=t.cloneNode(!0),h=J.contains(t.ownerDocument,t);if(!(K.noCloneChecked||1!==t.nodeType&&11!==t.nodeType||J.isXMLDoc(t)))for(a=v(s),o=v(t),r=0,i=o.length;i>r;r++)y(o[r],a[r]);if(e)if(n)for(o=o||v(t),a=a||v(s),r=0,i=o.length;i>r;r++)g(o[r],a[r]);else g(t,s);return a=v(s,"script"),a.length>0&&m(a,!h&&v(t,"script")),s},buildFragment:function(t,e,n,r){for(var i,o,a,s,h,u,c=e.createDocumentFragment(),l=[],f=0,p=t.length;p>f;f++)if(i=t[f],i||0===i)if("object"===J.type(i))J.merge(l,i.nodeType?[i]:i);else if(Pe.test(i)){for(o=o||c.appendChild(e.createElement("div")),a=(Le.exec(i)||["",""])[1].toLowerCase(),s=Ve[a]||Ve._default,o.innerHTML=s[1]+i.replace(Ae,"<$1></$2>")+s[2],u=s[0];u--;)o=o.lastChild;J.merge(l,o.childNodes),o=c.firstChild,o.textContent=""}else l.push(e.createTextNode(i));for(c.textContent="",f=0;i=l[f++];)if((!r||-1===J.inArray(i,r))&&(h=J.contains(i.ownerDocument,i),o=v(c.appendChild(i),"script"),h&&m(o),n))for(u=0;i=o[u++];)Fe.test(i.type||"")&&n.push(i);return c},cleanData:function(t){for(var e,n,r,i,o=J.event.special,a=0;void 0!==(n=t[a]);a++){if(J.acceptData(n)&&(i=n[ve.expando],i&&(e=ve.cache[i]))){if(e.events)for(r in e.events)o[r]?J.event.remove(n,r):J.removeEvent(n,r,e.handle);ve.cache[i]&&delete ve.cache[i]}delete ye.cache[n[ye.expando]]}}}),J.fn.extend({text:function(t){return ge(this,function(t){return void 0===t?J.text(this):this.empty().each(function(){(1===this.nodeType||11===this.nodeType||9===this.nodeType)&&(this.textContent=t)})},null,t,arguments.length)},append:function(){return this.domManip(arguments,function(t){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var e=f(this,t);e.appendChild(t)}})},prepend:function(){return this.domManip(arguments,function(t){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var e=f(this,t);e.insertBefore(t,e.firstChild)}})},before:function(){return this.domManip(arguments,function(t){this.parentNode&&this.parentNode.insertBefore(t,this)})},after:function(){return this.domManip(arguments,function(t){this.parentNode&&this.parentNode.insertBefore(t,this.nextSibling)})},remove:function(t,e){for(var n,r=t?J.filter(t,this):this,i=0;null!=(n=r[i]);i++)e||1!==n.nodeType||J.cleanData(v(n)),n.parentNode&&(e&&J.contains(n.ownerDocument,n)&&m(v(n,"script")),n.parentNode.removeChild(n));return this},empty:function(){for(var t,e=0;null!=(t=this[e]);e++)1===t.nodeType&&(J.cleanData(v(t,!1)),t.textContent="");return this},clone:function(t,e){return t=null==t?!1:t,e=null==e?t:e,this.map(function(){return J.clone(this,t,e)})},html:function(t){return ge(this,function(t){var e=this[0]||{},n=0,r=this.length;if(void 0===t&&1===e.nodeType)return e.innerHTML;if("string"==typeof t&&!De.test(t)&&!Ve[(Le.exec(t)||["",""])[1].toLowerCase()]){t=t.replace(Ae,"<$1></$2>");try{for(;r>n;n++)e=this[n]||{},1===e.nodeType&&(J.cleanData(v(e,!1)),e.innerHTML=t);e=0}catch(i){}}e&&this.empty().append(t)},null,t,arguments.length)},replaceWith:function(){var t=arguments[0];return this.domManip(arguments,function(e){t=this.parentNode,J.cleanData(v(this)),t&&t.replaceChild(e,this)}),t&&(t.length||t.nodeType)?this:this.remove()},detach:function(t){return this.remove(t,!0)},domManip:function(t,e){t=G.apply([],t);var n,r,i,o,a,s,h=0,u=this.length,c=this,l=u-1,f=t[0],m=J.isFunction(f);if(m||u>1&&"string"==typeof f&&!K.checkClone&&ze.test(f))return this.each(function(n){var r=c.eq(n);m&&(t[0]=f.call(this,n,r.html())),r.domManip(t,e)});if(u&&(n=J.buildFragment(t,this[0].ownerDocument,!1,this),r=n.firstChild,1===n.childNodes.length&&(n=r),r)){for(i=J.map(v(n,"script"),p),o=i.length;u>h;h++)a=n,h!==l&&(a=J.clone(a,!0,!0),o&&J.merge(i,v(a,"script"))),e.call(this[h],a,h);if(o)for(s=i[i.length-1].ownerDocument,J.map(i,d),h=0;o>h;h++)a=i[h],Fe.test(a.type||"")&&!ve.access(a,"globalEval")&&J.contains(s,a)&&(a.src?J._evalUrl&&J._evalUrl(a.src):J.globalEval(a.textContent.replace(Ne,"")))}return this}}),J.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(t,e){J.fn[t]=function(t){for(var n,r=[],i=J(t),o=i.length-1,a=0;o>=a;a++)n=a===o?this:this.clone(!0),J(i[a])[e](n),j.apply(r,n.get());return this.pushStack(r)}});var Ie,Be={},Ue=/^margin/,Oe=new RegExp("^("+Te+")(?!px)[a-z%]+$","i"),We=function(t){return t.ownerDocument.defaultView.getComputedStyle(t,null)};!function(){function e(){a.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;display:block;margin-top:1%;top:1%;border:1px;padding:1px;width:4px;position:absolute",a.innerHTML="",i.appendChild(o);var e=t.getComputedStyle(a,null);n="1%"!==e.top,r="4px"===e.width,i.removeChild(o)}var n,r,i=Q.documentElement,o=Q.createElement("div"),a=Q.createElement("div");a.style&&(a.style.backgroundClip="content-box",a.cloneNode(!0).style.backgroundClip="",K.clearCloneStyle="content-box"===a.style.backgroundClip,o.style.cssText="border:0;width:0;height:0;top:0;left:-9999px;margin-top:1px;position:absolute",o.appendChild(a),t.getComputedStyle&&J.extend(K,{pixelPosition:function(){return e(),n},boxSizingReliable:function(){return null==r&&e(),r},reliableMarginRight:function(){var e,n=a.appendChild(Q.createElement("div"));return n.style.cssText=a.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:0",n.style.marginRight=n.style.width="0",a.style.width="1px",i.appendChild(o),e=!parseFloat(t.getComputedStyle(n,null).marginRight),i.removeChild(o),e}}))}(),J.swap=function(t,e,n,r){var i,o,a={};for(o in e)a[o]=t.style[o],t.style[o]=e[o];i=n.apply(t,r||[]);for(o in e)t.style[o]=a[o];return i};var Ge=/^(none|table(?!-c[ea]).+)/,je=new RegExp("^("+Te+")(.*)$","i"),qe=new RegExp("^([+-])=("+Te+")","i"),Xe={position:"absolute",visibility:"hidden",display:"block"},Ye={letterSpacing:"0",fontWeight:"400"},Ze=["Webkit","O","Moz","ms"];J.extend({cssHooks:{opacity:{get:function(t,e){if(e){var n=T(t,"opacity");return""===n?"1":n}}}},cssNumber:{columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":"cssFloat"},style:function(t,e,n,r){if(t&&3!==t.nodeType&&8!==t.nodeType&&t.style){var i,o,a,s=J.camelCase(e),h=t.style;return e=J.cssProps[s]||(J.cssProps[s]=R(h,s)),a=J.cssHooks[e]||J.cssHooks[s],void 0===n?a&&"get"in a&&void 0!==(i=a.get(t,!1,r))?i:h[e]:(o=typeof n,"string"===o&&(i=qe.exec(n))&&(n=(i[1]+1)*i[2]+parseFloat(J.css(t,e)),o="number"),null!=n&&n===n&&("number"!==o||J.cssNumber[s]||(n+="px"),K.clearCloneStyle||""!==n||0!==e.indexOf("background")||(h[e]="inherit"),a&&"set"in a&&void 0===(n=a.set(t,n,r))||(h[e]=n)),void 0)}},css:function(t,e,n,r){var i,o,a,s=J.camelCase(e);return e=J.cssProps[s]||(J.cssProps[s]=R(t.style,s)),a=J.cssHooks[e]||J.cssHooks[s],a&&"get"in a&&(i=a.get(t,!0,n)),void 0===i&&(i=T(t,e,r)),"normal"===i&&e in Ye&&(i=Ye[e]),""===n||n?(o=parseFloat(i),n===!0||J.isNumeric(o)?o||0:i):i}}),J.each(["height","width"],function(t,e){J.cssHooks[e]={get:function(t,n,r){return n?Ge.test(J.css(t,"display"))&&0===t.offsetWidth?J.swap(t,Xe,function(){return H(t,e,r)}):H(t,e,r):void 0},set:function(t,n,r){var i=r&&We(t);return w(t,n,r?_(t,e,r,"border-box"===J.css(t,"boxSizing",!1,i),i):0)}}}),J.cssHooks.marginRight=b(K.reliableMarginRight,function(t,e){return e?J.swap(t,{display:"inline-block"},T,[t,"marginRight"]):void 0}),J.each({margin:"",padding:"",border:"Width"},function(t,e){J.cssHooks[t+e]={expand:function(n){for(var r=0,i={},o="string"==typeof n?n.split(" "):[n];4>r;r++)i[t+be[r]+e]=o[r]||o[r-2]||o[0];return i}},Ue.test(t)||(J.cssHooks[t+e].set=w)}),J.fn.extend({css:function(t,e){return ge(this,function(t,e,n){var r,i,o={},a=0;if(J.isArray(e)){for(r=We(t),i=e.length;i>a;a++)o[e[a]]=J.css(t,e[a],!1,r);return o}return void 0!==n?J.style(t,e,n):J.css(t,e)},t,e,arguments.length>1)},show:function(){return M(this,!0)},hide:function(){return M(this)},toggle:function(t){return"boolean"==typeof t?t?this.show():this.hide():this.each(function(){Re(this)?J(this).show():J(this).hide()})}}),J.Tween=S,S.prototype={constructor:S,init:function(t,e,n,r,i,o){this.elem=t,this.prop=n,this.easing=i||"swing",this.options=e,this.start=this.now=this.cur(),this.end=r,this.unit=o||(J.cssNumber[n]?"":"px")},cur:function(){var t=S.propHooks[this.prop];return t&&t.get?t.get(this):S.propHooks._default.get(this)},run:function(t){var e,n=S.propHooks[this.prop];return this.pos=e=this.options.duration?J.easing[this.easing](t,this.options.duration*t,0,1,this.options.duration):t,this.now=(this.end-this.start)*e+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):S.propHooks._default.set(this),this}},S.prototype.init.prototype=S.prototype,S.propHooks={_default:{get:function(t){var e;return null==t.elem[t.prop]||t.elem.style&&null!=t.elem.style[t.prop]?(e=J.css(t.elem,t.prop,""),e&&"auto"!==e?e:0):t.elem[t.prop]},set:function(t){J.fx.step[t.prop]?J.fx.step[t.prop](t):t.elem.style&&(null!=t.elem.style[J.cssProps[t.prop]]||J.cssHooks[t.prop])?J.style(t.elem,t.prop,t.now+t.unit):t.elem[t.prop]=t.now}}},S.propHooks.scrollTop=S.propHooks.scrollLeft={set:function(t){t.elem.nodeType&&t.elem.parentNode&&(t.elem[t.prop]=t.now)}},J.easing={linear:function(t){return t},swing:function(t){return.5-Math.cos(t*Math.PI)/2}},J.fx=S.prototype.init,J.fx.step={};var Ke,Qe,$e=/^(?:toggle|show|hide)$/,Je=new RegExp("^(?:([+-])=|)("+Te+")([a-z%]*)$","i"),tn=/queueHooks$/,en=[P],nn={"*":[function(t,e){var n=this.createTween(t,e),r=n.cur(),i=Je.exec(e),o=i&&i[3]||(J.cssNumber[t]?"":"px"),a=(J.cssNumber[t]||"px"!==o&&+r)&&Je.exec(J.css(n.elem,t)),s=1,h=20;if(a&&a[3]!==o){o=o||a[3],i=i||[],a=+r||1;do s=s||".5",a/=s,J.style(n.elem,t,a+o);while(s!==(s=n.cur()/r)&&1!==s&&--h)}return i&&(a=n.start=+a||+r||0,n.unit=o,n.end=i[1]?a+(i[1]+1)*i[2]:+i[2]),n}]};J.Animation=J.extend(z,{tweener:function(t,e){J.isFunction(t)?(e=t,t=["*"]):t=t.split(" ");for(var n,r=0,i=t.length;i>r;r++)n=t[r],nn[n]=nn[n]||[],nn[n].unshift(e)},prefilter:function(t,e){e?en.unshift(t):en.push(t)}}),J.speed=function(t,e,n){var r=t&&"object"==typeof t?J.extend({},t):{complete:n||!n&&e||J.isFunction(t)&&t,duration:t,easing:n&&e||e&&!J.isFunction(e)&&e};return r.duration=J.fx.off?0:"number"==typeof r.duration?r.duration:r.duration in J.fx.speeds?J.fx.speeds[r.duration]:J.fx.speeds._default,(null==r.queue||r.queue===!0)&&(r.queue="fx"),r.old=r.complete,r.complete=function(){J.isFunction(r.old)&&r.old.call(this),r.queue&&J.dequeue(this,r.queue)},r},J.fn.extend({fadeTo:function(t,e,n,r){return this.filter(Re).css("opacity",0).show().end().animate({opacity:e},t,n,r)},animate:function(t,e,n,r){var i=J.isEmptyObject(t),o=J.speed(e,n,r),a=function(){var e=z(this,J.extend({},t),o);(i||ve.get(this,"finish"))&&e.stop(!0)};return a.finish=a,i||o.queue===!1?this.each(a):this.queue(o.queue,a)},stop:function(t,e,n){var r=function(t){var e=t.stop;delete t.stop,e(n)};return"string"!=typeof t&&(n=e,e=t,t=void 0),e&&t!==!1&&this.queue(t||"fx",[]),this.each(function(){var e=!0,i=null!=t&&t+"queueHooks",o=J.timers,a=ve.get(this);if(i)a[i]&&a[i].stop&&r(a[i]);else for(i in a)a[i]&&a[i].stop&&tn.test(i)&&r(a[i]);for(i=o.length;i--;)o[i].elem!==this||null!=t&&o[i].queue!==t||(o[i].anim.stop(n),e=!1,o.splice(i,1));(e||!n)&&J.dequeue(this,t)})},finish:function(t){return t!==!1&&(t=t||"fx"),this.each(function(){var e,n=ve.get(this),r=n[t+"queue"],i=n[t+"queueHooks"],o=J.timers,a=r?r.length:0;for(n.finish=!0,J.queue(this,t,[]),i&&i.stop&&i.stop.call(this,!0),e=o.length;e--;)o[e].elem===this&&o[e].queue===t&&(o[e].anim.stop(!0),o.splice(e,1));for(e=0;a>e;e++)r[e]&&r[e].finish&&r[e].finish.call(this);delete n.finish})}}),J.each(["toggle","show","hide"],function(t,e){var n=J.fn[e];
J.fn[e]=function(t,r,i){return null==t||"boolean"==typeof t?n.apply(this,arguments):this.animate(A(e,!0),t,r,i)}}),J.each({slideDown:A("show"),slideUp:A("hide"),slideToggle:A("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(t,e){J.fn[t]=function(t,n,r){return this.animate(e,t,n,r)}}),J.timers=[],J.fx.tick=function(){var t,e=0,n=J.timers;for(Ke=J.now();e<n.length;e++)t=n[e],t()||n[e]!==t||n.splice(e--,1);n.length||J.fx.stop(),Ke=void 0},J.fx.timer=function(t){J.timers.push(t),t()?J.fx.start():J.timers.pop()},J.fx.interval=13,J.fx.start=function(){Qe||(Qe=setInterval(J.fx.tick,J.fx.interval))},J.fx.stop=function(){clearInterval(Qe),Qe=null},J.fx.speeds={slow:600,fast:200,_default:400},J.fn.delay=function(t,e){return t=J.fx?J.fx.speeds[t]||t:t,e=e||"fx",this.queue(e,function(e,n){var r=setTimeout(e,t);n.stop=function(){clearTimeout(r)}})},function(){var t=Q.createElement("input"),e=Q.createElement("select"),n=e.appendChild(Q.createElement("option"));t.type="checkbox",K.checkOn=""!==t.value,K.optSelected=n.selected,e.disabled=!0,K.optDisabled=!n.disabled,t=Q.createElement("input"),t.value="t",t.type="radio",K.radioValue="t"===t.value}();var rn,on,an=J.expr.attrHandle;J.fn.extend({attr:function(t,e){return ge(this,J.attr,t,e,arguments.length>1)},removeAttr:function(t){return this.each(function(){J.removeAttr(this,t)})}}),J.extend({attr:function(t,e,n){var r,i,o=t.nodeType;if(t&&3!==o&&8!==o&&2!==o)return typeof t.getAttribute===_e?J.prop(t,e,n):(1===o&&J.isXMLDoc(t)||(e=e.toLowerCase(),r=J.attrHooks[e]||(J.expr.match.bool.test(e)?on:rn)),void 0===n?r&&"get"in r&&null!==(i=r.get(t,e))?i:(i=J.find.attr(t,e),null==i?void 0:i):null!==n?r&&"set"in r&&void 0!==(i=r.set(t,n,e))?i:(t.setAttribute(e,n+""),n):void J.removeAttr(t,e))},removeAttr:function(t,e){var n,r,i=0,o=e&&e.match(pe);if(o&&1===t.nodeType)for(;n=o[i++];)r=J.propFix[n]||n,J.expr.match.bool.test(n)&&(t[r]=!1),t.removeAttribute(n)},attrHooks:{type:{set:function(t,e){if(!K.radioValue&&"radio"===e&&J.nodeName(t,"input")){var n=t.value;return t.setAttribute("type",e),n&&(t.value=n),e}}}}}),on={set:function(t,e,n){return e===!1?J.removeAttr(t,n):t.setAttribute(n,n),n}},J.each(J.expr.match.bool.source.match(/\w+/g),function(t,e){var n=an[e]||J.find.attr;an[e]=function(t,e,r){var i,o;return r||(o=an[e],an[e]=i,i=null!=n(t,e,r)?e.toLowerCase():null,an[e]=o),i}});var sn=/^(?:input|select|textarea|button)$/i;J.fn.extend({prop:function(t,e){return ge(this,J.prop,t,e,arguments.length>1)},removeProp:function(t){return this.each(function(){delete this[J.propFix[t]||t]})}}),J.extend({propFix:{"for":"htmlFor","class":"className"},prop:function(t,e,n){var r,i,o,a=t.nodeType;if(t&&3!==a&&8!==a&&2!==a)return o=1!==a||!J.isXMLDoc(t),o&&(e=J.propFix[e]||e,i=J.propHooks[e]),void 0!==n?i&&"set"in i&&void 0!==(r=i.set(t,n,e))?r:t[e]=n:i&&"get"in i&&null!==(r=i.get(t,e))?r:t[e]},propHooks:{tabIndex:{get:function(t){return t.hasAttribute("tabindex")||sn.test(t.nodeName)||t.href?t.tabIndex:-1}}}}),K.optSelected||(J.propHooks.selected={get:function(t){var e=t.parentNode;return e&&e.parentNode&&e.parentNode.selectedIndex,null}}),J.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){J.propFix[this.toLowerCase()]=this});var hn=/[\t\r\n\f]/g;J.fn.extend({addClass:function(t){var e,n,r,i,o,a,s="string"==typeof t&&t,h=0,u=this.length;if(J.isFunction(t))return this.each(function(e){J(this).addClass(t.call(this,e,this.className))});if(s)for(e=(t||"").match(pe)||[];u>h;h++)if(n=this[h],r=1===n.nodeType&&(n.className?(" "+n.className+" ").replace(hn," "):" ")){for(o=0;i=e[o++];)r.indexOf(" "+i+" ")<0&&(r+=i+" ");a=J.trim(r),n.className!==a&&(n.className=a)}return this},removeClass:function(t){var e,n,r,i,o,a,s=0===arguments.length||"string"==typeof t&&t,h=0,u=this.length;if(J.isFunction(t))return this.each(function(e){J(this).removeClass(t.call(this,e,this.className))});if(s)for(e=(t||"").match(pe)||[];u>h;h++)if(n=this[h],r=1===n.nodeType&&(n.className?(" "+n.className+" ").replace(hn," "):"")){for(o=0;i=e[o++];)for(;r.indexOf(" "+i+" ")>=0;)r=r.replace(" "+i+" "," ");a=t?J.trim(r):"",n.className!==a&&(n.className=a)}return this},toggleClass:function(t,e){var n=typeof t;return"boolean"==typeof e&&"string"===n?e?this.addClass(t):this.removeClass(t):this.each(J.isFunction(t)?function(n){J(this).toggleClass(t.call(this,n,this.className,e),e)}:function(){if("string"===n)for(var e,r=0,i=J(this),o=t.match(pe)||[];e=o[r++];)i.hasClass(e)?i.removeClass(e):i.addClass(e);else(n===_e||"boolean"===n)&&(this.className&&ve.set(this,"__className__",this.className),this.className=this.className||t===!1?"":ve.get(this,"__className__")||"")})},hasClass:function(t){for(var e=" "+t+" ",n=0,r=this.length;r>n;n++)if(1===this[n].nodeType&&(" "+this[n].className+" ").replace(hn," ").indexOf(e)>=0)return!0;return!1}});var un=/\r/g;J.fn.extend({val:function(t){var e,n,r,i=this[0];{if(arguments.length)return r=J.isFunction(t),this.each(function(n){var i;1===this.nodeType&&(i=r?t.call(this,n,J(this).val()):t,null==i?i="":"number"==typeof i?i+="":J.isArray(i)&&(i=J.map(i,function(t){return null==t?"":t+""})),e=J.valHooks[this.type]||J.valHooks[this.nodeName.toLowerCase()],e&&"set"in e&&void 0!==e.set(this,i,"value")||(this.value=i))});if(i)return e=J.valHooks[i.type]||J.valHooks[i.nodeName.toLowerCase()],e&&"get"in e&&void 0!==(n=e.get(i,"value"))?n:(n=i.value,"string"==typeof n?n.replace(un,""):null==n?"":n)}}}),J.extend({valHooks:{option:{get:function(t){var e=J.find.attr(t,"value");return null!=e?e:J.trim(J.text(t))}},select:{get:function(t){for(var e,n,r=t.options,i=t.selectedIndex,o="select-one"===t.type||0>i,a=o?null:[],s=o?i+1:r.length,h=0>i?s:o?i:0;s>h;h++)if(n=r[h],!(!n.selected&&h!==i||(K.optDisabled?n.disabled:null!==n.getAttribute("disabled"))||n.parentNode.disabled&&J.nodeName(n.parentNode,"optgroup"))){if(e=J(n).val(),o)return e;a.push(e)}return a},set:function(t,e){for(var n,r,i=t.options,o=J.makeArray(e),a=i.length;a--;)r=i[a],(r.selected=J.inArray(r.value,o)>=0)&&(n=!0);return n||(t.selectedIndex=-1),o}}}}),J.each(["radio","checkbox"],function(){J.valHooks[this]={set:function(t,e){return J.isArray(e)?t.checked=J.inArray(J(t).val(),e)>=0:void 0}},K.checkOn||(J.valHooks[this].get=function(t){return null===t.getAttribute("value")?"on":t.value})}),J.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(t,e){J.fn[e]=function(t,n){return arguments.length>0?this.on(e,null,t,n):this.trigger(e)}}),J.fn.extend({hover:function(t,e){return this.mouseenter(t).mouseleave(e||t)},bind:function(t,e,n){return this.on(t,null,e,n)},unbind:function(t,e){return this.off(t,null,e)},delegate:function(t,e,n,r){return this.on(e,t,n,r)},undelegate:function(t,e,n){return 1===arguments.length?this.off(t,"**"):this.off(e,t||"**",n)}});var cn=J.now(),ln=/\?/;J.parseJSON=function(t){return JSON.parse(t+"")},J.parseXML=function(t){var e,n;if(!t||"string"!=typeof t)return null;try{n=new DOMParser,e=n.parseFromString(t,"text/xml")}catch(r){e=void 0}return(!e||e.getElementsByTagName("parsererror").length)&&J.error("Invalid XML: "+t),e};var fn,pn,dn=/#.*$/,mn=/([?&])_=[^&]*/,gn=/^(.*?):[ \t]*([^\r\n]*)$/gm,vn=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,yn=/^(?:GET|HEAD)$/,En=/^\/\//,xn=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,Tn={},bn={},Rn="*/".concat("*");try{pn=location.href}catch(wn){pn=Q.createElement("a"),pn.href="",pn=pn.href}fn=xn.exec(pn.toLowerCase())||[],J.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:pn,type:"GET",isLocal:vn.test(fn[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Rn,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":J.parseJSON,"text xml":J.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(t,e){return e?N(N(t,J.ajaxSettings),e):N(J.ajaxSettings,t)},ajaxPrefilter:F(Tn),ajaxTransport:F(bn),ajax:function(t,e){function n(t,e,n,a){var h,c,v,y,x,b=e;2!==E&&(E=2,s&&clearTimeout(s),r=void 0,o=a||"",T.readyState=t>0?4:0,h=t>=200&&300>t||304===t,n&&(y=V(l,T,n)),y=I(l,y,T,h),h?(l.ifModified&&(x=T.getResponseHeader("Last-Modified"),x&&(J.lastModified[i]=x),x=T.getResponseHeader("etag"),x&&(J.etag[i]=x)),204===t||"HEAD"===l.type?b="nocontent":304===t?b="notmodified":(b=y.state,c=y.data,v=y.error,h=!v)):(v=b,(t||!b)&&(b="error",0>t&&(t=0))),T.status=t,T.statusText=(e||b)+"",h?d.resolveWith(f,[c,b,T]):d.rejectWith(f,[T,b,v]),T.statusCode(g),g=void 0,u&&p.trigger(h?"ajaxSuccess":"ajaxError",[T,l,h?c:v]),m.fireWith(f,[T,b]),u&&(p.trigger("ajaxComplete",[T,l]),--J.active||J.event.trigger("ajaxStop")))}"object"==typeof t&&(e=t,t=void 0),e=e||{};var r,i,o,a,s,h,u,c,l=J.ajaxSetup({},e),f=l.context||l,p=l.context&&(f.nodeType||f.jquery)?J(f):J.event,d=J.Deferred(),m=J.Callbacks("once memory"),g=l.statusCode||{},v={},y={},E=0,x="canceled",T={readyState:0,getResponseHeader:function(t){var e;if(2===E){if(!a)for(a={};e=gn.exec(o);)a[e[1].toLowerCase()]=e[2];e=a[t.toLowerCase()]}return null==e?null:e},getAllResponseHeaders:function(){return 2===E?o:null},setRequestHeader:function(t,e){var n=t.toLowerCase();return E||(t=y[n]=y[n]||t,v[t]=e),this},overrideMimeType:function(t){return E||(l.mimeType=t),this},statusCode:function(t){var e;if(t)if(2>E)for(e in t)g[e]=[g[e],t[e]];else T.always(t[T.status]);return this},abort:function(t){var e=t||x;return r&&r.abort(e),n(0,e),this}};if(d.promise(T).complete=m.add,T.success=T.done,T.error=T.fail,l.url=((t||l.url||pn)+"").replace(dn,"").replace(En,fn[1]+"//"),l.type=e.method||e.type||l.method||l.type,l.dataTypes=J.trim(l.dataType||"*").toLowerCase().match(pe)||[""],null==l.crossDomain&&(h=xn.exec(l.url.toLowerCase()),l.crossDomain=!(!h||h[1]===fn[1]&&h[2]===fn[2]&&(h[3]||("http:"===h[1]?"80":"443"))===(fn[3]||("http:"===fn[1]?"80":"443")))),l.data&&l.processData&&"string"!=typeof l.data&&(l.data=J.param(l.data,l.traditional)),k(Tn,l,e,T),2===E)return T;u=l.global,u&&0===J.active++&&J.event.trigger("ajaxStart"),l.type=l.type.toUpperCase(),l.hasContent=!yn.test(l.type),i=l.url,l.hasContent||(l.data&&(i=l.url+=(ln.test(i)?"&":"?")+l.data,delete l.data),l.cache===!1&&(l.url=mn.test(i)?i.replace(mn,"$1_="+cn++):i+(ln.test(i)?"&":"?")+"_="+cn++)),l.ifModified&&(J.lastModified[i]&&T.setRequestHeader("If-Modified-Since",J.lastModified[i]),J.etag[i]&&T.setRequestHeader("If-None-Match",J.etag[i])),(l.data&&l.hasContent&&l.contentType!==!1||e.contentType)&&T.setRequestHeader("Content-Type",l.contentType),T.setRequestHeader("Accept",l.dataTypes[0]&&l.accepts[l.dataTypes[0]]?l.accepts[l.dataTypes[0]]+("*"!==l.dataTypes[0]?", "+Rn+"; q=0.01":""):l.accepts["*"]);for(c in l.headers)T.setRequestHeader(c,l.headers[c]);if(l.beforeSend&&(l.beforeSend.call(f,T,l)===!1||2===E))return T.abort();x="abort";for(c in{success:1,error:1,complete:1})T[c](l[c]);if(r=k(bn,l,e,T)){T.readyState=1,u&&p.trigger("ajaxSend",[T,l]),l.async&&l.timeout>0&&(s=setTimeout(function(){T.abort("timeout")},l.timeout));try{E=1,r.send(v,n)}catch(b){if(!(2>E))throw b;n(-1,b)}}else n(-1,"No Transport");return T},getJSON:function(t,e,n){return J.get(t,e,n,"json")},getScript:function(t,e){return J.get(t,void 0,e,"script")}}),J.each(["get","post"],function(t,e){J[e]=function(t,n,r,i){return J.isFunction(n)&&(i=i||r,r=n,n=void 0),J.ajax({url:t,type:e,dataType:i,data:n,success:r})}}),J.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(t,e){J.fn[e]=function(t){return this.on(e,t)}}),J._evalUrl=function(t){return J.ajax({url:t,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})},J.fn.extend({wrapAll:function(t){var e;return J.isFunction(t)?this.each(function(e){J(this).wrapAll(t.call(this,e))}):(this[0]&&(e=J(t,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&e.insertBefore(this[0]),e.map(function(){for(var t=this;t.firstElementChild;)t=t.firstElementChild;return t}).append(this)),this)},wrapInner:function(t){return this.each(J.isFunction(t)?function(e){J(this).wrapInner(t.call(this,e))}:function(){var e=J(this),n=e.contents();n.length?n.wrapAll(t):e.append(t)})},wrap:function(t){var e=J.isFunction(t);return this.each(function(n){J(this).wrapAll(e?t.call(this,n):t)})},unwrap:function(){return this.parent().each(function(){J.nodeName(this,"body")||J(this).replaceWith(this.childNodes)}).end()}}),J.expr.filters.hidden=function(t){return t.offsetWidth<=0&&t.offsetHeight<=0},J.expr.filters.visible=function(t){return!J.expr.filters.hidden(t)};var _n=/%20/g,Hn=/\[\]$/,Mn=/\r?\n/g,Sn=/^(?:submit|button|image|reset|file)$/i,Cn=/^(?:input|select|textarea|keygen)/i;J.param=function(t,e){var n,r=[],i=function(t,e){e=J.isFunction(e)?e():null==e?"":e,r[r.length]=encodeURIComponent(t)+"="+encodeURIComponent(e)};if(void 0===e&&(e=J.ajaxSettings&&J.ajaxSettings.traditional),J.isArray(t)||t.jquery&&!J.isPlainObject(t))J.each(t,function(){i(this.name,this.value)});else for(n in t)B(n,t[n],e,i);return r.join("&").replace(_n,"+")},J.fn.extend({serialize:function(){return J.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var t=J.prop(this,"elements");return t?J.makeArray(t):this}).filter(function(){var t=this.type;return this.name&&!J(this).is(":disabled")&&Cn.test(this.nodeName)&&!Sn.test(t)&&(this.checked||!we.test(t))}).map(function(t,e){var n=J(this).val();return null==n?null:J.isArray(n)?J.map(n,function(t){return{name:e.name,value:t.replace(Mn,"\r\n")}}):{name:e.name,value:n.replace(Mn,"\r\n")}}).get()}}),J.ajaxSettings.xhr=function(){try{return new XMLHttpRequest}catch(t){}};var An=0,Ln={},Pn={0:200,1223:204},Dn=J.ajaxSettings.xhr();t.ActiveXObject&&J(t).on("unload",function(){for(var t in Ln)Ln[t]()}),K.cors=!!Dn&&"withCredentials"in Dn,K.ajax=Dn=!!Dn,J.ajaxTransport(function(t){var e;return K.cors||Dn&&!t.crossDomain?{send:function(n,r){var i,o=t.xhr(),a=++An;if(o.open(t.type,t.url,t.async,t.username,t.password),t.xhrFields)for(i in t.xhrFields)o[i]=t.xhrFields[i];t.mimeType&&o.overrideMimeType&&o.overrideMimeType(t.mimeType),t.crossDomain||n["X-Requested-With"]||(n["X-Requested-With"]="XMLHttpRequest");for(i in n)o.setRequestHeader(i,n[i]);e=function(t){return function(){e&&(delete Ln[a],e=o.onload=o.onerror=null,"abort"===t?o.abort():"error"===t?r(o.status,o.statusText):r(Pn[o.status]||o.status,o.statusText,"string"==typeof o.responseText?{text:o.responseText}:void 0,o.getAllResponseHeaders()))}},o.onload=e(),o.onerror=e("error"),e=Ln[a]=e("abort");try{o.send(t.hasContent&&t.data||null)}catch(s){if(e)throw s}},abort:function(){e&&e()}}:void 0}),J.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(t){return J.globalEval(t),t}}}),J.ajaxPrefilter("script",function(t){void 0===t.cache&&(t.cache=!1),t.crossDomain&&(t.type="GET")}),J.ajaxTransport("script",function(t){if(t.crossDomain){var e,n;return{send:function(r,i){e=J("<script>").prop({async:!0,charset:t.scriptCharset,src:t.url}).on("load error",n=function(t){e.remove(),n=null,t&&i("error"===t.type?404:200,t.type)}),Q.head.appendChild(e[0])},abort:function(){n&&n()}}}});var zn=[],Fn=/(=)\?(?=&|$)|\?\?/;J.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var t=zn.pop()||J.expando+"_"+cn++;return this[t]=!0,t}}),J.ajaxPrefilter("json jsonp",function(e,n,r){var i,o,a,s=e.jsonp!==!1&&(Fn.test(e.url)?"url":"string"==typeof e.data&&!(e.contentType||"").indexOf("application/x-www-form-urlencoded")&&Fn.test(e.data)&&"data");return s||"jsonp"===e.dataTypes[0]?(i=e.jsonpCallback=J.isFunction(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,s?e[s]=e[s].replace(Fn,"$1"+i):e.jsonp!==!1&&(e.url+=(ln.test(e.url)?"&":"?")+e.jsonp+"="+i),e.converters["script json"]=function(){return a||J.error(i+" was not called"),a[0]},e.dataTypes[0]="json",o=t[i],t[i]=function(){a=arguments},r.always(function(){t[i]=o,e[i]&&(e.jsonpCallback=n.jsonpCallback,zn.push(i)),a&&J.isFunction(o)&&o(a[0]),a=o=void 0}),"script"):void 0}),J.parseHTML=function(t,e,n){if(!t||"string"!=typeof t)return null;"boolean"==typeof e&&(n=e,e=!1),e=e||Q;var r=ae.exec(t),i=!n&&[];return r?[e.createElement(r[1])]:(r=J.buildFragment([t],e,i),i&&i.length&&J(i).remove(),J.merge([],r.childNodes))};var kn=J.fn.load;J.fn.load=function(t,e,n){if("string"!=typeof t&&kn)return kn.apply(this,arguments);var r,i,o,a=this,s=t.indexOf(" ");return s>=0&&(r=J.trim(t.slice(s)),t=t.slice(0,s)),J.isFunction(e)?(n=e,e=void 0):e&&"object"==typeof e&&(i="POST"),a.length>0&&J.ajax({url:t,type:i,dataType:"html",data:e}).done(function(t){o=arguments,a.html(r?J("<div>").append(J.parseHTML(t)).find(r):t)}).complete(n&&function(t,e){a.each(n,o||[t.responseText,e,t])}),this},J.expr.filters.animated=function(t){return J.grep(J.timers,function(e){return t===e.elem}).length};var Nn=t.document.documentElement;J.offset={setOffset:function(t,e,n){var r,i,o,a,s,h,u,c=J.css(t,"position"),l=J(t),f={};"static"===c&&(t.style.position="relative"),s=l.offset(),o=J.css(t,"top"),h=J.css(t,"left"),u=("absolute"===c||"fixed"===c)&&(o+h).indexOf("auto")>-1,u?(r=l.position(),a=r.top,i=r.left):(a=parseFloat(o)||0,i=parseFloat(h)||0),J.isFunction(e)&&(e=e.call(t,n,s)),null!=e.top&&(f.top=e.top-s.top+a),null!=e.left&&(f.left=e.left-s.left+i),"using"in e?e.using.call(t,f):l.css(f)}},J.fn.extend({offset:function(t){if(arguments.length)return void 0===t?this:this.each(function(e){J.offset.setOffset(this,t,e)});var e,n,r=this[0],i={top:0,left:0},o=r&&r.ownerDocument;if(o)return e=o.documentElement,J.contains(e,r)?(typeof r.getBoundingClientRect!==_e&&(i=r.getBoundingClientRect()),n=U(o),{top:i.top+n.pageYOffset-e.clientTop,left:i.left+n.pageXOffset-e.clientLeft}):i},position:function(){if(this[0]){var t,e,n=this[0],r={top:0,left:0};return"fixed"===J.css(n,"position")?e=n.getBoundingClientRect():(t=this.offsetParent(),e=this.offset(),J.nodeName(t[0],"html")||(r=t.offset()),r.top+=J.css(t[0],"borderTopWidth",!0),r.left+=J.css(t[0],"borderLeftWidth",!0)),{top:e.top-r.top-J.css(n,"marginTop",!0),left:e.left-r.left-J.css(n,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var t=this.offsetParent||Nn;t&&!J.nodeName(t,"html")&&"static"===J.css(t,"position");)t=t.offsetParent;return t||Nn})}}),J.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,n){var r="pageYOffset"===n;J.fn[e]=function(i){return ge(this,function(e,i,o){var a=U(e);return void 0===o?a?a[n]:e[i]:void(a?a.scrollTo(r?t.pageXOffset:o,r?o:t.pageYOffset):e[i]=o)},e,i,arguments.length,null)}}),J.each(["top","left"],function(t,e){J.cssHooks[e]=b(K.pixelPosition,function(t,n){return n?(n=T(t,e),Oe.test(n)?J(t).position()[e]+"px":n):void 0})}),J.each({Height:"height",Width:"width"},function(t,e){J.each({padding:"inner"+t,content:e,"":"outer"+t},function(n,r){J.fn[r]=function(r,i){var o=arguments.length&&(n||"boolean"!=typeof r),a=n||(r===!0||i===!0?"margin":"border");return ge(this,function(e,n,r){var i;return J.isWindow(e)?e.document.documentElement["client"+t]:9===e.nodeType?(i=e.documentElement,Math.max(e.body["scroll"+t],i["scroll"+t],e.body["offset"+t],i["offset"+t],i["client"+t])):void 0===r?J.css(e,n,a):J.style(e,n,r,a)},e,o?r:void 0,o,null)}})}),J.fn.size=function(){return this.length},J.fn.andSelf=J.fn.addBack,"function"==typeof define&&define.amd&&define("jquery",[],function(){return J});var Vn=t.jQuery,In=t.$;return J.noConflict=function(e){return t.$===J&&(t.$=In),e&&t.jQuery===J&&(t.jQuery=Vn),J},typeof e===_e&&(t.jQuery=t.$=J),J});var THREE={REVISION:"68"};"object"==typeof module&&(module.exports=THREE),THREE.CullFaceNone=0,THREE.CullFaceBack=1,THREE.CullFaceFront=2,THREE.CullFaceFrontBack=3,THREE.FrontFaceDirectionCW=0,THREE.FrontFaceDirectionCCW=1,THREE.BasicShadowMap=0,THREE.PCFShadowMap=1,THREE.PCFSoftShadowMap=2,THREE.FrontSide=0,THREE.BackSide=1,THREE.DoubleSide=2,THREE.NoShading=0,THREE.FlatShading=1,THREE.SmoothShading=2,THREE.NoColors=0,THREE.FaceColors=1,THREE.VertexColors=2,THREE.NoBlending=0,THREE.NormalBlending=1,THREE.AdditiveBlending=2,THREE.SubtractiveBlending=3,THREE.MultiplyBlending=4,THREE.CustomBlending=5,THREE.AddEquation=100,THREE.SubtractEquation=101,THREE.ReverseSubtractEquation=102,THREE.ZeroFactor=200,THREE.OneFactor=201,THREE.SrcColorFactor=202,THREE.OneMinusSrcColorFactor=203,THREE.SrcAlphaFactor=204,THREE.OneMinusSrcAlphaFactor=205,THREE.DstAlphaFactor=206,THREE.OneMinusDstAlphaFactor=207,THREE.DstColorFactor=208,THREE.OneMinusDstColorFactor=209,THREE.SrcAlphaSaturateFactor=210,THREE.MultiplyOperation=0,THREE.MixOperation=1,THREE.AddOperation=2,THREE.UVMapping=function(){},THREE.CubeReflectionMapping=function(){},THREE.CubeRefractionMapping=function(){},THREE.SphericalReflectionMapping=function(){},THREE.SphericalRefractionMapping=function(){},THREE.RepeatWrapping=1e3,THREE.ClampToEdgeWrapping=1001,THREE.MirroredRepeatWrapping=1002,THREE.NearestFilter=1003,THREE.NearestMipMapNearestFilter=1004,THREE.NearestMipMapLinearFilter=1005,THREE.LinearFilter=1006,THREE.LinearMipMapNearestFilter=1007,THREE.LinearMipMapLinearFilter=1008,THREE.UnsignedByteType=1009,THREE.ByteType=1010,THREE.ShortType=1011,THREE.UnsignedShortType=1012,THREE.IntType=1013,THREE.UnsignedIntType=1014,THREE.FloatType=1015,THREE.UnsignedShort4444Type=1016,THREE.UnsignedShort5551Type=1017,THREE.UnsignedShort565Type=1018,THREE.AlphaFormat=1019,THREE.RGBFormat=1020,THREE.RGBAFormat=1021,THREE.LuminanceFormat=1022,THREE.LuminanceAlphaFormat=1023,THREE.RGB_S3TC_DXT1_Format=2001,THREE.RGBA_S3TC_DXT1_Format=2002,THREE.RGBA_S3TC_DXT3_Format=2003,THREE.RGBA_S3TC_DXT5_Format=2004,THREE.Color=function(t){return 3===arguments.length?this.setRGB(arguments[0],arguments[1],arguments[2]):this.set(t)},THREE.Color.prototype={constructor:THREE.Color,r:1,g:1,b:1,set:function(t){return t instanceof THREE.Color?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t),this},setHex:function(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this},setRGB:function(t,e,n){return this.r=t,this.g=e,this.b=n,this},setHSL:function(t,e,n){if(0===e)this.r=this.g=this.b=n;else{var r=function(t,e,n){return 0>n&&(n+=1),n>1&&(n-=1),1/6>n?t+6*(e-t)*n:.5>n?e:2/3>n?t+6*(e-t)*(2/3-n):t};e=.5>=n?n*(1+e):n+e-n*e,n=2*n-e,this.r=r(n,e,t+1/3),this.g=r(n,e,t),this.b=r(n,e,t-1/3)}return this},setStyle:function(t){return/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.test(t)?(t=/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.exec(t),this.r=Math.min(255,parseInt(t[1],10))/255,this.g=Math.min(255,parseInt(t[2],10))/255,this.b=Math.min(255,parseInt(t[3],10))/255,this):/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.test(t)?(t=/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.exec(t),this.r=Math.min(100,parseInt(t[1],10))/100,this.g=Math.min(100,parseInt(t[2],10))/100,this.b=Math.min(100,parseInt(t[3],10))/100,this):/^\#([0-9a-f]{6})$/i.test(t)?(t=/^\#([0-9a-f]{6})$/i.exec(t),this.setHex(parseInt(t[1],16)),this):/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.test(t)?(t=/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(t),this.setHex(parseInt(t[1]+t[1]+t[2]+t[2]+t[3]+t[3],16)),this):/^(\w+)$/i.test(t)?(this.setHex(THREE.ColorKeywords[t]),this):void 0},copy:function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this},copyGammaToLinear:function(t){return this.r=t.r*t.r,this.g=t.g*t.g,this.b=t.b*t.b,this},copyLinearToGamma:function(t){return this.r=Math.sqrt(t.r),this.g=Math.sqrt(t.g),this.b=Math.sqrt(t.b),this},convertGammaToLinear:function(){var t=this.r,e=this.g,n=this.b;return this.r=t*t,this.g=e*e,this.b=n*n,this},convertLinearToGamma:function(){return this.r=Math.sqrt(this.r),this.g=Math.sqrt(this.g),this.b=Math.sqrt(this.b),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(t){t=t||{h:0,s:0,l:0};var e,n=this.r,r=this.g,i=this.b,o=Math.max(n,r,i),a=Math.min(n,r,i),s=(a+o)/2;if(a===o)a=e=0;else{var h=o-a,a=.5>=s?h/(o+a):h/(2-o-a);switch(o){case n:e=(r-i)/h+(i>r?6:0);break;case r:e=(i-n)/h+2;break;case i:e=(n-r)/h+4}e/=6}return t.h=e,t.s=a,t.l=s,t},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(t,e,n){var r=this.getHSL();return r.h+=t,r.s+=e,r.l+=n,this.setHSL(r.h,r.s,r.l),this},add:function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this},addColors:function(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this},addScalar:function(t){return this.r+=t,this.g+=t,this.b+=t,this},multiply:function(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this},multiplyScalar:function(t){return this.r*=t,this.g*=t,this.b*=t,this},lerp:function(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this},equals:function(t){return t.r===this.r&&t.g===this.g&&t.b===this.b},fromArray:function(t){return this.r=t[0],this.g=t[1],this.b=t[2],this},toArray:function(){return[this.r,this.g,this.b]},clone:function(){return(new THREE.Color).setRGB(this.r,this.g,this.b)}},THREE.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},THREE.Quaternion=function(t,e,n,r){this._x=t||0,this._y=e||0,this._z=n||0,this._w=void 0!==r?r:1},THREE.Quaternion.prototype={constructor:THREE.Quaternion,_x:0,_y:0,_z:0,_w:0,get x(){return this._x},set x(t){this._x=t,this.onChangeCallback()},get y(){return this._y},set y(t){this._y=t,this.onChangeCallback()},get z(){return this._z},set z(t){this._z=t,this.onChangeCallback()},get w(){return this._w},set w(t){this._w=t,this.onChangeCallback()},set:function(t,e,n,r){return this._x=t,this._y=e,this._z=n,this._w=r,this.onChangeCallback(),this},copy:function(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this.onChangeCallback(),this},setFromEuler:function(t,e){if(!1==t instanceof THREE.Euler)throw Error("THREE.Quaternion: .setFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var n=Math.cos(t._x/2),r=Math.cos(t._y/2),i=Math.cos(t._z/2),o=Math.sin(t._x/2),a=Math.sin(t._y/2),s=Math.sin(t._z/2);return"XYZ"===t.order?(this._x=o*r*i+n*a*s,this._y=n*a*i-o*r*s,this._z=n*r*s+o*a*i,this._w=n*r*i-o*a*s):"YXZ"===t.order?(this._x=o*r*i+n*a*s,this._y=n*a*i-o*r*s,this._z=n*r*s-o*a*i,this._w=n*r*i+o*a*s):"ZXY"===t.order?(this._x=o*r*i-n*a*s,this._y=n*a*i+o*r*s,this._z=n*r*s+o*a*i,this._w=n*r*i-o*a*s):"ZYX"===t.order?(this._x=o*r*i-n*a*s,this._y=n*a*i+o*r*s,this._z=n*r*s-o*a*i,this._w=n*r*i+o*a*s):"YZX"===t.order?(this._x=o*r*i+n*a*s,this._y=n*a*i+o*r*s,this._z=n*r*s-o*a*i,this._w=n*r*i-o*a*s):"XZY"===t.order&&(this._x=o*r*i-n*a*s,this._y=n*a*i-o*r*s,this._z=n*r*s+o*a*i,this._w=n*r*i+o*a*s),!1!==e&&this.onChangeCallback(),this},setFromAxisAngle:function(t,e){var n=e/2,r=Math.sin(n);return this._x=t.x*r,this._y=t.y*r,this._z=t.z*r,this._w=Math.cos(n),this.onChangeCallback(),this},setFromRotationMatrix:function(t){var e=t.elements,n=e[0];t=e[4];var r=e[8],i=e[1],o=e[5],a=e[9],s=e[2],h=e[6],e=e[10],u=n+o+e;return u>0?(n=.5/Math.sqrt(u+1),this._w=.25/n,this._x=(h-a)*n,this._y=(r-s)*n,this._z=(i-t)*n):n>o&&n>e?(n=2*Math.sqrt(1+n-o-e),this._w=(h-a)/n,this._x=.25*n,this._y=(t+i)/n,this._z=(r+s)/n):o>e?(n=2*Math.sqrt(1+o-n-e),this._w=(r-s)/n,this._x=(t+i)/n,this._y=.25*n,this._z=(a+h)/n):(n=2*Math.sqrt(1+e-n-o),this._w=(i-t)/n,this._x=(r+s)/n,this._y=(a+h)/n,this._z=.25*n),this.onChangeCallback(),this},setFromUnitVectors:function(){var t,e;return function(n,r){return void 0===t&&(t=new THREE.Vector3),e=n.dot(r)+1,1e-6>e?(e=0,Math.abs(n.x)>Math.abs(n.z)?t.set(-n.y,n.x,0):t.set(0,-n.z,n.y)):t.crossVectors(n,r),this._x=t.x,this._y=t.y,this._z=t.z,this._w=e,this.normalize(),this}}(),inverse:function(){return this.conjugate().normalize(),this},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this},dot:function(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var t=this.length();return 0===t?(this._z=this._y=this._x=0,this._w=1):(t=1/t,this._x*=t,this._y*=t,this._z*=t,this._w*=t),this.onChangeCallback(),this},multiply:function(t,e){return void 0!==e?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,e)):this.multiplyQuaternions(this,t)},multiplyQuaternions:function(t,e){var n=t._x,r=t._y,i=t._z,o=t._w,a=e._x,s=e._y,h=e._z,u=e._w;return this._x=n*u+o*a+r*h-i*s,this._y=r*u+o*s+i*a-n*h,this._z=i*u+o*h+n*s-r*a,this._w=o*u-n*a-r*s-i*h,this.onChangeCallback(),this},multiplyVector3:function(t){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),t.applyQuaternion(this)},slerp:function(t,e){var n=this._x,r=this._y,i=this._z,o=this._w,a=o*t._w+n*t._x+r*t._y+i*t._z;
if(0>a?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,a=-a):this.copy(t),a>=1)return this._w=o,this._x=n,this._y=r,this._z=i,this;var s=Math.acos(a),h=Math.sqrt(1-a*a);return.001>Math.abs(h)?(this._w=.5*(o+this._w),this._x=.5*(n+this._x),this._y=.5*(r+this._y),this._z=.5*(i+this._z),this):(a=Math.sin((1-e)*s)/h,s=Math.sin(e*s)/h,this._w=o*a+this._w*s,this._x=n*a+this._x*s,this._y=r*a+this._y*s,this._z=i*a+this._z*s,this.onChangeCallback(),this)},equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w},fromArray:function(t){return this._x=t[0],this._y=t[1],this._z=t[2],this._w=t[3],this.onChangeCallback(),this},toArray:function(){return[this._x,this._y,this._z,this._w]},onChange:function(t){return this.onChangeCallback=t,this},onChangeCallback:function(){},clone:function(){return new THREE.Quaternion(this._x,this._y,this._z,this._w)}},THREE.Quaternion.slerp=function(t,e,n,r){return n.copy(t).slerp(e,r)},THREE.Vector2=function(t,e){this.x=t||0,this.y=e||0},THREE.Vector2.prototype={constructor:THREE.Vector2,set:function(t,e){return this.x=t,this.y=e,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw Error("index is out of range: "+t)}},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw Error("index is out of range: "+t)}},copy:function(t){return this.x=t.x,this.y=t.y,this},add:function(t,e){return void 0!==e?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this)},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this},addScalar:function(t){return this.x+=t,this.y+=t,this},sub:function(t,e){return void 0!==e?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this)},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this},multiply:function(t){return this.x*=t.x,this.y*=t.y,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this},divide:function(t){return this.x/=t.x,this.y/=t.y,this},divideScalar:function(t){return 0!==t?(t=1/t,this.x*=t,this.y*=t):this.y=this.x=0,this},min:function(t){return this.x>t.x&&(this.x=t.x),this.y>t.y&&(this.y=t.y),this},max:function(t){return this.x<t.x&&(this.x=t.x),this.y<t.y&&(this.y=t.y),this},clamp:function(t,e){return this.x<t.x?this.x=t.x:this.x>e.x&&(this.x=e.x),this.y<t.y?this.y=t.y:this.y>e.y&&(this.y=e.y),this},clampScalar:function(){var t,e;return function(n,r){return void 0===t&&(t=new THREE.Vector2,e=new THREE.Vector2),t.set(n,n),e.set(r,r),this.clamp(t,e)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x),this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(t){return this.x*t.x+this.y*t.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x;return t=this.y-t.y,e*e+t*t},setLength:function(t){var e=this.length();return 0!==e&&t!==e&&this.multiplyScalar(t/e),this},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this},equals:function(t){return t.x===this.x&&t.y===this.y},fromArray:function(t){return this.x=t[0],this.y=t[1],this},toArray:function(){return[this.x,this.y]},clone:function(){return new THREE.Vector2(this.x,this.y)}},THREE.Vector3=function(t,e,n){this.x=t||0,this.y=e||0,this.z=n||0},THREE.Vector3.prototype={constructor:THREE.Vector3,set:function(t,e,n){return this.x=t,this.y=e,this.z=n,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw Error("index is out of range: "+t)}},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw Error("index is out of range: "+t)}},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},add:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this},sub:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this},multiply:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this},multiplyVectors:function(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this},applyEuler:function(){var t;return function(e){return!1==e instanceof THREE.Euler&&console.error("THREE.Vector3: .applyEuler() now expects a Euler rotation rather than a Vector3 and order."),void 0===t&&(t=new THREE.Quaternion),this.applyQuaternion(t.setFromEuler(e)),this}}(),applyAxisAngle:function(){var t;return function(e,n){return void 0===t&&(t=new THREE.Quaternion),this.applyQuaternion(t.setFromAxisAngle(e,n)),this}}(),applyMatrix3:function(t){var e=this.x,n=this.y,r=this.z;return t=t.elements,this.x=t[0]*e+t[3]*n+t[6]*r,this.y=t[1]*e+t[4]*n+t[7]*r,this.z=t[2]*e+t[5]*n+t[8]*r,this},applyMatrix4:function(t){var e=this.x,n=this.y,r=this.z;return t=t.elements,this.x=t[0]*e+t[4]*n+t[8]*r+t[12],this.y=t[1]*e+t[5]*n+t[9]*r+t[13],this.z=t[2]*e+t[6]*n+t[10]*r+t[14],this},applyProjection:function(t){var e=this.x,n=this.y,r=this.z;t=t.elements;var i=1/(t[3]*e+t[7]*n+t[11]*r+t[15]);return this.x=(t[0]*e+t[4]*n+t[8]*r+t[12])*i,this.y=(t[1]*e+t[5]*n+t[9]*r+t[13])*i,this.z=(t[2]*e+t[6]*n+t[10]*r+t[14])*i,this},applyQuaternion:function(t){var e=this.x,n=this.y,r=this.z,i=t.x,o=t.y,a=t.z;t=t.w;var s=t*e+o*r-a*n,h=t*n+a*e-i*r,u=t*r+i*n-o*e,e=-i*e-o*n-a*r;return this.x=s*t+e*-i+h*-a-u*-o,this.y=h*t+e*-o+u*-i-s*-a,this.z=u*t+e*-a+s*-o-h*-i,this},transformDirection:function(t){var e=this.x,n=this.y,r=this.z;return t=t.elements,this.x=t[0]*e+t[4]*n+t[8]*r,this.y=t[1]*e+t[5]*n+t[9]*r,this.z=t[2]*e+t[6]*n+t[10]*r,this.normalize(),this},divide:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this},divideScalar:function(t){return 0!==t?(t=1/t,this.x*=t,this.y*=t,this.z*=t):this.z=this.y=this.x=0,this},min:function(t){return this.x>t.x&&(this.x=t.x),this.y>t.y&&(this.y=t.y),this.z>t.z&&(this.z=t.z),this},max:function(t){return this.x<t.x&&(this.x=t.x),this.y<t.y&&(this.y=t.y),this.z<t.z&&(this.z=t.z),this},clamp:function(t,e){return this.x<t.x?this.x=t.x:this.x>e.x&&(this.x=e.x),this.y<t.y?this.y=t.y:this.y>e.y&&(this.y=e.y),this.z<t.z?this.z=t.z:this.z>e.z&&(this.z=e.z),this},clampScalar:function(){var t,e;return function(n,r){return void 0===t&&(t=new THREE.Vector3,e=new THREE.Vector3),t.set(n,n,n),e.set(r,r,r),this.clamp(t,e)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x),this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y),this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(t){var e=this.length();return 0!==e&&t!==e&&this.multiplyScalar(t/e),this},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this},cross:function(t,e){if(void 0!==e)return console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e);var n=this.x,r=this.y,i=this.z;return this.x=r*t.z-i*t.y,this.y=i*t.x-n*t.z,this.z=n*t.y-r*t.x,this},crossVectors:function(t,e){var n=t.x,r=t.y,i=t.z,o=e.x,a=e.y,s=e.z;return this.x=r*s-i*a,this.y=i*o-n*s,this.z=n*a-r*o,this},projectOnVector:function(){var t,e;return function(n){return void 0===t&&(t=new THREE.Vector3),t.copy(n).normalize(),e=this.dot(t),this.copy(t).multiplyScalar(e)}}(),projectOnPlane:function(){var t;return function(e){return void 0===t&&(t=new THREE.Vector3),t.copy(this).projectOnVector(e),this.sub(t)}}(),reflect:function(){var t;return function(e){return void 0===t&&(t=new THREE.Vector3),this.sub(t.copy(e).multiplyScalar(2*this.dot(e)))}}(),angleTo:function(t){return t=this.dot(t)/(this.length()*t.length()),Math.acos(THREE.Math.clamp(t,-1,1))},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,n=this.y-t.y;return t=this.z-t.z,e*e+n*n+t*t},setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(t){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(t)},getScaleFromMatrix:function(t){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(t)},getColumnFromMatrix:function(t,e){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,e)},setFromMatrixPosition:function(t){return this.x=t.elements[12],this.y=t.elements[13],this.z=t.elements[14],this},setFromMatrixScale:function(t){var e=this.set(t.elements[0],t.elements[1],t.elements[2]).length(),n=this.set(t.elements[4],t.elements[5],t.elements[6]).length();return t=this.set(t.elements[8],t.elements[9],t.elements[10]).length(),this.x=e,this.y=n,this.z=t,this},setFromMatrixColumn:function(t,e){var n=4*t,r=e.elements;return this.x=r[n],this.y=r[n+1],this.z=r[n+2],this},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z},fromArray:function(t){return this.x=t[0],this.y=t[1],this.z=t[2],this},toArray:function(){return[this.x,this.y,this.z]},clone:function(){return new THREE.Vector3(this.x,this.y,this.z)}},THREE.Vector4=function(t,e,n,r){this.x=t||0,this.y=e||0,this.z=n||0,this.w=void 0!==r?r:1},THREE.Vector4.prototype={constructor:THREE.Vector4,set:function(t,e,n,r){return this.x=t,this.y=e,this.z=n,this.w=r,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setW:function(t){return this.w=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw Error("index is out of range: "+t)}},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw Error("index is out of range: "+t)}},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this},add:function(t,e){return void 0!==e?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this},sub:function(t,e){return void 0!==e?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},applyMatrix4:function(t){var e=this.x,n=this.y,r=this.z,i=this.w;return t=t.elements,this.x=t[0]*e+t[4]*n+t[8]*r+t[12]*i,this.y=t[1]*e+t[5]*n+t[9]*r+t[13]*i,this.z=t[2]*e+t[6]*n+t[10]*r+t[14]*i,this.w=t[3]*e+t[7]*n+t[11]*r+t[15]*i,this},divideScalar:function(t){return 0!==t?(t=1/t,this.x*=t,this.y*=t,this.z*=t,this.w*=t):(this.z=this.y=this.x=0,this.w=1),this},setAxisAngleFromQuaternion:function(t){this.w=2*Math.acos(t.w);var e=Math.sqrt(1-t.w*t.w);return 1e-4>e?(this.x=1,this.z=this.y=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this},setAxisAngleFromRotationMatrix:function(t){var e,n,r;t=t.elements;var i=t[0];r=t[4];var o=t[8],a=t[1],s=t[5],h=t[9];n=t[2],e=t[6];var u=t[10];return.01>Math.abs(r-a)&&.01>Math.abs(o-n)&&.01>Math.abs(h-e)?.1>Math.abs(r+a)&&.1>Math.abs(o+n)&&.1>Math.abs(h+e)&&.1>Math.abs(i+s+u-3)?(this.set(1,0,0,0),this):(t=Math.PI,i=(i+1)/2,s=(s+1)/2,u=(u+1)/2,r=(r+a)/4,o=(o+n)/4,h=(h+e)/4,i>s&&i>u?.01>i?(e=0,r=n=.707106781):(e=Math.sqrt(i),n=r/e,r=o/e):s>u?.01>s?(e=.707106781,n=0,r=.707106781):(n=Math.sqrt(s),e=r/n,r=h/n):.01>u?(n=e=.707106781,r=0):(r=Math.sqrt(u),e=o/r,n=h/r),this.set(e,n,r,t),this):(t=Math.sqrt((e-h)*(e-h)+(o-n)*(o-n)+(a-r)*(a-r)),.001>Math.abs(t)&&(t=1),this.x=(e-h)/t,this.y=(o-n)/t,this.z=(a-r)/t,this.w=Math.acos((i+s+u-1)/2),this)},min:function(t){return this.x>t.x&&(this.x=t.x),this.y>t.y&&(this.y=t.y),this.z>t.z&&(this.z=t.z),this.w>t.w&&(this.w=t.w),this},max:function(t){return this.x<t.x&&(this.x=t.x),this.y<t.y&&(this.y=t.y),this.z<t.z&&(this.z=t.z),this.w<t.w&&(this.w=t.w),this},clamp:function(t,e){return this.x<t.x?this.x=t.x:this.x>e.x&&(this.x=e.x),this.y<t.y?this.y=t.y:this.y>e.y&&(this.y=e.y),this.z<t.z?this.z=t.z:this.z>e.z&&(this.z=e.z),this.w<t.w?this.w=t.w:this.w>e.w&&(this.w=e.w),this},clampScalar:function(){var t,e;return function(n,r){return void 0===t&&(t=new THREE.Vector4,e=new THREE.Vector4),t.set(n,n,n,n),e.set(r,r,r,r),this.clamp(t,e)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x),this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y),this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z),this.w=0>this.w?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(t){var e=this.length();return 0!==e&&t!==e&&this.multiplyScalar(t/e),this},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w},fromArray:function(t){return this.x=t[0],this.y=t[1],this.z=t[2],this.w=t[3],this},toArray:function(){return[this.x,this.y,this.z,this.w]},clone:function(){return new THREE.Vector4(this.x,this.y,this.z,this.w)}},THREE.Euler=function(t,e,n,r){this._x=t||0,this._y=e||0,this._z=n||0,this._order=r||THREE.Euler.DefaultOrder},THREE.Euler.RotationOrders="XYZ YZX ZXY XZY YXZ ZYX".split(" "),THREE.Euler.DefaultOrder="XYZ",THREE.Euler.prototype={constructor:THREE.Euler,_x:0,_y:0,_z:0,_order:THREE.Euler.DefaultOrder,get x(){return this._x},set x(t){this._x=t,this.onChangeCallback()},get y(){return this._y},set y(t){this._y=t,this.onChangeCallback()},get z(){return this._z},set z(t){this._z=t,this.onChangeCallback()},get order(){return this._order},set order(t){this._order=t,this.onChangeCallback()},set:function(t,e,n,r){return this._x=t,this._y=e,this._z=n,this._order=r||this._order,this.onChangeCallback(),this},copy:function(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this.onChangeCallback(),this},setFromRotationMatrix:function(t,e){var n=THREE.Math.clamp,r=t.elements,i=r[0],o=r[4],a=r[8],s=r[1],h=r[5],u=r[9],c=r[2],l=r[6],r=r[10];return e=e||this._order,"XYZ"===e?(this._y=Math.asin(n(a,-1,1)),.99999>Math.abs(a)?(this._x=Math.atan2(-u,r),this._z=Math.atan2(-o,i)):(this._x=Math.atan2(l,h),this._z=0)):"YXZ"===e?(this._x=Math.asin(-n(u,-1,1)),.99999>Math.abs(u)?(this._y=Math.atan2(a,r),this._z=Math.atan2(s,h)):(this._y=Math.atan2(-c,i),this._z=0)):"ZXY"===e?(this._x=Math.asin(n(l,-1,1)),.99999>Math.abs(l)?(this._y=Math.atan2(-c,r),this._z=Math.atan2(-o,h)):(this._y=0,this._z=Math.atan2(s,i))):"ZYX"===e?(this._y=Math.asin(-n(c,-1,1)),.99999>Math.abs(c)?(this._x=Math.atan2(l,r),this._z=Math.atan2(s,i)):(this._x=0,this._z=Math.atan2(-o,h))):"YZX"===e?(this._z=Math.asin(n(s,-1,1)),.99999>Math.abs(s)?(this._x=Math.atan2(-u,h),this._y=Math.atan2(-c,i)):(this._x=0,this._y=Math.atan2(a,r))):"XZY"===e?(this._z=Math.asin(-n(o,-1,1)),.99999>Math.abs(o)?(this._x=Math.atan2(l,h),this._y=Math.atan2(a,i)):(this._x=Math.atan2(-u,r),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+e),this._order=e,this.onChangeCallback(),this},setFromQuaternion:function(t,e,n){var r=THREE.Math.clamp,i=t.x*t.x,o=t.y*t.y,a=t.z*t.z,s=t.w*t.w;return e=e||this._order,"XYZ"===e?(this._x=Math.atan2(2*(t.x*t.w-t.y*t.z),s-i-o+a),this._y=Math.asin(r(2*(t.x*t.z+t.y*t.w),-1,1)),this._z=Math.atan2(2*(t.z*t.w-t.x*t.y),s+i-o-a)):"YXZ"===e?(this._x=Math.asin(r(2*(t.x*t.w-t.y*t.z),-1,1)),this._y=Math.atan2(2*(t.x*t.z+t.y*t.w),s-i-o+a),this._z=Math.atan2(2*(t.x*t.y+t.z*t.w),s-i+o-a)):"ZXY"===e?(this._x=Math.asin(r(2*(t.x*t.w+t.y*t.z),-1,1)),this._y=Math.atan2(2*(t.y*t.w-t.z*t.x),s-i-o+a),this._z=Math.atan2(2*(t.z*t.w-t.x*t.y),s-i+o-a)):"ZYX"===e?(this._x=Math.atan2(2*(t.x*t.w+t.z*t.y),s-i-o+a),this._y=Math.asin(r(2*(t.y*t.w-t.x*t.z),-1,1)),this._z=Math.atan2(2*(t.x*t.y+t.z*t.w),s+i-o-a)):"YZX"===e?(this._x=Math.atan2(2*(t.x*t.w-t.z*t.y),s-i+o-a),this._y=Math.atan2(2*(t.y*t.w-t.x*t.z),s+i-o-a),this._z=Math.asin(r(2*(t.x*t.y+t.z*t.w),-1,1))):"XZY"===e?(this._x=Math.atan2(2*(t.x*t.w+t.y*t.z),s-i+o-a),this._y=Math.atan2(2*(t.x*t.z+t.y*t.w),s+i-o-a),this._z=Math.asin(r(2*(t.z*t.w-t.x*t.y),-1,1))):console.warn("THREE.Euler: .setFromQuaternion() given unsupported order: "+e),this._order=e,!1!==n&&this.onChangeCallback(),this},reorder:function(){var t=new THREE.Quaternion;return function(e){t.setFromEuler(this),this.setFromQuaternion(t,e)}}(),equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order},fromArray:function(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this.onChangeCallback(),this},toArray:function(){return[this._x,this._y,this._z,this._order]},onChange:function(t){return this.onChangeCallback=t,this},onChangeCallback:function(){},clone:function(){return new THREE.Euler(this._x,this._y,this._z,this._order)}},THREE.Line3=function(t,e){this.start=void 0!==t?t:new THREE.Vector3,this.end=void 0!==e?e:new THREE.Vector3},THREE.Line3.prototype={constructor:THREE.Line3,set:function(t,e){return this.start.copy(t),this.end.copy(e),this},copy:function(t){return this.start.copy(t.start),this.end.copy(t.end),this},center:function(t){return(t||new THREE.Vector3).addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(t){return(t||new THREE.Vector3).subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(t,e){var n=e||new THREE.Vector3;return this.delta(n).multiplyScalar(t).add(this.start)},closestPointToPointParameter:function(){var t=new THREE.Vector3,e=new THREE.Vector3;return function(n,r){t.subVectors(n,this.start),e.subVectors(this.end,this.start);var i=e.dot(e),i=e.dot(t)/i;return r&&(i=THREE.Math.clamp(i,0,1)),i}}(),closestPointToPoint:function(t,e,n){return t=this.closestPointToPointParameter(t,e),n=n||new THREE.Vector3,this.delta(n).multiplyScalar(t).add(this.start)},applyMatrix4:function(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this},equals:function(t){return t.start.equals(this.start)&&t.end.equals(this.end)},clone:function(){return(new THREE.Line3).copy(this)}},THREE.Box2=function(t,e){this.min=void 0!==t?t:new THREE.Vector2(1/0,1/0),this.max=void 0!==e?e:new THREE.Vector2(-1/0,-1/0)},THREE.Box2.prototype={constructor:THREE.Box2,set:function(t,e){return this.min.copy(t),this.max.copy(e),this},setFromPoints:function(t){this.makeEmpty();for(var e=0,n=t.length;n>e;e++)this.expandByPoint(t[e]);return this},setFromCenterAndSize:function(){var t=new THREE.Vector2;return function(e,n){var r=t.copy(n).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}}(),copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},center:function(t){return(t||new THREE.Vector2).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(t){return(t||new THREE.Vector2).subVectors(this.max,this.min)},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByVector:function(t){return this.min.sub(t),this.max.add(t),this},expandByScalar:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},containsPoint:function(t){return t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y?!1:!0},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y?!0:!1},getParameter:function(t,e){return(e||new THREE.Vector2).set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))},isIntersectionBox:function(t){return t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y?!1:!0},clampPoint:function(t,e){return(e||new THREE.Vector2).copy(t).clamp(this.min,this.max)},distanceToPoint:function(){var t=new THREE.Vector2;return function(e){return t.copy(e).clamp(this.min,this.max).sub(e).length()}}(),intersect:function(t){return this.min.max(t.min),this.max.min(t.max),this},union:function(t){return this.min.min(t.min),this.max.max(t.max),this},translate:function(t){return this.min.add(t),this.max.add(t),this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)},clone:function(){return(new THREE.Box2).copy(this)}},THREE.Box3=function(t,e){this.min=void 0!==t?t:new THREE.Vector3(1/0,1/0,1/0),this.max=void 0!==e?e:new THREE.Vector3(-1/0,-1/0,-1/0)},THREE.Box3.prototype={constructor:THREE.Box3,set:function(t,e){return this.min.copy(t),this.max.copy(e),this},setFromPoints:function(t){this.makeEmpty();for(var e=0,n=t.length;n>e;e++)this.expandByPoint(t[e]);return this},setFromCenterAndSize:function(){var t=new THREE.Vector3;return function(e,n){var r=t.copy(n).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}}(),setFromObject:function(){var t=new THREE.Vector3;return function(e){var n=this;return e.updateMatrixWorld(!0),this.makeEmpty(),e.traverse(function(e){if(void 0!==e.geometry&&void 0!==e.geometry.vertices)for(var r=e.geometry.vertices,i=0,o=r.length;o>i;i++)t.copy(r[i]),t.applyMatrix4(e.matrixWorld),n.expandByPoint(t)}),this}}(),copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},center:function(t){return(t||new THREE.Vector3).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(t){return(t||new THREE.Vector3).subVectors(this.max,this.min)},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByVector:function(t){return this.min.sub(t),this.max.add(t),this},expandByScalar:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},containsPoint:function(t){return t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z?!1:!0},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z?!0:!1},getParameter:function(t,e){return(e||new THREE.Vector3).set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))},isIntersectionBox:function(t){return t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z?!1:!0},clampPoint:function(t,e){return(e||new THREE.Vector3).copy(t).clamp(this.min,this.max)},distanceToPoint:function(){var t=new THREE.Vector3;return function(e){return t.copy(e).clamp(this.min,this.max).sub(e).length()}}(),getBoundingSphere:function(){var t=new THREE.Vector3;return function(e){return e=e||new THREE.Sphere,e.center=this.center(),e.radius=.5*this.size(t).length(),e}}(),intersect:function(t){return this.min.max(t.min),this.max.min(t.max),this},union:function(t){return this.min.min(t.min),this.max.max(t.max),this},applyMatrix4:function(){var t=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];return function(e){return t[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),t[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),t[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),t[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),t[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),t[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),t[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),t[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.makeEmpty(),this.setFromPoints(t),this}}(),translate:function(t){return this.min.add(t),this.max.add(t),this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)},clone:function(){return(new THREE.Box3).copy(this)}},THREE.Matrix3=function(t,e,n,r,i,o,a,s,h){var u=this.elements=new Float32Array(9);u[0]=void 0!==t?t:1,u[3]=e||0,u[6]=n||0,u[1]=r||0,u[4]=void 0!==i?i:1,u[7]=o||0,u[2]=a||0,u[5]=s||0,u[8]=void 0!==h?h:1},THREE.Matrix3.prototype={constructor:THREE.Matrix3,set:function(t,e,n,r,i,o,a,s,h){var u=this.elements;return u[0]=t,u[3]=e,u[6]=n,u[1]=r,u[4]=i,u[7]=o,u[2]=a,u[5]=s,u[8]=h,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},copy:function(t){return t=t.elements,this.set(t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8]),this},multiplyVector3:function(t){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},multiplyVector3Array:function(t){return console.warn("THREE.Matrix3: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead."),this.applyToVector3Array(t)},applyToVector3Array:function(){var t=new THREE.Vector3;return function(e,n,r){void 0===n&&(n=0),void 0===r&&(r=e.length);for(var i=0;r>i;i+=3,n+=3)t.x=e[n],t.y=e[n+1],t.z=e[n+2],t.applyMatrix3(this),e[n]=t.x,e[n+1]=t.y,e[n+2]=t.z;return e}}(),multiplyScalar:function(t){var e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this},determinant:function(){var t=this.elements,e=t[0],n=t[1],r=t[2],i=t[3],o=t[4],a=t[5],s=t[6],h=t[7],t=t[8];return e*o*t-e*a*h-n*i*t+n*a*s+r*i*h-r*o*s},getInverse:function(t,e){var n=t.elements,r=this.elements;if(r[0]=n[10]*n[5]-n[6]*n[9],r[1]=-n[10]*n[1]+n[2]*n[9],r[2]=n[6]*n[1]-n[2]*n[5],r[3]=-n[10]*n[4]+n[6]*n[8],r[4]=n[10]*n[0]-n[2]*n[8],r[5]=-n[6]*n[0]+n[2]*n[4],r[6]=n[9]*n[4]-n[5]*n[8],r[7]=-n[9]*n[0]+n[1]*n[8],r[8]=n[5]*n[0]-n[1]*n[4],n=n[0]*r[0]+n[1]*r[3]+n[2]*r[6],0===n){if(e)throw Error("Matrix3.getInverse(): can't invert matrix, determinant is 0");return console.warn("Matrix3.getInverse(): can't invert matrix, determinant is 0"),this.identity(),this}return this.multiplyScalar(1/n),this},transpose:function(){var t,e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this},flattenToArrayOffset:function(t,e){var n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t},getNormalMatrix:function(t){return this.getInverse(t).transpose(),this},transposeIntoArray:function(t){var e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this},fromArray:function(t){return this.elements.set(t),this},toArray:function(){var t=this.elements;return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8]]},clone:function(){var t=this.elements;return new THREE.Matrix3(t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8])}},THREE.Matrix4=function(t,e,n,r,i,o,a,s,h,u,c,l,f,p,d,m){var g=this.elements=new Float32Array(16);g[0]=void 0!==t?t:1,g[4]=e||0,g[8]=n||0,g[12]=r||0,g[1]=i||0,g[5]=void 0!==o?o:1,g[9]=a||0,g[13]=s||0,g[2]=h||0,g[6]=u||0,g[10]=void 0!==c?c:1,g[14]=l||0,g[3]=f||0,g[7]=p||0,g[11]=d||0,g[15]=void 0!==m?m:1},THREE.Matrix4.prototype={constructor:THREE.Matrix4,set:function(t,e,n,r,i,o,a,s,h,u,c,l,f,p,d,m){var g=this.elements;return g[0]=t,g[4]=e,g[8]=n,g[12]=r,g[1]=i,g[5]=o,g[9]=a,g[13]=s,g[2]=h,g[6]=u,g[10]=c,g[14]=l,g[3]=f,g[7]=p,g[11]=d,g[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},copy:function(t){return this.elements.set(t.elements),this},extractPosition:function(t){return console.warn("THREEMatrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(t)},copyPosition:function(t){var e=this.elements;return t=t.elements,e[12]=t[12],e[13]=t[13],e[14]=t[14],this},extractRotation:function(){var t=new THREE.Vector3;return function(e){var n=this.elements;e=e.elements;var r=1/t.set(e[0],e[1],e[2]).length(),i=1/t.set(e[4],e[5],e[6]).length(),o=1/t.set(e[8],e[9],e[10]).length();return n[0]=e[0]*r,n[1]=e[1]*r,n[2]=e[2]*r,n[4]=e[4]*i,n[5]=e[5]*i,n[6]=e[6]*i,n[8]=e[8]*o,n[9]=e[9]*o,n[10]=e[10]*o,this}}(),makeRotationFromEuler:function(t){!1==t instanceof THREE.Euler&&console.error("THREE.Matrix: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var e=this.elements,n=t.x,r=t.y,i=t.z,o=Math.cos(n),n=Math.sin(n),a=Math.cos(r),r=Math.sin(r),s=Math.cos(i),i=Math.sin(i);
if("XYZ"===t.order){t=o*s;var h=o*i,u=n*s,c=n*i;e[0]=a*s,e[4]=-a*i,e[8]=r,e[1]=h+u*r,e[5]=t-c*r,e[9]=-n*a,e[2]=c-t*r,e[6]=u+h*r,e[10]=o*a}else"YXZ"===t.order?(t=a*s,h=a*i,u=r*s,c=r*i,e[0]=t+c*n,e[4]=u*n-h,e[8]=o*r,e[1]=o*i,e[5]=o*s,e[9]=-n,e[2]=h*n-u,e[6]=c+t*n,e[10]=o*a):"ZXY"===t.order?(t=a*s,h=a*i,u=r*s,c=r*i,e[0]=t-c*n,e[4]=-o*i,e[8]=u+h*n,e[1]=h+u*n,e[5]=o*s,e[9]=c-t*n,e[2]=-o*r,e[6]=n,e[10]=o*a):"ZYX"===t.order?(t=o*s,h=o*i,u=n*s,c=n*i,e[0]=a*s,e[4]=u*r-h,e[8]=t*r+c,e[1]=a*i,e[5]=c*r+t,e[9]=h*r-u,e[2]=-r,e[6]=n*a,e[10]=o*a):"YZX"===t.order?(t=o*a,h=o*r,u=n*a,c=n*r,e[0]=a*s,e[4]=c-t*i,e[8]=u*i+h,e[1]=i,e[5]=o*s,e[9]=-n*s,e[2]=-r*s,e[6]=h*i+u,e[10]=t-c*i):"XZY"===t.order&&(t=o*a,h=o*r,u=n*a,c=n*r,e[0]=a*s,e[4]=-i,e[8]=r*s,e[1]=t*i+c,e[5]=o*s,e[9]=h*i-u,e[2]=u*i-h,e[6]=n*s,e[10]=c*i+t);return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},setRotationFromQuaternion:function(t){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(t)},makeRotationFromQuaternion:function(t){var e=this.elements,n=t.x,r=t.y,i=t.z,o=t.w,a=n+n,s=r+r,h=i+i;t=n*a;var u=n*s,n=n*h,c=r*s,r=r*h,i=i*h,a=o*a,s=o*s,o=o*h;return e[0]=1-(c+i),e[4]=u-o,e[8]=n+s,e[1]=u+o,e[5]=1-(t+i),e[9]=r-a,e[2]=n-s,e[6]=r+a,e[10]=1-(t+c),e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},lookAt:function(){var t=new THREE.Vector3,e=new THREE.Vector3,n=new THREE.Vector3;return function(r,i,o){var a=this.elements;return n.subVectors(r,i).normalize(),0===n.length()&&(n.z=1),t.crossVectors(o,n).normalize(),0===t.length()&&(n.x+=1e-4,t.crossVectors(o,n).normalize()),e.crossVectors(n,t),a[0]=t.x,a[4]=e.x,a[8]=n.x,a[1]=t.y,a[5]=e.y,a[9]=n.y,a[2]=t.z,a[6]=e.z,a[10]=n.z,this}}(),multiply:function(t,e){return void 0!==e?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,e)):this.multiplyMatrices(this,t)},multiplyMatrices:function(t,e){var n=t.elements,r=e.elements,i=this.elements,o=n[0],a=n[4],s=n[8],h=n[12],u=n[1],c=n[5],l=n[9],f=n[13],p=n[2],d=n[6],m=n[10],g=n[14],v=n[3],y=n[7],E=n[11],n=n[15],x=r[0],T=r[4],b=r[8],R=r[12],w=r[1],_=r[5],H=r[9],M=r[13],S=r[2],C=r[6],A=r[10],L=r[14],P=r[3],D=r[7],z=r[11],r=r[15];return i[0]=o*x+a*w+s*S+h*P,i[4]=o*T+a*_+s*C+h*D,i[8]=o*b+a*H+s*A+h*z,i[12]=o*R+a*M+s*L+h*r,i[1]=u*x+c*w+l*S+f*P,i[5]=u*T+c*_+l*C+f*D,i[9]=u*b+c*H+l*A+f*z,i[13]=u*R+c*M+l*L+f*r,i[2]=p*x+d*w+m*S+g*P,i[6]=p*T+d*_+m*C+g*D,i[10]=p*b+d*H+m*A+g*z,i[14]=p*R+d*M+m*L+g*r,i[3]=v*x+y*w+E*S+n*P,i[7]=v*T+y*_+E*C+n*D,i[11]=v*b+y*H+E*A+n*z,i[15]=v*R+y*M+E*L+n*r,this},multiplyToArray:function(t,e,n){var r=this.elements;return this.multiplyMatrices(t,e),n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n[8]=r[8],n[9]=r[9],n[10]=r[10],n[11]=r[11],n[12]=r[12],n[13]=r[13],n[14]=r[14],n[15]=r[15],this},multiplyScalar:function(t){var e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this},multiplyVector3:function(t){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead."),t.applyProjection(this)},multiplyVector4:function(t){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},multiplyVector3Array:function(t){return console.warn("THREE.Matrix4: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead."),this.applyToVector3Array(t)},applyToVector3Array:function(){var t=new THREE.Vector3;return function(e,n,r){void 0===n&&(n=0),void 0===r&&(r=e.length);for(var i=0;r>i;i+=3,n+=3)t.x=e[n],t.y=e[n+1],t.z=e[n+2],t.applyMatrix4(this),e[n]=t.x,e[n+1]=t.y,e[n+2]=t.z;return e}}(),rotateAxis:function(t){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),t.transformDirection(this)},crossVector:function(t){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},determinant:function(){var t=this.elements,e=t[0],n=t[4],r=t[8],i=t[12],o=t[1],a=t[5],s=t[9],h=t[13],u=t[2],c=t[6],l=t[10],f=t[14];return t[3]*(+i*s*c-r*h*c-i*a*l+n*h*l+r*a*f-n*s*f)+t[7]*(+e*s*f-e*h*l+i*o*l-r*o*f+r*h*u-i*s*u)+t[11]*(+e*h*c-e*a*f-i*o*c+n*o*f+i*a*u-n*h*u)+t[15]*(-r*a*u-e*s*c+e*a*l+r*o*c-n*o*l+n*s*u)},transpose:function(){var t,e=this.elements;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this},flattenToArrayOffset:function(t,e){var n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t[e+9]=n[9],t[e+10]=n[10],t[e+11]=n[11],t[e+12]=n[12],t[e+13]=n[13],t[e+14]=n[14],t[e+15]=n[15],t},getPosition:function(){var t=new THREE.Vector3;return function(){console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.");var e=this.elements;return t.set(e[12],e[13],e[14])}}(),setPosition:function(t){var e=this.elements;return e[12]=t.x,e[13]=t.y,e[14]=t.z,this},getInverse:function(t,e){var n=this.elements,r=t.elements,i=r[0],o=r[4],a=r[8],s=r[12],h=r[1],u=r[5],c=r[9],l=r[13],f=r[2],p=r[6],d=r[10],m=r[14],g=r[3],v=r[7],y=r[11],r=r[15];if(n[0]=c*m*v-l*d*v+l*p*y-u*m*y-c*p*r+u*d*r,n[4]=s*d*v-a*m*v-s*p*y+o*m*y+a*p*r-o*d*r,n[8]=a*l*v-s*c*v+s*u*y-o*l*y-a*u*r+o*c*r,n[12]=s*c*p-a*l*p-s*u*d+o*l*d+a*u*m-o*c*m,n[1]=l*d*g-c*m*g-l*f*y+h*m*y+c*f*r-h*d*r,n[5]=a*m*g-s*d*g+s*f*y-i*m*y-a*f*r+i*d*r,n[9]=s*c*g-a*l*g-s*h*y+i*l*y+a*h*r-i*c*r,n[13]=a*l*f-s*c*f+s*h*d-i*l*d-a*h*m+i*c*m,n[2]=u*m*g-l*p*g+l*f*v-h*m*v-u*f*r+h*p*r,n[6]=s*p*g-o*m*g-s*f*v+i*m*v+o*f*r-i*p*r,n[10]=o*l*g-s*u*g+s*h*v-i*l*v-o*h*r+i*u*r,n[14]=s*u*f-o*l*f-s*h*p+i*l*p+o*h*m-i*u*m,n[3]=c*p*g-u*d*g-c*f*v+h*d*v+u*f*y-h*p*y,n[7]=o*d*g-a*p*g+a*f*v-i*d*v-o*f*y+i*p*y,n[11]=a*u*g-o*c*g-a*h*v+i*c*v+o*h*y-i*u*y,n[15]=o*c*f-a*u*f+a*h*p-i*c*p-o*h*d+i*u*d,n=i*n[0]+h*n[4]+f*n[8]+g*n[12],0==n){if(e)throw Error("Matrix4.getInverse(): can't invert matrix, determinant is 0");return console.warn("Matrix4.getInverse(): can't invert matrix, determinant is 0"),this.identity(),this}return this.multiplyScalar(1/n),this},translate:function(){console.warn("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.warn("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.warn("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.warn("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.warn("THREE.Matrix4: .rotateByAxis() has been removed.")},scale:function(t){var e=this.elements,n=t.x,r=t.y;return t=t.z,e[0]*=n,e[4]*=r,e[8]*=t,e[1]*=n,e[5]*=r,e[9]*=t,e[2]*=n,e[6]*=r,e[10]*=t,e[3]*=n,e[7]*=r,e[11]*=t,this},getMaxScaleOnAxis:function(){var t=this.elements;return Math.sqrt(Math.max(t[0]*t[0]+t[1]*t[1]+t[2]*t[2],Math.max(t[4]*t[4]+t[5]*t[5]+t[6]*t[6],t[8]*t[8]+t[9]*t[9]+t[10]*t[10])))},makeTranslation:function(t,e,n){return this.set(1,0,0,t,0,1,0,e,0,0,1,n,0,0,0,1),this},makeRotationX:function(t){var e=Math.cos(t);return t=Math.sin(t),this.set(1,0,0,0,0,e,-t,0,0,t,e,0,0,0,0,1),this},makeRotationY:function(t){var e=Math.cos(t);return t=Math.sin(t),this.set(e,0,t,0,0,1,0,0,-t,0,e,0,0,0,0,1),this},makeRotationZ:function(t){var e=Math.cos(t);return t=Math.sin(t),this.set(e,-t,0,0,t,e,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(t,e){var n=Math.cos(e),r=Math.sin(e),i=1-n,o=t.x,a=t.y,s=t.z,h=i*o,u=i*a;return this.set(h*o+n,h*a-r*s,h*s+r*a,0,h*a+r*s,u*a+n,u*s-r*o,0,h*s-r*a,u*s+r*o,i*s*s+n,0,0,0,0,1),this},makeScale:function(t,e,n){return this.set(t,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1),this},compose:function(t,e,n){return this.makeRotationFromQuaternion(e),this.scale(n),this.setPosition(t),this},decompose:function(){var t=new THREE.Vector3,e=new THREE.Matrix4;return function(n,r,i){var o=this.elements,a=t.set(o[0],o[1],o[2]).length(),s=t.set(o[4],o[5],o[6]).length(),h=t.set(o[8],o[9],o[10]).length();0>this.determinant()&&(a=-a),n.x=o[12],n.y=o[13],n.z=o[14],e.elements.set(this.elements),n=1/a;var o=1/s,u=1/h;return e.elements[0]*=n,e.elements[1]*=n,e.elements[2]*=n,e.elements[4]*=o,e.elements[5]*=o,e.elements[6]*=o,e.elements[8]*=u,e.elements[9]*=u,e.elements[10]*=u,r.setFromRotationMatrix(e),i.x=a,i.y=s,i.z=h,this}}(),makeFrustum:function(t,e,n,r,i,o){var a=this.elements;return a[0]=2*i/(e-t),a[4]=0,a[8]=(e+t)/(e-t),a[12]=0,a[1]=0,a[5]=2*i/(r-n),a[9]=(r+n)/(r-n),a[13]=0,a[2]=0,a[6]=0,a[10]=-(o+i)/(o-i),a[14]=-2*o*i/(o-i),a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this},makePerspective:function(t,e,n,r){t=n*Math.tan(THREE.Math.degToRad(.5*t));var i=-t;return this.makeFrustum(i*e,t*e,i,t,n,r)},makeOrthographic:function(t,e,n,r,i,o){var a=this.elements,s=e-t,h=n-r,u=o-i;return a[0]=2/s,a[4]=0,a[8]=0,a[12]=-((e+t)/s),a[1]=0,a[5]=2/h,a[9]=0,a[13]=-((n+r)/h),a[2]=0,a[6]=0,a[10]=-2/u,a[14]=-((o+i)/u),a[3]=0,a[7]=0,a[11]=0,a[15]=1,this},fromArray:function(t){return this.elements.set(t),this},toArray:function(){var t=this.elements;return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15]]},clone:function(){var t=this.elements;return new THREE.Matrix4(t[0],t[4],t[8],t[12],t[1],t[5],t[9],t[13],t[2],t[6],t[10],t[14],t[3],t[7],t[11],t[15])}},THREE.Ray=function(t,e){this.origin=void 0!==t?t:new THREE.Vector3,this.direction=void 0!==e?e:new THREE.Vector3},THREE.Ray.prototype={constructor:THREE.Ray,set:function(t,e){return this.origin.copy(t),this.direction.copy(e),this},copy:function(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this},at:function(t,e){return(e||new THREE.Vector3).copy(this.direction).multiplyScalar(t).add(this.origin)},recast:function(){var t=new THREE.Vector3;return function(e){return this.origin.copy(this.at(e,t)),this}}(),closestPointToPoint:function(t,e){var n=e||new THREE.Vector3;n.subVectors(t,this.origin);var r=n.dot(this.direction);return 0>r?n.copy(this.origin):n.copy(this.direction).multiplyScalar(r).add(this.origin)},distanceToPoint:function(){var t=new THREE.Vector3;return function(e){var n=t.subVectors(e,this.origin).dot(this.direction);return 0>n?this.origin.distanceTo(e):(t.copy(this.direction).multiplyScalar(n).add(this.origin),t.distanceTo(e))}}(),distanceSqToSegment:function(t,e,n,r){var i=t.clone().add(e).multiplyScalar(.5),o=e.clone().sub(t).normalize(),a=.5*t.distanceTo(e),s=this.origin.clone().sub(i);t=-this.direction.dot(o),e=s.dot(this.direction);var h,u,c=-s.dot(o),l=s.lengthSq(),f=Math.abs(1-t*t);return f>=0?(s=t*c-e,h=t*e-c,u=a*f,s>=0?h>=-u?u>=h?(a=1/f,s*=a,h*=a,t=s*(s+t*h+2*e)+h*(t*s+h+2*c)+l):(h=a,s=Math.max(0,-(t*h+e)),t=-s*s+h*(h+2*c)+l):(h=-a,s=Math.max(0,-(t*h+e)),t=-s*s+h*(h+2*c)+l):-u>=h?(s=Math.max(0,-(-t*a+e)),h=s>0?-a:Math.min(Math.max(-a,-c),a),t=-s*s+h*(h+2*c)+l):u>=h?(s=0,h=Math.min(Math.max(-a,-c),a),t=h*(h+2*c)+l):(s=Math.max(0,-(t*a+e)),h=s>0?a:Math.min(Math.max(-a,-c),a),t=-s*s+h*(h+2*c)+l)):(h=t>0?-a:a,s=Math.max(0,-(t*h+e)),t=-s*s+h*(h+2*c)+l),n&&n.copy(this.direction.clone().multiplyScalar(s).add(this.origin)),r&&r.copy(o.clone().multiplyScalar(h).add(i)),t},isIntersectionSphere:function(t){return this.distanceToPoint(t.center)<=t.radius},intersectSphere:function(){var t=new THREE.Vector3;return function(e,n){t.subVectors(e.center,this.origin);var r=t.dot(this.direction),i=t.dot(t)-r*r,o=e.radius*e.radius;return i>o?null:(o=Math.sqrt(o-i),i=r-o,r+=o,0>i&&0>r?null:0>i?this.at(r,n):this.at(i,n))}}(),isIntersectionPlane:function(t){var e=t.distanceToPoint(this.origin);return 0===e||0>t.normal.dot(this.direction)*e?!0:!1},distanceToPlane:function(t){var e=t.normal.dot(this.direction);return 0==e?0==t.distanceToPoint(this.origin)?0:null:(t=-(this.origin.dot(t.normal)+t.constant)/e,t>=0?t:null)},intersectPlane:function(t,e){var n=this.distanceToPlane(t);return null===n?null:this.at(n,e)},isIntersectionBox:function(){var t=new THREE.Vector3;return function(e){return null!==this.intersectBox(e,t)}}(),intersectBox:function(t,e){var n,r,i,o,a;r=1/this.direction.x,o=1/this.direction.y,a=1/this.direction.z;var s=this.origin;return r>=0?(n=(t.min.x-s.x)*r,r*=t.max.x-s.x):(n=(t.max.x-s.x)*r,r*=t.min.x-s.x),o>=0?(i=(t.min.y-s.y)*o,o*=t.max.y-s.y):(i=(t.max.y-s.y)*o,o*=t.min.y-s.y),n>o||i>r?null:((i>n||n!==n)&&(n=i),(r>o||r!==r)&&(r=o),a>=0?(i=(t.min.z-s.z)*a,a*=t.max.z-s.z):(i=(t.max.z-s.z)*a,a*=t.min.z-s.z),n>a||i>r?null:((i>n||n!==n)&&(n=i),(r>a||r!==r)&&(r=a),0>r?null:this.at(n>=0?n:r,e)))},intersectTriangle:function(){var t=new THREE.Vector3,e=new THREE.Vector3,n=new THREE.Vector3,r=new THREE.Vector3;return function(i,o,a,s,h){if(e.subVectors(o,i),n.subVectors(a,i),r.crossVectors(e,n),o=this.direction.dot(r),o>0){if(s)return null;s=1}else{if(!(0>o))return null;s=-1,o=-o}return t.subVectors(this.origin,i),i=s*this.direction.dot(n.crossVectors(t,n)),0>i?null:(a=s*this.direction.dot(e.cross(t)),0>a||i+a>o?null:(i=-s*t.dot(r),0>i?null:this.at(i/o,h)))}}(),applyMatrix4:function(t){return this.direction.add(this.origin).applyMatrix4(t),this.origin.applyMatrix4(t),this.direction.sub(this.origin),this.direction.normalize(),this},equals:function(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)},clone:function(){return(new THREE.Ray).copy(this)}},THREE.Sphere=function(t,e){this.center=void 0!==t?t:new THREE.Vector3,this.radius=void 0!==e?e:0},THREE.Sphere.prototype={constructor:THREE.Sphere,set:function(t,e){return this.center.copy(t),this.radius=e,this},setFromPoints:function(){var t=new THREE.Box3;return function(e,n){var r=this.center;void 0!==n?r.copy(n):t.setFromPoints(e).center(r);for(var i=0,o=0,a=e.length;a>o;o++)i=Math.max(i,r.distanceToSquared(e[o]));return this.radius=Math.sqrt(i),this}}(),copy:function(t){return this.center.copy(t.center),this.radius=t.radius,this},empty:function(){return 0>=this.radius},containsPoint:function(t){return t.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(t){return t.distanceTo(this.center)-this.radius},intersectsSphere:function(t){var e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e},clampPoint:function(t,e){var n=this.center.distanceToSquared(t),r=e||new THREE.Vector3;return r.copy(t),n>this.radius*this.radius&&(r.sub(this.center).normalize(),r.multiplyScalar(this.radius).add(this.center)),r},getBoundingBox:function(t){return t=t||new THREE.Box3,t.set(this.center,this.center),t.expandByScalar(this.radius),t},applyMatrix4:function(t){return this.center.applyMatrix4(t),this.radius*=t.getMaxScaleOnAxis(),this},translate:function(t){return this.center.add(t),this},equals:function(t){return t.center.equals(this.center)&&t.radius===this.radius},clone:function(){return(new THREE.Sphere).copy(this)}},THREE.Frustum=function(t,e,n,r,i,o){this.planes=[void 0!==t?t:new THREE.Plane,void 0!==e?e:new THREE.Plane,void 0!==n?n:new THREE.Plane,void 0!==r?r:new THREE.Plane,void 0!==i?i:new THREE.Plane,void 0!==o?o:new THREE.Plane]},THREE.Frustum.prototype={constructor:THREE.Frustum,set:function(t,e,n,r,i,o){var a=this.planes;return a[0].copy(t),a[1].copy(e),a[2].copy(n),a[3].copy(r),a[4].copy(i),a[5].copy(o),this},copy:function(t){for(var e=this.planes,n=0;6>n;n++)e[n].copy(t.planes[n]);return this},setFromMatrix:function(t){var e=this.planes,n=t.elements;t=n[0];var r=n[1],i=n[2],o=n[3],a=n[4],s=n[5],h=n[6],u=n[7],c=n[8],l=n[9],f=n[10],p=n[11],d=n[12],m=n[13],g=n[14],n=n[15];return e[0].setComponents(o-t,u-a,p-c,n-d).normalize(),e[1].setComponents(o+t,u+a,p+c,n+d).normalize(),e[2].setComponents(o+r,u+s,p+l,n+m).normalize(),e[3].setComponents(o-r,u-s,p-l,n-m).normalize(),e[4].setComponents(o-i,u-h,p-f,n-g).normalize(),e[5].setComponents(o+i,u+h,p+f,n+g).normalize(),this},intersectsObject:function(){var t=new THREE.Sphere;return function(e){var n=e.geometry;return null===n.boundingSphere&&n.computeBoundingSphere(),t.copy(n.boundingSphere),t.applyMatrix4(e.matrixWorld),this.intersectsSphere(t)}}(),intersectsSphere:function(t){var e=this.planes,n=t.center;t=-t.radius;for(var r=0;6>r;r++)if(e[r].distanceToPoint(n)<t)return!1;return!0},intersectsBox:function(){var t=new THREE.Vector3,e=new THREE.Vector3;return function(n){for(var r=this.planes,i=0;6>i;i++){var o=r[i];t.x=0<o.normal.x?n.min.x:n.max.x,e.x=0<o.normal.x?n.max.x:n.min.x,t.y=0<o.normal.y?n.min.y:n.max.y,e.y=0<o.normal.y?n.max.y:n.min.y,t.z=0<o.normal.z?n.min.z:n.max.z,e.z=0<o.normal.z?n.max.z:n.min.z;var a=o.distanceToPoint(t),o=o.distanceToPoint(e);if(0>a&&0>o)return!1}return!0}}(),containsPoint:function(t){for(var e=this.planes,n=0;6>n;n++)if(0>e[n].distanceToPoint(t))return!1;return!0},clone:function(){return(new THREE.Frustum).copy(this)}},THREE.Plane=function(t,e){this.normal=void 0!==t?t:new THREE.Vector3(1,0,0),this.constant=void 0!==e?e:0},THREE.Plane.prototype={constructor:THREE.Plane,set:function(t,e){return this.normal.copy(t),this.constant=e,this},setComponents:function(t,e,n,r){return this.normal.set(t,e,n),this.constant=r,this},setFromNormalAndCoplanarPoint:function(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this},setFromCoplanarPoints:function(){var t=new THREE.Vector3,e=new THREE.Vector3;return function(n,r,i){return r=t.subVectors(i,r).cross(e.subVectors(n,r)).normalize(),this.setFromNormalAndCoplanarPoint(r,n),this}}(),copy:function(t){return this.normal.copy(t.normal),this.constant=t.constant,this},normalize:function(){var t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(t){return this.normal.dot(t)+this.constant},distanceToSphere:function(t){return this.distanceToPoint(t.center)-t.radius},projectPoint:function(t,e){return this.orthoPoint(t,e).sub(t).negate()},orthoPoint:function(t,e){var n=this.distanceToPoint(t);return(e||new THREE.Vector3).copy(this.normal).multiplyScalar(n)},isIntersectionLine:function(t){var e=this.distanceToPoint(t.start);return t=this.distanceToPoint(t.end),0>e&&t>0||0>t&&e>0},intersectLine:function(){var t=new THREE.Vector3;return function(e,n){var r=n||new THREE.Vector3,i=e.delta(t),o=this.normal.dot(i);return 0!=o?(o=-(e.start.dot(this.normal)+this.constant)/o,0>o||o>1?void 0:r.copy(i).multiplyScalar(o).add(e.start)):0==this.distanceToPoint(e.start)?r.copy(e.start):void 0}}(),coplanarPoint:function(t){return(t||new THREE.Vector3).copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var t=new THREE.Vector3,e=new THREE.Vector3,n=new THREE.Matrix3;return function(r,i){var o=i||n.getNormalMatrix(r),o=t.copy(this.normal).applyMatrix3(o),a=this.coplanarPoint(e);return a.applyMatrix4(r),this.setFromNormalAndCoplanarPoint(o,a),this}}(),translate:function(t){return this.constant-=t.dot(this.normal),this},equals:function(t){return t.normal.equals(this.normal)&&t.constant==this.constant},clone:function(){return(new THREE.Plane).copy(this)}},THREE.Math={generateUUID:function(){var t,e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),n=Array(36),r=0;return function(){for(var i=0;36>i;i++)8==i||13==i||18==i||23==i?n[i]="-":14==i?n[i]="4":(2>=r&&(r=33554432+16777216*Math.random()|0),t=15&r,r>>=4,n[i]=e[19==i?3&t|8:t]);return n.join("")}}(),clamp:function(t,e,n){return e>t?e:t>n?n:t},clampBottom:function(t,e){return e>t?e:t},mapLinear:function(t,e,n,r,i){return r+(t-e)*(i-r)/(n-e)},smoothstep:function(t,e,n){return e>=t?0:t>=n?1:(t=(t-e)/(n-e),t*t*(3-2*t))},smootherstep:function(t,e,n){return e>=t?0:t>=n?1:(t=(t-e)/(n-e),t*t*t*(t*(6*t-15)+10))},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},sign:function(t){return 0>t?-1:t>0?1:0},degToRad:function(){var t=Math.PI/180;return function(e){return e*t}}(),radToDeg:function(){var t=180/Math.PI;return function(e){return e*t}}(),isPowerOfTwo:function(t){return 0===(t&t-1)&&0!==t}},THREE.Spline=function(t){function e(t,e,n,r,i,o,a){return t=.5*(n-t),r=.5*(r-e),(2*(e-n)+t+r)*a+(-3*(e-n)-2*t-r)*o+t*i+e}this.points=t;var n,r,i,o,a,s,h,u,c,l=[],f={x:0,y:0,z:0};this.initFromArray=function(t){this.points=[];for(var e=0;e<t.length;e++)this.points[e]={x:t[e][0],y:t[e][1],z:t[e][2]}},this.getPoint=function(t){return n=(this.points.length-1)*t,r=Math.floor(n),i=n-r,l[0]=0===r?r:r-1,l[1]=r,l[2]=r>this.points.length-2?this.points.length-1:r+1,l[3]=r>this.points.length-3?this.points.length-1:r+2,s=this.points[l[0]],h=this.points[l[1]],u=this.points[l[2]],c=this.points[l[3]],o=i*i,a=i*o,f.x=e(s.x,h.x,u.x,c.x,i,o,a),f.y=e(s.y,h.y,u.y,c.y,i,o,a),f.z=e(s.z,h.z,u.z,c.z,i,o,a),f},this.getControlPointsArray=function(){var t,e,n=this.points.length,r=[];for(t=0;n>t;t++)e=this.points[t],r[t]=[e.x,e.y,e.z];return r},this.getLength=function(t){var e,n,r,i=e=e=0,o=new THREE.Vector3,a=new THREE.Vector3,s=[],h=0;for(s[0]=0,t||(t=100),n=this.points.length*t,o.copy(this.points[0]),t=1;n>t;t++)e=t/n,r=this.getPoint(e),a.copy(r),h+=a.distanceTo(o),o.copy(r),e*=this.points.length-1,e=Math.floor(e),e!=i&&(s[e]=h,i=e);return s[s.length]=h,{chunks:s,total:h}},this.reparametrizeByArcLength=function(t){var e,n,r,i,o,a,s=[],h=new THREE.Vector3,u=this.getLength();for(s.push(h.copy(this.points[0]).clone()),e=1;e<this.points.length;e++){for(n=u.chunks[e]-u.chunks[e-1],a=Math.ceil(t*n/u.total),i=(e-1)/(this.points.length-1),o=e/(this.points.length-1),n=1;a-1>n;n++)r=i+1/a*n*(o-i),r=this.getPoint(r),s.push(h.copy(r).clone());s.push(h.copy(this.points[e]).clone())}this.points=s}},THREE.Triangle=function(t,e,n){this.a=void 0!==t?t:new THREE.Vector3,this.b=void 0!==e?e:new THREE.Vector3,this.c=void 0!==n?n:new THREE.Vector3},THREE.Triangle.normal=function(){var t=new THREE.Vector3;return function(e,n,r,i){return i=i||new THREE.Vector3,i.subVectors(r,n),t.subVectors(e,n),i.cross(t),e=i.lengthSq(),e>0?i.multiplyScalar(1/Math.sqrt(e)):i.set(0,0,0)}}(),THREE.Triangle.barycoordFromPoint=function(){var t=new THREE.Vector3,e=new THREE.Vector3,n=new THREE.Vector3;return function(r,i,o,a,s){t.subVectors(a,i),e.subVectors(o,i),n.subVectors(r,i),r=t.dot(t),i=t.dot(e),o=t.dot(n);var h=e.dot(e);a=e.dot(n);var u=r*h-i*i;return s=s||new THREE.Vector3,0==u?s.set(-2,-1,-1):(u=1/u,h=(h*o-i*a)*u,r=(r*a-i*o)*u,s.set(1-h-r,r,h))}}(),THREE.Triangle.containsPoint=function(){var t=new THREE.Vector3;return function(e,n,r,i){return e=THREE.Triangle.barycoordFromPoint(e,n,r,i,t),0<=e.x&&0<=e.y&&1>=e.x+e.y}}(),THREE.Triangle.prototype={constructor:THREE.Triangle,set:function(t,e,n){return this.a.copy(t),this.b.copy(e),this.c.copy(n),this},setFromPointsAndIndices:function(t,e,n,r){return this.a.copy(t[e]),this.b.copy(t[n]),this.c.copy(t[r]),this},copy:function(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this},area:function(){var t=new THREE.Vector3,e=new THREE.Vector3;return function(){return t.subVectors(this.c,this.b),e.subVectors(this.a,this.b),.5*t.cross(e).length()}}(),midpoint:function(t){return(t||new THREE.Vector3).addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(t){return THREE.Triangle.normal(this.a,this.b,this.c,t)},plane:function(t){return(t||new THREE.Plane).setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(t,e){return THREE.Triangle.barycoordFromPoint(t,this.a,this.b,this.c,e)},containsPoint:function(t){return THREE.Triangle.containsPoint(t,this.a,this.b,this.c)},equals:function(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)},clone:function(){return(new THREE.Triangle).copy(this)}},THREE.Clock=function(t){this.autoStart=void 0!==t?t:!0,this.elapsedTime=this.oldTime=this.startTime=0,this.running=!1},THREE.Clock.prototype={constructor:THREE.Clock,start:function(){this.oldTime=this.startTime=void 0!==self.performance&&void 0!==self.performance.now?self.performance.now():Date.now(),this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var t=0;if(this.autoStart&&!this.running&&this.start(),this.running){var e=void 0!==self.performance&&void 0!==self.performance.now?self.performance.now():Date.now(),t=.001*(e-this.oldTime);this.oldTime=e,this.elapsedTime+=t}return t}},THREE.EventDispatcher=function(){},THREE.EventDispatcher.prototype={constructor:THREE.EventDispatcher,apply:function(t){t.addEventListener=THREE.EventDispatcher.prototype.addEventListener,t.hasEventListener=THREE.EventDispatcher.prototype.hasEventListener,t.removeEventListener=THREE.EventDispatcher.prototype.removeEventListener,t.dispatchEvent=THREE.EventDispatcher.prototype.dispatchEvent},addEventListener:function(t,e){void 0===this._listeners&&(this._listeners={});var n=this._listeners;void 0===n[t]&&(n[t]=[]),-1===n[t].indexOf(e)&&n[t].push(e)},hasEventListener:function(t,e){if(void 0===this._listeners)return!1;var n=this._listeners;return void 0!==n[t]&&-1!==n[t].indexOf(e)?!0:!1},removeEventListener:function(t,e){if(void 0!==this._listeners){var n=this._listeners[t];if(void 0!==n){var r=n.indexOf(e);-1!==r&&n.splice(r,1)}}},dispatchEvent:function(t){if(void 0!==this._listeners){var e=this._listeners[t.type];if(void 0!==e){t.target=this;for(var n=[],r=e.length,i=0;r>i;i++)n[i]=e[i];for(i=0;r>i;i++)n[i].call(this,t)}}}},function(t){t.Raycaster=function(e,n,r,i){this.ray=new t.Ray(e,n),this.near=r||0,this.far=i||1/0,this.params={Sprite:{},Mesh:{},PointCloud:{threshold:1},LOD:{},Line:{}}};var e=function(t,e){return t.distance-e.distance},n=function(t,e,r,i){if(t.raycast(e,r),!0===i){t=t.children,i=0;for(var o=t.length;o>i;i++)n(t[i],e,r,!0)}};t.Raycaster.prototype={constructor:t.Raycaster,precision:1e-4,linePrecision:1,set:function(t,e){this.ray.set(t,e)},intersectObject:function(t,r){var i=[];return n(t,this,i,r),i.sort(e),i},intersectObjects:function(t,r){for(var i=[],o=0,a=t.length;a>o;o++)n(t[o],this,i,r);return i.sort(e),i}}}(THREE),THREE.Object3D=function(){this.id=THREE.Object3DIdCount++,this.uuid=THREE.Math.generateUUID(),this.name="",this.parent=void 0,this.children=[],this.up=THREE.Object3D.DefaultUp.clone();var t=new THREE.Vector3,e=new THREE.Euler,n=new THREE.Quaternion,r=new THREE.Vector3(1,1,1);e.onChange(function(){n.setFromEuler(e,!1)}),n.onChange(function(){e.setFromQuaternion(n,void 0,!1)}),Object.defineProperties(this,{position:{enumerable:!0,value:t},rotation:{enumerable:!0,value:e},quaternion:{enumerable:!0,value:n},scale:{enumerable:!0,value:r}}),this.renderDepth=null,this.rotationAutoUpdate=!0,this.matrix=new THREE.Matrix4,this.matrixWorld=new THREE.Matrix4,this.matrixAutoUpdate=!0,this.matrixWorldNeedsUpdate=!1,this.visible=!0,this.receiveShadow=this.castShadow=!1,this.frustumCulled=!0,this.userData={}},THREE.Object3D.DefaultUp=new THREE.Vector3(0,1,0),THREE.Object3D.prototype={constructor:THREE.Object3D,get eulerOrder(){return console.warn("THREE.Object3D: .eulerOrder has been moved to .rotation.order."),this.rotation.order},set eulerOrder(t){console.warn("THREE.Object3D: .eulerOrder has been moved to .rotation.order."),this.rotation.order=t},get useQuaternion(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set useQuaternion(t){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},applyMatrix:function(t){this.matrix.multiplyMatrices(t,this.matrix),this.matrix.decompose(this.position,this.quaternion,this.scale)},setRotationFromAxisAngle:function(t,e){this.quaternion.setFromAxisAngle(t,e)},setRotationFromEuler:function(t){this.quaternion.setFromEuler(t,!0)},setRotationFromMatrix:function(t){this.quaternion.setFromRotationMatrix(t)},setRotationFromQuaternion:function(t){this.quaternion.copy(t)},rotateOnAxis:function(){var t=new THREE.Quaternion;return function(e,n){return t.setFromAxisAngle(e,n),this.quaternion.multiply(t),this}}(),rotateX:function(){var t=new THREE.Vector3(1,0,0);return function(e){return this.rotateOnAxis(t,e)}}(),rotateY:function(){var t=new THREE.Vector3(0,1,0);return function(e){return this.rotateOnAxis(t,e)}}(),rotateZ:function(){var t=new THREE.Vector3(0,0,1);return function(e){return this.rotateOnAxis(t,e)}}(),translateOnAxis:function(){var t=new THREE.Vector3;return function(e,n){return t.copy(e).applyQuaternion(this.quaternion),this.position.add(t.multiplyScalar(n)),this}}(),translate:function(t,e){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(e,t)},translateX:function(){var t=new THREE.Vector3(1,0,0);return function(e){return this.translateOnAxis(t,e)}}(),translateY:function(){var t=new THREE.Vector3(0,1,0);return function(e){return this.translateOnAxis(t,e)}}(),translateZ:function(){var t=new THREE.Vector3(0,0,1);return function(e){return this.translateOnAxis(t,e)}}(),localToWorld:function(t){return t.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var t=new THREE.Matrix4;return function(e){return e.applyMatrix4(t.getInverse(this.matrixWorld))}}(),lookAt:function(){var t=new THREE.Matrix4;return function(e){t.lookAt(e,this.position,this.up),this.quaternion.setFromRotationMatrix(t)}}(),add:function(t){if(1<arguments.length){for(var e=0;e<arguments.length;e++)this.add(arguments[e]);return this}if(t===this)return console.error("THREE.Object3D.add:",t,"can't be added as a child of itself."),this;if(t instanceof THREE.Object3D){for(void 0!==t.parent&&t.parent.remove(t),t.parent=this,t.dispatchEvent({type:"added"}),this.children.push(t),e=this;void 0!==e.parent;)e=e.parent;void 0!==e&&e instanceof THREE.Scene&&e.__addObject(t)}else console.error("THREE.Object3D.add:",t,"is not an instance of THREE.Object3D.");return this},remove:function(t){if(1<arguments.length)for(var e=0;e<arguments.length;e++)this.remove(arguments[e]);if(e=this.children.indexOf(t),-1!==e){for(t.parent=void 0,t.dispatchEvent({type:"removed"}),this.children.splice(e,1),e=this;void 0!==e.parent;)e=e.parent;void 0!==e&&e instanceof THREE.Scene&&e.__removeObject(t)}},raycast:function(){},traverse:function(t){t(this);for(var e=0,n=this.children.length;n>e;e++)this.children[e].traverse(t)},traverseVisible:function(t){if(!1!==this.visible){t(this);for(var e=0,n=this.children.length;n>e;e++)this.children[e].traverseVisible(t)}},getObjectById:function(t,e){for(var n=0,r=this.children.length;r>n;n++){var i=this.children[n];if(i.id===t||!0===e&&(i=i.getObjectById(t,e),void 0!==i))return i}},getObjectByName:function(t,e){for(var n=0,r=this.children.length;r>n;n++){var i=this.children[n];if(i.name===t||!0===e&&(i=i.getObjectByName(t,e),void 0!==i))return i}},getChildByName:function(t,e){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(t,e)},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(t){!0===this.matrixAutoUpdate&&this.updateMatrix(),(!0===this.matrixWorldNeedsUpdate||!0===t)&&(void 0===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);for(var e=0,n=this.children.length;n>e;e++)this.children[e].updateMatrixWorld(t)},clone:function(t,e){if(void 0===t&&(t=new THREE.Object3D),void 0===e&&(e=!0),t.name=this.name,t.up.copy(this.up),t.position.copy(this.position),t.quaternion.copy(this.quaternion),t.scale.copy(this.scale),t.renderDepth=this.renderDepth,t.rotationAutoUpdate=this.rotationAutoUpdate,t.matrix.copy(this.matrix),t.matrixWorld.copy(this.matrixWorld),t.matrixAutoUpdate=this.matrixAutoUpdate,t.matrixWorldNeedsUpdate=this.matrixWorldNeedsUpdate,t.visible=this.visible,t.castShadow=this.castShadow,t.receiveShadow=this.receiveShadow,t.frustumCulled=this.frustumCulled,t.userData=JSON.parse(JSON.stringify(this.userData)),!0===e)for(var n=0;n<this.children.length;n++)t.add(this.children[n].clone());
return t}},THREE.EventDispatcher.prototype.apply(THREE.Object3D.prototype),THREE.Object3DIdCount=0,THREE.Projector=function(){function t(){if(u===x){var t=new THREE.RenderableVertex;return E.push(t),x++,u++,t}return E[u++]}function e(){if(l===b){var t=new THREE.RenderableFace;return T.push(t),b++,l++,t}return T[l++]}function n(){if(p===w){var t=new THREE.RenderableLine;return R.push(t),w++,p++,t}return R[p++]}function r(){if(m===H){var t=new THREE.RenderableSprite;return _.push(t),H++,m++,t}return _[m++]}function i(t,e){return t.z!==e.z?e.z-t.z:t.id!==e.id?t.id-e.id:0}function o(t,e){var n=0,r=1,i=t.z+t.w,o=e.z+e.w,a=-t.z+t.w,s=-e.z+e.w;return i>=0&&o>=0&&a>=0&&s>=0?!0:0>i&&0>o||0>a&&0>s?!1:(0>i?n=Math.max(n,i/(i-o)):0>o&&(r=Math.min(r,i/(i-o))),0>a?n=Math.max(n,a/(a-s)):0>s&&(r=Math.min(r,a/(a-s))),n>r?!1:(t.lerp(e,n),e.lerp(t,1-r),!0))}var a,s,h,u,c,l,f,p,d,m,g,v=[],y=0,E=[],x=0,T=[],b=0,R=[],w=0,_=[],H=0,M={objects:[],lights:[],elements:[]},S=new THREE.Vector3,C=new THREE.Vector3,A=new THREE.Vector3,L=new THREE.Vector3,P=new THREE.Vector4,D=new THREE.Box3(new THREE.Vector3(-1,-1,-1),new THREE.Vector3(1,1,1)),z=new THREE.Box3,F=Array(3),k=new THREE.Matrix4,N=new THREE.Matrix4,V=new THREE.Matrix4,I=new THREE.Matrix3,B=new THREE.Frustum,U=new THREE.Vector4,O=new THREE.Vector4;this.projectVector=function(t,e){return e.matrixWorldInverse.getInverse(e.matrixWorld),N.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),t.applyProjection(N)},this.unprojectVector=function(){var t=new THREE.Matrix4;return function(e,n){return t.getInverse(n.projectionMatrix),N.multiplyMatrices(n.matrixWorld,t),e.applyProjection(N)}}(),this.pickingRay=function(t,e){t.z=-1;var n=new THREE.Vector3(t.x,t.y,1);return this.unprojectVector(t,e),this.unprojectVector(n,e),n.sub(t).normalize(),new THREE.Raycaster(t,n)};var W=new function(){var r=[],i=[],o=null,a=null,s=new THREE.Matrix3,u=function(t){var e=t.positionWorld,n=t.positionScreen;e.copy(t.position).applyMatrix4(g),n.copy(e).applyMatrix4(N),e=1/n.w,n.x*=e,n.y*=e,n.z*=e,t.visible=-1<=n.x&&1>=n.x&&-1<=n.y&&1>=n.y&&-1<=n.z&&1>=n.z},l=function(t,e,n){return!0===t.visible||!0===e.visible||!0===n.visible?!0:(F[0]=t.positionScreen,F[1]=e.positionScreen,F[2]=n.positionScreen,D.isIntersectionBox(z.setFromPoints(F)))},p=function(t,e,n){return 0>(n.positionScreen.x-t.positionScreen.x)*(e.positionScreen.y-t.positionScreen.y)-(n.positionScreen.y-t.positionScreen.y)*(e.positionScreen.x-t.positionScreen.x)};return{setObject:function(t){o=t,a=o.material,s.getNormalMatrix(o.matrixWorld),r.length=0,i.length=0},projectVertex:u,checkTriangleVisibility:l,checkBackfaceCulling:p,pushVertex:function(e,n,r){h=t(),h.position.set(e,n,r),u(h)},pushNormal:function(t,e,n){r.push(t,e,n)},pushUv:function(t,e){i.push(t,e)},pushLine:function(t,e){var r=E[t],i=E[e];f=n(),f.id=o.id,f.v1.copy(r),f.v2.copy(i),f.z=(r.positionScreen.z+i.positionScreen.z)/2,f.material=o.material,M.elements.push(f)},pushTriangle:function(t,n,h){var u=E[t],f=E[n],d=E[h];if(!1!==l(u,f,d)&&(a.side===THREE.DoubleSide||!0===p(u,f,d))){for(c=e(),c.id=o.id,c.v1.copy(u),c.v2.copy(f),c.v3.copy(d),c.z=(u.positionScreen.z+f.positionScreen.z+d.positionScreen.z)/3,u=0;3>u;u++)f=3*arguments[u],d=c.vertexNormalsModel[u],d.set(r[f],r[f+1],r[f+2]),d.applyMatrix3(s).normalize(),f=2*arguments[u],c.uvs[u].set(i[f],i[f+1]);c.vertexNormalsLength=3,c.material=o.material,M.elements.push(c)}}}};this.projectScene=function(h,x,T,b){for(m=p=l=0,M.elements.length=0,!0===h.autoUpdate&&h.updateMatrixWorld(),void 0===x.parent&&x.updateMatrixWorld(),k.copy(x.matrixWorldInverse.getInverse(x.matrixWorld)),N.multiplyMatrices(x.projectionMatrix,k),B.setFromMatrix(N),s=0,M.objects.length=0,M.lights.length=0,h.traverseVisible(function(t){if(t instanceof THREE.Light)M.lights.push(t);else if((t instanceof THREE.Mesh||t instanceof THREE.Line||t instanceof THREE.Sprite)&&(!1===t.frustumCulled||!0===B.intersectsObject(t))){if(s===y){var e=new THREE.RenderableObject;v.push(e),y++,s++,a=e}else a=v[s++];a.id=t.id,a.object=t,null!==t.renderDepth?a.z=t.renderDepth:(L.setFromMatrixPosition(t.matrixWorld),L.applyProjection(N),a.z=L.z),M.objects.push(a)}}),!0===T&&M.objects.sort(i),h=0,T=M.objects.length;T>h;h++){var R=M.objects[h].object,w=R.geometry;if(W.setObject(R),g=R.matrixWorld,u=0,R instanceof THREE.Mesh){if(w instanceof THREE.BufferGeometry){var _=w.attributes,R=w.offsets;if(void 0!==_.position){for(var H=_.position.array,w=0,D=H.length;D>w;w+=3)W.pushVertex(H[w],H[w+1],H[w+2]);if(void 0!==_.normal)for(var z=_.normal.array,w=0,D=z.length;D>w;w+=3)W.pushNormal(z[w],z[w+1],z[w+2]);if(void 0!==_.uv)for(z=_.uv.array,w=0,D=z.length;D>w;w+=2)W.pushUv(z[w],z[w+1]);if(void 0!==_.index)if(_=_.index.array,0<R.length)for(h=0;h<R.length;h++)for(D=R[h],H=D.index,w=D.start,D=D.start+D.count;D>w;w+=3)W.pushTriangle(_[w]+H,_[w+1]+H,_[w+2]+H);else for(w=0,D=_.length;D>w;w+=3)W.pushTriangle(_[w],_[w+1],_[w+2]);else for(w=0,D=H.length/3;D>w;w+=3)W.pushTriangle(w,w+1,w+2)}}else if(w instanceof THREE.Geometry){var F=w.vertices,D=w.faces,_=w.faceVertexUvs[0];I.getNormalMatrix(g);for(var H=R.material instanceof THREE.MeshFaceMaterial,z=!0===H?R.material:null,G=0,j=F.length;j>G;G++){var q=F[G];W.pushVertex(q.x,q.y,q.z)}for(F=0,G=D.length;G>F;F++){var j=D[F],X=!0===H?z.materials[j.materialIndex]:R.material;if(void 0!==X){var Y=X.side,q=E[j.a],Z=E[j.b],K=E[j.c];if(!0===X.morphTargets){var Q=w.morphTargets,$=R.morphTargetInfluences,J=q.position,te=Z.position,ee=K.position;S.set(0,0,0),C.set(0,0,0),A.set(0,0,0);for(var ne=0,re=Q.length;re>ne;ne++){var ie=$[ne];if(0!==ie){var oe=Q[ne].vertices;S.x+=(oe[j.a].x-J.x)*ie,S.y+=(oe[j.a].y-J.y)*ie,S.z+=(oe[j.a].z-J.z)*ie,C.x+=(oe[j.b].x-te.x)*ie,C.y+=(oe[j.b].y-te.y)*ie,C.z+=(oe[j.b].z-te.z)*ie,A.x+=(oe[j.c].x-ee.x)*ie,A.y+=(oe[j.c].y-ee.y)*ie,A.z+=(oe[j.c].z-ee.z)*ie}}q.position.add(S),Z.position.add(C),K.position.add(A),W.projectVertex(q),W.projectVertex(Z),W.projectVertex(K)}if(!1!==W.checkTriangleVisibility(q,Z,K)){if(Q=W.checkBackfaceCulling(q,Z,K),Y!==THREE.DoubleSide){if(Y===THREE.FrontSide&&!1===Q)continue;if(Y===THREE.BackSide&&!0===Q)continue}for(c=e(),c.id=R.id,c.v1.copy(q),c.v2.copy(Z),c.v3.copy(K),c.normalModel.copy(j.normal),!1!==Q||Y!==THREE.BackSide&&Y!==THREE.DoubleSide||c.normalModel.negate(),c.normalModel.applyMatrix3(I).normalize(),$=j.vertexNormals,J=0,te=Math.min($.length,3);te>J;J++)ee=c.vertexNormalsModel[J],ee.copy($[J]),!1!==Q||Y!==THREE.BackSide&&Y!==THREE.DoubleSide||ee.negate(),ee.applyMatrix3(I).normalize();if(c.vertexNormalsLength=$.length,Y=_[F],void 0!==Y)for(Q=0;3>Q;Q++)c.uvs[Q].copy(Y[Q]);c.color=j.color,c.material=X,c.z=(q.positionScreen.z+Z.positionScreen.z+K.positionScreen.z)/3,M.elements.push(c)}}}}}else if(R instanceof THREE.Line){if(w instanceof THREE.BufferGeometry){if(_=w.attributes,void 0!==_.position){for(H=_.position.array,w=0,D=H.length;D>w;w+=3)W.pushVertex(H[w],H[w+1],H[w+2]);if(void 0!==_.index)for(_=_.index.array,w=0,D=_.length;D>w;w+=2)W.pushLine(_[w],_[w+1]);else for(_=R.type===THREE.LinePieces?2:1,w=0,D=H.length/3-1;D>w;w+=_)W.pushLine(w,w+1)}}else if(w instanceof THREE.Geometry&&(V.multiplyMatrices(N,g),F=R.geometry.vertices,0!==F.length))for(q=t(),q.positionScreen.copy(F[0]).applyMatrix4(V),_=R.type===THREE.LinePieces?2:1,G=1,j=F.length;j>G;G++)q=t(),q.positionScreen.copy(F[G]).applyMatrix4(V),(G+1)%_>0||(Z=E[u-2],U.copy(q.positionScreen),O.copy(Z.positionScreen),!0===o(U,O)&&(U.multiplyScalar(1/U.w),O.multiplyScalar(1/O.w),f=n(),f.id=R.id,f.v1.positionScreen.copy(U),f.v2.positionScreen.copy(O),f.z=Math.max(U.z,O.z),f.material=R.material,R.material.vertexColors===THREE.VertexColors&&(f.vertexColors[0].copy(R.geometry.colors[G]),f.vertexColors[1].copy(R.geometry.colors[G-1])),M.elements.push(f)))}else R instanceof THREE.Sprite&&(P.set(g.elements[12],g.elements[13],g.elements[14],1),P.applyMatrix4(N),w=1/P.w,P.z*=w,-1<=P.z&&1>=P.z&&(d=r(),d.id=R.id,d.x=P.x*w,d.y=P.y*w,d.z=P.z,d.object=R,d.rotation=R.rotation,d.scale.x=R.scale.x*Math.abs(d.x-(P.x+x.projectionMatrix.elements[0])/(P.w+x.projectionMatrix.elements[12])),d.scale.y=R.scale.y*Math.abs(d.y-(P.y+x.projectionMatrix.elements[5])/(P.w+x.projectionMatrix.elements[13])),d.material=R.material,M.elements.push(d)))}return!0===b&&M.elements.sort(i),M}},THREE.Face3=function(t,e,n,r,i,o){this.a=t,this.b=e,this.c=n,this.normal=r instanceof THREE.Vector3?r:new THREE.Vector3,this.vertexNormals=r instanceof Array?r:[],this.color=i instanceof THREE.Color?i:new THREE.Color,this.vertexColors=i instanceof Array?i:[],this.vertexTangents=[],this.materialIndex=void 0!==o?o:0},THREE.Face3.prototype={constructor:THREE.Face3,clone:function(){var t=new THREE.Face3(this.a,this.b,this.c);t.normal.copy(this.normal),t.color.copy(this.color),t.materialIndex=this.materialIndex;for(var e=0,n=this.vertexNormals.length;n>e;e++)t.vertexNormals[e]=this.vertexNormals[e].clone();for(e=0,n=this.vertexColors.length;n>e;e++)t.vertexColors[e]=this.vertexColors[e].clone();for(e=0,n=this.vertexTangents.length;n>e;e++)t.vertexTangents[e]=this.vertexTangents[e].clone();return t}},THREE.Face4=function(t,e,n,r,i,o,a){return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new THREE.Face3(t,e,n,i,o,a)},THREE.BufferAttribute=function(t,e){this.array=t,this.itemSize=e},THREE.BufferAttribute.prototype={constructor:THREE.BufferAttribute,get length(){return this.array.length},set:function(t){return this.array.set(t),this},setX:function(t,e){return this.array[t*this.itemSize]=e,this},setY:function(t,e){return this.array[t*this.itemSize+1]=e,this},setZ:function(t,e){return this.array[t*this.itemSize+2]=e,this},setXY:function(t,e,n){return t*=this.itemSize,this.array[t]=e,this.array[t+1]=n,this},setXYZ:function(t,e,n,r){return t*=this.itemSize,this.array[t]=e,this.array[t+1]=n,this.array[t+2]=r,this},setXYZW:function(t,e,n,r,i){return t*=this.itemSize,this.array[t]=e,this.array[t+1]=n,this.array[t+2]=r,this.array[t+3]=i,this}},THREE.Int8Attribute=function(t,e){return console.warn("THREE.Int8Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new THREE.BufferAttribute(t,e)},THREE.Uint8Attribute=function(t,e){return console.warn("THREE.Uint8Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new THREE.BufferAttribute(t,e)},THREE.Uint8ClampedAttribute=function(t,e){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new THREE.BufferAttribute(t,e)},THREE.Int16Attribute=function(t,e){return console.warn("THREE.Int16Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new THREE.BufferAttribute(t,e)},THREE.Uint16Attribute=function(t,e){return console.warn("THREE.Uint16Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new THREE.BufferAttribute(t,e)},THREE.Int32Attribute=function(t,e){return console.warn("THREE.Int32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new THREE.BufferAttribute(t,e)},THREE.Uint32Attribute=function(t,e){return console.warn("THREE.Uint32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new THREE.BufferAttribute(t,e)},THREE.Float32Attribute=function(t,e){return console.warn("THREE.Float32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new THREE.BufferAttribute(t,e)},THREE.Float64Attribute=function(t,e){return console.warn("THREE.Float64Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new THREE.BufferAttribute(t,e)},THREE.BufferGeometry=function(){this.id=THREE.GeometryIdCount++,this.uuid=THREE.Math.generateUUID(),this.name="",this.attributes={},this.offsets=this.drawcalls=[],this.boundingSphere=this.boundingBox=null},THREE.BufferGeometry.prototype={constructor:THREE.BufferGeometry,addAttribute:function(t,e,n){!1==e instanceof THREE.BufferAttribute?(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.attributes[t]={array:e,itemSize:n}):this.attributes[t]=e},getAttribute:function(t){return this.attributes[t]},addDrawCall:function(t,e,n){this.drawcalls.push({start:t,count:e,index:void 0!==n?n:0})},applyMatrix:function(t){var e=this.attributes.position;void 0!==e&&(t.applyToVector3Array(e.array),e.needsUpdate=!0),e=this.attributes.normal,void 0!==e&&((new THREE.Matrix3).getNormalMatrix(t).applyToVector3Array(e.array),e.needsUpdate=!0)},fromGeometry:function(t,e){e=e||{vertexColors:THREE.NoColors};var n=t.vertices,r=t.faces,i=t.faceVertexUvs,o=e.vertexColors,a=0<i[0].length,s=3==r[0].vertexNormals.length,h=new Float32Array(9*r.length);this.addAttribute("position",new THREE.BufferAttribute(h,3));var u=new Float32Array(9*r.length);if(this.addAttribute("normal",new THREE.BufferAttribute(u,3)),o!==THREE.NoColors){var c=new Float32Array(9*r.length);this.addAttribute("color",new THREE.BufferAttribute(c,3))}if(!0===a){var l=new Float32Array(6*r.length);this.addAttribute("uvs",new THREE.BufferAttribute(l,2))}for(var f=0,p=0,d=0;f<r.length;f++,p+=6,d+=9){var m=r[f],g=n[m.a],v=n[m.b],y=n[m.c];h[d]=g.x,h[d+1]=g.y,h[d+2]=g.z,h[d+3]=v.x,h[d+4]=v.y,h[d+5]=v.z,h[d+6]=y.x,h[d+7]=y.y,h[d+8]=y.z,!0===s?(g=m.vertexNormals[0],v=m.vertexNormals[1],y=m.vertexNormals[2],u[d]=g.x,u[d+1]=g.y,u[d+2]=g.z,u[d+3]=v.x,u[d+4]=v.y,u[d+5]=v.z,u[d+6]=y.x,u[d+7]=y.y,u[d+8]=y.z):(g=m.normal,u[d]=g.x,u[d+1]=g.y,u[d+2]=g.z,u[d+3]=g.x,u[d+4]=g.y,u[d+5]=g.z,u[d+6]=g.x,u[d+7]=g.y,u[d+8]=g.z),o===THREE.FaceColors?(m=m.color,c[d]=m.r,c[d+1]=m.g,c[d+2]=m.b,c[d+3]=m.r,c[d+4]=m.g,c[d+5]=m.b,c[d+6]=m.r,c[d+7]=m.g,c[d+8]=m.b):o===THREE.VertexColors&&(g=m.vertexColors[0],v=m.vertexColors[1],m=m.vertexColors[2],c[d]=g.r,c[d+1]=g.g,c[d+2]=g.b,c[d+3]=v.r,c[d+4]=v.g,c[d+5]=v.b,c[d+6]=m.r,c[d+7]=m.g,c[d+8]=m.b),!0===a&&(m=i[0][f][0],g=i[0][f][1],v=i[0][f][2],l[p]=m.x,l[p+1]=m.y,l[p+2]=g.x,l[p+3]=g.y,l[p+4]=v.x,l[p+5]=v.y)}return this.computeBoundingSphere(),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new THREE.Box3);var t=this.attributes.position.array;if(t){var e=this.boundingBox;3<=t.length&&(e.min.x=e.max.x=t[0],e.min.y=e.max.y=t[1],e.min.z=e.max.z=t[2]);for(var n=3,r=t.length;r>n;n+=3){var i=t[n],o=t[n+1],a=t[n+2];i<e.min.x?e.min.x=i:i>e.max.x&&(e.max.x=i),o<e.min.y?e.min.y=o:o>e.max.y&&(e.max.y=o),a<e.min.z?e.min.z=a:a>e.max.z&&(e.max.z=a)}}(void 0===t||0===t.length)&&(this.boundingBox.min.set(0,0,0),this.boundingBox.max.set(0,0,0)),(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.')},computeBoundingSphere:function(){var t=new THREE.Box3,e=new THREE.Vector3;return function(){null===this.boundingSphere&&(this.boundingSphere=new THREE.Sphere);var n=this.attributes.position.array;if(n){t.makeEmpty();for(var r=this.boundingSphere.center,i=0,o=n.length;o>i;i+=3)e.set(n[i],n[i+1],n[i+2]),t.expandByPoint(e);t.center(r);for(var a=0,i=0,o=n.length;o>i;i+=3)e.set(n[i],n[i+1],n[i+2]),a=Math.max(a,r.distanceToSquared(e));this.boundingSphere.radius=Math.sqrt(a),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.')}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){if(this.attributes.position){var t,e,n,r;if(t=this.attributes.position.array.length,void 0===this.attributes.normal)this.attributes.normal={itemSize:3,array:new Float32Array(t)};else for(t=0,e=this.attributes.normal.array.length;e>t;t++)this.attributes.normal.array[t]=0;var i,o,a,s,h,u,c=this.attributes.position.array,l=this.attributes.normal.array,f=new THREE.Vector3,p=new THREE.Vector3,d=new THREE.Vector3,m=new THREE.Vector3,g=new THREE.Vector3;if(this.attributes.index){var v=this.attributes.index.array,y=0<this.offsets.length?this.offsets:[{start:0,count:v.length,index:0}];for(n=0,r=y.length;r>n;++n){e=y[n].start,i=y[n].count;var E=y[n].index;for(t=e,e+=i;e>t;t+=3)i=E+v[t],o=E+v[t+1],a=E+v[t+2],s=c[3*i],h=c[3*i+1],u=c[3*i+2],f.set(s,h,u),s=c[3*o],h=c[3*o+1],u=c[3*o+2],p.set(s,h,u),s=c[3*a],h=c[3*a+1],u=c[3*a+2],d.set(s,h,u),m.subVectors(d,p),g.subVectors(f,p),m.cross(g),l[3*i]+=m.x,l[3*i+1]+=m.y,l[3*i+2]+=m.z,l[3*o]+=m.x,l[3*o+1]+=m.y,l[3*o+2]+=m.z,l[3*a]+=m.x,l[3*a+1]+=m.y,l[3*a+2]+=m.z}}else for(t=0,e=c.length;e>t;t+=9)s=c[t],h=c[t+1],u=c[t+2],f.set(s,h,u),s=c[t+3],h=c[t+4],u=c[t+5],p.set(s,h,u),s=c[t+6],h=c[t+7],u=c[t+8],d.set(s,h,u),m.subVectors(d,p),g.subVectors(f,p),m.cross(g),l[t]=m.x,l[t+1]=m.y,l[t+2]=m.z,l[t+3]=m.x,l[t+4]=m.y,l[t+5]=m.z,l[t+6]=m.x,l[t+7]=m.y,l[t+8]=m.z;this.normalizeNormals(),this.normalsNeedUpdate=!0}},computeTangents:function(){function t(t,e,n){l=r[3*t],f=r[3*t+1],p=r[3*t+2],d=r[3*e],m=r[3*e+1],g=r[3*e+2],v=r[3*n],y=r[3*n+1],E=r[3*n+2],x=o[2*t],T=o[2*t+1],b=o[2*e],R=o[2*e+1],w=o[2*n],_=o[2*n+1],H=d-l,M=v-l,S=m-f,C=y-f,A=g-p,L=E-p,P=b-x,D=w-x,z=R-T,F=_-T,k=1/(P*F-D*z),O.set((F*H-z*M)*k,(F*S-z*C)*k,(F*A-z*L)*k),W.set((P*M-D*H)*k,(P*C-D*S)*k,(P*L-D*A)*k),h[t].add(O),h[e].add(O),h[n].add(O),u[t].add(W),u[e].add(W),u[n].add(W)}function e(t){Q.x=i[3*t],Q.y=i[3*t+1],Q.z=i[3*t+2],$.copy(Q),X=h[t],Z.copy(X),Z.sub(Q.multiplyScalar(Q.dot(X))).normalize(),K.crossVectors($,X),Y=K.dot(u[t]),q=0>Y?-1:1,s[4*t]=Z.x,s[4*t+1]=Z.y,s[4*t+2]=Z.z,s[4*t+3]=q}if(void 0===this.attributes.index||void 0===this.attributes.position||void 0===this.attributes.normal||void 0===this.attributes.uv)console.warn("Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()");else{var n=this.attributes.index.array,r=this.attributes.position.array,i=this.attributes.normal.array,o=this.attributes.uv.array,a=r.length/3;void 0===this.attributes.tangent&&(this.attributes.tangent={itemSize:4,array:new Float32Array(4*a)});for(var s=this.attributes.tangent.array,h=[],u=[],c=0;a>c;c++)h[c]=new THREE.Vector3,u[c]=new THREE.Vector3;var l,f,p,d,m,g,v,y,E,x,T,b,R,w,_,H,M,S,C,A,L,P,D,z,F,k,N,V,I,B,U,O=new THREE.Vector3,W=new THREE.Vector3,G=this.offsets,c=0;for(V=G.length;V>c;++c){N=G[c].start,I=G[c].count;var j=G[c].index,a=N;for(N+=I;N>a;a+=3)I=j+n[a],B=j+n[a+1],U=j+n[a+2],t(I,B,U)}var q,X,Y,Z=new THREE.Vector3,K=new THREE.Vector3,Q=new THREE.Vector3,$=new THREE.Vector3,c=0;for(V=G.length;V>c;++c)for(N=G[c].start,I=G[c].count,j=G[c].index,a=N,N+=I;N>a;a+=3)I=j+n[a],B=j+n[a+1],U=j+n[a+2],e(I),e(B),e(U)}},computeOffsets:function(t){var e=t;void 0===t&&(e=65535),Date.now(),t=this.attributes.index.array;for(var n=this.attributes.position.array,r=t.length/3,i=new Uint16Array(t.length),o=0,a=0,s=[{start:0,count:0,index:0}],h=s[0],u=0,c=0,l=new Int32Array(6),f=new Int32Array(n.length),p=new Int32Array(n.length),d=0;d<n.length;d++)f[d]=-1,p[d]=-1;for(n=0;r>n;n++){for(var m=c=0;3>m;m++)d=t[3*n+m],-1==f[d]?(l[2*m]=d,l[2*m+1]=-1,c++):f[d]<h.index?(l[2*m]=d,l[2*m+1]=-1,u++):(l[2*m]=d,l[2*m+1]=f[d]);if(a+c>h.index+e)for(h={start:o,count:0,index:a},s.push(h),c=0;6>c;c+=2)m=l[c+1],m>-1&&m<h.index&&(l[c+1]=-1);for(c=0;6>c;c+=2)d=l[c],m=l[c+1],-1===m&&(m=a++),f[d]=m,p[m]=d,i[o++]=m-h.index,h.count++}return this.reorderBuffers(i,p,a),this.offsets=s},merge:function(){console.log("BufferGeometry.merge(): TODO")},normalizeNormals:function(){for(var t,e,n,r=this.attributes.normal.array,i=0,o=r.length;o>i;i+=3)t=r[i],e=r[i+1],n=r[i+2],t=1/Math.sqrt(t*t+e*e+n*n),r[i]*=t,r[i+1]*=t,r[i+2]*=t},reorderBuffers:function(t,e,n){var r,i={},o=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];for(r in this.attributes)if("index"!=r)for(var a=this.attributes[r].array,s=0,h=o.length;h>s;s++){var u=o[s];if(a instanceof u){i[r]=new u(this.attributes[r].itemSize*n);break}}for(o=0;n>o;o++)for(r in a=e[o],this.attributes)if("index"!=r)for(var s=this.attributes[r].array,h=this.attributes[r].itemSize,u=i[r],c=0;h>c;c++)u[o*h+c]=s[a*h+c];this.attributes.index.array=t;for(r in this.attributes)"index"!=r&&(this.attributes[r].array=i[r],this.attributes[r].numItems=this.attributes[r].itemSize*n)},clone:function(){var t,e=new THREE.BufferGeometry,n=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];for(t in this.attributes){for(var r=this.attributes[t],i=r.array,o={itemSize:r.itemSize,array:null},r=0,a=n.length;a>r;r++){var s=n[r];if(i instanceof s){o.array=new s(i);break}}e.attributes[t]=o}for(r=0,a=this.offsets.length;a>r;r++)n=this.offsets[r],e.offsets.push({start:n.start,index:n.index,count:n.count});return e},dispose:function(){this.dispatchEvent({type:"dispose"})}},THREE.EventDispatcher.prototype.apply(THREE.BufferGeometry.prototype),THREE.Geometry=function(){this.id=THREE.GeometryIdCount++,this.uuid=THREE.Math.generateUUID(),this.name="",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphColors=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingSphere=this.boundingBox=null,this.hasTangents=!1,this.dynamic=!0,this.groupsNeedUpdate=this.buffersNeedUpdate=this.lineDistancesNeedUpdate=this.colorsNeedUpdate=this.tangentsNeedUpdate=this.normalsNeedUpdate=this.uvsNeedUpdate=this.elementsNeedUpdate=this.verticesNeedUpdate=!1},THREE.Geometry.prototype={constructor:THREE.Geometry,applyMatrix:function(t){for(var e=(new THREE.Matrix3).getNormalMatrix(t),n=0,r=this.vertices.length;r>n;n++)this.vertices[n].applyMatrix4(t);for(n=0,r=this.faces.length;r>n;n++){t=this.faces[n],t.normal.applyMatrix3(e).normalize();for(var i=0,o=t.vertexNormals.length;o>i;i++)t.vertexNormals[i].applyMatrix3(e).normalize()}this.boundingBox instanceof THREE.Box3&&this.computeBoundingBox(),this.boundingSphere instanceof THREE.Sphere&&this.computeBoundingSphere()},center:function(){this.computeBoundingBox();var t=new THREE.Vector3;return t.addVectors(this.boundingBox.min,this.boundingBox.max),t.multiplyScalar(-.5),this.applyMatrix((new THREE.Matrix4).makeTranslation(t.x,t.y,t.z)),this.computeBoundingBox(),t},computeFaceNormals:function(){for(var t=new THREE.Vector3,e=new THREE.Vector3,n=0,r=this.faces.length;r>n;n++){var i=this.faces[n],o=this.vertices[i.a],a=this.vertices[i.b];t.subVectors(this.vertices[i.c],a),e.subVectors(o,a),t.cross(e),t.normalize(),i.normal.copy(t)}},computeVertexNormals:function(t){var e,n,r;for(r=Array(this.vertices.length),e=0,n=this.vertices.length;n>e;e++)r[e]=new THREE.Vector3;if(t){var i,o,a,s=new THREE.Vector3,h=new THREE.Vector3;for(new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,t=0,e=this.faces.length;e>t;t++)n=this.faces[t],i=this.vertices[n.a],o=this.vertices[n.b],a=this.vertices[n.c],s.subVectors(a,o),h.subVectors(i,o),s.cross(h),r[n.a].add(s),r[n.b].add(s),r[n.c].add(s)}else for(t=0,e=this.faces.length;e>t;t++)n=this.faces[t],r[n.a].add(n.normal),r[n.b].add(n.normal),r[n.c].add(n.normal);for(e=0,n=this.vertices.length;n>e;e++)r[e].normalize();for(t=0,e=this.faces.length;e>t;t++)n=this.faces[t],n.vertexNormals[0]=r[n.a].clone(),n.vertexNormals[1]=r[n.b].clone(),n.vertexNormals[2]=r[n.c].clone()},computeMorphNormals:function(){var t,e,n,r,i;for(n=0,r=this.faces.length;r>n;n++)for(i=this.faces[n],i.__originalFaceNormal?i.__originalFaceNormal.copy(i.normal):i.__originalFaceNormal=i.normal.clone(),i.__originalVertexNormals||(i.__originalVertexNormals=[]),t=0,e=i.vertexNormals.length;e>t;t++)i.__originalVertexNormals[t]?i.__originalVertexNormals[t].copy(i.vertexNormals[t]):i.__originalVertexNormals[t]=i.vertexNormals[t].clone();var o=new THREE.Geometry;for(o.faces=this.faces,t=0,e=this.morphTargets.length;e>t;t++){if(!this.morphNormals[t]){this.morphNormals[t]={},this.morphNormals[t].faceNormals=[],this.morphNormals[t].vertexNormals=[],i=this.morphNormals[t].faceNormals;var a,s,h=this.morphNormals[t].vertexNormals;for(n=0,r=this.faces.length;r>n;n++)a=new THREE.Vector3,s={a:new THREE.Vector3,b:new THREE.Vector3,c:new THREE.Vector3},i.push(a),h.push(s)}for(h=this.morphNormals[t],o.vertices=this.morphTargets[t].vertices,o.computeFaceNormals(),o.computeVertexNormals(),n=0,r=this.faces.length;r>n;n++)i=this.faces[n],a=h.faceNormals[n],s=h.vertexNormals[n],a.copy(i.normal),s.a.copy(i.vertexNormals[0]),s.b.copy(i.vertexNormals[1]),s.c.copy(i.vertexNormals[2])}for(n=0,r=this.faces.length;r>n;n++)i=this.faces[n],i.normal=i.__originalFaceNormal,i.vertexNormals=i.__originalVertexNormals},computeTangents:function(){var t,e,n,r,i,o,a,s,h,u,c,l,f,p,d,m,g,v=[],y=[];n=new THREE.Vector3;var E=new THREE.Vector3,x=new THREE.Vector3,T=new THREE.Vector3,b=new THREE.Vector3;for(t=0,e=this.vertices.length;e>t;t++)v[t]=new THREE.Vector3,y[t]=new THREE.Vector3;for(t=0,e=this.faces.length;e>t;t++)i=this.faces[t],o=this.faceVertexUvs[0][t],r=i.a,g=i.b,i=i.c,a=this.vertices[r],s=this.vertices[g],h=this.vertices[i],u=o[0],c=o[1],l=o[2],o=s.x-a.x,f=h.x-a.x,p=s.y-a.y,d=h.y-a.y,s=s.z-a.z,a=h.z-a.z,h=c.x-u.x,m=l.x-u.x,c=c.y-u.y,u=l.y-u.y,l=1/(h*u-m*c),n.set((u*o-c*f)*l,(u*p-c*d)*l,(u*s-c*a)*l),E.set((h*f-m*o)*l,(h*d-m*p)*l,(h*a-m*s)*l),v[r].add(n),v[g].add(n),v[i].add(n),y[r].add(E),y[g].add(E),y[i].add(E);for(E=["a","b","c","d"],t=0,e=this.faces.length;e>t;t++)for(i=this.faces[t],n=0;n<Math.min(i.vertexNormals.length,3);n++)b.copy(i.vertexNormals[n]),r=i[E[n]],g=v[r],x.copy(g),x.sub(b.multiplyScalar(b.dot(g))).normalize(),T.crossVectors(i.vertexNormals[n],g),r=T.dot(y[r]),r=0>r?-1:1,i.vertexTangents[n]=new THREE.Vector4(x.x,x.y,x.z,r);this.hasTangents=!0},computeLineDistances:function(){for(var t=0,e=this.vertices,n=0,r=e.length;r>n;n++)n>0&&(t+=e[n].distanceTo(e[n-1])),this.lineDistances[n]=t},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new THREE.Box3),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new THREE.Sphere),this.boundingSphere.setFromPoints(this.vertices)},merge:function(t,e,n){if(!1==t instanceof THREE.Geometry)console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",t);else{var r,i=this.vertices.length,o=this.vertices,a=t.vertices,s=this.faces,h=t.faces,u=this.faceVertexUvs[0];t=t.faceVertexUvs[0],void 0===n&&(n=0),void 0!==e&&(r=(new THREE.Matrix3).getNormalMatrix(e));for(var c=0,l=a.length;l>c;c++){var f=a[c].clone();void 0!==e&&f.applyMatrix4(e),o.push(f)}for(c=0,l=h.length;l>c;c++){var p,a=h[c],d=a.vertexNormals,m=a.vertexColors,f=new THREE.Face3(a.a+i,a.b+i,a.c+i);for(f.normal.copy(a.normal),void 0!==r&&f.normal.applyMatrix3(r).normalize(),e=0,o=d.length;o>e;e++)p=d[e].clone(),void 0!==r&&p.applyMatrix3(r).normalize(),f.vertexNormals.push(p);for(f.color.copy(a.color),e=0,o=m.length;o>e;e++)p=m[e],f.vertexColors.push(p.clone());f.materialIndex=a.materialIndex+n,s.push(f)}for(c=0,l=t.length;l>c;c++)if(n=t[c],r=[],void 0!==n){for(e=0,o=n.length;o>e;e++)r.push(new THREE.Vector2(n[e].x,n[e].y));u.push(r)}}},mergeVertices:function(){var t,e,n,r={},i=[],o=[],a=Math.pow(10,4);for(e=0,n=this.vertices.length;n>e;e++)t=this.vertices[e],t=Math.round(t.x*a)+"_"+Math.round(t.y*a)+"_"+Math.round(t.z*a),void 0===r[t]?(r[t]=e,i.push(this.vertices[e]),o[e]=i.length-1):o[e]=o[r[t]];for(r=[],e=0,n=this.faces.length;n>e;e++)for(a=this.faces[e],a.a=o[a.a],a.b=o[a.b],a.c=o[a.c],a=[a.a,a.b,a.c],t=0;3>t;t++)if(a[t]==a[(t+1)%3]){r.push(e);break}for(e=r.length-1;e>=0;e--)for(a=r[e],this.faces.splice(a,1),o=0,n=this.faceVertexUvs.length;n>o;o++)this.faceVertexUvs[o].splice(a,1);return e=this.vertices.length-i.length,this.vertices=i,e},makeGroups:function(){var t=0;return function(e,n){var r,i,o,a,s,h={},u=this.morphTargets.length,c=this.morphNormals.length;for(this.geometryGroups={},this.geometryGroupsList=[],r=0,i=this.faces.length;i>r;r++)o=this.faces[r],o=e?o.materialIndex:0,o in h||(h[o]={hash:o,counter:0}),a=h[o].hash+"_"+h[o].counter,a in this.geometryGroups||(s={id:t++,faces3:[],materialIndex:o,vertices:0,numMorphTargets:u,numMorphNormals:c},this.geometryGroups[a]=s,this.geometryGroupsList.push(s)),this.geometryGroups[a].vertices+3>n&&(h[o].counter+=1,a=h[o].hash+"_"+h[o].counter,a in this.geometryGroups||(s={id:t++,faces3:[],materialIndex:o,vertices:0,numMorphTargets:u,numMorphNormals:c},this.geometryGroups[a]=s,this.geometryGroupsList.push(s))),this.geometryGroups[a].faces3.push(r),this.geometryGroups[a].vertices+=3}}(),clone:function(){for(var t=new THREE.Geometry,e=this.vertices,n=0,r=e.length;r>n;n++)t.vertices.push(e[n].clone());for(e=this.faces,n=0,r=e.length;r>n;n++)t.faces.push(e[n].clone());for(e=this.faceVertexUvs[0],n=0,r=e.length;r>n;n++){for(var i=e[n],o=[],a=0,s=i.length;s>a;a++)o.push(new THREE.Vector2(i[a].x,i[a].y));t.faceVertexUvs[0].push(o)}return t},dispose:function(){this.dispatchEvent({type:"dispose"})}},THREE.EventDispatcher.prototype.apply(THREE.Geometry.prototype),THREE.GeometryIdCount=0,THREE.Camera=function(){THREE.Object3D.call(this),this.matrixWorldInverse=new THREE.Matrix4,this.projectionMatrix=new THREE.Matrix4},THREE.Camera.prototype=Object.create(THREE.Object3D.prototype),THREE.Camera.prototype.lookAt=function(){var t=new THREE.Matrix4;return function(e){t.lookAt(this.position,e,this.up),this.quaternion.setFromRotationMatrix(t)}}(),THREE.Camera.prototype.clone=function(t){return void 0===t&&(t=new THREE.Camera),THREE.Object3D.prototype.clone.call(this,t),t.matrixWorldInverse.copy(this.matrixWorldInverse),t.projectionMatrix.copy(this.projectionMatrix),t},THREE.CubeCamera=function(t,e,n){THREE.Object3D.call(this);var r=new THREE.PerspectiveCamera(90,1,t,e);r.up.set(0,-1,0),r.lookAt(new THREE.Vector3(1,0,0)),this.add(r);var i=new THREE.PerspectiveCamera(90,1,t,e);i.up.set(0,-1,0),i.lookAt(new THREE.Vector3(-1,0,0)),this.add(i);var o=new THREE.PerspectiveCamera(90,1,t,e);o.up.set(0,0,1),o.lookAt(new THREE.Vector3(0,1,0)),this.add(o);var a=new THREE.PerspectiveCamera(90,1,t,e);a.up.set(0,0,-1),a.lookAt(new THREE.Vector3(0,-1,0)),this.add(a);var s=new THREE.PerspectiveCamera(90,1,t,e);s.up.set(0,-1,0),s.lookAt(new THREE.Vector3(0,0,1)),this.add(s);var h=new THREE.PerspectiveCamera(90,1,t,e);h.up.set(0,-1,0),h.lookAt(new THREE.Vector3(0,0,-1)),this.add(h),this.renderTarget=new THREE.WebGLRenderTargetCube(n,n,{format:THREE.RGBFormat,magFilter:THREE.LinearFilter,minFilter:THREE.LinearFilter}),this.updateCubeMap=function(t,e){var n=this.renderTarget,u=n.generateMipmaps;n.generateMipmaps=!1,n.activeCubeFace=0,t.render(e,r,n),n.activeCubeFace=1,t.render(e,i,n),n.activeCubeFace=2,t.render(e,o,n),n.activeCubeFace=3,t.render(e,a,n),n.activeCubeFace=4,t.render(e,s,n),n.generateMipmaps=u,n.activeCubeFace=5,t.render(e,h,n)}},THREE.CubeCamera.prototype=Object.create(THREE.Object3D.prototype),THREE.OrthographicCamera=function(t,e,n,r,i,o){THREE.Camera.call(this),this.left=t,this.right=e,this.top=n,this.bottom=r,this.near=void 0!==i?i:.1,this.far=void 0!==o?o:2e3,this.updateProjectionMatrix()},THREE.OrthographicCamera.prototype=Object.create(THREE.Camera.prototype),THREE.OrthographicCamera.prototype.updateProjectionMatrix=function(){this.projectionMatrix.makeOrthographic(this.left,this.right,this.top,this.bottom,this.near,this.far)},THREE.OrthographicCamera.prototype.clone=function(){var t=new THREE.OrthographicCamera;return THREE.Camera.prototype.clone.call(this,t),t.left=this.left,t.right=this.right,t.top=this.top,t.bottom=this.bottom,t.near=this.near,t.far=this.far,t},THREE.PerspectiveCamera=function(t,e,n,r){THREE.Camera.call(this),this.fov=void 0!==t?t:50,this.aspect=void 0!==e?e:1,this.near=void 0!==n?n:.1,this.far=void 0!==r?r:2e3,this.updateProjectionMatrix()},THREE.PerspectiveCamera.prototype=Object.create(THREE.Camera.prototype),THREE.PerspectiveCamera.prototype.setLens=function(t,e){void 0===e&&(e=24),this.fov=2*THREE.Math.radToDeg(Math.atan(e/(2*t))),this.updateProjectionMatrix()},THREE.PerspectiveCamera.prototype.setViewOffset=function(t,e,n,r,i,o){this.fullWidth=t,this.fullHeight=e,this.x=n,this.y=r,this.width=i,this.height=o,this.updateProjectionMatrix()
},THREE.PerspectiveCamera.prototype.updateProjectionMatrix=function(){if(this.fullWidth){var t=this.fullWidth/this.fullHeight,e=Math.tan(THREE.Math.degToRad(.5*this.fov))*this.near,n=-e,r=t*n,t=Math.abs(t*e-r),n=Math.abs(e-n);this.projectionMatrix.makeFrustum(r+this.x*t/this.fullWidth,r+(this.x+this.width)*t/this.fullWidth,e-(this.y+this.height)*n/this.fullHeight,e-this.y*n/this.fullHeight,this.near,this.far)}else this.projectionMatrix.makePerspective(this.fov,this.aspect,this.near,this.far)},THREE.PerspectiveCamera.prototype.clone=function(){var t=new THREE.PerspectiveCamera;return THREE.Camera.prototype.clone.call(this,t),t.fov=this.fov,t.aspect=this.aspect,t.near=this.near,t.far=this.far,t},THREE.Light=function(t){THREE.Object3D.call(this),this.color=new THREE.Color(t)},THREE.Light.prototype=Object.create(THREE.Object3D.prototype),THREE.Light.prototype.clone=function(t){return void 0===t&&(t=new THREE.Light),THREE.Object3D.prototype.clone.call(this,t),t.color.copy(this.color),t},THREE.AmbientLight=function(t){THREE.Light.call(this,t)},THREE.AmbientLight.prototype=Object.create(THREE.Light.prototype),THREE.AmbientLight.prototype.clone=function(){var t=new THREE.AmbientLight;return THREE.Light.prototype.clone.call(this,t),t},THREE.AreaLight=function(t,e){THREE.Light.call(this,t),this.normal=new THREE.Vector3(0,-1,0),this.right=new THREE.Vector3(1,0,0),this.intensity=void 0!==e?e:1,this.height=this.width=1,this.constantAttenuation=1.5,this.linearAttenuation=.5,this.quadraticAttenuation=.1},THREE.AreaLight.prototype=Object.create(THREE.Light.prototype),THREE.DirectionalLight=function(t,e){THREE.Light.call(this,t),this.position.set(0,1,0),this.target=new THREE.Object3D,this.intensity=void 0!==e?e:1,this.onlyShadow=this.castShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraLeft=-500,this.shadowCameraTop=this.shadowCameraRight=500,this.shadowCameraBottom=-500,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapHeight=this.shadowMapWidth=512,this.shadowCascade=!1,this.shadowCascadeOffset=new THREE.Vector3(0,0,-1e3),this.shadowCascadeCount=2,this.shadowCascadeBias=[0,0,0],this.shadowCascadeWidth=[512,512,512],this.shadowCascadeHeight=[512,512,512],this.shadowCascadeNearZ=[-1,.99,.998],this.shadowCascadeFarZ=[.99,.998,1],this.shadowCascadeArray=[],this.shadowMatrix=this.shadowCamera=this.shadowMapSize=this.shadowMap=null},THREE.DirectionalLight.prototype=Object.create(THREE.Light.prototype),THREE.DirectionalLight.prototype.clone=function(){var t=new THREE.DirectionalLight;return THREE.Light.prototype.clone.call(this,t),t.target=this.target.clone(),t.intensity=this.intensity,t.castShadow=this.castShadow,t.onlyShadow=this.onlyShadow,t.shadowCameraNear=this.shadowCameraNear,t.shadowCameraFar=this.shadowCameraFar,t.shadowCameraLeft=this.shadowCameraLeft,t.shadowCameraRight=this.shadowCameraRight,t.shadowCameraTop=this.shadowCameraTop,t.shadowCameraBottom=this.shadowCameraBottom,t.shadowCameraVisible=this.shadowCameraVisible,t.shadowBias=this.shadowBias,t.shadowDarkness=this.shadowDarkness,t.shadowMapWidth=this.shadowMapWidth,t.shadowMapHeight=this.shadowMapHeight,t.shadowCascade=this.shadowCascade,t.shadowCascadeOffset.copy(this.shadowCascadeOffset),t.shadowCascadeCount=this.shadowCascadeCount,t.shadowCascadeBias=this.shadowCascadeBias.slice(0),t.shadowCascadeWidth=this.shadowCascadeWidth.slice(0),t.shadowCascadeHeight=this.shadowCascadeHeight.slice(0),t.shadowCascadeNearZ=this.shadowCascadeNearZ.slice(0),t.shadowCascadeFarZ=this.shadowCascadeFarZ.slice(0),t},THREE.HemisphereLight=function(t,e,n){THREE.Light.call(this,t),this.position.set(0,100,0),this.groundColor=new THREE.Color(e),this.intensity=void 0!==n?n:1},THREE.HemisphereLight.prototype=Object.create(THREE.Light.prototype),THREE.HemisphereLight.prototype.clone=function(){var t=new THREE.HemisphereLight;return THREE.Light.prototype.clone.call(this,t),t.groundColor.copy(this.groundColor),t.intensity=this.intensity,t},THREE.PointLight=function(t,e,n){THREE.Light.call(this,t),this.intensity=void 0!==e?e:1,this.distance=void 0!==n?n:0},THREE.PointLight.prototype=Object.create(THREE.Light.prototype),THREE.PointLight.prototype.clone=function(){var t=new THREE.PointLight;return THREE.Light.prototype.clone.call(this,t),t.intensity=this.intensity,t.distance=this.distance,t},THREE.SpotLight=function(t,e,n,r,i){THREE.Light.call(this,t),this.position.set(0,1,0),this.target=new THREE.Object3D,this.intensity=void 0!==e?e:1,this.distance=void 0!==n?n:0,this.angle=void 0!==r?r:Math.PI/3,this.exponent=void 0!==i?i:10,this.onlyShadow=this.castShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraFov=50,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapHeight=this.shadowMapWidth=512,this.shadowMatrix=this.shadowCamera=this.shadowMapSize=this.shadowMap=null},THREE.SpotLight.prototype=Object.create(THREE.Light.prototype),THREE.SpotLight.prototype.clone=function(){var t=new THREE.SpotLight;return THREE.Light.prototype.clone.call(this,t),t.target=this.target.clone(),t.intensity=this.intensity,t.distance=this.distance,t.angle=this.angle,t.exponent=this.exponent,t.castShadow=this.castShadow,t.onlyShadow=this.onlyShadow,t.shadowCameraNear=this.shadowCameraNear,t.shadowCameraFar=this.shadowCameraFar,t.shadowCameraFov=this.shadowCameraFov,t.shadowCameraVisible=this.shadowCameraVisible,t.shadowBias=this.shadowBias,t.shadowDarkness=this.shadowDarkness,t.shadowMapWidth=this.shadowMapWidth,t.shadowMapHeight=this.shadowMapHeight,t},THREE.Cache=function(){this.files={}},THREE.Cache.prototype={constructor:THREE.Cache,add:function(t,e){this.files[t]=e},get:function(t){return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}},THREE.Loader=function(t){this.statusDomElement=(this.showStatus=t)?THREE.Loader.prototype.addStatusElement():null,this.imageLoader=new THREE.ImageLoader,this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){}},THREE.Loader.prototype={constructor:THREE.Loader,crossOrigin:void 0,addStatusElement:function(){var t=document.createElement("div");return t.style.position="absolute",t.style.right="0px",t.style.top="0px",t.style.fontSize="0.8em",t.style.textAlign="left",t.style.background="rgba(0,0,0,0.25)",t.style.color="#fff",t.style.width="120px",t.style.padding="0.5em 0.5em 0.5em 0.5em",t.style.zIndex=1e3,t.innerHTML="Loading ...",t},updateProgress:function(t){var e="Loaded ",e=t.total?e+((100*t.loaded/t.total).toFixed(0)+"%"):e+((t.loaded/1024).toFixed(2)+" KB");this.statusDomElement.innerHTML=e},extractUrlBase:function(t){return t=t.split("/"),1===t.length?"./":(t.pop(),t.join("/")+"/")},initMaterials:function(t,e){for(var n=[],r=0;r<t.length;++r)n[r]=this.createMaterial(t[r],e);return n},needsTangents:function(t){for(var e=0,n=t.length;n>e;e++)if(t[e]instanceof THREE.ShaderMaterial)return!0;return!1},createMaterial:function(t,e){function n(t){return t=Math.log(t)/Math.LN2,Math.pow(2,Math.round(t))}function r(t,r,i,a,s,h,u){var c,l=e+i,f=THREE.Loader.Handlers.get(l);null!==f?c=f.load(l):(c=new THREE.Texture,f=o.imageLoader,f.crossOrigin=o.crossOrigin,f.load(l,function(t){if(!1===THREE.Math.isPowerOfTwo(t.width)||!1===THREE.Math.isPowerOfTwo(t.height)){var e=n(t.width),r=n(t.height),i=document.createElement("canvas");i.width=e,i.height=r,i.getContext("2d").drawImage(t,0,0,e,r),c.image=i}else c.image=t;c.needsUpdate=!0})),c.sourceFile=i,a&&(c.repeat.set(a[0],a[1]),1!==a[0]&&(c.wrapS=THREE.RepeatWrapping),1!==a[1]&&(c.wrapT=THREE.RepeatWrapping)),s&&c.offset.set(s[0],s[1]),h&&(i={repeat:THREE.RepeatWrapping,mirror:THREE.MirroredRepeatWrapping},void 0!==i[h[0]]&&(c.wrapS=i[h[0]]),void 0!==i[h[1]]&&(c.wrapT=i[h[1]])),u&&(c.anisotropy=u),t[r]=c}function i(t){return(255*t[0]<<16)+(255*t[1]<<8)+255*t[2]}var o=this,a="MeshLambertMaterial",s={color:15658734,opacity:1,map:null,lightMap:null,normalMap:null,bumpMap:null,wireframe:!1};if(t.shading){var h=t.shading.toLowerCase();"phong"===h?a="MeshPhongMaterial":"basic"===h&&(a="MeshBasicMaterial")}return void 0!==t.blending&&void 0!==THREE[t.blending]&&(s.blending=THREE[t.blending]),(void 0!==t.transparent||1>t.opacity)&&(s.transparent=t.transparent),void 0!==t.depthTest&&(s.depthTest=t.depthTest),void 0!==t.depthWrite&&(s.depthWrite=t.depthWrite),void 0!==t.visible&&(s.visible=t.visible),void 0!==t.flipSided&&(s.side=THREE.BackSide),void 0!==t.doubleSided&&(s.side=THREE.DoubleSide),void 0!==t.wireframe&&(s.wireframe=t.wireframe),void 0!==t.vertexColors&&("face"===t.vertexColors?s.vertexColors=THREE.FaceColors:t.vertexColors&&(s.vertexColors=THREE.VertexColors)),t.colorDiffuse?s.color=i(t.colorDiffuse):t.DbgColor&&(s.color=t.DbgColor),t.colorSpecular&&(s.specular=i(t.colorSpecular)),t.colorAmbient&&(s.ambient=i(t.colorAmbient)),t.colorEmissive&&(s.emissive=i(t.colorEmissive)),t.transparency&&(s.opacity=t.transparency),t.specularCoef&&(s.shininess=t.specularCoef),t.mapDiffuse&&e&&r(s,"map",t.mapDiffuse,t.mapDiffuseRepeat,t.mapDiffuseOffset,t.mapDiffuseWrap,t.mapDiffuseAnisotropy),t.mapLight&&e&&r(s,"lightMap",t.mapLight,t.mapLightRepeat,t.mapLightOffset,t.mapLightWrap,t.mapLightAnisotropy),t.mapBump&&e&&r(s,"bumpMap",t.mapBump,t.mapBumpRepeat,t.mapBumpOffset,t.mapBumpWrap,t.mapBumpAnisotropy),t.mapNormal&&e&&r(s,"normalMap",t.mapNormal,t.mapNormalRepeat,t.mapNormalOffset,t.mapNormalWrap,t.mapNormalAnisotropy),t.mapSpecular&&e&&r(s,"specularMap",t.mapSpecular,t.mapSpecularRepeat,t.mapSpecularOffset,t.mapSpecularWrap,t.mapSpecularAnisotropy),t.mapAlpha&&e&&r(s,"alphaMap",t.mapAlpha,t.mapAlphaRepeat,t.mapAlphaOffset,t.mapAlphaWrap,t.mapAlphaAnisotropy),t.mapBumpScale&&(s.bumpScale=t.mapBumpScale),t.mapNormal?(a=THREE.ShaderLib.normalmap,h=THREE.UniformsUtils.clone(a.uniforms),h.tNormal.value=s.normalMap,t.mapNormalFactor&&h.uNormalScale.value.set(t.mapNormalFactor,t.mapNormalFactor),s.map&&(h.tDiffuse.value=s.map,h.enableDiffuse.value=!0),s.specularMap&&(h.tSpecular.value=s.specularMap,h.enableSpecular.value=!0),s.lightMap&&(h.tAO.value=s.lightMap,h.enableAO.value=!0),h.diffuse.value.setHex(s.color),h.specular.value.setHex(s.specular),h.ambient.value.setHex(s.ambient),h.shininess.value=s.shininess,void 0!==s.opacity&&(h.opacity.value=s.opacity),a=new THREE.ShaderMaterial({fragmentShader:a.fragmentShader,vertexShader:a.vertexShader,uniforms:h,lights:!0,fog:!0}),s.transparent&&(a.transparent=!0)):a=new THREE[a](s),void 0!==t.DbgName&&(a.name=t.DbgName),a}},THREE.Loader.Handlers={handlers:[],add:function(t,e){this.handlers.push(t,e)},get:function(t){for(var e=0,n=this.handlers.length;n>e;e+=2){var r=this.handlers[e+1];if(this.handlers[e].test(t))return r}return null}},THREE.XHRLoader=function(t){this.cache=new THREE.Cache,this.manager=void 0!==t?t:THREE.DefaultLoadingManager},THREE.XHRLoader.prototype={constructor:THREE.XHRLoader,load:function(t,e,n,r){var i=this,o=i.cache.get(t);void 0!==o?e&&e(o):(o=new XMLHttpRequest,o.open("GET",t,!0),o.addEventListener("load",function(){i.cache.add(t,this.response),e&&e(this.response),i.manager.itemEnd(t)},!1),void 0!==n&&o.addEventListener("progress",function(t){n(t)},!1),void 0!==r&&o.addEventListener("error",function(t){r(t)},!1),void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),void 0!==this.responseType&&(o.responseType=this.responseType),o.send(null),i.manager.itemStart(t))},setResponseType:function(t){this.responseType=t},setCrossOrigin:function(t){this.crossOrigin=t}},THREE.ImageLoader=function(t){this.cache=new THREE.Cache,this.manager=void 0!==t?t:THREE.DefaultLoadingManager},THREE.ImageLoader.prototype={constructor:THREE.ImageLoader,load:function(t,e,n,r){var i=this,o=i.cache.get(t);return void 0===o?(o=document.createElement("img"),void 0!==e&&o.addEventListener("load",function(){i.cache.add(t,this),e(this),i.manager.itemEnd(t)},!1),void 0!==n&&o.addEventListener("progress",function(t){n(t)},!1),void 0!==r&&o.addEventListener("error",function(t){r(t)},!1),void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),o.src=t,i.manager.itemStart(t),o):void e(o)},setCrossOrigin:function(t){this.crossOrigin=t}},THREE.JSONLoader=function(t){THREE.Loader.call(this,t),this.withCredentials=!1},THREE.JSONLoader.prototype=Object.create(THREE.Loader.prototype),THREE.JSONLoader.prototype.load=function(t,e,n){n=n&&"string"==typeof n?n:this.extractUrlBase(t),this.onLoadStart(),this.loadAjaxJSON(this,t,e,n)},THREE.JSONLoader.prototype.loadAjaxJSON=function(t,e,n,r,i){var o=new XMLHttpRequest,a=0;o.onreadystatechange=function(){if(o.readyState===o.DONE)if(200===o.status||0===o.status){if(o.responseText){var s=JSON.parse(o.responseText);if(void 0!==s.metadata&&"scene"===s.metadata.type)return void console.error('THREE.JSONLoader: "'+e+'" seems to be a Scene. Use THREE.SceneLoader instead.');s=t.parse(s,r),n(s.geometry,s.materials)}else console.error('THREE.JSONLoader: "'+e+'" seems to be unreachable or the file is empty.');t.onLoadComplete()}else console.error("THREE.JSONLoader: Couldn't load \""+e+'" ('+o.status+")");else o.readyState===o.LOADING?i&&(0===a&&(a=o.getResponseHeader("Content-Length")),i({total:a,loaded:o.responseText.length})):o.readyState===o.HEADERS_RECEIVED&&void 0!==i&&(a=o.getResponseHeader("Content-Length"))},o.open("GET",e,!0),o.withCredentials=this.withCredentials,o.send(null)},THREE.JSONLoader.prototype.parse=function(t,e){var n=new THREE.Geometry,r=void 0!==t.scale?1/t.scale:1;return function(e){var r,i,o,a,s,h,u,c,l,f,p,d,m,g=t.faces;h=t.vertices;var v=t.normals,y=t.colors,E=0;if(void 0!==t.uvs){for(r=0;r<t.uvs.length;r++)t.uvs[r].length&&E++;for(r=0;E>r;r++)n.faceVertexUvs[r]=[]}for(a=0,s=h.length;s>a;)r=new THREE.Vector3,r.x=h[a++]*e,r.y=h[a++]*e,r.z=h[a++]*e,n.vertices.push(r);for(a=0,s=g.length;s>a;)if(e=g[a++],l=1&e,o=2&e,r=8&e,u=16&e,f=32&e,h=64&e,e&=128,l){if(l=new THREE.Face3,l.a=g[a],l.b=g[a+1],l.c=g[a+3],p=new THREE.Face3,p.a=g[a+1],p.b=g[a+2],p.c=g[a+3],a+=4,o&&(o=g[a++],l.materialIndex=o,p.materialIndex=o),o=n.faces.length,r)for(r=0;E>r;r++)for(d=t.uvs[r],n.faceVertexUvs[r][o]=[],n.faceVertexUvs[r][o+1]=[],i=0;4>i;i++)c=g[a++],m=d[2*c],c=d[2*c+1],m=new THREE.Vector2(m,c),2!==i&&n.faceVertexUvs[r][o].push(m),0!==i&&n.faceVertexUvs[r][o+1].push(m);if(u&&(u=3*g[a++],l.normal.set(v[u++],v[u++],v[u]),p.normal.copy(l.normal)),f)for(r=0;4>r;r++)u=3*g[a++],f=new THREE.Vector3(v[u++],v[u++],v[u]),2!==r&&l.vertexNormals.push(f),0!==r&&p.vertexNormals.push(f);if(h&&(h=g[a++],h=y[h],l.color.setHex(h),p.color.setHex(h)),e)for(r=0;4>r;r++)h=g[a++],h=y[h],2!==r&&l.vertexColors.push(new THREE.Color(h)),0!==r&&p.vertexColors.push(new THREE.Color(h));n.faces.push(l),n.faces.push(p)}else{if(l=new THREE.Face3,l.a=g[a++],l.b=g[a++],l.c=g[a++],o&&(o=g[a++],l.materialIndex=o),o=n.faces.length,r)for(r=0;E>r;r++)for(d=t.uvs[r],n.faceVertexUvs[r][o]=[],i=0;3>i;i++)c=g[a++],m=d[2*c],c=d[2*c+1],m=new THREE.Vector2(m,c),n.faceVertexUvs[r][o].push(m);if(u&&(u=3*g[a++],l.normal.set(v[u++],v[u++],v[u])),f)for(r=0;3>r;r++)u=3*g[a++],f=new THREE.Vector3(v[u++],v[u++],v[u]),l.vertexNormals.push(f);if(h&&(h=g[a++],l.color.setHex(y[h])),e)for(r=0;3>r;r++)h=g[a++],l.vertexColors.push(new THREE.Color(y[h]));n.faces.push(l)}}(r),function(){var e=void 0!==t.influencesPerVertex?t.influencesPerVertex:2;if(t.skinWeights)for(var r=0,i=t.skinWeights.length;i>r;r+=e)n.skinWeights.push(new THREE.Vector4(t.skinWeights[r],e>1?t.skinWeights[r+1]:0,e>2?t.skinWeights[r+2]:0,e>3?t.skinWeights[r+3]:0));if(t.skinIndices)for(r=0,i=t.skinIndices.length;i>r;r+=e)n.skinIndices.push(new THREE.Vector4(t.skinIndices[r],e>1?t.skinIndices[r+1]:0,e>2?t.skinIndices[r+2]:0,e>3?t.skinIndices[r+3]:0));n.bones=t.bones,n.bones&&0<n.bones.length&&(n.skinWeights.length!==n.skinIndices.length||n.skinIndices.length!==n.vertices.length)&&console.warn("When skinning, number of vertices ("+n.vertices.length+"), skinIndices ("+n.skinIndices.length+"), and skinWeights ("+n.skinWeights.length+") should match."),n.animation=t.animation,n.animations=t.animations}(),function(e){if(void 0!==t.morphTargets){var r,i,o,a,s,h;for(r=0,i=t.morphTargets.length;i>r;r++)for(n.morphTargets[r]={},n.morphTargets[r].name=t.morphTargets[r].name,n.morphTargets[r].vertices=[],s=n.morphTargets[r].vertices,h=t.morphTargets[r].vertices,o=0,a=h.length;a>o;o+=3){var u=new THREE.Vector3;u.x=h[o]*e,u.y=h[o+1]*e,u.z=h[o+2]*e,s.push(u)}}if(void 0!==t.morphColors)for(r=0,i=t.morphColors.length;i>r;r++)for(n.morphColors[r]={},n.morphColors[r].name=t.morphColors[r].name,n.morphColors[r].colors=[],a=n.morphColors[r].colors,s=t.morphColors[r].colors,e=0,o=s.length;o>e;e+=3)h=new THREE.Color(16755200),h.setRGB(s[e],s[e+1],s[e+2]),a.push(h)}(r),n.computeFaceNormals(),n.computeBoundingSphere(),void 0===t.materials||0===t.materials.length?{geometry:n}:(r=this.initMaterials(t.materials,e),this.needsTangents(r)&&n.computeTangents(),{geometry:n,materials:r})},THREE.LoadingManager=function(t,e,n){var r=this,i=0,o=0;this.onLoad=t,this.onProgress=e,this.onError=n,this.itemStart=function(){o++},this.itemEnd=function(t){i++,void 0!==r.onProgress&&r.onProgress(t,i,o),i===o&&void 0!==r.onLoad&&r.onLoad()}},THREE.DefaultLoadingManager=new THREE.LoadingManager,THREE.BufferGeometryLoader=function(t){this.manager=void 0!==t?t:THREE.DefaultLoadingManager},THREE.BufferGeometryLoader.prototype={constructor:THREE.BufferGeometryLoader,load:function(t,e,n,r){var i=this,o=new THREE.XHRLoader;o.setCrossOrigin(this.crossOrigin),o.load(t,function(t){e(i.parse(JSON.parse(t)))},n,r)},setCrossOrigin:function(t){this.crossOrigin=t},parse:function(t){var e,n=new THREE.BufferGeometry,r=t.attributes;for(e in r){var i=r[e];n.attributes[e]={itemSize:i.itemSize,array:new self[i.type](i.array)}}return r=t.offsets,void 0!==r&&(n.offsets=JSON.parse(JSON.stringify(r))),t=t.boundingSphere,void 0!==t&&(n.boundingSphere=new THREE.Sphere((new THREE.Vector3).fromArray(void 0!==t.center?t.center:[0,0,0]),t.radius)),n}},THREE.MaterialLoader=function(t){this.manager=void 0!==t?t:THREE.DefaultLoadingManager},THREE.MaterialLoader.prototype={constructor:THREE.MaterialLoader,load:function(t,e,n,r){var i=this,o=new THREE.XHRLoader;o.setCrossOrigin(this.crossOrigin),o.load(t,function(t){e(i.parse(JSON.parse(t)))},n,r)},setCrossOrigin:function(t){this.crossOrigin=t},parse:function(t){var e=new THREE[t.type];if(void 0!==t.color&&e.color.setHex(t.color),void 0!==t.ambient&&e.ambient.setHex(t.ambient),void 0!==t.emissive&&e.emissive.setHex(t.emissive),void 0!==t.specular&&e.specular.setHex(t.specular),void 0!==t.shininess&&(e.shininess=t.shininess),void 0!==t.uniforms&&(e.uniforms=t.uniforms),void 0!==t.vertexShader&&(e.vertexShader=t.vertexShader),void 0!==t.fragmentShader&&(e.fragmentShader=t.fragmentShader),void 0!==t.vertexColors&&(e.vertexColors=t.vertexColors),void 0!==t.blending&&(e.blending=t.blending),void 0!==t.side&&(e.side=t.side),void 0!==t.opacity&&(e.opacity=t.opacity),void 0!==t.transparent&&(e.transparent=t.transparent),void 0!==t.wireframe&&(e.wireframe=t.wireframe),void 0!==t.materials)for(var n=0,r=t.materials.length;r>n;n++)e.materials.push(this.parse(t.materials[n]));return e}},THREE.ObjectLoader=function(t){this.manager=void 0!==t?t:THREE.DefaultLoadingManager},THREE.ObjectLoader.prototype={constructor:THREE.ObjectLoader,load:function(t,e,n,r){var i=this,o=new THREE.XHRLoader(i.manager);o.setCrossOrigin(this.crossOrigin),o.load(t,function(t){e(i.parse(JSON.parse(t)))},n,r)},setCrossOrigin:function(t){this.crossOrigin=t},parse:function(t){var e=this.parseGeometries(t.geometries),n=this.parseMaterials(t.materials);return this.parseObject(t.object,e,n)},parseGeometries:function(t){var e={};if(void 0!==t)for(var n=new THREE.JSONLoader,r=new THREE.BufferGeometryLoader,i=0,o=t.length;o>i;i++){var a,s=t[i];switch(s.type){case"PlaneGeometry":a=new THREE.PlaneGeometry(s.width,s.height,s.widthSegments,s.heightSegments);break;case"BoxGeometry":case"CubeGeometry":a=new THREE.BoxGeometry(s.width,s.height,s.depth,s.widthSegments,s.heightSegments,s.depthSegments);break;case"CircleGeometry":a=new THREE.CircleGeometry(s.radius,s.segments);break;case"CylinderGeometry":a=new THREE.CylinderGeometry(s.radiusTop,s.radiusBottom,s.height,s.radialSegments,s.heightSegments,s.openEnded);break;case"SphereGeometry":a=new THREE.SphereGeometry(s.radius,s.widthSegments,s.heightSegments,s.phiStart,s.phiLength,s.thetaStart,s.thetaLength);break;case"IcosahedronGeometry":a=new THREE.IcosahedronGeometry(s.radius,s.detail);break;case"TorusGeometry":a=new THREE.TorusGeometry(s.radius,s.tube,s.radialSegments,s.tubularSegments,s.arc);break;case"TorusKnotGeometry":a=new THREE.TorusKnotGeometry(s.radius,s.tube,s.radialSegments,s.tubularSegments,s.p,s.q,s.heightScale);break;case"BufferGeometry":a=r.parse(s.data);break;case"Geometry":a=n.parse(s.data).geometry}a.uuid=s.uuid,void 0!==s.name&&(a.name=s.name),e[s.uuid]=a}return e},parseMaterials:function(t){var e={};if(void 0!==t)for(var n=new THREE.MaterialLoader,r=0,i=t.length;i>r;r++){var o=t[r],a=n.parse(o);a.uuid=o.uuid,void 0!==o.name&&(a.name=o.name),e[o.uuid]=a}return e},parseObject:function(){var t=new THREE.Matrix4;return function(e,n,r){var i;switch(e.type){case"Scene":i=new THREE.Scene;break;case"PerspectiveCamera":i=new THREE.PerspectiveCamera(e.fov,e.aspect,e.near,e.far);break;case"OrthographicCamera":i=new THREE.OrthographicCamera(e.left,e.right,e.top,e.bottom,e.near,e.far);break;case"AmbientLight":i=new THREE.AmbientLight(e.color);break;case"DirectionalLight":i=new THREE.DirectionalLight(e.color,e.intensity);break;case"PointLight":i=new THREE.PointLight(e.color,e.intensity,e.distance);break;case"SpotLight":i=new THREE.SpotLight(e.color,e.intensity,e.distance,e.angle,e.exponent);break;case"HemisphereLight":i=new THREE.HemisphereLight(e.color,e.groundColor,e.intensity);break;case"Mesh":i=n[e.geometry];var o=r[e.material];void 0===i&&console.error("THREE.ObjectLoader: Undefined geometry "+e.geometry),void 0===o&&console.error("THREE.ObjectLoader: Undefined material "+e.material),i=new THREE.Mesh(i,o);break;case"Sprite":o=r[e.material],void 0===o&&console.error("THREE.ObjectLoader: Undefined material "+e.material),i=new THREE.Sprite(o);break;default:i=new THREE.Object3D}if(i.uuid=e.uuid,void 0!==e.name&&(i.name=e.name),void 0!==e.matrix?(t.fromArray(e.matrix),t.decompose(i.position,i.quaternion,i.scale)):(void 0!==e.position&&i.position.fromArray(e.position),void 0!==e.rotation&&i.rotation.fromArray(e.rotation),void 0!==e.scale&&i.scale.fromArray(e.scale)),void 0!==e.visible&&(i.visible=e.visible),void 0!==e.userData&&(i.userData=e.userData),void 0!==e.children)for(var a in e.children)i.add(this.parseObject(e.children[a],n,r));return i}}()},THREE.TextureLoader=function(t){this.manager=void 0!==t?t:THREE.DefaultLoadingManager},THREE.TextureLoader.prototype={constructor:THREE.TextureLoader,load:function(t,e,n,r){var i=new THREE.ImageLoader(this.manager);i.setCrossOrigin(this.crossOrigin),i.load(t,function(t){t=new THREE.Texture(t),t.needsUpdate=!0,void 0!==e&&e(t)},n,r)},setCrossOrigin:function(t){this.crossOrigin=t}},THREE.Material=function(){this.id=THREE.MaterialIdCount++,this.uuid=THREE.Math.generateUUID(),this.name="",this.side=THREE.FrontSide,this.opacity=1,this.transparent=!1,this.blending=THREE.NormalBlending,this.blendSrc=THREE.SrcAlphaFactor,this.blendDst=THREE.OneMinusSrcAlphaFactor,this.blendEquation=THREE.AddEquation,this.depthWrite=this.depthTest=!0,this.polygonOffset=!1,this.overdraw=this.alphaTest=this.polygonOffsetUnits=this.polygonOffsetFactor=0,this.needsUpdate=this.visible=!0},THREE.Material.prototype={constructor:THREE.Material,setValues:function(t){if(void 0!==t)for(var e in t){var n=t[e];if(void 0===n)console.warn("THREE.Material: '"+e+"' parameter is undefined.");else if(e in this){var r=this[e];r instanceof THREE.Color?r.set(n):r instanceof THREE.Vector3&&n instanceof THREE.Vector3?r.copy(n):this[e]="overdraw"==e?Number(n):n}}},clone:function(t){return void 0===t&&(t=new THREE.Material),t.name=this.name,t.side=this.side,t.opacity=this.opacity,t.transparent=this.transparent,t.blending=this.blending,t.blendSrc=this.blendSrc,t.blendDst=this.blendDst,t.blendEquation=this.blendEquation,t.depthTest=this.depthTest,t.depthWrite=this.depthWrite,t.polygonOffset=this.polygonOffset,t.polygonOffsetFactor=this.polygonOffsetFactor,t.polygonOffsetUnits=this.polygonOffsetUnits,t.alphaTest=this.alphaTest,t.overdraw=this.overdraw,t.visible=this.visible,t},dispose:function(){this.dispatchEvent({type:"dispose"})}},THREE.EventDispatcher.prototype.apply(THREE.Material.prototype),THREE.MaterialIdCount=0,THREE.LineBasicMaterial=function(t){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.linewidth=1,this.linejoin=this.linecap="round",this.vertexColors=THREE.NoColors,this.fog=!0,this.setValues(t)},THREE.LineBasicMaterial.prototype=Object.create(THREE.Material.prototype),THREE.LineBasicMaterial.prototype.clone=function(){var t=new THREE.LineBasicMaterial;return THREE.Material.prototype.clone.call(this,t),t.color.copy(this.color),t.linewidth=this.linewidth,t.linecap=this.linecap,t.linejoin=this.linejoin,t.vertexColors=this.vertexColors,t.fog=this.fog,t},THREE.LineDashedMaterial=function(t){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.scale=this.linewidth=1,this.dashSize=3,this.gapSize=1,this.vertexColors=!1,this.fog=!0,this.setValues(t)},THREE.LineDashedMaterial.prototype=Object.create(THREE.Material.prototype),THREE.LineDashedMaterial.prototype.clone=function(){var t=new THREE.LineDashedMaterial;return THREE.Material.prototype.clone.call(this,t),t.color.copy(this.color),t.linewidth=this.linewidth,t.scale=this.scale,t.dashSize=this.dashSize,t.gapSize=this.gapSize,t.vertexColors=this.vertexColors,t.fog=this.fog,t},THREE.MeshBasicMaterial=function(t){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.envMap=this.alphaMap=this.specularMap=this.lightMap=this.map=null,this.combine=THREE.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=THREE.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinejoin=this.wireframeLinecap="round",this.vertexColors=THREE.NoColors,this.morphTargets=this.skinning=!1,this.setValues(t)},THREE.MeshBasicMaterial.prototype=Object.create(THREE.Material.prototype),THREE.MeshBasicMaterial.prototype.clone=function(){var t=new THREE.MeshBasicMaterial;return THREE.Material.prototype.clone.call(this,t),t.color.copy(this.color),t.map=this.map,t.lightMap=this.lightMap,t.specularMap=this.specularMap,t.alphaMap=this.alphaMap,t.envMap=this.envMap,t.combine=this.combine,t.reflectivity=this.reflectivity,t.refractionRatio=this.refractionRatio,t.fog=this.fog,t.shading=this.shading,t.wireframe=this.wireframe,t.wireframeLinewidth=this.wireframeLinewidth,t.wireframeLinecap=this.wireframeLinecap,t.wireframeLinejoin=this.wireframeLinejoin,t.vertexColors=this.vertexColors,t.skinning=this.skinning,t.morphTargets=this.morphTargets,t},THREE.MeshLambertMaterial=function(t){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.ambient=new THREE.Color(16777215),this.emissive=new THREE.Color(0),this.wrapAround=!1,this.wrapRGB=new THREE.Vector3(1,1,1),this.envMap=this.alphaMap=this.specularMap=this.lightMap=this.map=null,this.combine=THREE.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=THREE.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinejoin=this.wireframeLinecap="round",this.vertexColors=THREE.NoColors,this.morphNormals=this.morphTargets=this.skinning=!1,this.setValues(t)},THREE.MeshLambertMaterial.prototype=Object.create(THREE.Material.prototype),THREE.MeshLambertMaterial.prototype.clone=function(){var t=new THREE.MeshLambertMaterial;return THREE.Material.prototype.clone.call(this,t),t.color.copy(this.color),t.ambient.copy(this.ambient),t.emissive.copy(this.emissive),t.wrapAround=this.wrapAround,t.wrapRGB.copy(this.wrapRGB),t.map=this.map,t.lightMap=this.lightMap,t.specularMap=this.specularMap,t.alphaMap=this.alphaMap,t.envMap=this.envMap,t.combine=this.combine,t.reflectivity=this.reflectivity,t.refractionRatio=this.refractionRatio,t.fog=this.fog,t.shading=this.shading,t.wireframe=this.wireframe,t.wireframeLinewidth=this.wireframeLinewidth,t.wireframeLinecap=this.wireframeLinecap,t.wireframeLinejoin=this.wireframeLinejoin,t.vertexColors=this.vertexColors,t.skinning=this.skinning,t.morphTargets=this.morphTargets,t.morphNormals=this.morphNormals,t},THREE.MeshPhongMaterial=function(t){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.ambient=new THREE.Color(16777215),this.emissive=new THREE.Color(0),this.specular=new THREE.Color(1118481),this.shininess=30,this.wrapAround=this.metal=!1,this.wrapRGB=new THREE.Vector3(1,1,1),this.bumpMap=this.lightMap=this.map=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new THREE.Vector2(1,1),this.envMap=this.alphaMap=this.specularMap=null,this.combine=THREE.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=THREE.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinejoin=this.wireframeLinecap="round",this.vertexColors=THREE.NoColors,this.morphNormals=this.morphTargets=this.skinning=!1,this.setValues(t)},THREE.MeshPhongMaterial.prototype=Object.create(THREE.Material.prototype),THREE.MeshPhongMaterial.prototype.clone=function(){var t=new THREE.MeshPhongMaterial;return THREE.Material.prototype.clone.call(this,t),t.color.copy(this.color),t.ambient.copy(this.ambient),t.emissive.copy(this.emissive),t.specular.copy(this.specular),t.shininess=this.shininess,t.metal=this.metal,t.wrapAround=this.wrapAround,t.wrapRGB.copy(this.wrapRGB),t.map=this.map,t.lightMap=this.lightMap,t.bumpMap=this.bumpMap,t.bumpScale=this.bumpScale,t.normalMap=this.normalMap,t.normalScale.copy(this.normalScale),t.specularMap=this.specularMap,t.alphaMap=this.alphaMap,t.envMap=this.envMap,t.combine=this.combine,t.reflectivity=this.reflectivity,t.refractionRatio=this.refractionRatio,t.fog=this.fog,t.shading=this.shading,t.wireframe=this.wireframe,t.wireframeLinewidth=this.wireframeLinewidth,t.wireframeLinecap=this.wireframeLinecap,t.wireframeLinejoin=this.wireframeLinejoin,t.vertexColors=this.vertexColors,t.skinning=this.skinning,t.morphTargets=this.morphTargets,t.morphNormals=this.morphNormals,t},THREE.MeshDepthMaterial=function(t){THREE.Material.call(this),this.wireframe=this.morphTargets=!1,this.wireframeLinewidth=1,this.setValues(t)},THREE.MeshDepthMaterial.prototype=Object.create(THREE.Material.prototype),THREE.MeshDepthMaterial.prototype.clone=function(){var t=new THREE.MeshDepthMaterial;return THREE.Material.prototype.clone.call(this,t),t.wireframe=this.wireframe,t.wireframeLinewidth=this.wireframeLinewidth,t},THREE.MeshNormalMaterial=function(t){THREE.Material.call(this,t),this.shading=THREE.FlatShading,this.wireframe=!1,this.wireframeLinewidth=1,this.morphTargets=!1,this.setValues(t)},THREE.MeshNormalMaterial.prototype=Object.create(THREE.Material.prototype),THREE.MeshNormalMaterial.prototype.clone=function(){var t=new THREE.MeshNormalMaterial;return THREE.Material.prototype.clone.call(this,t),t.shading=this.shading,t.wireframe=this.wireframe,t.wireframeLinewidth=this.wireframeLinewidth,t},THREE.MeshFaceMaterial=function(t){this.materials=t instanceof Array?t:[]},THREE.MeshFaceMaterial.prototype.clone=function(){for(var t=new THREE.MeshFaceMaterial,e=0;e<this.materials.length;e++)t.materials.push(this.materials[e].clone());return t},THREE.PointCloudMaterial=function(t){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.vertexColors=THREE.NoColors,this.fog=!0,this.setValues(t)},THREE.PointCloudMaterial.prototype=Object.create(THREE.Material.prototype),THREE.PointCloudMaterial.prototype.clone=function(){var t=new THREE.PointCloudMaterial;return THREE.Material.prototype.clone.call(this,t),t.color.copy(this.color),t.map=this.map,t.size=this.size,t.sizeAttenuation=this.sizeAttenuation,t.vertexColors=this.vertexColors,t.fog=this.fog,t
},THREE.ParticleBasicMaterial=function(t){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointCloudMaterial."),new THREE.PointCloudMaterial(t)},THREE.ParticleSystemMaterial=function(t){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointCloudMaterial."),new THREE.PointCloudMaterial(t)},THREE.ShaderMaterial=function(t){THREE.Material.call(this),this.defines={},this.uniforms={},this.attributes=null,this.vertexShader="void main() {\n	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.shading=THREE.SmoothShading,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.lights=this.fog=!1,this.vertexColors=THREE.NoColors,this.morphNormals=this.morphTargets=this.skinning=!1,this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.setValues(t)},THREE.ShaderMaterial.prototype=Object.create(THREE.Material.prototype),THREE.ShaderMaterial.prototype.clone=function(){var t=new THREE.ShaderMaterial;return THREE.Material.prototype.clone.call(this,t),t.fragmentShader=this.fragmentShader,t.vertexShader=this.vertexShader,t.uniforms=THREE.UniformsUtils.clone(this.uniforms),t.attributes=this.attributes,t.defines=this.defines,t.shading=this.shading,t.wireframe=this.wireframe,t.wireframeLinewidth=this.wireframeLinewidth,t.fog=this.fog,t.lights=this.lights,t.vertexColors=this.vertexColors,t.skinning=this.skinning,t.morphTargets=this.morphTargets,t.morphNormals=this.morphNormals,t},THREE.RawShaderMaterial=function(t){THREE.ShaderMaterial.call(this,t)},THREE.RawShaderMaterial.prototype=Object.create(THREE.ShaderMaterial.prototype),THREE.RawShaderMaterial.prototype.clone=function(){var t=new THREE.RawShaderMaterial;return THREE.ShaderMaterial.prototype.clone.call(this,t),t},THREE.SpriteMaterial=function(t){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.map=null,this.rotation=0,this.fog=!1,this.setValues(t)},THREE.SpriteMaterial.prototype=Object.create(THREE.Material.prototype),THREE.SpriteMaterial.prototype.clone=function(){var t=new THREE.SpriteMaterial;return THREE.Material.prototype.clone.call(this,t),t.color.copy(this.color),t.map=this.map,t.rotation=this.rotation,t.fog=this.fog,t},THREE.SpriteCanvasMaterial=function(t){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.program=function(){},this.setValues(t)},THREE.SpriteCanvasMaterial.prototype=Object.create(THREE.Material.prototype),THREE.SpriteCanvasMaterial.prototype.clone=function(){var t=new THREE.SpriteCanvasMaterial;return THREE.Material.prototype.clone.call(this,t),t.color.copy(this.color),t.program=this.program,t},THREE.ParticleCanvasMaterial=THREE.SpriteCanvasMaterial,THREE.Texture=function(t,e,n,r,i,o,a,s,h){this.id=THREE.TextureIdCount++,this.uuid=THREE.Math.generateUUID(),this.name="",this.image=void 0!==t?t:THREE.Texture.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==e?e:THREE.Texture.DEFAULT_MAPPING,this.wrapS=void 0!==n?n:THREE.ClampToEdgeWrapping,this.wrapT=void 0!==r?r:THREE.ClampToEdgeWrapping,this.magFilter=void 0!==i?i:THREE.LinearFilter,this.minFilter=void 0!==o?o:THREE.LinearMipMapLinearFilter,this.anisotropy=void 0!==h?h:1,this.format=void 0!==a?a:THREE.RGBAFormat,this.type=void 0!==s?s:THREE.UnsignedByteType,this.offset=new THREE.Vector2(0,0),this.repeat=new THREE.Vector2(1,1),this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this._needsUpdate=!1,this.onUpdate=null},THREE.Texture.DEFAULT_IMAGE=void 0,THREE.Texture.DEFAULT_MAPPING=new THREE.UVMapping,THREE.Texture.prototype={constructor:THREE.Texture,get needsUpdate(){return this._needsUpdate},set needsUpdate(t){!0===t&&this.update(),this._needsUpdate=t},clone:function(t){return void 0===t&&(t=new THREE.Texture),t.image=this.image,t.mipmaps=this.mipmaps.slice(0),t.mapping=this.mapping,t.wrapS=this.wrapS,t.wrapT=this.wrapT,t.magFilter=this.magFilter,t.minFilter=this.minFilter,t.anisotropy=this.anisotropy,t.format=this.format,t.type=this.type,t.offset.copy(this.offset),t.repeat.copy(this.repeat),t.generateMipmaps=this.generateMipmaps,t.premultiplyAlpha=this.premultiplyAlpha,t.flipY=this.flipY,t.unpackAlignment=this.unpackAlignment,t},update:function(){this.dispatchEvent({type:"update"})},dispose:function(){this.dispatchEvent({type:"dispose"})}},THREE.EventDispatcher.prototype.apply(THREE.Texture.prototype),THREE.TextureIdCount=0,THREE.CubeTexture=function(t,e,n,r,i,o,a,s,h){THREE.Texture.call(this,t,e,n,r,i,o,a,s,h),this.images=t},THREE.CubeTexture.prototype=Object.create(THREE.Texture.prototype),THREE.CubeTexture.clone=function(t){return void 0===t&&(t=new THREE.CubeTexture),THREE.Texture.prototype.clone.call(this,t),t.images=this.images,t},THREE.CompressedTexture=function(t,e,n,r,i,o,a,s,h,u,c){THREE.Texture.call(this,null,o,a,s,h,u,r,i,c),this.image={width:e,height:n},this.mipmaps=t,this.generateMipmaps=!1},THREE.CompressedTexture.prototype=Object.create(THREE.Texture.prototype),THREE.CompressedTexture.prototype.clone=function(){var t=new THREE.CompressedTexture;return THREE.Texture.prototype.clone.call(this,t),t},THREE.DataTexture=function(t,e,n,r,i,o,a,s,h,u,c){THREE.Texture.call(this,null,o,a,s,h,u,r,i,c),this.image={data:t,width:e,height:n}},THREE.DataTexture.prototype=Object.create(THREE.Texture.prototype),THREE.DataTexture.prototype.clone=function(){var t=new THREE.DataTexture;return THREE.Texture.prototype.clone.call(this,t),t},THREE.PointCloud=function(t,e){THREE.Object3D.call(this),this.geometry=void 0!==t?t:new THREE.Geometry,this.material=void 0!==e?e:new THREE.PointCloudMaterial({color:16777215*Math.random()}),this.sortParticles=!1},THREE.PointCloud.prototype=Object.create(THREE.Object3D.prototype),THREE.PointCloud.prototype.raycast=function(){var t=new THREE.Matrix4,e=new THREE.Ray;return function(n,r){var i=this,o=i.geometry,a=n.params.PointCloud.threshold;if(t.getInverse(this.matrixWorld),e.copy(n.ray).applyMatrix4(t),null===o.boundingBox||!1!==e.isIntersectionBox(o.boundingBox)){var s=a/((this.scale.x+this.scale.y+this.scale.z)/3),h=new THREE.Vector3,a=function(t,o){var a=e.distanceToPoint(t);if(s>a){var h=e.closestPointToPoint(t);h.applyMatrix4(i.matrixWorld);var u=n.ray.origin.distanceTo(h);r.push({distance:u,distanceToRay:a,point:h.clone(),index:o,face:null,object:i})}};if(o instanceof THREE.BufferGeometry){var u=o.attributes,c=u.position.array;if(void 0!==u.index){var u=u.index.array,l=o.offsets;0===l.length&&(l=[{start:0,count:u.length,index:0}]);for(var f=0,p=l.length;p>f;++f)for(var d=l[f].start,m=l[f].index,o=d,d=d+l[f].count;d>o;o++){var g=m+u[o];h.set(c[3*g],c[3*g+1],c[3*g+2]),a(h,g)}}else for(u=c.length/3,o=0;u>o;o++)h.set(c[3*o],c[3*o+1],c[3*o+2]),a(h,o)}else for(h=this.geometry.vertices,o=0;o<h.length;o++)a(h[o],o)}}}(),THREE.PointCloud.prototype.clone=function(t){return void 0===t&&(t=new THREE.PointCloud(this.geometry,this.material)),t.sortParticles=this.sortParticles,THREE.Object3D.prototype.clone.call(this,t),t},THREE.ParticleSystem=function(t,e){return console.warn("THREE.ParticleSystem has been renamed to THREE.PointCloud."),new THREE.PointCloud(t,e)},THREE.Line=function(t,e,n){THREE.Object3D.call(this),this.geometry=void 0!==t?t:new THREE.Geometry,this.material=void 0!==e?e:new THREE.LineBasicMaterial({color:16777215*Math.random()}),this.type=void 0!==n?n:THREE.LineStrip},THREE.LineStrip=0,THREE.LinePieces=1,THREE.Line.prototype=Object.create(THREE.Object3D.prototype),THREE.Line.prototype.raycast=function(){var t=new THREE.Matrix4,e=new THREE.Ray,n=new THREE.Sphere;return function(r,i){var o=r.linePrecision,o=o*o,a=this.geometry;if(null===a.boundingSphere&&a.computeBoundingSphere(),n.copy(a.boundingSphere),n.applyMatrix4(this.matrixWorld),!1!==r.ray.isIntersectionSphere(n)&&(t.getInverse(this.matrixWorld),e.copy(r.ray).applyMatrix4(t),a instanceof THREE.Geometry))for(var a=a.vertices,s=a.length,h=new THREE.Vector3,u=new THREE.Vector3,c=this.type===THREE.LineStrip?1:2,l=0;s-1>l;l+=c)if(!(e.distanceSqToSegment(a[l],a[l+1],u,h)>o)){var f=e.origin.distanceTo(u);f<r.near||f>r.far||i.push({distance:f,point:h.clone().applyMatrix4(this.matrixWorld),face:null,faceIndex:null,object:this})}}}(),THREE.Line.prototype.clone=function(t){return void 0===t&&(t=new THREE.Line(this.geometry,this.material,this.type)),THREE.Object3D.prototype.clone.call(this,t),t},THREE.Mesh=function(t,e){THREE.Object3D.call(this),this.geometry=void 0!==t?t:new THREE.Geometry,this.material=void 0!==e?e:new THREE.MeshBasicMaterial({color:16777215*Math.random()}),this.updateMorphTargets()},THREE.Mesh.prototype=Object.create(THREE.Object3D.prototype),THREE.Mesh.prototype.updateMorphTargets=function(){if(void 0!==this.geometry.morphTargets&&0<this.geometry.morphTargets.length){this.morphTargetBase=-1,this.morphTargetForcedOrder=[],this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var t=0,e=this.geometry.morphTargets.length;e>t;t++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[t].name]=t}},THREE.Mesh.prototype.getMorphTargetIndexByName=function(t){return void 0!==this.morphTargetDictionary[t]?this.morphTargetDictionary[t]:(console.log("THREE.Mesh.getMorphTargetIndexByName: morph target "+t+" does not exist. Returning 0."),0)},THREE.Mesh.prototype.raycast=function(){var t=new THREE.Matrix4,e=new THREE.Ray,n=new THREE.Sphere,r=new THREE.Vector3,i=new THREE.Vector3,o=new THREE.Vector3;return function(a,s){var h=this.geometry;if(null===h.boundingSphere&&h.computeBoundingSphere(),n.copy(h.boundingSphere),n.applyMatrix4(this.matrixWorld),!1!==a.ray.isIntersectionSphere(n)&&(t.getInverse(this.matrixWorld),e.copy(a.ray).applyMatrix4(t),null===h.boundingBox||!1!==e.isIntersectionBox(h.boundingBox)))if(h instanceof THREE.BufferGeometry){var u=this.material;if(void 0!==u){var c,l,f=h.attributes,p=a.precision;if(void 0!==f.index){var d=f.index.array,m=f.position.array,g=h.offsets;0===g.length&&(g=[{start:0,count:d.length,index:0}]);for(var v=0,y=g.length;y>v;++v)for(var f=g[v].start,E=g[v].index,h=f,x=f+g[v].count;x>h;h+=3){f=E+d[h],c=E+d[h+1],l=E+d[h+2],r.set(m[3*f],m[3*f+1],m[3*f+2]),i.set(m[3*c],m[3*c+1],m[3*c+2]),o.set(m[3*l],m[3*l+1],m[3*l+2]);var T=u.side===THREE.BackSide?e.intersectTriangle(o,i,r,!0):e.intersectTriangle(r,i,o,u.side!==THREE.DoubleSide);if(null!==T){T.applyMatrix4(this.matrixWorld);var b=a.ray.origin.distanceTo(T);p>b||b<a.near||b>a.far||s.push({distance:b,point:T,indices:[f,c,l],face:null,faceIndex:null,object:this})}}}else for(m=f.position.array,d=h=0,x=m.length;x>h;h+=3,d+=9)f=h,c=h+1,l=h+2,r.set(m[d],m[d+1],m[d+2]),i.set(m[d+3],m[d+4],m[d+5]),o.set(m[d+6],m[d+7],m[d+8]),T=u.side===THREE.BackSide?e.intersectTriangle(o,i,r,!0):e.intersectTriangle(r,i,o,u.side!==THREE.DoubleSide),null!==T&&(T.applyMatrix4(this.matrixWorld),b=a.ray.origin.distanceTo(T),p>b||b<a.near||b>a.far||s.push({distance:b,point:T,indices:[f,c,l],face:null,faceIndex:null,object:this}))}}else if(h instanceof THREE.Geometry)for(d=this.material instanceof THREE.MeshFaceMaterial,m=!0===d?this.material.materials:null,p=a.precision,g=h.vertices,v=0,y=h.faces.length;y>v;v++)if(E=h.faces[v],u=!0===d?m[E.materialIndex]:this.material,void 0!==u){if(f=g[E.a],c=g[E.b],l=g[E.c],!0===u.morphTargets){T=h.morphTargets,b=this.morphTargetInfluences,r.set(0,0,0),i.set(0,0,0),o.set(0,0,0);for(var x=0,R=T.length;R>x;x++){var w=b[x];if(0!==w){var _=T[x].vertices;r.x+=(_[E.a].x-f.x)*w,r.y+=(_[E.a].y-f.y)*w,r.z+=(_[E.a].z-f.z)*w,i.x+=(_[E.b].x-c.x)*w,i.y+=(_[E.b].y-c.y)*w,i.z+=(_[E.b].z-c.z)*w,o.x+=(_[E.c].x-l.x)*w,o.y+=(_[E.c].y-l.y)*w,o.z+=(_[E.c].z-l.z)*w}}r.add(f),i.add(c),o.add(l),f=r,c=i,l=o}T=u.side===THREE.BackSide?e.intersectTriangle(l,c,f,!0):e.intersectTriangle(f,c,l,u.side!==THREE.DoubleSide),null!==T&&(T.applyMatrix4(this.matrixWorld),b=a.ray.origin.distanceTo(T),p>b||b<a.near||b>a.far||s.push({distance:b,point:T,face:E,faceIndex:v,object:this}))}}}(),THREE.Mesh.prototype.clone=function(t,e){return void 0===t&&(t=new THREE.Mesh(this.geometry,this.material)),THREE.Object3D.prototype.clone.call(this,t,e),t},THREE.Bone=function(t){THREE.Object3D.call(this),this.skin=t,this.accumulatedSclWeight=this.accumulatedPosWeight=this.accumulatedRotWeight=0},THREE.Bone.prototype=Object.create(THREE.Object3D.prototype),THREE.Bone.prototype.updateMatrixWorld=function(t){THREE.Object3D.prototype.updateMatrixWorld.call(this,t),this.accumulatedSclWeight=this.accumulatedPosWeight=this.accumulatedRotWeight=0},THREE.Skeleton=function(t,e,n){if(this.useVertexTexture=void 0!==n?n:!0,this.identityMatrix=new THREE.Matrix4,t=t||[],this.bones=t.slice(0),this.useVertexTexture?(this.boneTextureHeight=this.boneTextureWidth=t=256<this.bones.length?64:64<this.bones.length?32:16<this.bones.length?16:8,this.boneMatrices=new Float32Array(this.boneTextureWidth*this.boneTextureHeight*4),this.boneTexture=new THREE.DataTexture(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,THREE.RGBAFormat,THREE.FloatType),this.boneTexture.minFilter=THREE.NearestFilter,this.boneTexture.magFilter=THREE.NearestFilter,this.boneTexture.generateMipmaps=!1,this.boneTexture.flipY=!1):this.boneMatrices=new Float32Array(16*this.bones.length),void 0===e)this.calculateInverses();else if(this.bones.length===e.length)this.boneInverses=e.slice(0);else for(console.warn("THREE.Skeleton bonInverses is the wrong length."),this.boneInverses=[],e=0,t=this.bones.length;t>e;e++)this.boneInverses.push(new THREE.Matrix4)},THREE.Skeleton.prototype.calculateInverses=function(){this.boneInverses=[];for(var t=0,e=this.bones.length;e>t;t++){var n=new THREE.Matrix4;this.bones[t]&&n.getInverse(this.bones[t].matrixWorld),this.boneInverses.push(n)}},THREE.Skeleton.prototype.pose=function(){for(var t,e=0,n=this.bones.length;n>e;e++)(t=this.bones[e])&&t.matrixWorld.getInverse(this.boneInverses[e]);for(e=0,n=this.bones.length;n>e;e++)(t=this.bones[e])&&(t.parent?(t.matrix.getInverse(t.parent.matrixWorld),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))},THREE.Skeleton.prototype.update=function(){for(var t=new THREE.Matrix4,e=0,n=this.bones.length;n>e;e++)t.multiplyMatrices(this.bones[e]?this.bones[e].matrixWorld:this.identityMatrix,this.boneInverses[e]),t.flattenToArrayOffset(this.boneMatrices,16*e);this.useVertexTexture&&(this.boneTexture.needsUpdate=!0)},THREE.SkinnedMesh=function(t,e,n){if(THREE.Mesh.call(this,t,e),this.bindMode="attached",this.bindMatrix=new THREE.Matrix4,this.bindMatrixInverse=new THREE.Matrix4,t=[],this.geometry&&void 0!==this.geometry.bones){for(var r,i,o,a,s=0,h=this.geometry.bones.length;h>s;++s)r=this.geometry.bones[s],i=r.pos,o=r.rotq,a=r.scl,e=new THREE.Bone(this),t.push(e),e.name=r.name,e.position.set(i[0],i[1],i[2]),e.quaternion.set(o[0],o[1],o[2],o[3]),void 0!==a?e.scale.set(a[0],a[1],a[2]):e.scale.set(1,1,1);for(s=0,h=this.geometry.bones.length;h>s;++s)r=this.geometry.bones[s],-1!==r.parent?t[r.parent].add(t[s]):this.add(t[s])}this.normalizeSkinWeights(),this.updateMatrixWorld(!0),this.bind(new THREE.Skeleton(t,void 0,n))},THREE.SkinnedMesh.prototype=Object.create(THREE.Mesh.prototype),THREE.SkinnedMesh.prototype.bind=function(t,e){this.skeleton=t,void 0===e&&(this.updateMatrixWorld(!0),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.getInverse(e)},THREE.SkinnedMesh.prototype.pose=function(){this.skeleton.pose()},THREE.SkinnedMesh.prototype.normalizeSkinWeights=function(){if(this.geometry instanceof THREE.Geometry)for(var t=0;t<this.geometry.skinIndices.length;t++){var e=this.geometry.skinWeights[t],n=1/e.lengthManhattan();1/0!==n?e.multiplyScalar(n):e.set(1)}},THREE.SkinnedMesh.prototype.updateMatrixWorld=function(){THREE.Mesh.prototype.updateMatrixWorld.call(this,!0),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh unreckognized bindMode: "+this.bindMode)},THREE.SkinnedMesh.prototype.clone=function(t){return void 0===t&&(t=new THREE.SkinnedMesh(this.geometry,this.material,this.useVertexTexture)),THREE.Mesh.prototype.clone.call(this,t),t},THREE.MorphAnimMesh=function(t,e){THREE.Mesh.call(this,t,e),this.duration=1e3,this.mirroredLoop=!1,this.currentKeyframe=this.lastKeyframe=this.time=0,this.direction=1,this.directionBackwards=!1,this.setFrameRange(0,this.geometry.morphTargets.length-1)},THREE.MorphAnimMesh.prototype=Object.create(THREE.Mesh.prototype),THREE.MorphAnimMesh.prototype.setFrameRange=function(t,e){this.startKeyframe=t,this.endKeyframe=e,this.length=this.endKeyframe-this.startKeyframe+1},THREE.MorphAnimMesh.prototype.setDirectionForward=function(){this.direction=1,this.directionBackwards=!1},THREE.MorphAnimMesh.prototype.setDirectionBackward=function(){this.direction=-1,this.directionBackwards=!0},THREE.MorphAnimMesh.prototype.parseAnimations=function(){var t=this.geometry;t.animations||(t.animations={});for(var e,n=t.animations,r=/([a-z]+)_?(\d+)/,i=0,o=t.morphTargets.length;o>i;i++){var a=t.morphTargets[i].name.match(r);if(a&&1<a.length){a=a[1],n[a]||(n[a]={start:1/0,end:-1/0});var s=n[a];i<s.start&&(s.start=i),i>s.end&&(s.end=i),e||(e=a)}}t.firstAnimation=e},THREE.MorphAnimMesh.prototype.setAnimationLabel=function(t,e,n){this.geometry.animations||(this.geometry.animations={}),this.geometry.animations[t]={start:e,end:n}},THREE.MorphAnimMesh.prototype.playAnimation=function(t,e){var n=this.geometry.animations[t];n?(this.setFrameRange(n.start,n.end),this.duration=(n.end-n.start)/e*1e3,this.time=0):console.warn("animation["+t+"] undefined")},THREE.MorphAnimMesh.prototype.updateAnimation=function(t){var e=this.duration/this.length;this.time+=this.direction*t,this.mirroredLoop?(this.time>this.duration||0>this.time)&&(this.direction*=-1,this.time>this.duration&&(this.time=this.duration,this.directionBackwards=!0),0>this.time&&(this.time=0,this.directionBackwards=!1)):(this.time%=this.duration,0>this.time&&(this.time+=this.duration)),t=this.startKeyframe+THREE.Math.clamp(Math.floor(this.time/e),0,this.length-1),t!==this.currentKeyframe&&(this.morphTargetInfluences[this.lastKeyframe]=0,this.morphTargetInfluences[this.currentKeyframe]=1,this.morphTargetInfluences[t]=0,this.lastKeyframe=this.currentKeyframe,this.currentKeyframe=t),e=this.time%e/e,this.directionBackwards&&(e=1-e),this.morphTargetInfluences[this.currentKeyframe]=e,this.morphTargetInfluences[this.lastKeyframe]=1-e},THREE.MorphAnimMesh.prototype.interpolateTargets=function(t,e,n){for(var r=this.morphTargetInfluences,i=0,o=r.length;o>i;i++)r[i]=0;t>-1&&(r[t]=1-n),e>-1&&(r[e]=n)},THREE.MorphAnimMesh.prototype.clone=function(t){return void 0===t&&(t=new THREE.MorphAnimMesh(this.geometry,this.material)),t.duration=this.duration,t.mirroredLoop=this.mirroredLoop,t.time=this.time,t.lastKeyframe=this.lastKeyframe,t.currentKeyframe=this.currentKeyframe,t.direction=this.direction,t.directionBackwards=this.directionBackwards,THREE.Mesh.prototype.clone.call(this,t),t},THREE.LOD=function(){THREE.Object3D.call(this),this.objects=[]},THREE.LOD.prototype=Object.create(THREE.Object3D.prototype),THREE.LOD.prototype.addLevel=function(t,e){void 0===e&&(e=0),e=Math.abs(e);for(var n=0;n<this.objects.length&&!(e<this.objects[n].distance);n++);this.objects.splice(n,0,{distance:e,object:t}),this.add(t)},THREE.LOD.prototype.getObjectForDistance=function(t){for(var e=1,n=this.objects.length;n>e&&!(t<this.objects[e].distance);e++);return this.objects[e-1].object},THREE.LOD.prototype.raycast=function(){var t=new THREE.Vector3;return function(e,n){t.setFromMatrixPosition(this.matrixWorld);var r=e.ray.origin.distanceTo(t);this.getObjectForDistance(r).raycast(e,n)}}(),THREE.LOD.prototype.update=function(){var t=new THREE.Vector3,e=new THREE.Vector3;return function(n){if(1<this.objects.length){t.setFromMatrixPosition(n.matrixWorld),e.setFromMatrixPosition(this.matrixWorld),n=t.distanceTo(e),this.objects[0].object.visible=!0;for(var r=1,i=this.objects.length;i>r&&n>=this.objects[r].distance;r++)this.objects[r-1].object.visible=!1,this.objects[r].object.visible=!0;for(;i>r;r++)this.objects[r].object.visible=!1}}}(),THREE.LOD.prototype.clone=function(t){void 0===t&&(t=new THREE.LOD),THREE.Object3D.prototype.clone.call(this,t);for(var e=0,n=this.objects.length;n>e;e++){var r=this.objects[e].object.clone();r.visible=0===e,t.addLevel(r,this.objects[e].distance)}return t},THREE.Sprite=function(){var t=new Float32Array([-.5,-.5,0,.5,-.5,0,.5,.5,0]),e=new THREE.BufferGeometry;return e.addAttribute("position",new THREE.BufferAttribute(t,3)),function(t){THREE.Object3D.call(this),this.geometry=e,this.material=void 0!==t?t:new THREE.SpriteMaterial}}(),THREE.Sprite.prototype=Object.create(THREE.Object3D.prototype),THREE.Sprite.prototype.raycast=function(){var t=new THREE.Vector3;return function(e,n){t.setFromMatrixPosition(this.matrixWorld);var r=e.ray.distanceToPoint(t);r>this.scale.x||n.push({distance:r,point:this.position,face:null,object:this})}}(),THREE.Sprite.prototype.updateMatrix=function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},THREE.Sprite.prototype.clone=function(t){return void 0===t&&(t=new THREE.Sprite(this.material)),THREE.Object3D.prototype.clone.call(this,t),t},THREE.Particle=THREE.Sprite,THREE.Scene=function(){THREE.Object3D.call(this),this.overrideMaterial=this.fog=null,this.autoUpdate=!0,this.matrixAutoUpdate=!1,this.__lights=[],this.__objectsAdded=[],this.__objectsRemoved=[]},THREE.Scene.prototype=Object.create(THREE.Object3D.prototype),THREE.Scene.prototype.__addObject=function(t){if(t instanceof THREE.Light)-1===this.__lights.indexOf(t)&&this.__lights.push(t),t.target&&void 0===t.target.parent&&this.add(t.target);else if(!(t instanceof THREE.Camera||t instanceof THREE.Bone)){this.__objectsAdded.push(t);var e=this.__objectsRemoved.indexOf(t);-1!==e&&this.__objectsRemoved.splice(e,1)}for(this.dispatchEvent({type:"objectAdded",object:t}),t.dispatchEvent({type:"addedToScene",scene:this}),e=0;e<t.children.length;e++)this.__addObject(t.children[e])},THREE.Scene.prototype.__removeObject=function(t){if(t instanceof THREE.Light){var e=this.__lights.indexOf(t);if(-1!==e&&this.__lights.splice(e,1),t.shadowCascadeArray)for(e=0;e<t.shadowCascadeArray.length;e++)this.__removeObject(t.shadowCascadeArray[e])}else t instanceof THREE.Camera||(this.__objectsRemoved.push(t),e=this.__objectsAdded.indexOf(t),-1!==e&&this.__objectsAdded.splice(e,1));for(this.dispatchEvent({type:"objectRemoved",object:t}),t.dispatchEvent({type:"removedFromScene",scene:this}),e=0;e<t.children.length;e++)this.__removeObject(t.children[e])},THREE.Scene.prototype.clone=function(t){return void 0===t&&(t=new THREE.Scene),THREE.Object3D.prototype.clone.call(this,t),null!==this.fog&&(t.fog=this.fog.clone()),null!==this.overrideMaterial&&(t.overrideMaterial=this.overrideMaterial.clone()),t.autoUpdate=this.autoUpdate,t.matrixAutoUpdate=this.matrixAutoUpdate,t},THREE.Fog=function(t,e,n){this.name="",this.color=new THREE.Color(t),this.near=void 0!==e?e:1,this.far=void 0!==n?n:1e3},THREE.Fog.prototype.clone=function(){return new THREE.Fog(this.color.getHex(),this.near,this.far)},THREE.FogExp2=function(t,e){this.name="",this.color=new THREE.Color(t),this.density=void 0!==e?e:25e-5},THREE.FogExp2.prototype.clone=function(){return new THREE.FogExp2(this.color.getHex(),this.density)},THREE.CanvasRenderer=function(t){function e(t,e,n,r){u(e),c(n),l(r),f(t.getStyle()),z.stroke(),le.expandByScalar(2*e)}function n(t){p(t.getStyle()),z.fill()}function r(t){i(t.target)}function i(t){if(!(t instanceof THREE.CompressedTexture)){var e=t.wrapS===THREE.RepeatWrapping,n=t.wrapT===THREE.RepeatWrapping,r=t.image,i=document.createElement("canvas");i.width=r.width,i.height=r.height;var o=i.getContext("2d");o.setTransform(1,0,0,-1,0,r.height),o.drawImage(r,0,0),he[t.id]=z.createPattern(i,!0===e&&!0===n?"repeat":!0===e&&!1===n?"repeat-x":!1===e&&!0===n?"repeat-y":"no-repeat")}}function o(t,e,n,o,a,s,h,u,c,l,f,d,m){if(!(m instanceof THREE.DataTexture)){!1===m.hasEventListener("update",r)&&(void 0!==m.image&&0<m.image.width&&i(m),m.addEventListener("update",r));var g=he[m.id];if(void 0!==g){p(g);var g=m.offset.x/m.repeat.x,v=m.offset.y/m.repeat.y,y=m.image.width*m.repeat.x;m=m.image.height*m.repeat.y,h=(h+g)*y,u=(u+v)*m,n-=t,o-=e,a-=t,s-=e,c=(c+g)*y-h,l=(l+v)*m-u,f=(f+g)*y-h,d=(d+v)*m-u,m=c*d-f*l,0!==m&&(g=1/m,m=(d*n-l*a)*g,l=(d*o-l*s)*g,n=(c*a-f*n)*g,o=(c*s-f*o)*g,t=t-m*h-n*u,e=e-l*h-o*u,z.save(),z.transform(m,l,n,o,t,e),z.fill(),z.restore())}else p("rgba(0,0,0,1)"),z.fill()}}function a(t,e,n){var r=e.x-t.x,i=e.y-t.y,o=r*r+i*i;0!==o&&(n/=Math.sqrt(o),r*=n,i*=n,e.x+=r,e.y+=i,t.x-=r,t.y-=i)}function s(t){N!==t&&(N=z.globalAlpha=t)}function h(t){V!==t&&(t===THREE.NormalBlending?z.globalCompositeOperation="source-over":t===THREE.AdditiveBlending?z.globalCompositeOperation="lighter":t===THREE.SubtractiveBlending&&(z.globalCompositeOperation="darker"),V=t)}function u(t){U!==t&&(U=z.lineWidth=t)}function c(t){O!==t&&(O=z.lineCap=t)}function l(t){W!==t&&(W=z.lineJoin=t)}function f(t){I!==t&&(I=z.strokeStyle=t)}function p(t){B!==t&&(B=z.fillStyle=t)}function d(t){G.length!==t.length&&(z.setLineDash(t),G=t)}console.log("THREE.CanvasRenderer",THREE.REVISION);var m=THREE.Math.smoothstep;t=t||{};var g,v,y,E,x,T,b,R=this,w=new THREE.Projector,_=void 0!==t.canvas?t.canvas:document.createElement("canvas"),H=_.width,M=_.height,S=Math.floor(H/2),C=Math.floor(M/2),A=0,L=0,P=H,D=M,z=_.getContext("2d",{alpha:!0===t.alpha}),F=new THREE.Color(0),k=0,N=1,V=0,I=null,B=null,U=null,O=null,W=null,G=[];new THREE.RenderableVertex,new THREE.RenderableVertex;var j,q,X,Y,Z,K,Q=new THREE.Color;new THREE.Color,new THREE.Color,new THREE.Color,new THREE.Color;var $,J,te,ee,ne,re,ie,oe=new THREE.Color,ae=new THREE.Color,se=new THREE.Color,he={},ue=new THREE.Box2,ce=new THREE.Box2,le=new THREE.Box2,fe=new THREE.Color,pe=new THREE.Color,de=new THREE.Color,me=new THREE.Vector3,ge=new THREE.Vector3,ve=new THREE.Vector3,ye=new THREE.Matrix3;void 0===z.setLineDash&&(z.setLineDash=function(){}),this.domElement=_,this.devicePixelRatio=void 0!==t.devicePixelRatio?t.devicePixelRatio:void 0!==self.devicePixelRatio?self.devicePixelRatio:1,this.sortElements=this.sortObjects=this.autoClear=!0,this.info={render:{vertices:0,faces:0}},this.supportsVertexTextures=function(){},this.setFaceCulling=function(){},this.setSize=function(t,e,n){H=t*this.devicePixelRatio,M=e*this.devicePixelRatio,_.width=H,_.height=M,S=Math.floor(H/2),C=Math.floor(M/2),!1!==n&&(_.style.width=t+"px",_.style.height=e+"px"),ue.min.set(-S,-C),ue.max.set(S,C),ce.min.set(-S,-C),ce.max.set(S,C),N=1,V=0,W=O=U=B=I=null,this.setViewport(0,0,t,e)},this.setViewport=function(t,e,n,r){A=t*this.devicePixelRatio,L=e*this.devicePixelRatio,P=n*this.devicePixelRatio,D=r*this.devicePixelRatio},this.setScissor=function(){},this.enableScissorTest=function(){},this.setClearColor=function(t,e){F.set(t),k=void 0!==e?e:1,ce.min.set(-S,-C),ce.max.set(S,C)},this.setClearColorHex=function(t,e){console.warn("THREE.CanvasRenderer: .setClearColorHex() is being removed. Use .setClearColor() instead."),this.setClearColor(t,e)},this.getClearColor=function(){return F},this.getClearAlpha=function(){return k},this.getMaxAnisotropy=function(){return 0},this.clear=function(){!1===ce.empty()&&(ce.intersect(ue),ce.expandByScalar(2),ce.min.x+=S,ce.min.y=-ce.min.y+C,ce.max.x+=S,ce.max.y=-ce.max.y+C,1>k&&z.clearRect(0|ce.min.x,0|ce.min.y,ce.max.x-ce.min.x|0,ce.max.y-ce.min.y|0),k>0&&(h(THREE.NormalBlending),s(1),p("rgba("+Math.floor(255*F.r)+","+Math.floor(255*F.g)+","+Math.floor(255*F.b)+","+k+")"),z.fillRect(0|ce.min.x,0|ce.min.y,ce.max.x-ce.min.x|0,ce.max.y-ce.min.y|0)),ce.makeEmpty())},this.clearColor=function(){},this.clearDepth=function(){},this.clearStencil=function(){},this.render=function(t,_){if(!1==_ instanceof THREE.Camera)console.error("THREE.CanvasRenderer.render: camera is not an instance of THREE.Camera.");else{!0===this.autoClear&&this.clear(),R.info.render.vertices=0,R.info.render.faces=0,z.setTransform(P/H,0,0,-D/M,A,M-L),z.translate(S,C),g=w.projectScene(t,_,this.sortObjects,this.sortElements),v=g.elements,y=g.lights,E=_,ye.getNormalMatrix(_.matrixWorldInverse),fe.setRGB(0,0,0),pe.setRGB(0,0,0),de.setRGB(0,0,0);for(var F=0,k=y.length;k>F;F++){var N=y[F],V=N.color;N instanceof THREE.AmbientLight?fe.add(V):N instanceof THREE.DirectionalLight?pe.add(V):N instanceof THREE.PointLight&&de.add(V)}for(F=0,k=v.length;k>F;F++){var I=v[F],B=I.material;if(void 0!==B&&0!==B.opacity){if(le.makeEmpty(),I instanceof THREE.RenderableSprite){x=I,x.x*=S,x.y*=C;var N=x,U=I,V=B;s(V.opacity),h(V.blending);var O=U.scale.x*S,U=U.scale.y*C,I=.5*Math.sqrt(O*O+U*U);if(le.min.set(N.x-I,N.y-I),le.max.set(N.x+I,N.y+I),V instanceof THREE.SpriteMaterial){var W=V.map;if(null!==W&&void 0!==W.image){!1===W.hasEventListener("update",r)&&(0<W.image.width&&i(W),W.addEventListener("update",r)),I=he[W.id],p(void 0!==I?I:"rgba( 0, 0, 0, 1 )");var G=W.image,I=G.width*W.offset.x,B=G.height*W.offset.y,Ee=G.width*W.repeat.x,W=G.height*W.repeat.y,G=O/Ee,xe=U/W;z.save(),z.translate(N.x,N.y),0!==V.rotation&&z.rotate(V.rotation),z.translate(-O/2,-U/2),z.scale(G,xe),z.translate(-I,-B),z.fillRect(I,B,Ee,W)}else p(V.color.getStyle()),z.save(),z.translate(N.x,N.y),0!==V.rotation&&z.rotate(V.rotation),z.scale(O,-U),z.fillRect(-.5,-.5,1,1);z.restore()}else V instanceof THREE.SpriteCanvasMaterial&&(f(V.color.getStyle()),p(V.color.getStyle()),z.save(),z.translate(N.x,N.y),0!==V.rotation&&z.rotate(V.rotation),z.scale(O,U),V.program(z),z.restore())}else if(I instanceof THREE.RenderableLine){if(x=I.v1,T=I.v2,x.positionScreen.x*=S,x.positionScreen.y*=C,T.positionScreen.x*=S,T.positionScreen.y*=C,le.setFromPoints([x.positionScreen,T.positionScreen]),!0===ue.isIntersectionBox(le))if(N=x,V=T,O=I,U=B,s(U.opacity),h(U.blending),z.beginPath(),z.moveTo(N.positionScreen.x,N.positionScreen.y),z.lineTo(V.positionScreen.x,V.positionScreen.y),U instanceof THREE.LineBasicMaterial){if(u(U.linewidth),c(U.linecap),l(U.linejoin),U.vertexColors!==THREE.VertexColors)f(U.color.getStyle());else if(I=O.vertexColors[0].getStyle(),O=O.vertexColors[1].getStyle(),I===O)f(I);else{try{var Te=z.createLinearGradient(N.positionScreen.x,N.positionScreen.y,V.positionScreen.x,V.positionScreen.y);Te.addColorStop(0,I),Te.addColorStop(1,O)}catch(be){Te=I}f(Te)}z.stroke(),le.expandByScalar(2*U.linewidth)}else U instanceof THREE.LineDashedMaterial&&(u(U.linewidth),c(U.linecap),l(U.linejoin),f(U.color.getStyle()),d([U.dashSize,U.gapSize]),z.stroke(),le.expandByScalar(2*U.linewidth),d([]))}else if(I instanceof THREE.RenderableFace){if(x=I.v1,T=I.v2,b=I.v3,-1>x.positionScreen.z||1<x.positionScreen.z)continue;if(-1>T.positionScreen.z||1<T.positionScreen.z)continue;if(-1>b.positionScreen.z||1<b.positionScreen.z)continue;if(x.positionScreen.x*=S,x.positionScreen.y*=C,T.positionScreen.x*=S,T.positionScreen.y*=C,b.positionScreen.x*=S,b.positionScreen.y*=C,0<B.overdraw&&(a(x.positionScreen,T.positionScreen,B.overdraw),a(T.positionScreen,b.positionScreen,B.overdraw),a(b.positionScreen,x.positionScreen,B.overdraw)),le.setFromPoints([x.positionScreen,T.positionScreen,b.positionScreen]),!0===ue.isIntersectionBox(le)){V=x,O=T,U=b,N=B,R.info.render.vertices+=3,R.info.render.faces++,s(N.opacity),h(N.blending),j=V.positionScreen.x,q=V.positionScreen.y,X=O.positionScreen.x,Y=O.positionScreen.y,Z=U.positionScreen.x,K=U.positionScreen.y;var B=j,Ee=q,W=X,G=Y,xe=Z,Re=K;if(z.beginPath(),z.moveTo(B,Ee),z.lineTo(W,G),z.lineTo(xe,Re),z.closePath(),(N instanceof THREE.MeshLambertMaterial||N instanceof THREE.MeshPhongMaterial)&&null===N.map){for(oe.copy(N.color),ae.copy(N.emissive),N.vertexColors===THREE.FaceColors&&oe.multiply(I.color),Q.copy(fe),ge.copy(V.positionWorld).add(O.positionWorld).add(U.positionWorld).divideScalar(3),V=ge,O=I.normalModel,U=Q,I=0,B=y.length;B>I;I++)Ee=y[I],se.copy(Ee.color),Ee instanceof THREE.DirectionalLight?(W=me.setFromMatrixPosition(Ee.matrixWorld).normalize(),G=O.dot(W),0>=G||(G*=Ee.intensity,U.add(se.multiplyScalar(G)))):Ee instanceof THREE.PointLight&&(W=me.setFromMatrixPosition(Ee.matrixWorld),G=O.dot(me.subVectors(W,V).normalize()),0>=G||(G*=0==Ee.distance?1:1-Math.min(V.distanceTo(W)/Ee.distance,1),0!=G&&(G*=Ee.intensity,U.add(se.multiplyScalar(G)))));
Q.multiply(oe).add(ae),!0===N.wireframe?e(Q,N.wireframeLinewidth,N.wireframeLinecap,N.wireframeLinejoin):n(Q)}else N instanceof THREE.MeshBasicMaterial||N instanceof THREE.MeshLambertMaterial||N instanceof THREE.MeshPhongMaterial?null!==N.map?N.map.mapping instanceof THREE.UVMapping&&($=I.uvs,o(j,q,X,Y,Z,K,$[0].x,$[0].y,$[1].x,$[1].y,$[2].x,$[2].y,N.map)):null!==N.envMap?N.envMap.mapping instanceof THREE.SphericalReflectionMapping?(ve.copy(I.vertexNormalsModel[0]).applyMatrix3(ye),J=.5*ve.x+.5,te=.5*ve.y+.5,ve.copy(I.vertexNormalsModel[1]).applyMatrix3(ye),ee=.5*ve.x+.5,ne=.5*ve.y+.5,ve.copy(I.vertexNormalsModel[2]).applyMatrix3(ye),re=.5*ve.x+.5,ie=.5*ve.y+.5,o(j,q,X,Y,Z,K,J,te,ee,ne,re,ie,N.envMap)):N.envMap.mapping instanceof THREE.SphericalRefractionMapping&&(ve.copy(I.vertexNormalsModel[0]).applyMatrix3(ye),J=-.5*ve.x+.5,te=-.5*ve.y+.5,ve.copy(I.vertexNormalsModel[1]).applyMatrix3(ye),ee=-.5*ve.x+.5,ne=-.5*ve.y+.5,ve.copy(I.vertexNormalsModel[2]).applyMatrix3(ye),re=-.5*ve.x+.5,ie=-.5*ve.y+.5,o(j,q,X,Y,Z,K,J,te,ee,ne,re,ie,N.envMap)):(Q.copy(N.color),N.vertexColors===THREE.FaceColors&&Q.multiply(I.color),!0===N.wireframe?e(Q,N.wireframeLinewidth,N.wireframeLinecap,N.wireframeLinejoin):n(Q)):(N instanceof THREE.MeshDepthMaterial?Q.r=Q.g=Q.b=1-m(V.positionScreen.z*V.positionScreen.w,E.near,E.far):N instanceof THREE.MeshNormalMaterial?(ve.copy(I.normalModel).applyMatrix3(ye),Q.setRGB(ve.x,ve.y,ve.z).multiplyScalar(.5).addScalar(.5)):Q.setRGB(1,1,1),!0===N.wireframe?e(Q,N.wireframeLinewidth,N.wireframeLinecap,N.wireframeLinejoin):n(Q))}}ce.union(le)}}z.setTransform(1,0,0,1,0,0)}}},THREE.ShaderChunk={},THREE.ShaderChunk.alphatest_fragment="#ifdef ALPHATEST\n\n	if ( gl_FragColor.a < ALPHATEST ) discard;\n\n#endif\n",THREE.ShaderChunk.lights_lambert_vertex="vLightFront = vec3( 0.0 );\n\n#ifdef DOUBLE_SIDED\n\n	vLightBack = vec3( 0.0 );\n\n#endif\n\ntransformedNormal = normalize( transformedNormal );\n\n#if MAX_DIR_LIGHTS > 0\n\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\n\n	vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\n	vec3 dirVector = normalize( lDirection.xyz );\n\n	float dotProduct = dot( transformedNormal, dirVector );\n	vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );\n\n	#ifdef DOUBLE_SIDED\n\n		vec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n\n		#ifdef WRAP_AROUND\n\n			vec3 directionalLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n\n		#endif\n\n	#endif\n\n	#ifdef WRAP_AROUND\n\n		vec3 directionalLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\n		directionalLightWeighting = mix( directionalLightWeighting, directionalLightWeightingHalf, wrapRGB );\n\n		#ifdef DOUBLE_SIDED\n\n			directionalLightWeightingBack = mix( directionalLightWeightingBack, directionalLightWeightingHalfBack, wrapRGB );\n\n		#endif\n\n	#endif\n\n	vLightFront += directionalLightColor[ i ] * directionalLightWeighting;\n\n	#ifdef DOUBLE_SIDED\n\n		vLightBack += directionalLightColor[ i ] * directionalLightWeightingBack;\n\n	#endif\n\n}\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n	for( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n\n		vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\n		vec3 lVector = lPosition.xyz - mvPosition.xyz;\n\n		float lDistance = 1.0;\n		if ( pointLightDistance[ i ] > 0.0 )\n			lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\n\n		lVector = normalize( lVector );\n		float dotProduct = dot( transformedNormal, lVector );\n\n		vec3 pointLightWeighting = vec3( max( dotProduct, 0.0 ) );\n\n		#ifdef DOUBLE_SIDED\n\n			vec3 pointLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n\n			#ifdef WRAP_AROUND\n\n				vec3 pointLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n\n			#endif\n\n		#endif\n\n		#ifdef WRAP_AROUND\n\n			vec3 pointLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\n			pointLightWeighting = mix( pointLightWeighting, pointLightWeightingHalf, wrapRGB );\n\n			#ifdef DOUBLE_SIDED\n\n				pointLightWeightingBack = mix( pointLightWeightingBack, pointLightWeightingHalfBack, wrapRGB );\n\n			#endif\n\n		#endif\n\n		vLightFront += pointLightColor[ i ] * pointLightWeighting * lDistance;\n\n		#ifdef DOUBLE_SIDED\n\n			vLightBack += pointLightColor[ i ] * pointLightWeightingBack * lDistance;\n\n		#endif\n\n	}\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n	for( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n\n		vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\n		vec3 lVector = lPosition.xyz - mvPosition.xyz;\n\n		float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - worldPosition.xyz ) );\n\n		if ( spotEffect > spotLightAngleCos[ i ] ) {\n\n			spotEffect = max( pow( max( spotEffect, 0.0 ), spotLightExponent[ i ] ), 0.0 );\n\n			float lDistance = 1.0;\n			if ( spotLightDistance[ i ] > 0.0 )\n				lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\n\n			lVector = normalize( lVector );\n\n			float dotProduct = dot( transformedNormal, lVector );\n			vec3 spotLightWeighting = vec3( max( dotProduct, 0.0 ) );\n\n			#ifdef DOUBLE_SIDED\n\n				vec3 spotLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n\n				#ifdef WRAP_AROUND\n\n					vec3 spotLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n\n				#endif\n\n			#endif\n\n			#ifdef WRAP_AROUND\n\n				vec3 spotLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\n				spotLightWeighting = mix( spotLightWeighting, spotLightWeightingHalf, wrapRGB );\n\n				#ifdef DOUBLE_SIDED\n\n					spotLightWeightingBack = mix( spotLightWeightingBack, spotLightWeightingHalfBack, wrapRGB );\n\n				#endif\n\n			#endif\n\n			vLightFront += spotLightColor[ i ] * spotLightWeighting * lDistance * spotEffect;\n\n			#ifdef DOUBLE_SIDED\n\n				vLightBack += spotLightColor[ i ] * spotLightWeightingBack * lDistance * spotEffect;\n\n			#endif\n\n		}\n\n	}\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n	for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\n\n		vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );\n		vec3 lVector = normalize( lDirection.xyz );\n\n		float dotProduct = dot( transformedNormal, lVector );\n\n		float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\n		float hemiDiffuseWeightBack = -0.5 * dotProduct + 0.5;\n\n		vLightFront += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n\n		#ifdef DOUBLE_SIDED\n\n			vLightBack += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeightBack );\n\n		#endif\n\n	}\n\n#endif\n\nvLightFront = vLightFront * diffuse + ambient * ambientLightColor + emissive;\n\n#ifdef DOUBLE_SIDED\n\n	vLightBack = vLightBack * diffuse + ambient * ambientLightColor + emissive;\n\n#endif",THREE.ShaderChunk.map_particle_pars_fragment="#ifdef USE_MAP\n\n	uniform sampler2D map;\n\n#endif",THREE.ShaderChunk.default_vertex="vec4 mvPosition;\n\n#ifdef USE_SKINNING\n\n	mvPosition = modelViewMatrix * skinned;\n\n#endif\n\n#if !defined( USE_SKINNING ) && defined( USE_MORPHTARGETS )\n\n	mvPosition = modelViewMatrix * vec4( morphed, 1.0 );\n\n#endif\n\n#if !defined( USE_SKINNING ) && ! defined( USE_MORPHTARGETS )\n\n	mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\n#endif\n\ngl_Position = projectionMatrix * mvPosition;",THREE.ShaderChunk.map_pars_fragment="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )\n\n	varying vec2 vUv;\n\n#endif\n\n#ifdef USE_MAP\n\n	uniform sampler2D map;\n\n#endif",THREE.ShaderChunk.skinnormal_vertex="#ifdef USE_SKINNING\n\n	mat4 skinMatrix = mat4( 0.0 );\n	skinMatrix += skinWeight.x * boneMatX;\n	skinMatrix += skinWeight.y * boneMatY;\n	skinMatrix += skinWeight.z * boneMatZ;\n	skinMatrix += skinWeight.w * boneMatW;\n	skinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\n	#ifdef USE_MORPHNORMALS\n\n	vec4 skinnedNormal = skinMatrix * vec4( morphedNormal, 0.0 );\n\n	#else\n\n	vec4 skinnedNormal = skinMatrix * vec4( normal, 0.0 );\n\n	#endif\n\n#endif\n",THREE.ShaderChunk.logdepthbuf_pars_vertex="#ifdef USE_LOGDEPTHBUF\n\n	#ifdef USE_LOGDEPTHBUF_EXT\n\n		varying float vFragDepth;\n\n	#endif\n\n	uniform float logDepthBufFC;\n\n#endif",THREE.ShaderChunk.lightmap_pars_vertex="#ifdef USE_LIGHTMAP\n\n	varying vec2 vUv2;\n\n#endif",THREE.ShaderChunk.lights_phong_fragment="vec3 normal = normalize( vNormal );\nvec3 viewPosition = normalize( vViewPosition );\n\n#ifdef DOUBLE_SIDED\n\n	normal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n\n#endif\n\n#ifdef USE_NORMALMAP\n\n	normal = perturbNormal2Arb( -vViewPosition, normal );\n\n#elif defined( USE_BUMPMAP )\n\n	normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n	vec3 pointDiffuse = vec3( 0.0 );\n	vec3 pointSpecular = vec3( 0.0 );\n\n	for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n\n		vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\n		vec3 lVector = lPosition.xyz + vViewPosition.xyz;\n\n		float lDistance = 1.0;\n		if ( pointLightDistance[ i ] > 0.0 )\n			lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\n\n		lVector = normalize( lVector );\n\n				// diffuse\n\n		float dotProduct = dot( normal, lVector );\n\n		#ifdef WRAP_AROUND\n\n			float pointDiffuseWeightFull = max( dotProduct, 0.0 );\n			float pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n\n			vec3 pointDiffuseWeight = mix( vec3( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );\n\n		#else\n\n			float pointDiffuseWeight = max( dotProduct, 0.0 );\n\n		#endif\n\n		pointDiffuse += diffuse * pointLightColor[ i ] * pointDiffuseWeight * lDistance;\n\n				// specular\n\n		vec3 pointHalfVector = normalize( lVector + viewPosition );\n		float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\n		float pointSpecularWeight = specularStrength * max( pow( pointDotNormalHalf, shininess ), 0.0 );\n\n		float specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n		vec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, pointHalfVector ), 0.0 ), 5.0 );\n		pointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance * specularNormalization;\n\n	}\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n	vec3 spotDiffuse = vec3( 0.0 );\n	vec3 spotSpecular = vec3( 0.0 );\n\n	for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n\n		vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\n		vec3 lVector = lPosition.xyz + vViewPosition.xyz;\n\n		float lDistance = 1.0;\n		if ( spotLightDistance[ i ] > 0.0 )\n			lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\n\n		lVector = normalize( lVector );\n\n		float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );\n\n		if ( spotEffect > spotLightAngleCos[ i ] ) {\n\n			spotEffect = max( pow( max( spotEffect, 0.0 ), spotLightExponent[ i ] ), 0.0 );\n\n					// diffuse\n\n			float dotProduct = dot( normal, lVector );\n\n			#ifdef WRAP_AROUND\n\n				float spotDiffuseWeightFull = max( dotProduct, 0.0 );\n				float spotDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n\n				vec3 spotDiffuseWeight = mix( vec3( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );\n\n			#else\n\n				float spotDiffuseWeight = max( dotProduct, 0.0 );\n\n			#endif\n\n			spotDiffuse += diffuse * spotLightColor[ i ] * spotDiffuseWeight * lDistance * spotEffect;\n\n					// specular\n\n			vec3 spotHalfVector = normalize( lVector + viewPosition );\n			float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );\n			float spotSpecularWeight = specularStrength * max( pow( spotDotNormalHalf, shininess ), 0.0 );\n\n			float specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n			vec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, spotHalfVector ), 0.0 ), 5.0 );\n			spotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * specularNormalization * spotEffect;\n\n		}\n\n	}\n\n#endif\n\n#if MAX_DIR_LIGHTS > 0\n\n	vec3 dirDiffuse = vec3( 0.0 );\n	vec3 dirSpecular = vec3( 0.0 );\n\n	for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\n\n		vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\n		vec3 dirVector = normalize( lDirection.xyz );\n\n				// diffuse\n\n		float dotProduct = dot( normal, dirVector );\n\n		#ifdef WRAP_AROUND\n\n			float dirDiffuseWeightFull = max( dotProduct, 0.0 );\n			float dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n\n			vec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );\n\n		#else\n\n			float dirDiffuseWeight = max( dotProduct, 0.0 );\n\n		#endif\n\n		dirDiffuse += diffuse * directionalLightColor[ i ] * dirDiffuseWeight;\n\n		// specular\n\n		vec3 dirHalfVector = normalize( dirVector + viewPosition );\n		float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\n		float dirSpecularWeight = specularStrength * max( pow( dirDotNormalHalf, shininess ), 0.0 );\n\n		/*\n		// fresnel term from skin shader\n		const float F0 = 0.128;\n\n		float base = 1.0 - dot( viewPosition, dirHalfVector );\n		float exponential = pow( base, 5.0 );\n\n		float fresnel = exponential + F0 * ( 1.0 - exponential );\n		*/\n\n		/*\n		// fresnel term from fresnel shader\n		const float mFresnelBias = 0.08;\n		const float mFresnelScale = 0.3;\n		const float mFresnelPower = 5.0;\n\n		float fresnel = mFresnelBias + mFresnelScale * pow( 1.0 + dot( normalize( -viewPosition ), normal ), mFresnelPower );\n		*/\n\n		float specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n		// 		dirSpecular += specular * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization * fresnel;\n\n		vec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( dirVector, dirHalfVector ), 0.0 ), 5.0 );\n		dirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\n\n\n	}\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n	vec3 hemiDiffuse = vec3( 0.0 );\n	vec3 hemiSpecular = vec3( 0.0 );\n\n	for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\n\n		vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );\n		vec3 lVector = normalize( lDirection.xyz );\n\n		// diffuse\n\n		float dotProduct = dot( normal, lVector );\n		float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\n\n		vec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n\n		hemiDiffuse += diffuse * hemiColor;\n\n		// specular (sky light)\n\n		vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );\n		float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;\n		float hemiSpecularWeightSky = specularStrength * max( pow( max( hemiDotNormalHalfSky, 0.0 ), shininess ), 0.0 );\n\n		// specular (ground light)\n\n		vec3 lVectorGround = -lVector;\n\n		vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );\n		float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;\n		float hemiSpecularWeightGround = specularStrength * max( pow( max( hemiDotNormalHalfGround, 0.0 ), shininess ), 0.0 );\n\n		float dotProductGround = dot( normal, lVectorGround );\n\n		float specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n		vec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, hemiHalfVectorSky ), 0.0 ), 5.0 );\n		vec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 0.0 ), 5.0 );\n		hemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );\n\n	}\n\n#endif\n\nvec3 totalDiffuse = vec3( 0.0 );\nvec3 totalSpecular = vec3( 0.0 );\n\n#if MAX_DIR_LIGHTS > 0\n\n	totalDiffuse += dirDiffuse;\n	totalSpecular += dirSpecular;\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n	totalDiffuse += hemiDiffuse;\n	totalSpecular += hemiSpecular;\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n	totalDiffuse += pointDiffuse;\n	totalSpecular += pointSpecular;\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n	totalDiffuse += spotDiffuse;\n	totalSpecular += spotSpecular;\n\n#endif\n\n#ifdef METAL\n\n	gl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient + totalSpecular );\n\n#else\n\n	gl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient ) + totalSpecular;\n\n#endif",THREE.ShaderChunk.fog_pars_fragment="#ifdef USE_FOG\n\n	uniform vec3 fogColor;\n\n	#ifdef FOG_EXP2\n\n		uniform float fogDensity;\n\n	#else\n\n		uniform float fogNear;\n		uniform float fogFar;\n	#endif\n\n#endif",THREE.ShaderChunk.morphnormal_vertex="#ifdef USE_MORPHNORMALS\n\n	vec3 morphedNormal = vec3( 0.0 );\n\n	morphedNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n	morphedNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n	morphedNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n	morphedNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n\n	morphedNormal += normal;\n\n#endif",THREE.ShaderChunk.envmap_pars_fragment="#ifdef USE_ENVMAP\n\n	uniform float reflectivity;\n	uniform samplerCube envMap;\n	uniform float flipEnvMap;\n	uniform int combine;\n\n	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\n		uniform bool useRefract;\n		uniform float refractionRatio;\n\n	#else\n\n		varying vec3 vReflect;\n\n	#endif\n\n#endif",THREE.ShaderChunk.logdepthbuf_fragment="#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\n\n	gl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n\n#endif",THREE.ShaderChunk.normalmap_pars_fragment="#ifdef USE_NORMALMAP\n\n	uniform sampler2D normalMap;\n	uniform vec2 normalScale;\n\n			// Per-Pixel Tangent Space Normal Mapping\n			// http://hacksoflife.blogspot.ch/2009/11/per-pixel-tangent-space-normal-mapping.html\n\n	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\n		vec3 q0 = dFdx( eye_pos.xyz );\n		vec3 q1 = dFdy( eye_pos.xyz );\n		vec2 st0 = dFdx( vUv.st );\n		vec2 st1 = dFdy( vUv.st );\n\n		vec3 S = normalize( q0 * st1.t - q1 * st0.t );\n		vec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n		vec3 N = normalize( surf_norm );\n\n		vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n		mapN.xy = normalScale * mapN.xy;\n		mat3 tsn = mat3( S, T, N );\n		return normalize( tsn * mapN );\n\n	}\n\n#endif\n",THREE.ShaderChunk.lights_phong_pars_vertex="#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\n\n	varying vec3 vWorldPosition;\n\n#endif\n",THREE.ShaderChunk.lightmap_pars_fragment="#ifdef USE_LIGHTMAP\n\n	varying vec2 vUv2;\n	uniform sampler2D lightMap;\n\n#endif",THREE.ShaderChunk.shadowmap_vertex="#ifdef USE_SHADOWMAP\n\n	for( int i = 0; i < MAX_SHADOWS; i ++ ) {\n\n		vShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;\n\n	}\n\n#endif",THREE.ShaderChunk.lights_phong_vertex="#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\n\n	vWorldPosition = worldPosition.xyz;\n\n#endif",THREE.ShaderChunk.map_fragment="#ifdef USE_MAP\n\n	vec4 texelColor = texture2D( map, vUv );\n\n	#ifdef GAMMA_INPUT\n\n		texelColor.xyz *= texelColor.xyz;\n\n	#endif\n\n	gl_FragColor = gl_FragColor * texelColor;\n\n#endif",THREE.ShaderChunk.lightmap_vertex="#ifdef USE_LIGHTMAP\n\n	vUv2 = uv2;\n\n#endif",THREE.ShaderChunk.map_particle_fragment="#ifdef USE_MAP\n\n	gl_FragColor = gl_FragColor * texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) );\n\n#endif",THREE.ShaderChunk.color_pars_fragment="#ifdef USE_COLOR\n\n	varying vec3 vColor;\n\n#endif\n",THREE.ShaderChunk.color_vertex="#ifdef USE_COLOR\n\n	#ifdef GAMMA_INPUT\n\n		vColor = color * color;\n\n	#else\n\n		vColor = color;\n\n	#endif\n\n#endif",THREE.ShaderChunk.skinning_vertex="#ifdef USE_SKINNING\n\n	#ifdef USE_MORPHTARGETS\n\n	vec4 skinVertex = bindMatrix * vec4( morphed, 1.0 );\n\n	#else\n\n	vec4 skinVertex = bindMatrix * vec4( position, 1.0 );\n\n	#endif\n\n	vec4 skinned = vec4( 0.0 );\n	skinned += boneMatX * skinVertex * skinWeight.x;\n	skinned += boneMatY * skinVertex * skinWeight.y;\n	skinned += boneMatZ * skinVertex * skinWeight.z;\n	skinned += boneMatW * skinVertex * skinWeight.w;\n	skinned  = bindMatrixInverse * skinned;\n\n#endif\n",THREE.ShaderChunk.envmap_pars_vertex="#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )\n\n	varying vec3 vReflect;\n\n	uniform float refractionRatio;\n	uniform bool useRefract;\n\n#endif\n",THREE.ShaderChunk.linear_to_gamma_fragment="#ifdef GAMMA_OUTPUT\n\n	gl_FragColor.xyz = sqrt( gl_FragColor.xyz );\n\n#endif",THREE.ShaderChunk.color_pars_vertex="#ifdef USE_COLOR\n\n	varying vec3 vColor;\n\n#endif",THREE.ShaderChunk.lights_lambert_pars_vertex="uniform vec3 ambient;\nuniform vec3 diffuse;\nuniform vec3 emissive;\n\nuniform vec3 ambientLightColor;\n\n#if MAX_DIR_LIGHTS > 0\n\n	uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\n	uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n	uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\n	uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\n	uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n	uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n	uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\n	uniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n	uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\n	uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\n	uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n\n#endif\n\n#ifdef WRAP_AROUND\n\n	uniform vec3 wrapRGB;\n\n#endif\n",THREE.ShaderChunk.map_pars_vertex="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )\n\n	varying vec2 vUv;\n	uniform vec4 offsetRepeat;\n\n#endif\n",THREE.ShaderChunk.envmap_fragment="#ifdef USE_ENVMAP\n\n	vec3 reflectVec;\n\n	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\n		vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\n		// http://en.wikibooks.org/wiki/GLSL_Programming/Applying_Matrix_Transformations\n		// Transforming Normal Vectors with the Inverse Transformation\n\n		vec3 worldNormal = normalize( vec3( vec4( normal, 0.0 ) * viewMatrix ) );\n\n		if ( useRefract ) {\n\n			reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\n		} else { \n\n			reflectVec = reflect( cameraToVertex, worldNormal );\n\n		}\n\n	#else\n\n		reflectVec = vReflect;\n\n	#endif\n\n	#ifdef DOUBLE_SIDED\n\n		float flipNormal = ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n		vec4 cubeColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\n	#else\n\n		vec4 cubeColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\n	#endif\n\n	#ifdef GAMMA_INPUT\n\n		cubeColor.xyz *= cubeColor.xyz;\n\n	#endif\n\n	if ( combine == 1 ) {\n\n		gl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularStrength * reflectivity );\n\n	} else if ( combine == 2 ) {\n\n		gl_FragColor.xyz += cubeColor.xyz * specularStrength * reflectivity;\n\n	} else {\n\n		gl_FragColor.xyz = mix( gl_FragColor.xyz, gl_FragColor.xyz * cubeColor.xyz, specularStrength * reflectivity );\n\n	}\n\n#endif",THREE.ShaderChunk.specularmap_pars_fragment="#ifdef USE_SPECULARMAP\n\n	uniform sampler2D specularMap;\n\n#endif",THREE.ShaderChunk.logdepthbuf_vertex="#ifdef USE_LOGDEPTHBUF\n\n	gl_Position.z = log2(max(1e-6, gl_Position.w + 1.0)) * logDepthBufFC;\n\n	#ifdef USE_LOGDEPTHBUF_EXT\n\n		vFragDepth = 1.0 + gl_Position.w;\n\n#else\n\n		gl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\n\n	#endif\n\n#endif",THREE.ShaderChunk.morphtarget_pars_vertex="#ifdef USE_MORPHTARGETS\n\n	#ifndef USE_MORPHNORMALS\n\n	uniform float morphTargetInfluences[ 8 ];\n\n	#else\n\n	uniform float morphTargetInfluences[ 4 ];\n\n	#endif\n\n#endif",THREE.ShaderChunk.specularmap_fragment="float specularStrength;\n\n#ifdef USE_SPECULARMAP\n\n	vec4 texelSpecular = texture2D( specularMap, vUv );\n	specularStrength = texelSpecular.r;\n\n#else\n\n	specularStrength = 1.0;\n\n#endif",THREE.ShaderChunk.fog_fragment="#ifdef USE_FOG\n\n	#ifdef USE_LOGDEPTHBUF_EXT\n\n		float depth = gl_FragDepthEXT / gl_FragCoord.w;\n\n	#else\n\n		float depth = gl_FragCoord.z / gl_FragCoord.w;\n\n	#endif\n\n	#ifdef FOG_EXP2\n\n		const float LOG2 = 1.442695;\n		float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\n		fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n\n	#else\n\n		float fogFactor = smoothstep( fogNear, fogFar, depth );\n\n	#endif\n	\n	gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n\n#endif",THREE.ShaderChunk.bumpmap_pars_fragment="#ifdef USE_BUMPMAP\n\n	uniform sampler2D bumpMap;\n	uniform float bumpScale;\n\n			// Derivative maps - bump mapping unparametrized surfaces by Morten Mikkelsen\n			//	http://mmikkelsen3d.blogspot.sk/2011/07/derivative-maps.html\n\n			// Evaluate the derivative of the height w.r.t. screen-space using forward differencing (listing 2)\n\n	vec2 dHdxy_fwd() {\n\n		vec2 dSTdx = dFdx( vUv );\n		vec2 dSTdy = dFdy( vUv );\n\n		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\n		return vec2( dBx, dBy );\n\n	}\n\n	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\n		vec3 vSigmaX = dFdx( surf_pos );\n		vec3 vSigmaY = dFdy( surf_pos );\n		vec3 vN = surf_norm;		// normalized\n\n		vec3 R1 = cross( vSigmaY, vN );\n		vec3 R2 = cross( vN, vSigmaX );\n\n		float fDet = dot( vSigmaX, R1 );\n\n		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n		return normalize( abs( fDet ) * surf_norm - vGrad );\n\n	}\n\n#endif",THREE.ShaderChunk.defaultnormal_vertex="vec3 objectNormal;\n\n#ifdef USE_SKINNING\n\n	objectNormal = skinnedNormal.xyz;\n\n#endif\n\n#if !defined( USE_SKINNING ) && defined( USE_MORPHNORMALS )\n\n	objectNormal = morphedNormal;\n\n#endif\n\n#if !defined( USE_SKINNING ) && ! defined( USE_MORPHNORMALS )\n\n	objectNormal = normal;\n\n#endif\n\n#ifdef FLIP_SIDED\n\n	objectNormal = -objectNormal;\n\n#endif\n\nvec3 transformedNormal = normalMatrix * objectNormal;",THREE.ShaderChunk.lights_phong_pars_fragment="uniform vec3 ambientLightColor;\n\n#if MAX_DIR_LIGHTS > 0\n\n	uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\n	uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n	uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\n	uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\n	uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n	uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n\n	uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\n	uniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n	uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\n	uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\n	uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n\n	uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\n\n	varying vec3 vWorldPosition;\n\n#endif\n\n#ifdef WRAP_AROUND\n\n	uniform vec3 wrapRGB;\n\n#endif\n\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;",THREE.ShaderChunk.skinbase_vertex="#ifdef USE_SKINNING\n\n	mat4 boneMatX = getBoneMatrix( skinIndex.x );\n	mat4 boneMatY = getBoneMatrix( skinIndex.y );\n	mat4 boneMatZ = getBoneMatrix( skinIndex.z );\n	mat4 boneMatW = getBoneMatrix( skinIndex.w );\n\n#endif",THREE.ShaderChunk.map_vertex="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )\n\n	vUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n\n#endif",THREE.ShaderChunk.lightmap_fragment="#ifdef USE_LIGHTMAP\n\n	gl_FragColor = gl_FragColor * texture2D( lightMap, vUv2 );\n\n#endif",THREE.ShaderChunk.shadowmap_pars_vertex="#ifdef USE_SHADOWMAP\n\n	varying vec4 vShadowCoord[ MAX_SHADOWS ];\n	uniform mat4 shadowMatrix[ MAX_SHADOWS ];\n\n#endif",THREE.ShaderChunk.color_fragment="#ifdef USE_COLOR\n\n	gl_FragColor = gl_FragColor * vec4( vColor, 1.0 );\n\n#endif",THREE.ShaderChunk.morphtarget_vertex="#ifdef USE_MORPHTARGETS\n\n	vec3 morphed = vec3( 0.0 );\n	morphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n	morphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n	morphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n	morphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\n	#ifndef USE_MORPHNORMALS\n\n	morphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n	morphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n	morphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n	morphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\n	#endif\n\n	morphed += position;\n\n#endif",THREE.ShaderChunk.envmap_vertex="#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )\n\n	vec3 worldNormal = mat3( modelMatrix[ 0 ].xyz, modelMatrix[ 1 ].xyz, modelMatrix[ 2 ].xyz ) * objectNormal;\n	worldNormal = normalize( worldNormal );\n\n	vec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\n	if ( useRefract ) {\n\n		vReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\n	} else {\n\n		vReflect = reflect( cameraToVertex, worldNormal );\n\n	}\n\n#endif",THREE.ShaderChunk.shadowmap_fragment="#ifdef USE_SHADOWMAP\n\n	#ifdef SHADOWMAP_DEBUG\n\n		vec3 frustumColors[3];\n		frustumColors[0] = vec3( 1.0, 0.5, 0.0 );\n		frustumColors[1] = vec3( 0.0, 1.0, 0.8 );\n		frustumColors[2] = vec3( 0.0, 0.5, 1.0 );\n\n	#endif\n\n	#ifdef SHADOWMAP_CASCADE\n\n		int inFrustumCount = 0;\n\n	#endif\n\n	float fDepth;\n	vec3 shadowColor = vec3( 1.0 );\n\n	for( int i = 0; i < MAX_SHADOWS; i ++ ) {\n\n		vec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;\n\n				// if ( something && something ) breaks ATI OpenGL shader compiler\n				// if ( all( something, something ) ) using this instead\n\n		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n		bool inFrustum = all( inFrustumVec );\n\n				// don't shadow pixels outside of light frustum\n				// use just first frustum (for cascades)\n				// don't shadow pixels behind far plane of light frustum\n\n		#ifdef SHADOWMAP_CASCADE\n\n			inFrustumCount += int( inFrustum );\n			bvec3 frustumTestVec = bvec3( inFrustum, inFrustumCount == 1, shadowCoord.z <= 1.0 );\n\n		#else\n\n			bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\n		#endif\n\n		bool frustumTest = all( frustumTestVec );\n\n		if ( frustumTest ) {\n\n			shadowCoord.z += shadowBias[ i ];\n\n			#if defined( SHADOWMAP_TYPE_PCF )\n\n						// Percentage-close filtering\n						// (9 pixel kernel)\n						// http://fabiensanglard.net/shadowmappingPCF/\n\n				float shadow = 0.0;\n\n		/*\n						// nested loops breaks shader compiler / validator on some ATI cards when using OpenGL\n						// must enroll loop manually\n\n				for ( float y = -1.25; y <= 1.25; y += 1.25 )\n					for ( float x = -1.25; x <= 1.25; x += 1.25 ) {\n\n						vec4 rgbaDepth = texture2D( shadowMap[ i ], vec2( x * xPixelOffset, y * yPixelOffset ) + shadowCoord.xy );\n\n								// doesn't seem to produce any noticeable visual difference compared to simple texture2D lookup\n								//vec4 rgbaDepth = texture2DProj( shadowMap[ i ], vec4( vShadowCoord[ i ].w * ( vec2( x * xPixelOffset, y * yPixelOffset ) + shadowCoord.xy ), 0.05, vShadowCoord[ i ].w ) );\n\n						float fDepth = unpackDepth( rgbaDepth );\n\n						if ( fDepth < shadowCoord.z )\n							shadow += 1.0;\n\n				}\n\n				shadow /= 9.0;\n\n		*/\n\n				const float shadowDelta = 1.0 / 9.0;\n\n				float xPixelOffset = 1.0 / shadowMapSize[ i ].x;\n				float yPixelOffset = 1.0 / shadowMapSize[ i ].y;\n\n				float dx0 = -1.25 * xPixelOffset;\n				float dy0 = -1.25 * yPixelOffset;\n				float dx1 = 1.25 * xPixelOffset;\n				float dy1 = 1.25 * yPixelOffset;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				shadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\n\n			#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\n						// Percentage-close filtering\n						// (9 pixel kernel)\n						// http://fabiensanglard.net/shadowmappingPCF/\n\n				float shadow = 0.0;\n\n				float xPixelOffset = 1.0 / shadowMapSize[ i ].x;\n				float yPixelOffset = 1.0 / shadowMapSize[ i ].y;\n\n				float dx0 = -1.0 * xPixelOffset;\n				float dy0 = -1.0 * yPixelOffset;\n				float dx1 = 1.0 * xPixelOffset;\n				float dy1 = 1.0 * yPixelOffset;\n\n				mat3 shadowKernel;\n				mat3 depthKernel;\n\n				depthKernel[0][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\n				depthKernel[0][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\n				depthKernel[0][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\n				depthKernel[1][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\n				depthKernel[1][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\n				depthKernel[1][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\n				depthKernel[2][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\n				depthKernel[2][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\n				depthKernel[2][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\n\n				vec3 shadowZ = vec3( shadowCoord.z );\n				shadowKernel[0] = vec3(lessThan(depthKernel[0], shadowZ ));\n				shadowKernel[0] *= vec3(0.25);\n\n				shadowKernel[1] = vec3(lessThan(depthKernel[1], shadowZ ));\n				shadowKernel[1] *= vec3(0.25);\n\n				shadowKernel[2] = vec3(lessThan(depthKernel[2], shadowZ ));\n				shadowKernel[2] *= vec3(0.25);\n\n				vec2 fractionalCoord = 1.0 - fract( shadowCoord.xy * shadowMapSize[i].xy );\n\n				shadowKernel[0] = mix( shadowKernel[1], shadowKernel[0], fractionalCoord.x );\n				shadowKernel[1] = mix( shadowKernel[2], shadowKernel[1], fractionalCoord.x );\n\n				vec4 shadowValues;\n				shadowValues.x = mix( shadowKernel[0][1], shadowKernel[0][0], fractionalCoord.y );\n				shadowValues.y = mix( shadowKernel[0][2], shadowKernel[0][1], fractionalCoord.y );\n				shadowValues.z = mix( shadowKernel[1][1], shadowKernel[1][0], fractionalCoord.y );\n				shadowValues.w = mix( shadowKernel[1][2], shadowKernel[1][1], fractionalCoord.y );\n\n				shadow = dot( shadowValues, vec4( 1.0 ) );\n\n				shadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\n\n			#else\n\n				vec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );\n				float fDepth = unpackDepth( rgbaDepth );\n\n				if ( fDepth < shadowCoord.z )\n\n		// spot with multiple shadows is darker\n\n					shadowColor = shadowColor * vec3( 1.0 - shadowDarkness[ i ] );\n\n		// spot with multiple shadows has the same color as single shadow spot\n\n		// 					shadowColor = min( shadowColor, vec3( shadowDarkness[ i ] ) );\n\n			#endif\n\n		}\n\n\n		#ifdef SHADOWMAP_DEBUG\n\n			#ifdef SHADOWMAP_CASCADE\n\n				if ( inFrustum && inFrustumCount == 1 ) gl_FragColor.xyz *= frustumColors[ i ];\n\n			#else\n\n				if ( inFrustum ) gl_FragColor.xyz *= frustumColors[ i ];\n\n			#endif\n\n		#endif\n\n	}\n\n	#ifdef GAMMA_OUTPUT\n\n		shadowColor *= shadowColor;\n\n	#endif\n\n	gl_FragColor.xyz = gl_FragColor.xyz * shadowColor;\n\n#endif\n",THREE.ShaderChunk.worldpos_vertex="#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )\n\n	#ifdef USE_SKINNING\n\n		vec4 worldPosition = modelMatrix * skinned;\n\n	#endif\n\n	#if defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )\n\n		vec4 worldPosition = modelMatrix * vec4( morphed, 1.0 );\n\n	#endif\n\n	#if ! defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )\n\n		vec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n\n	#endif\n\n#endif",THREE.ShaderChunk.shadowmap_pars_fragment="#ifdef USE_SHADOWMAP\n\n	uniform sampler2D shadowMap[ MAX_SHADOWS ];\n	uniform vec2 shadowMapSize[ MAX_SHADOWS ];\n\n	uniform float shadowDarkness[ MAX_SHADOWS ];\n	uniform float shadowBias[ MAX_SHADOWS ];\n\n	varying vec4 vShadowCoord[ MAX_SHADOWS ];\n\n	float unpackDepth( const in vec4 rgba_depth ) {\n\n		const vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\n		float depth = dot( rgba_depth, bit_shift );\n		return depth;\n\n	}\n\n#endif",THREE.ShaderChunk.skinning_pars_vertex="#ifdef USE_SKINNING\n\n	uniform mat4 bindMatrix;\n	uniform mat4 bindMatrixInverse;\n\n	#ifdef BONE_TEXTURE\n\n		uniform sampler2D boneTexture;\n		uniform int boneTextureWidth;\n		uniform int boneTextureHeight;\n\n		mat4 getBoneMatrix( const in float i ) {\n\n			float j = i * 4.0;\n			float x = mod( j, float( boneTextureWidth ) );\n			float y = floor( j / float( boneTextureWidth ) );\n\n			float dx = 1.0 / float( boneTextureWidth );\n			float dy = 1.0 / float( boneTextureHeight );\n\n			y = dy * ( y + 0.5 );\n\n			vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n			vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n			vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n			vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\n			mat4 bone = mat4( v1, v2, v3, v4 );\n\n			return bone;\n\n		}\n\n	#else\n\n		uniform mat4 boneGlobalMatrices[ MAX_BONES ];\n\n		mat4 getBoneMatrix( const in float i ) {\n\n			mat4 bone = boneGlobalMatrices[ int(i) ];\n			return bone;\n\n		}\n\n	#endif\n\n#endif\n",THREE.ShaderChunk.logdepthbuf_pars_fragment="#ifdef USE_LOGDEPTHBUF\n\n	uniform float logDepthBufFC;\n\n	#ifdef USE_LOGDEPTHBUF_EXT\n\n		#extension GL_EXT_frag_depth : enable\n		varying float vFragDepth;\n\n	#endif\n\n#endif",THREE.ShaderChunk.alphamap_fragment="#ifdef USE_ALPHAMAP\n\n	gl_FragColor.a *= texture2D( alphaMap, vUv ).g;\n\n#endif\n",THREE.ShaderChunk.alphamap_pars_fragment="#ifdef USE_ALPHAMAP\n\n	uniform sampler2D alphaMap;\n\n#endif\n",THREE.UniformsUtils={merge:function(t){var e,n,r,i={};
for(e=0;e<t.length;e++)for(n in r=this.clone(t[e]))i[n]=r[n];return i},clone:function(t){var e,n,r,i={};for(e in t)for(n in i[e]={},t[e])r=t[e][n],i[e][n]=r instanceof THREE.Color||r instanceof THREE.Vector2||r instanceof THREE.Vector3||r instanceof THREE.Vector4||r instanceof THREE.Matrix4||r instanceof THREE.Texture?r.clone():r instanceof Array?r.slice():r;return i}},THREE.UniformsLib={common:{diffuse:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new THREE.Vector4(0,0,1,1)},lightMap:{type:"t",value:null},specularMap:{type:"t",value:null},alphaMap:{type:"t",value:null},envMap:{type:"t",value:null},flipEnvMap:{type:"f",value:-1},useRefract:{type:"i",value:0},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:.98},combine:{type:"i",value:0},morphTargetInfluences:{type:"f",value:0}},bump:{bumpMap:{type:"t",value:null},bumpScale:{type:"f",value:1}},normalmap:{normalMap:{type:"t",value:null},normalScale:{type:"v2",value:new THREE.Vector2(1,1)}},fog:{fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new THREE.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},hemisphereLightDirection:{type:"fv",value:[]},hemisphereLightSkyColor:{type:"fv",value:[]},hemisphereLightGroundColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]},spotLightColor:{type:"fv",value:[]},spotLightPosition:{type:"fv",value:[]},spotLightDirection:{type:"fv",value:[]},spotLightDistance:{type:"fv1",value:[]},spotLightAngleCos:{type:"fv1",value:[]},spotLightExponent:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:null},fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new THREE.Color(16777215)}},shadowmap:{shadowMap:{type:"tv",value:[]},shadowMapSize:{type:"v2v",value:[]},shadowBias:{type:"fv1",value:[]},shadowDarkness:{type:"fv1",value:[]},shadowMatrix:{type:"m4v",value:[]}}},THREE.ShaderLib={basic:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,THREE.UniformsLib.shadowmap]),vertexShader:[THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.skinbase_vertex,"	#ifdef USE_ENVMAP",THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,"	#endif",THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.logdepthbuf_vertex,THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.alphamap_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.specularmap_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {\n	gl_FragColor = vec4( diffuse, opacity );",THREE.ShaderChunk.logdepthbuf_fragment,THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.alphamap_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.specularmap_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},lambert:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{ambient:{type:"c",value:new THREE.Color(16777215)},emissive:{type:"c",value:new THREE.Color(0)},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}}]),vertexShader:["#define LAMBERT\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n	varying vec3 vLightBack;\n#endif",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_lambert_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.logdepthbuf_vertex,THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.lights_lambert_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n	varying vec3 vLightBack;\n#endif",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.alphamap_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.specularmap_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {\n	gl_FragColor = vec4( vec3( 1.0 ), opacity );",THREE.ShaderChunk.logdepthbuf_fragment,THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.alphamap_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.specularmap_fragment,"	#ifdef DOUBLE_SIDED\n		if ( gl_FrontFacing )\n			gl_FragColor.xyz *= vLightFront;\n		else\n			gl_FragColor.xyz *= vLightBack;\n	#else\n		gl_FragColor.xyz *= vLightFront;\n	#endif",THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},phong:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.bump,THREE.UniformsLib.normalmap,THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{ambient:{type:"c",value:new THREE.Color(16777215)},emissive:{type:"c",value:new THREE.Color(0)},specular:{type:"c",value:new THREE.Color(1118481)},shininess:{type:"f",value:30},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}}]),vertexShader:["#define PHONG\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_phong_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,"	vNormal = normalize( transformedNormal );",THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.logdepthbuf_vertex,"	vViewPosition = -mvPosition.xyz;",THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.lights_phong_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;\nuniform vec3 ambient;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.alphamap_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.lights_phong_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.bumpmap_pars_fragment,THREE.ShaderChunk.normalmap_pars_fragment,THREE.ShaderChunk.specularmap_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {\n	gl_FragColor = vec4( vec3( 1.0 ), opacity );",THREE.ShaderChunk.logdepthbuf_fragment,THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.alphamap_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.specularmap_fragment,THREE.ShaderChunk.lights_phong_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},particle_basic:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.particle,THREE.UniformsLib.shadowmap]),vertexShader:["uniform float size;\nuniform float scale;",THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",THREE.ShaderChunk.color_vertex,"	vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n	#ifdef USE_SIZEATTENUATION\n		gl_PointSize = size * ( scale / length( mvPosition.xyz ) );\n	#else\n		gl_PointSize = size;\n	#endif\n	gl_Position = projectionMatrix * mvPosition;",THREE.ShaderChunk.logdepthbuf_vertex,THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 psColor;\nuniform float opacity;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_particle_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {\n	gl_FragColor = vec4( psColor, opacity );",THREE.ShaderChunk.logdepthbuf_fragment,THREE.ShaderChunk.map_particle_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},dashed:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,{scale:{type:"f",value:1},dashSize:{type:"f",value:1},totalSize:{type:"f",value:2}}]),vertexShader:["uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;",THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",THREE.ShaderChunk.color_vertex,"	vLineDistance = scale * lineDistance;\n	vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n	gl_Position = projectionMatrix * mvPosition;",THREE.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {\n	if ( mod( vLineDistance, totalSize ) > dashSize ) {\n		discard;\n	}\n	gl_FragColor = vec4( diffuse, opacity );",THREE.ShaderChunk.logdepthbuf_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2e3},opacity:{type:"f",value:1}},vertexShader:[THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform float mNear;\nuniform float mFar;\nuniform float opacity;",THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {",THREE.ShaderChunk.logdepthbuf_fragment,"	#ifdef USE_LOGDEPTHBUF_EXT\n		float depth = gl_FragDepthEXT / gl_FragCoord.w;\n	#else\n		float depth = gl_FragCoord.z / gl_FragCoord.w;\n	#endif\n	float color = 1.0 - smoothstep( mNear, mFar, depth );\n	gl_FragColor = vec4( vec3( color ), opacity );\n}"].join("\n")},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:["varying vec3 vNormal;",THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {\n	vNormal = normalize( normalMatrix * normal );",THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;\nvarying vec3 vNormal;",THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {\n	gl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );",THREE.ShaderChunk.logdepthbuf_fragment,"}"].join("\n")},normalmap:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{enableAO:{type:"i",value:0},enableDiffuse:{type:"i",value:0},enableSpecular:{type:"i",value:0},enableReflection:{type:"i",value:0},enableDisplacement:{type:"i",value:0},tDisplacement:{type:"t",value:null},tDiffuse:{type:"t",value:null},tCube:{type:"t",value:null},tNormal:{type:"t",value:null},tSpecular:{type:"t",value:null},tAO:{type:"t",value:null},uNormalScale:{type:"v2",value:new THREE.Vector2(1,1)},uDisplacementBias:{type:"f",value:0},uDisplacementScale:{type:"f",value:1},diffuse:{type:"c",value:new THREE.Color(16777215)},specular:{type:"c",value:new THREE.Color(1118481)},ambient:{type:"c",value:new THREE.Color(16777215)},shininess:{type:"f",value:30},opacity:{type:"f",value:1},useRefract:{type:"i",value:0},refractionRatio:{type:"f",value:.98},reflectivity:{type:"f",value:.5},uOffset:{type:"v2",value:new THREE.Vector2(0,0)},uRepeat:{type:"v2",value:new THREE.Vector2(1,1)},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}}]),fragmentShader:["uniform vec3 ambient;\nuniform vec3 diffuse;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\nuniform bool enableDiffuse;\nuniform bool enableSpecular;\nuniform bool enableAO;\nuniform bool enableReflection;\nuniform sampler2D tDiffuse;\nuniform sampler2D tNormal;\nuniform sampler2D tSpecular;\nuniform sampler2D tAO;\nuniform samplerCube tCube;\nuniform vec2 uNormalScale;\nuniform bool useRefract;\nuniform float refractionRatio;\nuniform float reflectivity;\nvarying vec3 vTangent;\nvarying vec3 vBinormal;\nvarying vec3 vNormal;\nvarying vec2 vUv;\nuniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\n	uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\n	uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_HEMI_LIGHTS > 0\n	uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\n	uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\n	uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\n	uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n	uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\n	uniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#endif\n#if MAX_SPOT_LIGHTS > 0\n	uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\n	uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\n	uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n#endif\n#ifdef WRAP_AROUND\n	uniform vec3 wrapRGB;\n#endif\nvarying vec3 vWorldPosition;\nvarying vec3 vViewPosition;",THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {",THREE.ShaderChunk.logdepthbuf_fragment,"	gl_FragColor = vec4( vec3( 1.0 ), opacity );\n	vec3 specularTex = vec3( 1.0 );\n	vec3 normalTex = texture2D( tNormal, vUv ).xyz * 2.0 - 1.0;\n	normalTex.xy *= uNormalScale;\n	normalTex = normalize( normalTex );\n	if( enableDiffuse ) {\n		#ifdef GAMMA_INPUT\n			vec4 texelColor = texture2D( tDiffuse, vUv );\n			texelColor.xyz *= texelColor.xyz;\n			gl_FragColor = gl_FragColor * texelColor;\n		#else\n			gl_FragColor = gl_FragColor * texture2D( tDiffuse, vUv );\n		#endif\n	}\n	if( enableAO ) {\n		#ifdef GAMMA_INPUT\n			vec4 aoColor = texture2D( tAO, vUv );\n			aoColor.xyz *= aoColor.xyz;\n			gl_FragColor.xyz = gl_FragColor.xyz * aoColor.xyz;\n		#else\n			gl_FragColor.xyz = gl_FragColor.xyz * texture2D( tAO, vUv ).xyz;\n		#endif\n	}",THREE.ShaderChunk.alphatest_fragment,"	if( enableSpecular )\n		specularTex = texture2D( tSpecular, vUv ).xyz;\n	mat3 tsb = mat3( normalize( vTangent ), normalize( vBinormal ), normalize( vNormal ) );\n	vec3 finalNormal = tsb * normalTex;\n	#ifdef FLIP_SIDED\n		finalNormal = -finalNormal;\n	#endif\n	vec3 normal = normalize( finalNormal );\n	vec3 viewPosition = normalize( vViewPosition );\n	#if MAX_POINT_LIGHTS > 0\n		vec3 pointDiffuse = vec3( 0.0 );\n		vec3 pointSpecular = vec3( 0.0 );\n		for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n			vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\n			vec3 pointVector = lPosition.xyz + vViewPosition.xyz;\n			float pointDistance = 1.0;\n			if ( pointLightDistance[ i ] > 0.0 )\n				pointDistance = 1.0 - min( ( length( pointVector ) / pointLightDistance[ i ] ), 1.0 );\n			pointVector = normalize( pointVector );\n			#ifdef WRAP_AROUND\n				float pointDiffuseWeightFull = max( dot( normal, pointVector ), 0.0 );\n				float pointDiffuseWeightHalf = max( 0.5 * dot( normal, pointVector ) + 0.5, 0.0 );\n				vec3 pointDiffuseWeight = mix( vec3( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );\n			#else\n				float pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );\n			#endif\n			pointDiffuse += pointDistance * pointLightColor[ i ] * diffuse * pointDiffuseWeight;\n			vec3 pointHalfVector = normalize( pointVector + viewPosition );\n			float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\n			float pointSpecularWeight = specularTex.r * max( pow( pointDotNormalHalf, shininess ), 0.0 );\n			float specularNormalization = ( shininess + 2.0 ) / 8.0;\n			vec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( pointVector, pointHalfVector ), 0.0 ), 5.0 );\n			pointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * pointDistance * specularNormalization;\n		}\n	#endif\n	#if MAX_SPOT_LIGHTS > 0\n		vec3 spotDiffuse = vec3( 0.0 );\n		vec3 spotSpecular = vec3( 0.0 );\n		for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n			vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\n			vec3 spotVector = lPosition.xyz + vViewPosition.xyz;\n			float spotDistance = 1.0;\n			if ( spotLightDistance[ i ] > 0.0 )\n				spotDistance = 1.0 - min( ( length( spotVector ) / spotLightDistance[ i ] ), 1.0 );\n			spotVector = normalize( spotVector );\n			float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );\n			if ( spotEffect > spotLightAngleCos[ i ] ) {\n				spotEffect = max( pow( max( spotEffect, 0.0 ), spotLightExponent[ i ] ), 0.0 );\n				#ifdef WRAP_AROUND\n					float spotDiffuseWeightFull = max( dot( normal, spotVector ), 0.0 );\n					float spotDiffuseWeightHalf = max( 0.5 * dot( normal, spotVector ) + 0.5, 0.0 );\n					vec3 spotDiffuseWeight = mix( vec3( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );\n				#else\n					float spotDiffuseWeight = max( dot( normal, spotVector ), 0.0 );\n				#endif\n				spotDiffuse += spotDistance * spotLightColor[ i ] * diffuse * spotDiffuseWeight * spotEffect;\n				vec3 spotHalfVector = normalize( spotVector + viewPosition );\n				float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );\n				float spotSpecularWeight = specularTex.r * max( pow( spotDotNormalHalf, shininess ), 0.0 );\n				float specularNormalization = ( shininess + 2.0 ) / 8.0;\n				vec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( spotVector, spotHalfVector ), 0.0 ), 5.0 );\n				spotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * spotDistance * specularNormalization * spotEffect;\n			}\n		}\n	#endif\n	#if MAX_DIR_LIGHTS > 0\n		vec3 dirDiffuse = vec3( 0.0 );\n		vec3 dirSpecular = vec3( 0.0 );\n		for( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {\n			vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\n			vec3 dirVector = normalize( lDirection.xyz );\n			#ifdef WRAP_AROUND\n				float directionalLightWeightingFull = max( dot( normal, dirVector ), 0.0 );\n				float directionalLightWeightingHalf = max( 0.5 * dot( normal, dirVector ) + 0.5, 0.0 );\n				vec3 dirDiffuseWeight = mix( vec3( directionalLightWeightingFull ), vec3( directionalLightWeightingHalf ), wrapRGB );\n			#else\n				float dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );\n			#endif\n			dirDiffuse += directionalLightColor[ i ] * diffuse * dirDiffuseWeight;\n			vec3 dirHalfVector = normalize( dirVector + viewPosition );\n			float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\n			float dirSpecularWeight = specularTex.r * max( pow( dirDotNormalHalf, shininess ), 0.0 );\n			float specularNormalization = ( shininess + 2.0 ) / 8.0;\n			vec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( dirVector, dirHalfVector ), 0.0 ), 5.0 );\n			dirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\n		}\n	#endif\n	#if MAX_HEMI_LIGHTS > 0\n		vec3 hemiDiffuse = vec3( 0.0 );\n		vec3 hemiSpecular = vec3( 0.0 );\n		for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\n			vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );\n			vec3 lVector = normalize( lDirection.xyz );\n			float dotProduct = dot( normal, lVector );\n			float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\n			vec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n			hemiDiffuse += diffuse * hemiColor;\n			vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );\n			float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;\n			float hemiSpecularWeightSky = specularTex.r * max( pow( max( hemiDotNormalHalfSky, 0.0 ), shininess ), 0.0 );\n			vec3 lVectorGround = -lVector;\n			vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );\n			float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;\n			float hemiSpecularWeightGround = specularTex.r * max( pow( max( hemiDotNormalHalfGround, 0.0 ), shininess ), 0.0 );\n			float dotProductGround = dot( normal, lVectorGround );\n			float specularNormalization = ( shininess + 2.0 ) / 8.0;\n			vec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, hemiHalfVectorSky ), 0.0 ), 5.0 );\n			vec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 0.0 ), 5.0 );\n			hemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );\n		}\n	#endif\n	vec3 totalDiffuse = vec3( 0.0 );\n	vec3 totalSpecular = vec3( 0.0 );\n	#if MAX_DIR_LIGHTS > 0\n		totalDiffuse += dirDiffuse;\n		totalSpecular += dirSpecular;\n	#endif\n	#if MAX_HEMI_LIGHTS > 0\n		totalDiffuse += hemiDiffuse;\n		totalSpecular += hemiSpecular;\n	#endif\n	#if MAX_POINT_LIGHTS > 0\n		totalDiffuse += pointDiffuse;\n		totalSpecular += pointSpecular;\n	#endif\n	#if MAX_SPOT_LIGHTS > 0\n		totalDiffuse += spotDiffuse;\n		totalSpecular += spotSpecular;\n	#endif\n	#ifdef METAL\n		gl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * ambient + totalSpecular );\n	#else\n		gl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * ambient ) + totalSpecular;\n	#endif\n	if ( enableReflection ) {\n		vec3 vReflect;\n		vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n		if ( useRefract ) {\n			vReflect = refract( cameraToVertex, normal, refractionRatio );\n		} else {\n			vReflect = reflect( cameraToVertex, normal );\n		}\n		vec4 cubeColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );\n		#ifdef GAMMA_INPUT\n			cubeColor.xyz *= cubeColor.xyz;\n		#endif\n		gl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularTex.r * reflectivity );\n	}",THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["attribute vec4 tangent;\nuniform vec2 uOffset;\nuniform vec2 uRepeat;\nuniform bool enableDisplacement;\n#ifdef VERTEX_TEXTURES\n	uniform sampler2D tDisplacement;\n	uniform float uDisplacementScale;\n	uniform float uDisplacementBias;\n#endif\nvarying vec3 vTangent;\nvarying vec3 vBinormal;\nvarying vec3 vNormal;\nvarying vec2 vUv;\nvarying vec3 vWorldPosition;\nvarying vec3 vViewPosition;",THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.skinnormal_vertex,"	#ifdef USE_SKINNING\n		vNormal = normalize( normalMatrix * skinnedNormal.xyz );\n		vec4 skinnedTangent = skinMatrix * vec4( tangent.xyz, 0.0 );\n		vTangent = normalize( normalMatrix * skinnedTangent.xyz );\n	#else\n		vNormal = normalize( normalMatrix * normal );\n		vTangent = normalize( normalMatrix * tangent.xyz );\n	#endif\n	vBinormal = normalize( cross( vNormal, vTangent ) * tangent.w );\n	vUv = uv * uRepeat + uOffset;\n	vec3 displacedPosition;\n	#ifdef VERTEX_TEXTURES\n		if ( enableDisplacement ) {\n			vec3 dv = texture2D( tDisplacement, uv ).xyz;\n			float df = uDisplacementScale * dv.x + uDisplacementBias;\n			displacedPosition = position + normalize( normal ) * df;\n		} else {\n			#ifdef USE_SKINNING\n				vec4 skinVertex = bindMatrix * vec4( position, 1.0 );\n				vec4 skinned = vec4( 0.0 );\n				skinned += boneMatX * skinVertex * skinWeight.x;\n				skinned += boneMatY * skinVertex * skinWeight.y;\n				skinned += boneMatZ * skinVertex * skinWeight.z;\n				skinned += boneMatW * skinVertex * skinWeight.w;\n				skinned  = bindMatrixInverse * skinned;\n				displacedPosition = skinned.xyz;\n			#else\n				displacedPosition = position;\n			#endif\n		}\n	#else\n		#ifdef USE_SKINNING\n			vec4 skinVertex = bindMatrix * vec4( position, 1.0 );\n			vec4 skinned = vec4( 0.0 );\n			skinned += boneMatX * skinVertex * skinWeight.x;\n			skinned += boneMatY * skinVertex * skinWeight.y;\n			skinned += boneMatZ * skinVertex * skinWeight.z;\n			skinned += boneMatW * skinVertex * skinWeight.w;\n			skinned  = bindMatrixInverse * skinned;\n			displacedPosition = skinned.xyz;\n		#else\n			displacedPosition = position;\n		#endif\n	#endif\n	vec4 mvPosition = modelViewMatrix * vec4( displacedPosition, 1.0 );\n	vec4 worldPosition = modelMatrix * vec4( displacedPosition, 1.0 );\n	gl_Position = projectionMatrix * mvPosition;",THREE.ShaderChunk.logdepthbuf_vertex,"	vWorldPosition = worldPosition.xyz;\n	vViewPosition = -mvPosition.xyz;\n	#ifdef USE_SHADOWMAP\n		for( int i = 0; i < MAX_SHADOWS; i ++ ) {\n			vShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;\n		}\n	#endif\n}"].join("\n")},cube:{uniforms:{tCube:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:["varying vec3 vWorldPosition;",THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {\n	vec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n	vWorldPosition = worldPosition.xyz;\n	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform samplerCube tCube;\nuniform float tFlip;\nvarying vec3 vWorldPosition;",THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {\n	gl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );",THREE.ShaderChunk.logdepthbuf_fragment,"}"].join("\n")},depthRGBA:{uniforms:{},vertexShader:[THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:[THREE.ShaderChunk.logdepthbuf_pars_fragment,"vec4 pack_depth( const in float depth ) {\n	const vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );\n	const vec4 bit_mask = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );\n	vec4 res = mod( depth * bit_shift * vec4( 255 ), vec4( 256 ) ) / vec4( 255 );\n	res -= res.xxyz * bit_mask;\n	return res;\n}\nvoid main() {",THREE.ShaderChunk.logdepthbuf_fragment,"	#ifdef USE_LOGDEPTHBUF_EXT\n		gl_FragData[ 0 ] = pack_depth( gl_FragDepthEXT );\n	#else\n		gl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );\n	#endif\n}"].join("\n")}},THREE.WebGLRenderer=function(t){function e(t,e){var n=t.vertices.length,r=e.material;if(r.attributes){void 0===t.__webglCustomAttributesList&&(t.__webglCustomAttributesList=[]);for(var i in r.attributes){var o=r.attributes[i];if(!o.__webglInitialized||o.createUniqueBuffers){o.__webglInitialized=!0;var a=1;"v2"===o.type?a=2:"v3"===o.type?a=3:"v4"===o.type?a=4:"c"===o.type&&(a=3),o.size=a,o.array=new Float32Array(n*a),o.buffer=Q.createBuffer(),o.buffer.belongsToAttribute=i,o.needsUpdate=!0}t.__webglCustomAttributesList.push(o)}}}function n(t,e){var n=e.geometry,a=t.faces3,s=3*a.length,h=1*a.length,u=3*a.length,a=r(e,t),c=o(a),l=i(a),f=a.vertexColors?a.vertexColors:!1;if(t.__vertexArray=new Float32Array(3*s),l&&(t.__normalArray=new Float32Array(3*s)),n.hasTangents&&(t.__tangentArray=new Float32Array(4*s)),f&&(t.__colorArray=new Float32Array(3*s)),c&&(0<n.faceVertexUvs.length&&(t.__uvArray=new Float32Array(2*s)),1<n.faceVertexUvs.length&&(t.__uv2Array=new Float32Array(2*s))),e.geometry.skinWeights.length&&e.geometry.skinIndices.length&&(t.__skinIndexArray=new Float32Array(4*s),t.__skinWeightArray=new Float32Array(4*s)),n=null!==ne&&h>21845?Uint32Array:Uint16Array,t.__typeArray=n,t.__faceArray=new n(3*h),t.__lineArray=new n(2*u),t.numMorphTargets)for(t.__morphTargetsArrays=[],n=0,c=t.numMorphTargets;c>n;n++)t.__morphTargetsArrays.push(new Float32Array(3*s));if(t.numMorphNormals)for(t.__morphNormalsArrays=[],n=0,c=t.numMorphNormals;c>n;n++)t.__morphNormalsArrays.push(new Float32Array(3*s));if(t.__webglFaceCount=3*h,t.__webglLineCount=2*u,a.attributes){void 0===t.__webglCustomAttributesList&&(t.__webglCustomAttributesList=[]);for(var p in a.attributes){var d,h=a.attributes[p],u={};for(d in h)u[d]=h[d];(!u.__webglInitialized||u.createUniqueBuffers)&&(u.__webglInitialized=!0,n=1,"v2"===u.type?n=2:"v3"===u.type?n=3:"v4"===u.type?n=4:"c"===u.type&&(n=3),u.size=n,u.array=new Float32Array(s*n),u.buffer=Q.createBuffer(),u.buffer.belongsToAttribute=p,h.needsUpdate=!0,u.__original=h),t.__webglCustomAttributesList.push(u)}}t.__inittedArrays=!0}function r(t,e){return t.material instanceof THREE.MeshFaceMaterial?t.material.materials[e.materialIndex]:t.material}function i(t){return t instanceof THREE.MeshBasicMaterial&&!t.envMap||t instanceof THREE.MeshDepthMaterial?!1:t&&void 0!==t.shading&&t.shading===THREE.SmoothShading?THREE.SmoothShading:THREE.FlatShading}function o(t){return t.map||t.lightMap||t.bumpMap||t.normalMap||t.specularMap||t.alphaMap||t instanceof THREE.ShaderMaterial?!0:!1}function a(t){for(var e in t.attributes){var n="index"===e?Q.ELEMENT_ARRAY_BUFFER:Q.ARRAY_BUFFER,r=t.attributes[e];r.buffer=Q.createBuffer(),Q.bindBuffer(n,r.buffer),Q.bufferData(n,r.array,Q.STATIC_DRAW)}}function s(t,e,n,r){for(var i in e){var o=e[i],a=n[i];if(o>=0)if(a){var s=a.itemSize;
Q.bindBuffer(Q.ARRAY_BUFFER,a.buffer),u(o),Q.vertexAttribPointer(o,s,Q.FLOAT,!1,0,r*s*4)}else t.defaultAttributeValues&&(2===t.defaultAttributeValues[i].length?Q.vertexAttrib2fv(o,t.defaultAttributeValues[i]):3===t.defaultAttributeValues[i].length&&Q.vertexAttrib3fv(o,t.defaultAttributeValues[i]))}c()}function h(){for(var t=0,e=Ce.length;e>t;t++)Ce[t]=0}function u(t){Ce[t]=1,0===Ae[t]&&(Q.enableVertexAttribArray(t),Ae[t]=1)}function c(){for(var t=0,e=Ae.length;e>t;t++)Ae[t]!==Ce[t]&&(Q.disableVertexAttribArray(t),Ae[t]=0)}function l(t,e){return t.z!==e.z?e.z-t.z:t.id-e.id}function f(t,e){return t.z!==e.z?t.z-e.z:t.id-e.id}function p(t,e){return e[0]-t[0]}function d(t,e,s){if(!1!==e.visible){var h=t.__webglObjects[e.id];if(h&&(!1===e.frustumCulled||!0===Le.intersectsObject(e))){var u,c,l,f=e.geometry;if(f instanceof THREE.BufferGeometry){var m,g,v=Q.DYNAMIC_DRAW,y=f.attributes;for(m in y)g=y[m],g.needsUpdate&&("index"===m?(Q.bindBuffer(Q.ELEMENT_ARRAY_BUFFER,g.buffer),Q.bufferData(Q.ELEMENT_ARRAY_BUFFER,g.array,v)):(Q.bindBuffer(Q.ARRAY_BUFFER,g.buffer),Q.bufferData(Q.ARRAY_BUFFER,g.array,v)),g.needsUpdate=!1)}else if(e instanceof THREE.Mesh){(f.buffersNeedUpdate||f.groupsNeedUpdate)&&(f instanceof THREE.BufferGeometry?a(f):e instanceof THREE.Mesh&&E(t,e,f));for(var x=0,R=f.geometryGroupsList.length;R>x;x++)if(u=f.geometryGroupsList[x],l=r(e,u),(f.buffersNeedUpdate||f.groupsNeedUpdate)&&n(u,e),c=l.attributes&&T(l),f.verticesNeedUpdate||f.morphTargetsNeedUpdate||f.elementsNeedUpdate||f.uvsNeedUpdate||f.normalsNeedUpdate||f.colorsNeedUpdate||f.tangentsNeedUpdate||c){var w=u,_=e,H=Q.DYNAMIC_DRAW,M=!f.dynamic,S=l;if(w.__inittedArrays){var C=i(S),A=S.vertexColors?S.vertexColors:!1,L=o(S),P=C===THREE.SmoothShading,D=void 0,z=void 0,F=void 0,k=void 0,N=void 0,V=void 0,I=void 0,B=void 0,U=void 0,O=void 0,W=void 0,G=void 0,j=void 0,q=void 0,X=void 0,Y=void 0,$=void 0,J=void 0,te=void 0,ee=void 0,ne=void 0,ie=void 0,oe=void 0,ae=void 0,se=void 0,he=void 0,ue=void 0,ce=void 0,le=void 0,fe=void 0,pe=void 0,de=void 0,me=void 0,ge=void 0,ve=void 0,ye=void 0,Ee=void 0,xe=void 0,Te=void 0,be=void 0,Re=0,we=0,_e=0,He=0,Me=0,Se=0,Ce=0,Ae=0,Fe=0,ke=0,Ne=0,Ve=0,Ie=void 0,Be=w.__vertexArray,Ue=w.__uvArray,Oe=w.__uv2Array,We=w.__normalArray,Ge=w.__tangentArray,je=w.__colorArray,qe=w.__skinIndexArray,Xe=w.__skinWeightArray,Ye=w.__morphTargetsArrays,Ze=w.__morphNormalsArrays,Ke=w.__webglCustomAttributesList,Qe=void 0,$e=w.__faceArray,Je=w.__lineArray,tn=_.geometry,en=tn.elementsNeedUpdate,nn=tn.uvsNeedUpdate,rn=tn.normalsNeedUpdate,on=tn.tangentsNeedUpdate,an=tn.colorsNeedUpdate,sn=tn.morphTargetsNeedUpdate,hn=tn.vertices,un=w.faces3,cn=tn.faces,ln=tn.faceVertexUvs[0],fn=tn.faceVertexUvs[1],pn=tn.skinIndices,dn=tn.skinWeights,mn=tn.morphTargets,gn=tn.morphNormals;if(tn.verticesNeedUpdate){for(D=0,z=un.length;z>D;D++)k=cn[un[D]],G=hn[k.a],j=hn[k.b],q=hn[k.c],Be[we]=G.x,Be[we+1]=G.y,Be[we+2]=G.z,Be[we+3]=j.x,Be[we+4]=j.y,Be[we+5]=j.z,Be[we+6]=q.x,Be[we+7]=q.y,Be[we+8]=q.z,we+=9;Q.bindBuffer(Q.ARRAY_BUFFER,w.__webglVertexBuffer),Q.bufferData(Q.ARRAY_BUFFER,Be,H)}if(sn)for(ve=0,ye=mn.length;ye>ve;ve++){for(D=Ne=0,z=un.length;z>D;D++)Te=un[D],k=cn[Te],G=mn[ve].vertices[k.a],j=mn[ve].vertices[k.b],q=mn[ve].vertices[k.c],Ee=Ye[ve],Ee[Ne]=G.x,Ee[Ne+1]=G.y,Ee[Ne+2]=G.z,Ee[Ne+3]=j.x,Ee[Ne+4]=j.y,Ee[Ne+5]=j.z,Ee[Ne+6]=q.x,Ee[Ne+7]=q.y,Ee[Ne+8]=q.z,S.morphNormals&&(P?(be=gn[ve].vertexNormals[Te],J=be.a,te=be.b,ee=be.c):ee=te=J=gn[ve].faceNormals[Te],xe=Ze[ve],xe[Ne]=J.x,xe[Ne+1]=J.y,xe[Ne+2]=J.z,xe[Ne+3]=te.x,xe[Ne+4]=te.y,xe[Ne+5]=te.z,xe[Ne+6]=ee.x,xe[Ne+7]=ee.y,xe[Ne+8]=ee.z),Ne+=9;Q.bindBuffer(Q.ARRAY_BUFFER,w.__webglMorphTargetsBuffers[ve]),Q.bufferData(Q.ARRAY_BUFFER,Ye[ve],H),S.morphNormals&&(Q.bindBuffer(Q.ARRAY_BUFFER,w.__webglMorphNormalsBuffers[ve]),Q.bufferData(Q.ARRAY_BUFFER,Ze[ve],H))}if(dn.length){for(D=0,z=un.length;z>D;D++)k=cn[un[D]],ae=dn[k.a],se=dn[k.b],he=dn[k.c],Xe[ke]=ae.x,Xe[ke+1]=ae.y,Xe[ke+2]=ae.z,Xe[ke+3]=ae.w,Xe[ke+4]=se.x,Xe[ke+5]=se.y,Xe[ke+6]=se.z,Xe[ke+7]=se.w,Xe[ke+8]=he.x,Xe[ke+9]=he.y,Xe[ke+10]=he.z,Xe[ke+11]=he.w,ue=pn[k.a],ce=pn[k.b],le=pn[k.c],qe[ke]=ue.x,qe[ke+1]=ue.y,qe[ke+2]=ue.z,qe[ke+3]=ue.w,qe[ke+4]=ce.x,qe[ke+5]=ce.y,qe[ke+6]=ce.z,qe[ke+7]=ce.w,qe[ke+8]=le.x,qe[ke+9]=le.y,qe[ke+10]=le.z,qe[ke+11]=le.w,ke+=12;ke>0&&(Q.bindBuffer(Q.ARRAY_BUFFER,w.__webglSkinIndicesBuffer),Q.bufferData(Q.ARRAY_BUFFER,qe,H),Q.bindBuffer(Q.ARRAY_BUFFER,w.__webglSkinWeightsBuffer),Q.bufferData(Q.ARRAY_BUFFER,Xe,H))}if(an&&A){for(D=0,z=un.length;z>D;D++)k=cn[un[D]],I=k.vertexColors,B=k.color,3===I.length&&A===THREE.VertexColors?(ne=I[0],ie=I[1],oe=I[2]):oe=ie=ne=B,je[Fe]=ne.r,je[Fe+1]=ne.g,je[Fe+2]=ne.b,je[Fe+3]=ie.r,je[Fe+4]=ie.g,je[Fe+5]=ie.b,je[Fe+6]=oe.r,je[Fe+7]=oe.g,je[Fe+8]=oe.b,Fe+=9;Fe>0&&(Q.bindBuffer(Q.ARRAY_BUFFER,w.__webglColorBuffer),Q.bufferData(Q.ARRAY_BUFFER,je,H))}if(on&&tn.hasTangents){for(D=0,z=un.length;z>D;D++)k=cn[un[D]],U=k.vertexTangents,X=U[0],Y=U[1],$=U[2],Ge[Ce]=X.x,Ge[Ce+1]=X.y,Ge[Ce+2]=X.z,Ge[Ce+3]=X.w,Ge[Ce+4]=Y.x,Ge[Ce+5]=Y.y,Ge[Ce+6]=Y.z,Ge[Ce+7]=Y.w,Ge[Ce+8]=$.x,Ge[Ce+9]=$.y,Ge[Ce+10]=$.z,Ge[Ce+11]=$.w,Ce+=12;Q.bindBuffer(Q.ARRAY_BUFFER,w.__webglTangentBuffer),Q.bufferData(Q.ARRAY_BUFFER,Ge,H)}if(rn&&C){for(D=0,z=un.length;z>D;D++)if(k=cn[un[D]],N=k.vertexNormals,V=k.normal,3===N.length&&P)for(fe=0;3>fe;fe++)de=N[fe],We[Se]=de.x,We[Se+1]=de.y,We[Se+2]=de.z,Se+=3;else for(fe=0;3>fe;fe++)We[Se]=V.x,We[Se+1]=V.y,We[Se+2]=V.z,Se+=3;Q.bindBuffer(Q.ARRAY_BUFFER,w.__webglNormalBuffer),Q.bufferData(Q.ARRAY_BUFFER,We,H)}if(nn&&ln&&L){for(D=0,z=un.length;z>D;D++)if(F=un[D],O=ln[F],void 0!==O)for(fe=0;3>fe;fe++)me=O[fe],Ue[_e]=me.x,Ue[_e+1]=me.y,_e+=2;_e>0&&(Q.bindBuffer(Q.ARRAY_BUFFER,w.__webglUVBuffer),Q.bufferData(Q.ARRAY_BUFFER,Ue,H))}if(nn&&fn&&L){for(D=0,z=un.length;z>D;D++)if(F=un[D],W=fn[F],void 0!==W)for(fe=0;3>fe;fe++)ge=W[fe],Oe[He]=ge.x,Oe[He+1]=ge.y,He+=2;He>0&&(Q.bindBuffer(Q.ARRAY_BUFFER,w.__webglUV2Buffer),Q.bufferData(Q.ARRAY_BUFFER,Oe,H))}if(en){for(D=0,z=un.length;z>D;D++)$e[Me]=Re,$e[Me+1]=Re+1,$e[Me+2]=Re+2,Me+=3,Je[Ae]=Re,Je[Ae+1]=Re+1,Je[Ae+2]=Re,Je[Ae+3]=Re+2,Je[Ae+4]=Re+1,Je[Ae+5]=Re+2,Ae+=6,Re+=3;Q.bindBuffer(Q.ELEMENT_ARRAY_BUFFER,w.__webglFaceBuffer),Q.bufferData(Q.ELEMENT_ARRAY_BUFFER,$e,H),Q.bindBuffer(Q.ELEMENT_ARRAY_BUFFER,w.__webglLineBuffer),Q.bufferData(Q.ELEMENT_ARRAY_BUFFER,Je,H)}if(Ke)for(fe=0,pe=Ke.length;pe>fe;fe++)if(Qe=Ke[fe],Qe.__original.needsUpdate){if(Ve=0,1===Qe.size){if(void 0===Qe.boundTo||"vertices"===Qe.boundTo)for(D=0,z=un.length;z>D;D++)k=cn[un[D]],Qe.array[Ve]=Qe.value[k.a],Qe.array[Ve+1]=Qe.value[k.b],Qe.array[Ve+2]=Qe.value[k.c],Ve+=3;else if("faces"===Qe.boundTo)for(D=0,z=un.length;z>D;D++)Ie=Qe.value[un[D]],Qe.array[Ve]=Ie,Qe.array[Ve+1]=Ie,Qe.array[Ve+2]=Ie,Ve+=3}else if(2===Qe.size){if(void 0===Qe.boundTo||"vertices"===Qe.boundTo)for(D=0,z=un.length;z>D;D++)k=cn[un[D]],G=Qe.value[k.a],j=Qe.value[k.b],q=Qe.value[k.c],Qe.array[Ve]=G.x,Qe.array[Ve+1]=G.y,Qe.array[Ve+2]=j.x,Qe.array[Ve+3]=j.y,Qe.array[Ve+4]=q.x,Qe.array[Ve+5]=q.y,Ve+=6;else if("faces"===Qe.boundTo)for(D=0,z=un.length;z>D;D++)q=j=G=Ie=Qe.value[un[D]],Qe.array[Ve]=G.x,Qe.array[Ve+1]=G.y,Qe.array[Ve+2]=j.x,Qe.array[Ve+3]=j.y,Qe.array[Ve+4]=q.x,Qe.array[Ve+5]=q.y,Ve+=6}else if(3===Qe.size){var vn;if(vn="c"===Qe.type?["r","g","b"]:["x","y","z"],void 0===Qe.boundTo||"vertices"===Qe.boundTo)for(D=0,z=un.length;z>D;D++)k=cn[un[D]],G=Qe.value[k.a],j=Qe.value[k.b],q=Qe.value[k.c],Qe.array[Ve]=G[vn[0]],Qe.array[Ve+1]=G[vn[1]],Qe.array[Ve+2]=G[vn[2]],Qe.array[Ve+3]=j[vn[0]],Qe.array[Ve+4]=j[vn[1]],Qe.array[Ve+5]=j[vn[2]],Qe.array[Ve+6]=q[vn[0]],Qe.array[Ve+7]=q[vn[1]],Qe.array[Ve+8]=q[vn[2]],Ve+=9;else if("faces"===Qe.boundTo)for(D=0,z=un.length;z>D;D++)q=j=G=Ie=Qe.value[un[D]],Qe.array[Ve]=G[vn[0]],Qe.array[Ve+1]=G[vn[1]],Qe.array[Ve+2]=G[vn[2]],Qe.array[Ve+3]=j[vn[0]],Qe.array[Ve+4]=j[vn[1]],Qe.array[Ve+5]=j[vn[2]],Qe.array[Ve+6]=q[vn[0]],Qe.array[Ve+7]=q[vn[1]],Qe.array[Ve+8]=q[vn[2]],Ve+=9;else if("faceVertices"===Qe.boundTo)for(D=0,z=un.length;z>D;D++)Ie=Qe.value[un[D]],G=Ie[0],j=Ie[1],q=Ie[2],Qe.array[Ve]=G[vn[0]],Qe.array[Ve+1]=G[vn[1]],Qe.array[Ve+2]=G[vn[2]],Qe.array[Ve+3]=j[vn[0]],Qe.array[Ve+4]=j[vn[1]],Qe.array[Ve+5]=j[vn[2]],Qe.array[Ve+6]=q[vn[0]],Qe.array[Ve+7]=q[vn[1]],Qe.array[Ve+8]=q[vn[2]],Ve+=9}else if(4===Qe.size)if(void 0===Qe.boundTo||"vertices"===Qe.boundTo)for(D=0,z=un.length;z>D;D++)k=cn[un[D]],G=Qe.value[k.a],j=Qe.value[k.b],q=Qe.value[k.c],Qe.array[Ve]=G.x,Qe.array[Ve+1]=G.y,Qe.array[Ve+2]=G.z,Qe.array[Ve+3]=G.w,Qe.array[Ve+4]=j.x,Qe.array[Ve+5]=j.y,Qe.array[Ve+6]=j.z,Qe.array[Ve+7]=j.w,Qe.array[Ve+8]=q.x,Qe.array[Ve+9]=q.y,Qe.array[Ve+10]=q.z,Qe.array[Ve+11]=q.w,Ve+=12;else if("faces"===Qe.boundTo)for(D=0,z=un.length;z>D;D++)q=j=G=Ie=Qe.value[un[D]],Qe.array[Ve]=G.x,Qe.array[Ve+1]=G.y,Qe.array[Ve+2]=G.z,Qe.array[Ve+3]=G.w,Qe.array[Ve+4]=j.x,Qe.array[Ve+5]=j.y,Qe.array[Ve+6]=j.z,Qe.array[Ve+7]=j.w,Qe.array[Ve+8]=q.x,Qe.array[Ve+9]=q.y,Qe.array[Ve+10]=q.z,Qe.array[Ve+11]=q.w,Ve+=12;else if("faceVertices"===Qe.boundTo)for(D=0,z=un.length;z>D;D++)Ie=Qe.value[un[D]],G=Ie[0],j=Ie[1],q=Ie[2],Qe.array[Ve]=G.x,Qe.array[Ve+1]=G.y,Qe.array[Ve+2]=G.z,Qe.array[Ve+3]=G.w,Qe.array[Ve+4]=j.x,Qe.array[Ve+5]=j.y,Qe.array[Ve+6]=j.z,Qe.array[Ve+7]=j.w,Qe.array[Ve+8]=q.x,Qe.array[Ve+9]=q.y,Qe.array[Ve+10]=q.z,Qe.array[Ve+11]=q.w,Ve+=12;Q.bindBuffer(Q.ARRAY_BUFFER,Qe.buffer),Q.bufferData(Q.ARRAY_BUFFER,Qe.array,H)}M&&(delete w.__inittedArrays,delete w.__colorArray,delete w.__normalArray,delete w.__tangentArray,delete w.__uvArray,delete w.__uv2Array,delete w.__faceArray,delete w.__vertexArray,delete w.__lineArray,delete w.__skinIndexArray,delete w.__skinWeightArray)}}f.verticesNeedUpdate=!1,f.morphTargetsNeedUpdate=!1,f.elementsNeedUpdate=!1,f.uvsNeedUpdate=!1,f.normalsNeedUpdate=!1,f.colorsNeedUpdate=!1,f.tangentsNeedUpdate=!1,f.buffersNeedUpdate=!1,l.attributes&&b(l)}else if(e instanceof THREE.Line){if(l=r(e,f),c=l.attributes&&T(l),f.verticesNeedUpdate||f.colorsNeedUpdate||f.lineDistancesNeedUpdate||c){var yn,En,xn,Tn,bn,Rn,wn,_n,Hn,Mn,Sn,Cn,An=Q.DYNAMIC_DRAW,Ln=f.vertices,Pn=f.colors,Dn=f.lineDistances,zn=Ln.length,Fn=Pn.length,kn=Dn.length,Nn=f.__vertexArray,Vn=f.__colorArray,In=f.__lineDistanceArray,Bn=f.colorsNeedUpdate,Un=f.lineDistancesNeedUpdate,On=f.__webglCustomAttributesList;if(f.verticesNeedUpdate){for(yn=0;zn>yn;yn++)Tn=Ln[yn],bn=3*yn,Nn[bn]=Tn.x,Nn[bn+1]=Tn.y,Nn[bn+2]=Tn.z;Q.bindBuffer(Q.ARRAY_BUFFER,f.__webglVertexBuffer),Q.bufferData(Q.ARRAY_BUFFER,Nn,An)}if(Bn){for(En=0;Fn>En;En++)Rn=Pn[En],bn=3*En,Vn[bn]=Rn.r,Vn[bn+1]=Rn.g,Vn[bn+2]=Rn.b;Q.bindBuffer(Q.ARRAY_BUFFER,f.__webglColorBuffer),Q.bufferData(Q.ARRAY_BUFFER,Vn,An)}if(Un){for(xn=0;kn>xn;xn++)In[xn]=Dn[xn];Q.bindBuffer(Q.ARRAY_BUFFER,f.__webglLineDistanceBuffer),Q.bufferData(Q.ARRAY_BUFFER,In,An)}if(On)for(wn=0,_n=On.length;_n>wn;wn++)if(Cn=On[wn],Cn.needsUpdate&&(void 0===Cn.boundTo||"vertices"===Cn.boundTo)){if(bn=0,Mn=Cn.value.length,1===Cn.size)for(Hn=0;Mn>Hn;Hn++)Cn.array[Hn]=Cn.value[Hn];else if(2===Cn.size)for(Hn=0;Mn>Hn;Hn++)Sn=Cn.value[Hn],Cn.array[bn]=Sn.x,Cn.array[bn+1]=Sn.y,bn+=2;else if(3===Cn.size)if("c"===Cn.type)for(Hn=0;Mn>Hn;Hn++)Sn=Cn.value[Hn],Cn.array[bn]=Sn.r,Cn.array[bn+1]=Sn.g,Cn.array[bn+2]=Sn.b,bn+=3;else for(Hn=0;Mn>Hn;Hn++)Sn=Cn.value[Hn],Cn.array[bn]=Sn.x,Cn.array[bn+1]=Sn.y,Cn.array[bn+2]=Sn.z,bn+=3;else if(4===Cn.size)for(Hn=0;Mn>Hn;Hn++)Sn=Cn.value[Hn],Cn.array[bn]=Sn.x,Cn.array[bn+1]=Sn.y,Cn.array[bn+2]=Sn.z,Cn.array[bn+3]=Sn.w,bn+=4;Q.bindBuffer(Q.ARRAY_BUFFER,Cn.buffer),Q.bufferData(Q.ARRAY_BUFFER,Cn.array,An)}}f.verticesNeedUpdate=!1,f.colorsNeedUpdate=!1,f.lineDistancesNeedUpdate=!1,l.attributes&&b(l)}else if(e instanceof THREE.PointCloud){if(l=r(e,f),c=l.attributes&&T(l),f.verticesNeedUpdate||f.colorsNeedUpdate||e.sortParticles||c){var Wn,Gn,jn,qn,Xn,Yn,Zn,Kn,Qn,$n,Jn,tr,er=Q.DYNAMIC_DRAW,nr=f.vertices,rr=nr.length,ir=f.colors,or=ir.length,ar=f.__vertexArray,sr=f.__colorArray,hr=f.__sortArray,ur=f.verticesNeedUpdate,cr=f.colorsNeedUpdate,lr=f.__webglCustomAttributesList;if(e.sortParticles){for(De.copy(Pe),De.multiply(e.matrixWorld),Wn=0;rr>Wn;Wn++)jn=nr[Wn],ze.copy(jn),ze.applyProjection(De),hr[Wn]=[ze.z,Wn];for(hr.sort(p),Wn=0;rr>Wn;Wn++)jn=nr[hr[Wn][1]],qn=3*Wn,ar[qn]=jn.x,ar[qn+1]=jn.y,ar[qn+2]=jn.z;for(Gn=0;or>Gn;Gn++)qn=3*Gn,Yn=ir[hr[Gn][1]],sr[qn]=Yn.r,sr[qn+1]=Yn.g,sr[qn+2]=Yn.b;if(lr)for(Zn=0,Kn=lr.length;Kn>Zn;Zn++)if(tr=lr[Zn],void 0===tr.boundTo||"vertices"===tr.boundTo)if(qn=0,$n=tr.value.length,1===tr.size)for(Qn=0;$n>Qn;Qn++)Xn=hr[Qn][1],tr.array[Qn]=tr.value[Xn];else if(2===tr.size)for(Qn=0;$n>Qn;Qn++)Xn=hr[Qn][1],Jn=tr.value[Xn],tr.array[qn]=Jn.x,tr.array[qn+1]=Jn.y,qn+=2;else if(3===tr.size)if("c"===tr.type)for(Qn=0;$n>Qn;Qn++)Xn=hr[Qn][1],Jn=tr.value[Xn],tr.array[qn]=Jn.r,tr.array[qn+1]=Jn.g,tr.array[qn+2]=Jn.b,qn+=3;else for(Qn=0;$n>Qn;Qn++)Xn=hr[Qn][1],Jn=tr.value[Xn],tr.array[qn]=Jn.x,tr.array[qn+1]=Jn.y,tr.array[qn+2]=Jn.z,qn+=3;else if(4===tr.size)for(Qn=0;$n>Qn;Qn++)Xn=hr[Qn][1],Jn=tr.value[Xn],tr.array[qn]=Jn.x,tr.array[qn+1]=Jn.y,tr.array[qn+2]=Jn.z,tr.array[qn+3]=Jn.w,qn+=4}else{if(ur)for(Wn=0;rr>Wn;Wn++)jn=nr[Wn],qn=3*Wn,ar[qn]=jn.x,ar[qn+1]=jn.y,ar[qn+2]=jn.z;if(cr)for(Gn=0;or>Gn;Gn++)Yn=ir[Gn],qn=3*Gn,sr[qn]=Yn.r,sr[qn+1]=Yn.g,sr[qn+2]=Yn.b;if(lr)for(Zn=0,Kn=lr.length;Kn>Zn;Zn++)if(tr=lr[Zn],tr.needsUpdate&&(void 0===tr.boundTo||"vertices"===tr.boundTo))if($n=tr.value.length,qn=0,1===tr.size)for(Qn=0;$n>Qn;Qn++)tr.array[Qn]=tr.value[Qn];else if(2===tr.size)for(Qn=0;$n>Qn;Qn++)Jn=tr.value[Qn],tr.array[qn]=Jn.x,tr.array[qn+1]=Jn.y,qn+=2;else if(3===tr.size)if("c"===tr.type)for(Qn=0;$n>Qn;Qn++)Jn=tr.value[Qn],tr.array[qn]=Jn.r,tr.array[qn+1]=Jn.g,tr.array[qn+2]=Jn.b,qn+=3;else for(Qn=0;$n>Qn;Qn++)Jn=tr.value[Qn],tr.array[qn]=Jn.x,tr.array[qn+1]=Jn.y,tr.array[qn+2]=Jn.z,qn+=3;else if(4===tr.size)for(Qn=0;$n>Qn;Qn++)Jn=tr.value[Qn],tr.array[qn]=Jn.x,tr.array[qn+1]=Jn.y,tr.array[qn+2]=Jn.z,tr.array[qn+3]=Jn.w,qn+=4}if((ur||e.sortParticles)&&(Q.bindBuffer(Q.ARRAY_BUFFER,f.__webglVertexBuffer),Q.bufferData(Q.ARRAY_BUFFER,ar,er)),(cr||e.sortParticles)&&(Q.bindBuffer(Q.ARRAY_BUFFER,f.__webglColorBuffer),Q.bufferData(Q.ARRAY_BUFFER,sr,er)),lr)for(Zn=0,Kn=lr.length;Kn>Zn;Zn++)tr=lr[Zn],(tr.needsUpdate||e.sortParticles)&&(Q.bindBuffer(Q.ARRAY_BUFFER,tr.buffer),Q.bufferData(Q.ARRAY_BUFFER,tr.array,er))}f.verticesNeedUpdate=!1,f.colorsNeedUpdate=!1,l.attributes&&b(l)}for(var fr=0,pr=h.length;pr>fr;fr++){var dr=h[fr],mr=dr,gr=mr.object,vr=mr.buffer,yr=gr.geometry,Er=gr.material;Er instanceof THREE.MeshFaceMaterial?(Er=Er.materials[yr instanceof THREE.BufferGeometry?0:vr.materialIndex],Er.transparent?(mr.material=Er,K.push(mr)):(mr.material=Er,Z.push(mr))):Er&&(Er.transparent?(mr.material=Er,K.push(mr)):(mr.material=Er,Z.push(mr))),dr.render=!0,!0===re.sortObjects&&(null!==e.renderDepth?dr.z=e.renderDepth:(ze.setFromMatrixPosition(e.matrixWorld),ze.applyProjection(Pe),dr.z=ze.z))}}for(fr=0,pr=e.children.length;pr>fr;fr++)d(t,e.children[fr],s)}}function m(t,e,n){if(0!==t.length)for(var r=0,i=t.length;i>r;r++)ue=oe=null,se=he=fe=le=ye=ve=pe=-1,ke=!0,t[r].render(e,n,Me,Se),ue=oe=null,se=he=fe=le=ye=ve=pe=-1,ke=!0}function g(t,e,n,r,i,o){for(var a,s,h,u=t.length-1;-1!==u;u--){if(a=t[u],s=a.object,h=a.buffer,M(s,e),o)a=o;else{if(a=a.material,!a)continue;i&&re.setBlending(a.blending,a.blendEquation,a.blendSrc,a.blendDst),re.setDepthTest(a.depthTest),re.setDepthWrite(a.depthWrite),L(a.polygonOffset,a.polygonOffsetFactor,a.polygonOffsetUnits)}re.setMaterialFaces(a),h instanceof THREE.BufferGeometry?re.renderBufferDirect(e,n,r,a,h,s):re.renderBuffer(e,n,r,a,h,s)}}function v(t,e,n,r,i,o,a){for(var s,h,u=0,c=t.length;c>u;u++)if(s=t[u],h=s.object,h.visible){if(a)s=a;else{if(s=s[e],!s)continue;o&&re.setBlending(s.blending,s.blendEquation,s.blendSrc,s.blendDst),re.setDepthTest(s.depthTest),re.setDepthWrite(s.depthWrite),L(s.polygonOffset,s.polygonOffsetFactor,s.polygonOffsetUnits)}re.renderImmediateObject(n,r,i,s,h)}}function y(t){var e=t.object.material;e.transparent?(t.transparent=e,t.opaque=null):(t.opaque=e,t.transparent=null)}function E(t,e,r){var i,o=!1;i=e.material,(void 0===r.geometryGroups||r.groupsNeedUpdate)&&(delete t.__webglObjects[e.id],r.makeGroups(i instanceof THREE.MeshFaceMaterial,ne?4294967296:65535),r.groupsNeedUpdate=!1);for(var a=0,s=r.geometryGroupsList.length;s>a;a++){if(i=r.geometryGroupsList[a],i.__webglVertexBuffer)o=!1;else{o=i,o.__webglVertexBuffer=Q.createBuffer(),o.__webglNormalBuffer=Q.createBuffer(),o.__webglTangentBuffer=Q.createBuffer(),o.__webglColorBuffer=Q.createBuffer(),o.__webglUVBuffer=Q.createBuffer(),o.__webglUV2Buffer=Q.createBuffer(),o.__webglSkinIndicesBuffer=Q.createBuffer(),o.__webglSkinWeightsBuffer=Q.createBuffer(),o.__webglFaceBuffer=Q.createBuffer(),o.__webglLineBuffer=Q.createBuffer();var h=void 0,u=void 0;if(o.numMorphTargets)for(o.__webglMorphTargetsBuffers=[],h=0,u=o.numMorphTargets;u>h;h++)o.__webglMorphTargetsBuffers.push(Q.createBuffer());if(o.numMorphNormals)for(o.__webglMorphNormalsBuffers=[],h=0,u=o.numMorphNormals;u>h;h++)o.__webglMorphNormalsBuffers.push(Q.createBuffer());re.info.memory.geometries++,n(i,e),r.verticesNeedUpdate=!0,r.morphTargetsNeedUpdate=!0,r.elementsNeedUpdate=!0,r.uvsNeedUpdate=!0,r.normalsNeedUpdate=!0,r.tangentsNeedUpdate=!0,o=r.colorsNeedUpdate=!0}(o||void 0===e.__webglActive)&&x(t.__webglObjects,i,e)}e.__webglActive=!0}function x(t,e,n){var r=n.id;t[r]=t[r]||[],t[r].push({id:r,buffer:e,object:n,material:null,z:0})}function T(t){for(var e in t.attributes)if(t.attributes[e].needsUpdate)return!0;return!1}function b(t){for(var e in t.attributes)t.attributes[e].needsUpdate=!1}function R(t,e){if(t instanceof THREE.Mesh||t instanceof THREE.PointCloud||t instanceof THREE.Line)delete e.__webglObjects[t.id];else if(t instanceof THREE.ImmediateRenderObject||t.immediateRenderCallback)for(var n=e.__webglObjectsImmediate,r=n.length-1;r>=0;r--)n[r].object===t&&n.splice(r,1);delete t.__webglActive}function w(t,e,n,r,i){ce=0,r.needsUpdate&&(r.program&&en(r),re.initMaterial(r,e,n,i),r.needsUpdate=!1),r.morphTargets&&!i.__webglMorphTargetInfluences&&(i.__webglMorphTargetInfluences=new Float32Array(re.maxMorphTargets));var o=!1,a=!1,s=!1,h=r.program,u=h.uniforms,c=r.__webglShader.uniforms;if(h.id!==oe&&(Q.useProgram(h.program),oe=h.id,s=a=o=!0),r.id!==se&&(-1===se&&(s=!0),se=r.id,a=!0),(o||t!==ue)&&(Q.uniformMatrix4fv(u.projectionMatrix,!1,t.projectionMatrix.elements),q&&Q.uniform1f(u.logDepthBufFC,2/(Math.log(t.far+1)/Math.LN2)),t!==ue&&(ue=t),(r instanceof THREE.ShaderMaterial||r instanceof THREE.MeshPhongMaterial||r.envMap)&&null!==u.cameraPosition&&(ze.setFromMatrixPosition(t.matrixWorld),Q.uniform3f(u.cameraPosition,ze.x,ze.y,ze.z)),(r instanceof THREE.MeshPhongMaterial||r instanceof THREE.MeshLambertMaterial||r instanceof THREE.ShaderMaterial||r.skinning)&&null!==u.viewMatrix&&Q.uniformMatrix4fv(u.viewMatrix,!1,t.matrixWorldInverse.elements)),r.skinning&&(i.bindMatrix&&null!==u.bindMatrix&&Q.uniformMatrix4fv(u.bindMatrix,!1,i.bindMatrix.elements),i.bindMatrixInverse&&null!==u.bindMatrixInverse&&Q.uniformMatrix4fv(u.bindMatrixInverse,!1,i.bindMatrixInverse.elements),We&&i.skeleton&&i.skeleton.useVertexTexture?(null!==u.boneTexture&&(o=H(),Q.uniform1i(u.boneTexture,o),re.setTexture(i.skeleton.boneTexture,o)),null!==u.boneTextureWidth&&Q.uniform1i(u.boneTextureWidth,i.skeleton.boneTextureWidth),null!==u.boneTextureHeight&&Q.uniform1i(u.boneTextureHeight,i.skeleton.boneTextureHeight)):i.skeleton&&i.skeleton.boneMatrices&&null!==u.boneGlobalMatrices&&Q.uniformMatrix4fv(u.boneGlobalMatrices,!1,i.skeleton.boneMatrices)),a){if(n&&r.fog&&(c.fogColor.value=n.color,n instanceof THREE.Fog?(c.fogNear.value=n.near,c.fogFar.value=n.far):n instanceof THREE.FogExp2&&(c.fogDensity.value=n.density)),r instanceof THREE.MeshPhongMaterial||r instanceof THREE.MeshLambertMaterial||r.lights){if(ke){var l,f,p,d,s=!0,m=o=0,g=0,v=Ne,y=v.directional.colors,E=v.directional.positions,x=v.point.colors,T=v.point.positions,b=v.point.distances,R=v.spot.colors,w=v.spot.positions,M=v.spot.distances,A=v.spot.directions,L=v.spot.anglesCos,D=v.spot.exponents,z=v.hemi.skyColors,F=v.hemi.groundColors,V=v.hemi.positions,I=0,B=0,U=0,O=0,W=0,G=0,j=0,X=0,Y=l=0;for(n=d=Y=0,a=e.length;a>n;n++)l=e[n],l.onlyShadow||(f=l.color,p=l.intensity,d=l.distance,l instanceof THREE.AmbientLight?l.visible&&(re.gammaInput?(o+=f.r*f.r,m+=f.g*f.g,g+=f.b*f.b):(o+=f.r,m+=f.g,g+=f.b)):l instanceof THREE.DirectionalLight?(W+=1,l.visible&&(Fe.setFromMatrixPosition(l.matrixWorld),ze.setFromMatrixPosition(l.target.matrixWorld),Fe.sub(ze),Fe.normalize(),l=3*I,E[l]=Fe.x,E[l+1]=Fe.y,E[l+2]=Fe.z,re.gammaInput?S(y,l,f,p*p):C(y,l,f,p),I+=1)):l instanceof THREE.PointLight?(G+=1,l.visible&&(Y=3*B,re.gammaInput?S(x,Y,f,p*p):C(x,Y,f,p),ze.setFromMatrixPosition(l.matrixWorld),T[Y]=ze.x,T[Y+1]=ze.y,T[Y+2]=ze.z,b[B]=d,B+=1)):l instanceof THREE.SpotLight?(j+=1,l.visible&&(Y=3*U,re.gammaInput?S(R,Y,f,p*p):C(R,Y,f,p),ze.setFromMatrixPosition(l.matrixWorld),w[Y]=ze.x,w[Y+1]=ze.y,w[Y+2]=ze.z,M[U]=d,Fe.copy(ze),ze.setFromMatrixPosition(l.target.matrixWorld),Fe.sub(ze),Fe.normalize(),A[Y]=Fe.x,A[Y+1]=Fe.y,A[Y+2]=Fe.z,L[U]=Math.cos(l.angle),D[U]=l.exponent,U+=1)):l instanceof THREE.HemisphereLight&&(X+=1,l.visible&&(Fe.setFromMatrixPosition(l.matrixWorld),Fe.normalize(),d=3*O,V[d]=Fe.x,V[d+1]=Fe.y,V[d+2]=Fe.z,f=l.color,l=l.groundColor,re.gammaInput?(p*=p,S(z,d,f,p),S(F,d,l,p)):(C(z,d,f,p),C(F,d,l,p)),O+=1)));for(n=3*I,a=Math.max(y.length,3*W);a>n;n++)y[n]=0;for(n=3*B,a=Math.max(x.length,3*G);a>n;n++)x[n]=0;for(n=3*U,a=Math.max(R.length,3*j);a>n;n++)R[n]=0;for(n=3*O,a=Math.max(z.length,3*X);a>n;n++)z[n]=0;for(n=3*O,a=Math.max(F.length,3*X);a>n;n++)F[n]=0;v.directional.length=I,v.point.length=B,v.spot.length=U,v.hemi.length=O,v.ambient[0]=o,v.ambient[1]=m,v.ambient[2]=g,ke=!1}s?(s=Ne,c.ambientLightColor.value=s.ambient,c.directionalLightColor.value=s.directional.colors,c.directionalLightDirection.value=s.directional.positions,c.pointLightColor.value=s.point.colors,c.pointLightPosition.value=s.point.positions,c.pointLightDistance.value=s.point.distances,c.spotLightColor.value=s.spot.colors,c.spotLightPosition.value=s.spot.positions,c.spotLightDistance.value=s.spot.distances,c.spotLightDirection.value=s.spot.directions,c.spotLightAngleCos.value=s.spot.anglesCos,c.spotLightExponent.value=s.spot.exponents,c.hemisphereLightSkyColor.value=s.hemi.skyColors,c.hemisphereLightGroundColor.value=s.hemi.groundColors,c.hemisphereLightDirection.value=s.hemi.positions,_(c,!0)):_(c,!1)}if(r instanceof THREE.MeshBasicMaterial||r instanceof THREE.MeshLambertMaterial||r instanceof THREE.MeshPhongMaterial){c.opacity.value=r.opacity,re.gammaInput?c.diffuse.value.copyGammaToLinear(r.color):c.diffuse.value=r.color,c.map.value=r.map,c.lightMap.value=r.lightMap,c.specularMap.value=r.specularMap,c.alphaMap.value=r.alphaMap,r.bumpMap&&(c.bumpMap.value=r.bumpMap,c.bumpScale.value=r.bumpScale),r.normalMap&&(c.normalMap.value=r.normalMap,c.normalScale.value.copy(r.normalScale));var Z;r.map?Z=r.map:r.specularMap?Z=r.specularMap:r.normalMap?Z=r.normalMap:r.bumpMap?Z=r.bumpMap:r.alphaMap&&(Z=r.alphaMap),void 0!==Z&&(s=Z.offset,Z=Z.repeat,c.offsetRepeat.value.set(s.x,s.y,Z.x,Z.y)),c.envMap.value=r.envMap,c.flipEnvMap.value=r.envMap instanceof THREE.WebGLRenderTargetCube?1:-1,c.reflectivity.value=r.reflectivity,c.refractionRatio.value=r.refractionRatio,c.combine.value=r.combine,c.useRefract.value=r.envMap&&r.envMap.mapping instanceof THREE.CubeRefractionMapping}if(r instanceof THREE.LineBasicMaterial?(c.diffuse.value=r.color,c.opacity.value=r.opacity):r instanceof THREE.LineDashedMaterial?(c.diffuse.value=r.color,c.opacity.value=r.opacity,c.dashSize.value=r.dashSize,c.totalSize.value=r.dashSize+r.gapSize,c.scale.value=r.scale):r instanceof THREE.PointCloudMaterial?(c.psColor.value=r.color,c.opacity.value=r.opacity,c.size.value=r.size,c.scale.value=N.height/2,c.map.value=r.map):r instanceof THREE.MeshPhongMaterial?(c.shininess.value=r.shininess,re.gammaInput?(c.ambient.value.copyGammaToLinear(r.ambient),c.emissive.value.copyGammaToLinear(r.emissive),c.specular.value.copyGammaToLinear(r.specular)):(c.ambient.value=r.ambient,c.emissive.value=r.emissive,c.specular.value=r.specular),r.wrapAround&&c.wrapRGB.value.copy(r.wrapRGB)):r instanceof THREE.MeshLambertMaterial?(re.gammaInput?(c.ambient.value.copyGammaToLinear(r.ambient),c.emissive.value.copyGammaToLinear(r.emissive)):(c.ambient.value=r.ambient,c.emissive.value=r.emissive),r.wrapAround&&c.wrapRGB.value.copy(r.wrapRGB)):r instanceof THREE.MeshDepthMaterial?(c.mNear.value=t.near,c.mFar.value=t.far,c.opacity.value=r.opacity):r instanceof THREE.MeshNormalMaterial&&(c.opacity.value=r.opacity),i.receiveShadow&&!r._shadowPass&&c.shadowMatrix)for(Z=t=0,s=e.length;s>Z;Z++)n=e[Z],n.castShadow&&(n instanceof THREE.SpotLight||n instanceof THREE.DirectionalLight&&!n.shadowCascade)&&(c.shadowMap.value[t]=n.shadowMap,c.shadowMapSize.value[t]=n.shadowMapSize,c.shadowMatrix.value[t]=n.shadowMatrix,c.shadowDarkness.value[t]=n.shadowDarkness,c.shadowBias.value[t]=n.shadowBias,t++);for(e=r.uniformsList,r=0,c=e.length;c>r;r++)if(t=e[r][0],!1!==t.needsUpdate)switch(n=t.type,s=t.value,Z=e[r][1],n){case"1i":Q.uniform1i(Z,s);break;case"1f":Q.uniform1f(Z,s);break;case"2f":Q.uniform2f(Z,s[0],s[1]);break;case"3f":Q.uniform3f(Z,s[0],s[1],s[2]);break;case"4f":Q.uniform4f(Z,s[0],s[1],s[2],s[3]);break;case"1iv":Q.uniform1iv(Z,s);break;case"3iv":Q.uniform3iv(Z,s);break;case"1fv":Q.uniform1fv(Z,s);break;case"2fv":Q.uniform2fv(Z,s);break;case"3fv":Q.uniform3fv(Z,s);break;case"4fv":Q.uniform4fv(Z,s);break;case"Matrix3fv":Q.uniformMatrix3fv(Z,!1,s);break;case"Matrix4fv":Q.uniformMatrix4fv(Z,!1,s);break;case"i":Q.uniform1i(Z,s);break;case"f":Q.uniform1f(Z,s);break;case"v2":Q.uniform2f(Z,s.x,s.y);break;case"v3":Q.uniform3f(Z,s.x,s.y,s.z);break;case"v4":Q.uniform4f(Z,s.x,s.y,s.z,s.w);break;case"c":Q.uniform3f(Z,s.r,s.g,s.b);break;case"iv1":Q.uniform1iv(Z,s);break;case"iv":Q.uniform3iv(Z,s);break;case"fv1":Q.uniform1fv(Z,s);break;case"fv":Q.uniform3fv(Z,s);break;case"v2v":for(void 0===t._array&&(t._array=new Float32Array(2*s.length)),n=0,a=s.length;a>n;n++)o=2*n,t._array[o]=s[n].x,t._array[o+1]=s[n].y;Q.uniform2fv(Z,t._array);break;case"v3v":for(void 0===t._array&&(t._array=new Float32Array(3*s.length)),n=0,a=s.length;a>n;n++)o=3*n,t._array[o]=s[n].x,t._array[o+1]=s[n].y,t._array[o+2]=s[n].z;Q.uniform3fv(Z,t._array);break;case"v4v":for(void 0===t._array&&(t._array=new Float32Array(4*s.length)),n=0,a=s.length;a>n;n++)o=4*n,t._array[o]=s[n].x,t._array[o+1]=s[n].y,t._array[o+2]=s[n].z,t._array[o+3]=s[n].w;Q.uniform4fv(Z,t._array);break;case"m3":Q.uniformMatrix3fv(Z,!1,s.elements);break;case"m3v":for(void 0===t._array&&(t._array=new Float32Array(9*s.length)),n=0,a=s.length;a>n;n++)s[n].flattenToArrayOffset(t._array,9*n);Q.uniformMatrix3fv(Z,!1,t._array);break;case"m4":Q.uniformMatrix4fv(Z,!1,s.elements);break;case"m4v":for(void 0===t._array&&(t._array=new Float32Array(16*s.length)),n=0,a=s.length;a>n;n++)s[n].flattenToArrayOffset(t._array,16*n);Q.uniformMatrix4fv(Z,!1,t._array);break;case"t":if(o=s,s=H(),Q.uniform1i(Z,s),!o)continue;if(o instanceof THREE.CubeTexture||o.image instanceof Array&&6===o.image.length){if(t=o,Z=s,6===t.image.length)if(t.needsUpdate){for(t.image.__webglTextureCube||(t.addEventListener("dispose",Qe),t.image.__webglTextureCube=Q.createTexture(),re.info.memory.textures++),Q.activeTexture(Q.TEXTURE0+Z),Q.bindTexture(Q.TEXTURE_CUBE_MAP,t.image.__webglTextureCube),Q.pixelStorei(Q.UNPACK_FLIP_Y_WEBGL,t.flipY),Z=t instanceof THREE.CompressedTexture,s=[],n=0;6>n;n++)re.autoScaleCubemaps&&!Z?(a=s,o=n,m=t.image[n],v=Be,m.width<=v&&m.height<=v||(y=Math.max(m.width,m.height),g=Math.floor(m.width*v/y),v=Math.floor(m.height*v/y),y=document.createElement("canvas"),y.width=g,y.height=v,y.getContext("2d").drawImage(m,0,0,m.width,m.height,0,0,g,v),m=y),a[o]=m):s[n]=t.image[n];for(n=s[0],a=THREE.Math.isPowerOfTwo(n.width)&&THREE.Math.isPowerOfTwo(n.height),o=k(t.format),m=k(t.type),P(Q.TEXTURE_CUBE_MAP,t,a),n=0;6>n;n++)if(Z)for(v=s[n].mipmaps,y=0,E=v.length;E>y;y++)g=v[y],t.format!==THREE.RGBAFormat?Q.compressedTexImage2D(Q.TEXTURE_CUBE_MAP_POSITIVE_X+n,y,o,g.width,g.height,0,g.data):Q.texImage2D(Q.TEXTURE_CUBE_MAP_POSITIVE_X+n,y,o,g.width,g.height,0,o,m,g.data);else Q.texImage2D(Q.TEXTURE_CUBE_MAP_POSITIVE_X+n,0,o,o,m,s[n]);t.generateMipmaps&&a&&Q.generateMipmap(Q.TEXTURE_CUBE_MAP),t.needsUpdate=!1,t.onUpdate&&t.onUpdate()}else Q.activeTexture(Q.TEXTURE0+Z),Q.bindTexture(Q.TEXTURE_CUBE_MAP,t.image.__webglTextureCube)}else o instanceof THREE.WebGLRenderTargetCube?(t=o,Q.activeTexture(Q.TEXTURE0+s),Q.bindTexture(Q.TEXTURE_CUBE_MAP,t.__webglTexture)):re.setTexture(o,s);break;case"tv":for(void 0===t._array&&(t._array=[]),n=0,a=t.value.length;a>n;n++)t._array[n]=H();for(Q.uniform1iv(Z,t._array),n=0,a=t.value.length;a>n;n++)o=t.value[n],s=t._array[n],o&&re.setTexture(o,s);break;default:console.warn("THREE.WebGLRenderer: Unknown uniform type: "+n)}}return Q.uniformMatrix4fv(u.modelViewMatrix,!1,i._modelViewMatrix.elements),u.normalMatrix&&Q.uniformMatrix3fv(u.normalMatrix,!1,i._normalMatrix.elements),null!==u.modelMatrix&&Q.uniformMatrix4fv(u.modelMatrix,!1,i.matrixWorld.elements),h}function _(t,e){t.ambientLightColor.needsUpdate=e,t.directionalLightColor.needsUpdate=e,t.directionalLightDirection.needsUpdate=e,t.pointLightColor.needsUpdate=e,t.pointLightPosition.needsUpdate=e,t.pointLightDistance.needsUpdate=e,t.spotLightColor.needsUpdate=e,t.spotLightPosition.needsUpdate=e,t.spotLightDistance.needsUpdate=e,t.spotLightDirection.needsUpdate=e,t.spotLightAngleCos.needsUpdate=e,t.spotLightExponent.needsUpdate=e,t.hemisphereLightSkyColor.needsUpdate=e,t.hemisphereLightGroundColor.needsUpdate=e,t.hemisphereLightDirection.needsUpdate=e}function H(){var t=ce;return t>=Ve&&console.warn("WebGLRenderer: trying to use "+t+" texture units while this GPU supports only "+Ve),ce+=1,t}function M(t,e){t._modelViewMatrix.multiplyMatrices(e.matrixWorldInverse,t.matrixWorld),t._normalMatrix.getNormalMatrix(t._modelViewMatrix)}function S(t,e,n,r){t[e]=n.r*n.r*r,t[e+1]=n.g*n.g*r,t[e+2]=n.b*n.b*r}function C(t,e,n,r){t[e]=n.r*r,t[e+1]=n.g*r,t[e+2]=n.b*r}function A(t){t!==be&&(Q.lineWidth(t),be=t)}function L(t,e,n){Ee!==t&&(t?Q.enable(Q.POLYGON_OFFSET_FILL):Q.disable(Q.POLYGON_OFFSET_FILL),Ee=t),!t||xe===e&&Te===n||(Q.polygonOffset(e,n),xe=e,Te=n)}function P(t,e,n){n?(Q.texParameteri(t,Q.TEXTURE_WRAP_S,k(e.wrapS)),Q.texParameteri(t,Q.TEXTURE_WRAP_T,k(e.wrapT)),Q.texParameteri(t,Q.TEXTURE_MAG_FILTER,k(e.magFilter)),Q.texParameteri(t,Q.TEXTURE_MIN_FILTER,k(e.minFilter))):(Q.texParameteri(t,Q.TEXTURE_WRAP_S,Q.CLAMP_TO_EDGE),Q.texParameteri(t,Q.TEXTURE_WRAP_T,Q.CLAMP_TO_EDGE),Q.texParameteri(t,Q.TEXTURE_MAG_FILTER,F(e.magFilter)),Q.texParameteri(t,Q.TEXTURE_MIN_FILTER,F(e.minFilter))),te&&e.type!==THREE.FloatType&&(1<e.anisotropy||e.__oldAnisotropy)&&(Q.texParameterf(t,te.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(e.anisotropy,Ue)),e.__oldAnisotropy=e.anisotropy)}function D(t,e){Q.bindRenderbuffer(Q.RENDERBUFFER,t),e.depthBuffer&&!e.stencilBuffer?(Q.renderbufferStorage(Q.RENDERBUFFER,Q.DEPTH_COMPONENT16,e.width,e.height),Q.framebufferRenderbuffer(Q.FRAMEBUFFER,Q.DEPTH_ATTACHMENT,Q.RENDERBUFFER,t)):e.depthBuffer&&e.stencilBuffer?(Q.renderbufferStorage(Q.RENDERBUFFER,Q.DEPTH_STENCIL,e.width,e.height),Q.framebufferRenderbuffer(Q.FRAMEBUFFER,Q.DEPTH_STENCIL_ATTACHMENT,Q.RENDERBUFFER,t)):Q.renderbufferStorage(Q.RENDERBUFFER,Q.RGBA4,e.width,e.height)}function z(t){t instanceof THREE.WebGLRenderTargetCube?(Q.bindTexture(Q.TEXTURE_CUBE_MAP,t.__webglTexture),Q.generateMipmap(Q.TEXTURE_CUBE_MAP),Q.bindTexture(Q.TEXTURE_CUBE_MAP,null)):(Q.bindTexture(Q.TEXTURE_2D,t.__webglTexture),Q.generateMipmap(Q.TEXTURE_2D),Q.bindTexture(Q.TEXTURE_2D,null))}function F(t){return t===THREE.NearestFilter||t===THREE.NearestMipMapNearestFilter||t===THREE.NearestMipMapLinearFilter?Q.NEAREST:Q.LINEAR}function k(t){if(t===THREE.RepeatWrapping)return Q.REPEAT;if(t===THREE.ClampToEdgeWrapping)return Q.CLAMP_TO_EDGE;
if(t===THREE.MirroredRepeatWrapping)return Q.MIRRORED_REPEAT;if(t===THREE.NearestFilter)return Q.NEAREST;if(t===THREE.NearestMipMapNearestFilter)return Q.NEAREST_MIPMAP_NEAREST;if(t===THREE.NearestMipMapLinearFilter)return Q.NEAREST_MIPMAP_LINEAR;if(t===THREE.LinearFilter)return Q.LINEAR;if(t===THREE.LinearMipMapNearestFilter)return Q.LINEAR_MIPMAP_NEAREST;if(t===THREE.LinearMipMapLinearFilter)return Q.LINEAR_MIPMAP_LINEAR;if(t===THREE.UnsignedByteType)return Q.UNSIGNED_BYTE;if(t===THREE.UnsignedShort4444Type)return Q.UNSIGNED_SHORT_4_4_4_4;if(t===THREE.UnsignedShort5551Type)return Q.UNSIGNED_SHORT_5_5_5_1;if(t===THREE.UnsignedShort565Type)return Q.UNSIGNED_SHORT_5_6_5;if(t===THREE.ByteType)return Q.BYTE;if(t===THREE.ShortType)return Q.SHORT;if(t===THREE.UnsignedShortType)return Q.UNSIGNED_SHORT;if(t===THREE.IntType)return Q.INT;if(t===THREE.UnsignedIntType)return Q.UNSIGNED_INT;if(t===THREE.FloatType)return Q.FLOAT;if(t===THREE.AlphaFormat)return Q.ALPHA;if(t===THREE.RGBFormat)return Q.RGB;if(t===THREE.RGBAFormat)return Q.RGBA;if(t===THREE.LuminanceFormat)return Q.LUMINANCE;if(t===THREE.LuminanceAlphaFormat)return Q.LUMINANCE_ALPHA;if(t===THREE.AddEquation)return Q.FUNC_ADD;if(t===THREE.SubtractEquation)return Q.FUNC_SUBTRACT;if(t===THREE.ReverseSubtractEquation)return Q.FUNC_REVERSE_SUBTRACT;if(t===THREE.ZeroFactor)return Q.ZERO;if(t===THREE.OneFactor)return Q.ONE;if(t===THREE.SrcColorFactor)return Q.SRC_COLOR;if(t===THREE.OneMinusSrcColorFactor)return Q.ONE_MINUS_SRC_COLOR;if(t===THREE.SrcAlphaFactor)return Q.SRC_ALPHA;if(t===THREE.OneMinusSrcAlphaFactor)return Q.ONE_MINUS_SRC_ALPHA;if(t===THREE.DstAlphaFactor)return Q.DST_ALPHA;if(t===THREE.OneMinusDstAlphaFactor)return Q.ONE_MINUS_DST_ALPHA;if(t===THREE.DstColorFactor)return Q.DST_COLOR;if(t===THREE.OneMinusDstColorFactor)return Q.ONE_MINUS_DST_COLOR;if(t===THREE.SrcAlphaSaturateFactor)return Q.SRC_ALPHA_SATURATE;if(void 0!==ee){if(t===THREE.RGB_S3TC_DXT1_Format)return ee.COMPRESSED_RGB_S3TC_DXT1_EXT;if(t===THREE.RGBA_S3TC_DXT1_Format)return ee.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(t===THREE.RGBA_S3TC_DXT3_Format)return ee.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(t===THREE.RGBA_S3TC_DXT5_Format)return ee.COMPRESSED_RGBA_S3TC_DXT5_EXT}return 0}console.log("THREE.WebGLRenderer",THREE.REVISION),t=t||{};var N=void 0!==t.canvas?t.canvas:document.createElement("canvas"),V=void 0!==t.context?t.context:null,I=void 0!==t.precision?t.precision:"highp",B=void 0!==t.alpha?t.alpha:!1,U=void 0!==t.depth?t.depth:!0,O=void 0!==t.stencil?t.stencil:!0,W=void 0!==t.antialias?t.antialias:!1,G=void 0!==t.premultipliedAlpha?t.premultipliedAlpha:!0,j=void 0!==t.preserveDrawingBuffer?t.preserveDrawingBuffer:!1,q=void 0!==t.logarithmicDepthBuffer?t.logarithmicDepthBuffer:!1,X=new THREE.Color(0),Y=0,Z=[],K=[];this.domElement=N,this.context=null,this.devicePixelRatio=void 0!==t.devicePixelRatio?t.devicePixelRatio:void 0!==self.devicePixelRatio?self.devicePixelRatio:1,this.sortObjects=this.autoClearStencil=this.autoClearDepth=this.autoClearColor=this.autoClear=!0,this.shadowMapEnabled=this.gammaOutput=this.gammaInput=!1,this.shadowMapAutoUpdate=!0,this.shadowMapType=THREE.PCFShadowMap,this.shadowMapCullFace=THREE.CullFaceFront,this.shadowMapCascade=this.shadowMapDebug=!1,this.maxMorphTargets=8,this.maxMorphNormals=4,this.autoScaleCubemaps=!0,this.renderPluginsPre=[],this.renderPluginsPost=[],this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}};var Q,$,J,te,ee,ne,re=this,ie=[],oe=null,ae=null,se=-1,he=null,ue=null,ce=0,le=-1,fe=-1,pe=-1,de=-1,me=-1,ge=-1,ve=-1,ye=-1,Ee=null,xe=null,Te=null,be=null,Re=0,we=0,_e=N.width,He=N.height,Me=0,Se=0,Ce=new Uint8Array(16),Ae=new Uint8Array(16),Le=new THREE.Frustum,Pe=new THREE.Matrix4,De=new THREE.Matrix4,ze=new THREE.Vector3,Fe=new THREE.Vector3,ke=!0,Ne={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[]},spot:{length:0,colors:[],positions:[],distances:[],directions:[],anglesCos:[],exponents:[]},hemi:{length:0,skyColors:[],groundColors:[],positions:[]}};!function(){try{var t={alpha:B,depth:U,stencil:O,antialias:W,premultipliedAlpha:G,preserveDrawingBuffer:j};if(Q=V||N.getContext("webgl",t)||N.getContext("experimental-webgl",t),null===Q)throw"Error creating WebGL context."}catch(e){console.error(e)}$=Q.getExtension("OES_texture_float"),Q.getExtension("OES_texture_float_linear"),J=Q.getExtension("OES_standard_derivatives"),te=Q.getExtension("EXT_texture_filter_anisotropic")||Q.getExtension("MOZ_EXT_texture_filter_anisotropic")||Q.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),ee=Q.getExtension("WEBGL_compressed_texture_s3tc")||Q.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||Q.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),ne=Q.getExtension("OES_element_index_uint"),null===$&&console.log("THREE.WebGLRenderer: Float textures not supported."),null===J&&console.log("THREE.WebGLRenderer: Standard derivatives not supported."),null===te&&console.log("THREE.WebGLRenderer: Anisotropic texture filtering not supported."),null===ee&&console.log("THREE.WebGLRenderer: S3TC compressed textures not supported."),null===ne&&console.log("THREE.WebGLRenderer: elementindex as unsigned integer not supported."),void 0===Q.getShaderPrecisionFormat&&(Q.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}}),q&&Q.getExtension("EXT_frag_depth")}(),Q.clearColor(0,0,0,1),Q.clearDepth(1),Q.clearStencil(0),Q.enable(Q.DEPTH_TEST),Q.depthFunc(Q.LEQUAL),Q.frontFace(Q.CCW),Q.cullFace(Q.BACK),Q.enable(Q.CULL_FACE),Q.enable(Q.BLEND),Q.blendEquation(Q.FUNC_ADD),Q.blendFunc(Q.SRC_ALPHA,Q.ONE_MINUS_SRC_ALPHA),Q.viewport(Re,we,_e,He),Q.clearColor(X.r,X.g,X.b,Y),this.context=Q;var Ve=Q.getParameter(Q.MAX_TEXTURE_IMAGE_UNITS),Ie=Q.getParameter(Q.MAX_VERTEX_TEXTURE_IMAGE_UNITS);Q.getParameter(Q.MAX_TEXTURE_SIZE);var Be=Q.getParameter(Q.MAX_CUBE_MAP_TEXTURE_SIZE),Ue=te?Q.getParameter(te.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,Oe=Ie>0,We=Oe&&$;ee&&Q.getParameter(Q.COMPRESSED_TEXTURE_FORMATS);var Ge=Q.getShaderPrecisionFormat(Q.VERTEX_SHADER,Q.HIGH_FLOAT),je=Q.getShaderPrecisionFormat(Q.VERTEX_SHADER,Q.MEDIUM_FLOAT);Q.getShaderPrecisionFormat(Q.VERTEX_SHADER,Q.LOW_FLOAT);var qe=Q.getShaderPrecisionFormat(Q.FRAGMENT_SHADER,Q.HIGH_FLOAT),Xe=Q.getShaderPrecisionFormat(Q.FRAGMENT_SHADER,Q.MEDIUM_FLOAT);Q.getShaderPrecisionFormat(Q.FRAGMENT_SHADER,Q.LOW_FLOAT);var Ye=0<Ge.precision&&0<qe.precision,Ze=0<je.precision&&0<Xe.precision;"highp"!==I||Ye||(Ze?(I="mediump",console.warn("THREE.WebGLRenderer: highp not supported, using mediump.")):(I="lowp",console.warn("THREE.WebGLRenderer: highp and mediump not supported, using lowp."))),"mediump"!==I||Ze||(I="lowp",console.warn("THREE.WebGLRenderer: mediump not supported, using lowp.")),this.getContext=function(){return Q},this.supportsVertexTextures=function(){return Oe},this.supportsFloatTextures=function(){return $},this.supportsStandardDerivatives=function(){return J},this.supportsCompressedTextureS3TC=function(){return ee},this.getMaxAnisotropy=function(){return Ue},this.getPrecision=function(){return I},this.setSize=function(t,e,n){N.width=t*this.devicePixelRatio,N.height=e*this.devicePixelRatio,!1!==n&&(N.style.width=t+"px",N.style.height=e+"px"),this.setViewport(0,0,t,e)},this.setViewport=function(t,e,n,r){Re=t*this.devicePixelRatio,we=e*this.devicePixelRatio,_e=n*this.devicePixelRatio,He=r*this.devicePixelRatio,Q.viewport(Re,we,_e,He)},this.setScissor=function(t,e,n,r){Q.scissor(t*this.devicePixelRatio,e*this.devicePixelRatio,n*this.devicePixelRatio,r*this.devicePixelRatio)},this.enableScissorTest=function(t){t?Q.enable(Q.SCISSOR_TEST):Q.disable(Q.SCISSOR_TEST)},this.setClearColor=function(t,e){X.set(t),Y=void 0!==e?e:1,Q.clearColor(X.r,X.g,X.b,Y)},this.setClearColorHex=function(t,e){console.warn("THREE.WebGLRenderer: .setClearColorHex() is being removed. Use .setClearColor() instead."),this.setClearColor(t,e)},this.getClearColor=function(){return X},this.getClearAlpha=function(){return Y},this.clear=function(t,e,n){var r=0;(void 0===t||t)&&(r|=Q.COLOR_BUFFER_BIT),(void 0===e||e)&&(r|=Q.DEPTH_BUFFER_BIT),(void 0===n||n)&&(r|=Q.STENCIL_BUFFER_BIT),Q.clear(r)},this.clearColor=function(){Q.clear(Q.COLOR_BUFFER_BIT)},this.clearDepth=function(){Q.clear(Q.DEPTH_BUFFER_BIT)},this.clearStencil=function(){Q.clear(Q.STENCIL_BUFFER_BIT)},this.clearTarget=function(t,e,n,r){this.setRenderTarget(t),this.clear(e,n,r)},this.addPostPlugin=function(t){t.init(this),this.renderPluginsPost.push(t)},this.addPrePlugin=function(t){t.init(this),this.renderPluginsPre.push(t)},this.updateShadowMap=function(t,e){oe=null,se=he=ye=ve=pe=-1,ke=!0,fe=le=-1,nn(t),this.shadowMapPlugin.update(t,e)};var Ke=function(t){if(t=t.target,t.removeEventListener("dispose",Ke),t.__webglInit=void 0,t instanceof THREE.BufferGeometry){t=t.attributes;for(var e in t)void 0!==t[e].buffer&&Q.deleteBuffer(t[e].buffer);re.info.memory.geometries--}else if(void 0!==t.geometryGroups){e=0;for(var n=t.geometryGroupsList.length;n>e;e++){var r=t.geometryGroupsList[e];if(void 0!==r.numMorphTargets)for(var i=0,o=r.numMorphTargets;o>i;i++)Q.deleteBuffer(r.__webglMorphTargetsBuffers[i]);if(void 0!==r.numMorphNormals)for(i=0,o=r.numMorphNormals;o>i;i++)Q.deleteBuffer(r.__webglMorphNormalsBuffers[i]);tn(r)}}else tn(t)},Qe=function(t){t=t.target,t.removeEventListener("dispose",Qe),t.image&&t.image.__webglTextureCube?Q.deleteTexture(t.image.__webglTextureCube):t.__webglInit&&(t.__webglInit=!1,Q.deleteTexture(t.__webglTexture)),re.info.memory.textures--},$e=function(t){if(t=t.target,t.removeEventListener("dispose",$e),t&&t.__webglTexture)if(Q.deleteTexture(t.__webglTexture),t instanceof THREE.WebGLRenderTargetCube)for(var e=0;6>e;e++)Q.deleteFramebuffer(t.__webglFramebuffer[e]),Q.deleteRenderbuffer(t.__webglRenderbuffer[e]);else Q.deleteFramebuffer(t.__webglFramebuffer),Q.deleteRenderbuffer(t.__webglRenderbuffer);re.info.memory.textures--},Je=function(t){t=t.target,t.removeEventListener("dispose",Je),en(t)},tn=function(t){if(void 0!==t.__webglVertexBuffer&&Q.deleteBuffer(t.__webglVertexBuffer),void 0!==t.__webglNormalBuffer&&Q.deleteBuffer(t.__webglNormalBuffer),void 0!==t.__webglTangentBuffer&&Q.deleteBuffer(t.__webglTangentBuffer),void 0!==t.__webglColorBuffer&&Q.deleteBuffer(t.__webglColorBuffer),void 0!==t.__webglUVBuffer&&Q.deleteBuffer(t.__webglUVBuffer),void 0!==t.__webglUV2Buffer&&Q.deleteBuffer(t.__webglUV2Buffer),void 0!==t.__webglSkinIndicesBuffer&&Q.deleteBuffer(t.__webglSkinIndicesBuffer),void 0!==t.__webglSkinWeightsBuffer&&Q.deleteBuffer(t.__webglSkinWeightsBuffer),void 0!==t.__webglFaceBuffer&&Q.deleteBuffer(t.__webglFaceBuffer),void 0!==t.__webglLineBuffer&&Q.deleteBuffer(t.__webglLineBuffer),void 0!==t.__webglLineDistanceBuffer&&Q.deleteBuffer(t.__webglLineDistanceBuffer),void 0!==t.__webglCustomAttributesList)for(var e in t.__webglCustomAttributesList)Q.deleteBuffer(t.__webglCustomAttributesList[e].buffer);re.info.memory.geometries--},en=function(t){var e=t.program.program;if(void 0!==e){t.program=void 0;var n,r,i=!1;for(t=0,n=ie.length;n>t;t++)if(r=ie[t],r.program===e){r.usedTimes--,0===r.usedTimes&&(i=!0);break}if(!0===i){for(i=[],t=0,n=ie.length;n>t;t++)r=ie[t],r.program!==e&&i.push(r);ie=i,Q.deleteProgram(e),re.info.memory.programs--}}};this.renderBufferImmediate=function(t,e,n){if(h(),t.hasPositions&&!t.__webglVertexBuffer&&(t.__webglVertexBuffer=Q.createBuffer()),t.hasNormals&&!t.__webglNormalBuffer&&(t.__webglNormalBuffer=Q.createBuffer()),t.hasUvs&&!t.__webglUvBuffer&&(t.__webglUvBuffer=Q.createBuffer()),t.hasColors&&!t.__webglColorBuffer&&(t.__webglColorBuffer=Q.createBuffer()),t.hasPositions&&(Q.bindBuffer(Q.ARRAY_BUFFER,t.__webglVertexBuffer),Q.bufferData(Q.ARRAY_BUFFER,t.positionArray,Q.DYNAMIC_DRAW),u(e.attributes.position),Q.vertexAttribPointer(e.attributes.position,3,Q.FLOAT,!1,0,0)),t.hasNormals){if(Q.bindBuffer(Q.ARRAY_BUFFER,t.__webglNormalBuffer),n.shading===THREE.FlatShading){var r,i,o,a,s,l,f,p,d,m,g,v=3*t.count;for(g=0;v>g;g+=9)m=t.normalArray,r=m[g],i=m[g+1],o=m[g+2],a=m[g+3],l=m[g+4],p=m[g+5],s=m[g+6],f=m[g+7],d=m[g+8],r=(r+a+s)/3,i=(i+l+f)/3,o=(o+p+d)/3,m[g]=r,m[g+1]=i,m[g+2]=o,m[g+3]=r,m[g+4]=i,m[g+5]=o,m[g+6]=r,m[g+7]=i,m[g+8]=o}Q.bufferData(Q.ARRAY_BUFFER,t.normalArray,Q.DYNAMIC_DRAW),u(e.attributes.normal),Q.vertexAttribPointer(e.attributes.normal,3,Q.FLOAT,!1,0,0)}t.hasUvs&&n.map&&(Q.bindBuffer(Q.ARRAY_BUFFER,t.__webglUvBuffer),Q.bufferData(Q.ARRAY_BUFFER,t.uvArray,Q.DYNAMIC_DRAW),u(e.attributes.uv),Q.vertexAttribPointer(e.attributes.uv,2,Q.FLOAT,!1,0,0)),t.hasColors&&n.vertexColors!==THREE.NoColors&&(Q.bindBuffer(Q.ARRAY_BUFFER,t.__webglColorBuffer),Q.bufferData(Q.ARRAY_BUFFER,t.colorArray,Q.DYNAMIC_DRAW),u(e.attributes.color),Q.vertexAttribPointer(e.attributes.color,3,Q.FLOAT,!1,0,0)),c(),Q.drawArrays(Q.TRIANGLES,0,t.count),t.count=0},this.renderBufferDirect=function(t,e,n,r,i,o){if(!1!==r.visible){var a=w(t,e,n,r,o);if(t=a.attributes,e=i.attributes,n=!1,a=16777215*i.id+2*a.id+(r.wireframe?1:0),a!==he&&(he=a,n=!0),n&&h(),o instanceof THREE.Mesh)if(a=e.index){var u,c;if(a.array instanceof Uint32Array?(u=Q.UNSIGNED_INT,c=4):(u=Q.UNSIGNED_SHORT,c=2),i=i.offsets,0===i.length)n&&(s(r,t,e,0),Q.bindBuffer(Q.ELEMENT_ARRAY_BUFFER,a.buffer)),Q.drawElements(Q.TRIANGLES,a.array.length,u,0),re.info.render.calls++,re.info.render.vertices+=a.array.length,re.info.render.faces+=a.array.length/3;else{n=!0;for(var l=0,f=i.length;f>l;l++){var p=i[l].index;n&&(s(r,t,e,p),Q.bindBuffer(Q.ELEMENT_ARRAY_BUFFER,a.buffer)),Q.drawElements(Q.TRIANGLES,i[l].count,u,i[l].start*c),re.info.render.calls++,re.info.render.vertices+=i[l].count,re.info.render.faces+=i[l].count/3}}}else n&&s(r,t,e,0),r=i.attributes.position,Q.drawArrays(Q.TRIANGLES,0,r.array.length/3),re.info.render.calls++,re.info.render.vertices+=r.array.length/3,re.info.render.faces+=r.array.length/9;else if(o instanceof THREE.PointCloud)n&&s(r,t,e,0),r=e.position,Q.drawArrays(Q.POINTS,0,r.array.length/3),re.info.render.calls++,re.info.render.points+=r.array.length/3;else if(o instanceof THREE.Line)if(o=o.type===THREE.LineStrip?Q.LINE_STRIP:Q.LINES,A(r.linewidth),a=e.index)if(a.array instanceof Uint32Array?(u=Q.UNSIGNED_INT,c=4):(u=Q.UNSIGNED_SHORT,c=2),i=i.offsets,0===i.length)n&&(s(r,t,e,0),Q.bindBuffer(Q.ELEMENT_ARRAY_BUFFER,a.buffer)),Q.drawElements(o,a.array.length,u,0),re.info.render.calls++,re.info.render.vertices+=a.array.length;else for(1<i.length&&(n=!0),l=0,f=i.length;f>l;l++)p=i[l].index,n&&(s(r,t,e,p),Q.bindBuffer(Q.ELEMENT_ARRAY_BUFFER,a.buffer)),Q.drawElements(o,i[l].count,u,i[l].start*c),re.info.render.calls++,re.info.render.vertices+=i[l].count;else n&&s(r,t,e,0),r=e.position,Q.drawArrays(o,0,r.array.length/3),re.info.render.calls++,re.info.render.points+=r.array.length/3}},this.renderBuffer=function(t,e,n,r,i,o){if(!1!==r.visible){var a,s;if(n=w(t,e,n,r,o),e=n.attributes,t=!1,n=16777215*i.id+2*n.id+(r.wireframe?1:0),n!==he&&(he=n,t=!0),t&&h(),!r.morphTargets&&0<=e.position)t&&(Q.bindBuffer(Q.ARRAY_BUFFER,i.__webglVertexBuffer),u(e.position),Q.vertexAttribPointer(e.position,3,Q.FLOAT,!1,0,0));else if(o.morphTargetBase){if(n=r.program.attributes,-1!==o.morphTargetBase&&0<=n.position?(Q.bindBuffer(Q.ARRAY_BUFFER,i.__webglMorphTargetsBuffers[o.morphTargetBase]),u(n.position),Q.vertexAttribPointer(n.position,3,Q.FLOAT,!1,0,0)):0<=n.position&&(Q.bindBuffer(Q.ARRAY_BUFFER,i.__webglVertexBuffer),u(n.position),Q.vertexAttribPointer(n.position,3,Q.FLOAT,!1,0,0)),o.morphTargetForcedOrder.length){var l=0;for(s=o.morphTargetForcedOrder,a=o.morphTargetInfluences;l<r.numSupportedMorphTargets&&l<s.length;)0<=n["morphTarget"+l]&&(Q.bindBuffer(Q.ARRAY_BUFFER,i.__webglMorphTargetsBuffers[s[l]]),u(n["morphTarget"+l]),Q.vertexAttribPointer(n["morphTarget"+l],3,Q.FLOAT,!1,0,0)),0<=n["morphNormal"+l]&&r.morphNormals&&(Q.bindBuffer(Q.ARRAY_BUFFER,i.__webglMorphNormalsBuffers[s[l]]),u(n["morphNormal"+l]),Q.vertexAttribPointer(n["morphNormal"+l],3,Q.FLOAT,!1,0,0)),o.__webglMorphTargetInfluences[l]=a[s[l]],l++}else{s=[],a=o.morphTargetInfluences;var f,d=a.length;for(f=0;d>f;f++)l=a[f],l>0&&s.push([l,f]);for(s.length>r.numSupportedMorphTargets?(s.sort(p),s.length=r.numSupportedMorphTargets):s.length>r.numSupportedMorphNormals?s.sort(p):0===s.length&&s.push([0,0]),l=0;l<r.numSupportedMorphTargets;)s[l]?(f=s[l][1],0<=n["morphTarget"+l]&&(Q.bindBuffer(Q.ARRAY_BUFFER,i.__webglMorphTargetsBuffers[f]),u(n["morphTarget"+l]),Q.vertexAttribPointer(n["morphTarget"+l],3,Q.FLOAT,!1,0,0)),0<=n["morphNormal"+l]&&r.morphNormals&&(Q.bindBuffer(Q.ARRAY_BUFFER,i.__webglMorphNormalsBuffers[f]),u(n["morphNormal"+l]),Q.vertexAttribPointer(n["morphNormal"+l],3,Q.FLOAT,!1,0,0)),o.__webglMorphTargetInfluences[l]=a[f]):o.__webglMorphTargetInfluences[l]=0,l++}null!==r.program.uniforms.morphTargetInfluences&&Q.uniform1fv(r.program.uniforms.morphTargetInfluences,o.__webglMorphTargetInfluences)}if(t){if(i.__webglCustomAttributesList)for(a=0,s=i.__webglCustomAttributesList.length;s>a;a++)n=i.__webglCustomAttributesList[a],0<=e[n.buffer.belongsToAttribute]&&(Q.bindBuffer(Q.ARRAY_BUFFER,n.buffer),u(e[n.buffer.belongsToAttribute]),Q.vertexAttribPointer(e[n.buffer.belongsToAttribute],n.size,Q.FLOAT,!1,0,0));0<=e.color&&(0<o.geometry.colors.length||0<o.geometry.faces.length?(Q.bindBuffer(Q.ARRAY_BUFFER,i.__webglColorBuffer),u(e.color),Q.vertexAttribPointer(e.color,3,Q.FLOAT,!1,0,0)):r.defaultAttributeValues&&Q.vertexAttrib3fv(e.color,r.defaultAttributeValues.color)),0<=e.normal&&(Q.bindBuffer(Q.ARRAY_BUFFER,i.__webglNormalBuffer),u(e.normal),Q.vertexAttribPointer(e.normal,3,Q.FLOAT,!1,0,0)),0<=e.tangent&&(Q.bindBuffer(Q.ARRAY_BUFFER,i.__webglTangentBuffer),u(e.tangent),Q.vertexAttribPointer(e.tangent,4,Q.FLOAT,!1,0,0)),0<=e.uv&&(o.geometry.faceVertexUvs[0]?(Q.bindBuffer(Q.ARRAY_BUFFER,i.__webglUVBuffer),u(e.uv),Q.vertexAttribPointer(e.uv,2,Q.FLOAT,!1,0,0)):r.defaultAttributeValues&&Q.vertexAttrib2fv(e.uv,r.defaultAttributeValues.uv)),0<=e.uv2&&(o.geometry.faceVertexUvs[1]?(Q.bindBuffer(Q.ARRAY_BUFFER,i.__webglUV2Buffer),u(e.uv2),Q.vertexAttribPointer(e.uv2,2,Q.FLOAT,!1,0,0)):r.defaultAttributeValues&&Q.vertexAttrib2fv(e.uv2,r.defaultAttributeValues.uv2)),r.skinning&&0<=e.skinIndex&&0<=e.skinWeight&&(Q.bindBuffer(Q.ARRAY_BUFFER,i.__webglSkinIndicesBuffer),u(e.skinIndex),Q.vertexAttribPointer(e.skinIndex,4,Q.FLOAT,!1,0,0),Q.bindBuffer(Q.ARRAY_BUFFER,i.__webglSkinWeightsBuffer),u(e.skinWeight),Q.vertexAttribPointer(e.skinWeight,4,Q.FLOAT,!1,0,0)),0<=e.lineDistance&&(Q.bindBuffer(Q.ARRAY_BUFFER,i.__webglLineDistanceBuffer),u(e.lineDistance),Q.vertexAttribPointer(e.lineDistance,1,Q.FLOAT,!1,0,0))}c(),o instanceof THREE.Mesh?(o=i.__typeArray===Uint32Array?Q.UNSIGNED_INT:Q.UNSIGNED_SHORT,r.wireframe?(A(r.wireframeLinewidth),t&&Q.bindBuffer(Q.ELEMENT_ARRAY_BUFFER,i.__webglLineBuffer),Q.drawElements(Q.LINES,i.__webglLineCount,o,0)):(t&&Q.bindBuffer(Q.ELEMENT_ARRAY_BUFFER,i.__webglFaceBuffer),Q.drawElements(Q.TRIANGLES,i.__webglFaceCount,o,0)),re.info.render.calls++,re.info.render.vertices+=i.__webglFaceCount,re.info.render.faces+=i.__webglFaceCount/3):o instanceof THREE.Line?(o=o.type===THREE.LineStrip?Q.LINE_STRIP:Q.LINES,A(r.linewidth),Q.drawArrays(o,0,i.__webglLineCount),re.info.render.calls++):o instanceof THREE.PointCloud&&(Q.drawArrays(Q.POINTS,0,i.__webglParticleCount),re.info.render.calls++,re.info.render.points+=i.__webglParticleCount)}},this.render=function(t,e,n,r){function i(t){t instanceof THREE.SkinnedMesh&&t.skeleton.update();for(var e=0,n=t.children.length;n>e;e++)i(t.children[e])}if(!1==e instanceof THREE.Camera)console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");else{var o,a,s,h,u=t.__lights,c=t.fog;for(se=-1,ue=null,ke=!0,!0===t.autoUpdate&&t.updateMatrixWorld(),void 0===e.parent&&e.updateMatrixWorld(),i(t),e.matrixWorldInverse.getInverse(e.matrixWorld),Pe.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),Le.setFromMatrix(Pe),nn(t),Z.length=0,K.length=0,d(t,t,e),!0===re.sortObjects&&(Z.sort(l),K.sort(f)),m(this.renderPluginsPre,t,e),re.info.render.calls=0,re.info.render.vertices=0,re.info.render.faces=0,re.info.render.points=0,this.setRenderTarget(n),(this.autoClear||r)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil),h=t.__webglObjectsImmediate,r=0,o=h.length;o>r;r++)a=h[r],s=a.object,s.visible&&(M(s,e),y(a));t.overrideMaterial?(r=t.overrideMaterial,this.setBlending(r.blending,r.blendEquation,r.blendSrc,r.blendDst),this.setDepthTest(r.depthTest),this.setDepthWrite(r.depthWrite),L(r.polygonOffset,r.polygonOffsetFactor,r.polygonOffsetUnits),g(Z,e,u,c,!0,r),g(K,e,u,c,!0,r),v(t.__webglObjectsImmediate,"",e,u,c,!1,r)):(r=null,this.setBlending(THREE.NoBlending),g(Z,e,u,c,!1,r),v(t.__webglObjectsImmediate,"opaque",e,u,c,!1,r),g(K,e,u,c,!0,r),v(t.__webglObjectsImmediate,"transparent",e,u,c,!0,r)),m(this.renderPluginsPost,t,e),n&&n.generateMipmaps&&n.minFilter!==THREE.NearestFilter&&n.minFilter!==THREE.LinearFilter&&z(n),this.setDepthTest(!0),this.setDepthWrite(!0)}},this.renderImmediateObject=function(t,e,n,r,i){var o=w(t,e,n,r,i);he=-1,re.setMaterialFaces(r),i.immediateRenderCallback?i.immediateRenderCallback(o,Q,Le):i.render(function(t){re.renderBufferImmediate(t,o,r)})};var nn=function(t){for(t.__webglObjects||(t.__webglObjects={},t.__webglObjectsImmediate=[]);t.__objectsAdded.length;){var n=t.__objectsAdded[0],r=t,i=void 0,o=void 0;if(void 0===n.__webglInit&&(n.__webglInit=!0,n._modelViewMatrix=new THREE.Matrix4,n._normalMatrix=new THREE.Matrix3),i=n.geometry,void 0!==i&&void 0===i.__webglInit)if(i.__webglInit=!0,i.addEventListener("dispose",Ke),i instanceof THREE.BufferGeometry)a(i);else if(n instanceof THREE.Mesh)void 0!==n.__webglActive&&R(n,r),E(r,n,i);else if(n instanceof THREE.Line){if(!i.__webglVertexBuffer){o=i,o.__webglVertexBuffer=Q.createBuffer(),o.__webglColorBuffer=Q.createBuffer(),o.__webglLineDistanceBuffer=Q.createBuffer(),re.info.memory.geometries++;var o=i,s=n,h=o.vertices.length;o.__vertexArray=new Float32Array(3*h),o.__colorArray=new Float32Array(3*h),o.__lineDistanceArray=new Float32Array(1*h),o.__webglLineCount=h,e(o,s),i.verticesNeedUpdate=!0,i.colorsNeedUpdate=!0,i.lineDistancesNeedUpdate=!0}}else n instanceof THREE.PointCloud&&!i.__webglVertexBuffer&&(o=i,o.__webglVertexBuffer=Q.createBuffer(),o.__webglColorBuffer=Q.createBuffer(),re.info.memory.geometries++,o=i,s=n,h=o.vertices.length,o.__vertexArray=new Float32Array(3*h),o.__colorArray=new Float32Array(3*h),o.__sortArray=[],o.__webglParticleCount=h,e(o,s),i.verticesNeedUpdate=!0,i.colorsNeedUpdate=!0);if(void 0===n.__webglActive){if(n instanceof THREE.Mesh){if(i=n.geometry,i instanceof THREE.BufferGeometry)x(r.__webglObjects,i,n);else if(i instanceof THREE.Geometry)for(s=0,h=i.geometryGroupsList.length;h>s;s++)o=i.geometryGroupsList[s],x(r.__webglObjects,o,n)}else n instanceof THREE.Line||n instanceof THREE.PointCloud?(i=n.geometry,x(r.__webglObjects,i,n)):(n instanceof THREE.ImmediateRenderObject||n.immediateRenderCallback)&&r.__webglObjectsImmediate.push({id:null,object:n,opaque:null,transparent:null,z:0});n.__webglActive=!0}t.__objectsAdded.splice(0,1)}for(;t.__objectsRemoved.length;)R(t.__objectsRemoved[0],t),t.__objectsRemoved.splice(0,1)};this.initMaterial=function(t,e,n,r){var i,o,a,s;t.addEventListener("dispose",Je);var h,u,c,l;t instanceof THREE.MeshDepthMaterial?l="depth":t instanceof THREE.MeshNormalMaterial?l="normal":t instanceof THREE.MeshBasicMaterial?l="basic":t instanceof THREE.MeshLambertMaterial?l="lambert":t instanceof THREE.MeshPhongMaterial?l="phong":t instanceof THREE.LineBasicMaterial?l="basic":t instanceof THREE.LineDashedMaterial?l="dashed":t instanceof THREE.PointCloudMaterial&&(l="particle_basic"),l?(i=THREE.ShaderLib[l],t.__webglShader={uniforms:THREE.UniformsUtils.clone(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader}):t.__webglShader={uniforms:t.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader},c=s=a=o=i=0;for(var f=e.length;f>c;c++){var p=e[c];p.onlyShadow||!1===p.visible||(p instanceof THREE.DirectionalLight&&i++,p instanceof THREE.PointLight&&o++,p instanceof THREE.SpotLight&&a++,p instanceof THREE.HemisphereLight&&s++)}for(f=c=0,p=e.length;p>f;f++){var d=e[f];d.castShadow&&(d instanceof THREE.SpotLight&&c++,d instanceof THREE.DirectionalLight&&!d.shadowCascade&&c++)}e=c,We&&r&&r.skeleton&&r.skeleton.useVertexTexture?c=1024:(c=Q.getParameter(Q.MAX_VERTEX_UNIFORM_VECTORS),c=Math.floor((c-20)/4),void 0!==r&&r instanceof THREE.SkinnedMesh&&(c=Math.min(r.skeleton.bones.length,c),c<r.skeleton.bones.length&&console.warn("WebGLRenderer: too many bones - "+r.skeleton.bones.length+", this GPU supports just "+c+" (try OpenGL instead of ANGLE)"))),n={precision:I,supportsVertexTextures:Oe,map:!!t.map,envMap:!!t.envMap,lightMap:!!t.lightMap,bumpMap:!!t.bumpMap,normalMap:!!t.normalMap,specularMap:!!t.specularMap,alphaMap:!!t.alphaMap,vertexColors:t.vertexColors,fog:n,useFog:t.fog,fogExp:n instanceof THREE.FogExp2,sizeAttenuation:t.sizeAttenuation,logarithmicDepthBuffer:q,skinning:t.skinning,maxBones:c,useVertexTexture:We&&r&&r.skeleton&&r.skeleton.useVertexTexture,morphTargets:t.morphTargets,morphNormals:t.morphNormals,maxMorphTargets:this.maxMorphTargets,maxMorphNormals:this.maxMorphNormals,maxDirLights:i,maxPointLights:o,maxSpotLights:a,maxHemiLights:s,maxShadows:e,shadowMapEnabled:this.shadowMapEnabled&&r.receiveShadow&&e>0,shadowMapType:this.shadowMapType,shadowMapDebug:this.shadowMapDebug,shadowMapCascade:this.shadowMapCascade,alphaTest:t.alphaTest,metal:t.metal,wrapAround:t.wrapAround,doubleSided:t.side===THREE.DoubleSide,flipSided:t.side===THREE.BackSide},r=[],l?r.push(l):(r.push(t.fragmentShader),r.push(t.vertexShader));for(var m in t.defines)r.push(m),r.push(t.defines[m]);for(u in n)r.push(u),r.push(n[u]);l=r.join();var g;for(u=0,m=ie.length;m>u;u++)if(r=ie[u],r.code===l){g=r,g.usedTimes++;break}if(void 0===g&&(g=new THREE.WebGLProgram(this,l,t,n),ie.push(g),re.info.memory.programs=ie.length),t.program=g,g=t.program.attributes,t.morphTargets)for(t.numSupportedMorphTargets=0,m="morphTarget",u=0;u<this.maxMorphTargets;u++)l=m+u,0<=g[l]&&t.numSupportedMorphTargets++;if(t.morphNormals)for(t.numSupportedMorphNormals=0,m="morphNormal",u=0;u<this.maxMorphNormals;u++)l=m+u,0<=g[l]&&t.numSupportedMorphNormals++;t.uniformsList=[];for(h in t.__webglShader.uniforms)(u=t.program.uniforms[h])&&t.uniformsList.push([t.__webglShader.uniforms[h],u])},this.setFaceCulling=function(t,e){t===THREE.CullFaceNone?Q.disable(Q.CULL_FACE):(Q.frontFace(e===THREE.FrontFaceDirectionCW?Q.CW:Q.CCW),Q.cullFace(t===THREE.CullFaceBack?Q.BACK:t===THREE.CullFaceFront?Q.FRONT:Q.FRONT_AND_BACK),Q.enable(Q.CULL_FACE))},this.setMaterialFaces=function(t){var e=t.side===THREE.DoubleSide;t=t.side===THREE.BackSide,le!==e&&(e?Q.disable(Q.CULL_FACE):Q.enable(Q.CULL_FACE),le=e),fe!==t&&(Q.frontFace(t?Q.CW:Q.CCW),fe=t)},this.setDepthTest=function(t){ve!==t&&(t?Q.enable(Q.DEPTH_TEST):Q.disable(Q.DEPTH_TEST),ve=t)},this.setDepthWrite=function(t){ye!==t&&(Q.depthMask(t),ye=t)},this.setBlending=function(t,e,n,r){t!==pe&&(t===THREE.NoBlending?Q.disable(Q.BLEND):t===THREE.AdditiveBlending?(Q.enable(Q.BLEND),Q.blendEquation(Q.FUNC_ADD),Q.blendFunc(Q.SRC_ALPHA,Q.ONE)):t===THREE.SubtractiveBlending?(Q.enable(Q.BLEND),Q.blendEquation(Q.FUNC_ADD),Q.blendFunc(Q.ZERO,Q.ONE_MINUS_SRC_COLOR)):t===THREE.MultiplyBlending?(Q.enable(Q.BLEND),Q.blendEquation(Q.FUNC_ADD),Q.blendFunc(Q.ZERO,Q.SRC_COLOR)):t===THREE.CustomBlending?Q.enable(Q.BLEND):(Q.enable(Q.BLEND),Q.blendEquationSeparate(Q.FUNC_ADD,Q.FUNC_ADD),Q.blendFuncSeparate(Q.SRC_ALPHA,Q.ONE_MINUS_SRC_ALPHA,Q.ONE,Q.ONE_MINUS_SRC_ALPHA)),pe=t),t===THREE.CustomBlending?(e!==de&&(Q.blendEquation(k(e)),de=e),(n!==me||r!==ge)&&(Q.blendFunc(k(n),k(r)),me=n,ge=r)):ge=me=de=null},this.setTexture=function(t,e){if(t.needsUpdate){t.__webglInit||(t.__webglInit=!0,t.addEventListener("dispose",Qe),t.__webglTexture=Q.createTexture(),re.info.memory.textures++),Q.activeTexture(Q.TEXTURE0+e),Q.bindTexture(Q.TEXTURE_2D,t.__webglTexture),Q.pixelStorei(Q.UNPACK_FLIP_Y_WEBGL,t.flipY),Q.pixelStorei(Q.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),Q.pixelStorei(Q.UNPACK_ALIGNMENT,t.unpackAlignment);var n=t.image,r=THREE.Math.isPowerOfTwo(n.width)&&THREE.Math.isPowerOfTwo(n.height),i=k(t.format),o=k(t.type);P(Q.TEXTURE_2D,t,r);var a=t.mipmaps;if(t instanceof THREE.DataTexture)if(0<a.length&&r){for(var s=0,h=a.length;h>s;s++)n=a[s],Q.texImage2D(Q.TEXTURE_2D,s,i,n.width,n.height,0,i,o,n.data);t.generateMipmaps=!1}else Q.texImage2D(Q.TEXTURE_2D,0,i,n.width,n.height,0,i,o,n.data);else if(t instanceof THREE.CompressedTexture)for(s=0,h=a.length;h>s;s++)n=a[s],t.format!==THREE.RGBAFormat?Q.compressedTexImage2D(Q.TEXTURE_2D,s,i,n.width,n.height,0,n.data):Q.texImage2D(Q.TEXTURE_2D,s,i,n.width,n.height,0,i,o,n.data);else if(0<a.length&&r){for(s=0,h=a.length;h>s;s++)n=a[s],Q.texImage2D(Q.TEXTURE_2D,s,i,i,o,n);t.generateMipmaps=!1}else Q.texImage2D(Q.TEXTURE_2D,0,i,i,o,t.image);t.generateMipmaps&&r&&Q.generateMipmap(Q.TEXTURE_2D),t.needsUpdate=!1,t.onUpdate&&t.onUpdate()}else Q.activeTexture(Q.TEXTURE0+e),Q.bindTexture(Q.TEXTURE_2D,t.__webglTexture)},this.setRenderTarget=function(t){var e=t instanceof THREE.WebGLRenderTargetCube;if(t&&!t.__webglFramebuffer){void 0===t.depthBuffer&&(t.depthBuffer=!0),void 0===t.stencilBuffer&&(t.stencilBuffer=!0),t.addEventListener("dispose",$e),t.__webglTexture=Q.createTexture(),re.info.memory.textures++;var n=THREE.Math.isPowerOfTwo(t.width)&&THREE.Math.isPowerOfTwo(t.height),r=k(t.format),i=k(t.type);if(e){t.__webglFramebuffer=[],t.__webglRenderbuffer=[],Q.bindTexture(Q.TEXTURE_CUBE_MAP,t.__webglTexture),P(Q.TEXTURE_CUBE_MAP,t,n);for(var o=0;6>o;o++){t.__webglFramebuffer[o]=Q.createFramebuffer(),t.__webglRenderbuffer[o]=Q.createRenderbuffer(),Q.texImage2D(Q.TEXTURE_CUBE_MAP_POSITIVE_X+o,0,r,t.width,t.height,0,r,i,null);var a=t,s=Q.TEXTURE_CUBE_MAP_POSITIVE_X+o;Q.bindFramebuffer(Q.FRAMEBUFFER,t.__webglFramebuffer[o]),Q.framebufferTexture2D(Q.FRAMEBUFFER,Q.COLOR_ATTACHMENT0,s,a.__webglTexture,0),D(t.__webglRenderbuffer[o],t)}n&&Q.generateMipmap(Q.TEXTURE_CUBE_MAP)}else t.__webglFramebuffer=Q.createFramebuffer(),t.__webglRenderbuffer=t.shareDepthFrom?t.shareDepthFrom.__webglRenderbuffer:Q.createRenderbuffer(),Q.bindTexture(Q.TEXTURE_2D,t.__webglTexture),P(Q.TEXTURE_2D,t,n),Q.texImage2D(Q.TEXTURE_2D,0,r,t.width,t.height,0,r,i,null),r=Q.TEXTURE_2D,Q.bindFramebuffer(Q.FRAMEBUFFER,t.__webglFramebuffer),Q.framebufferTexture2D(Q.FRAMEBUFFER,Q.COLOR_ATTACHMENT0,r,t.__webglTexture,0),t.shareDepthFrom?t.depthBuffer&&!t.stencilBuffer?Q.framebufferRenderbuffer(Q.FRAMEBUFFER,Q.DEPTH_ATTACHMENT,Q.RENDERBUFFER,t.__webglRenderbuffer):t.depthBuffer&&t.stencilBuffer&&Q.framebufferRenderbuffer(Q.FRAMEBUFFER,Q.DEPTH_STENCIL_ATTACHMENT,Q.RENDERBUFFER,t.__webglRenderbuffer):D(t.__webglRenderbuffer,t),n&&Q.generateMipmap(Q.TEXTURE_2D);e?Q.bindTexture(Q.TEXTURE_CUBE_MAP,null):Q.bindTexture(Q.TEXTURE_2D,null),Q.bindRenderbuffer(Q.RENDERBUFFER,null),Q.bindFramebuffer(Q.FRAMEBUFFER,null)}t?(e=e?t.__webglFramebuffer[t.activeCubeFace]:t.__webglFramebuffer,n=t.width,t=t.height,i=r=0):(e=null,n=_e,t=He,r=Re,i=we),e!==ae&&(Q.bindFramebuffer(Q.FRAMEBUFFER,e),Q.viewport(r,i,n,t),ae=e),Me=n,Se=t},this.shadowMapPlugin=new THREE.ShadowMapPlugin,this.addPrePlugin(this.shadowMapPlugin),this.addPostPlugin(new THREE.SpritePlugin),this.addPostPlugin(new THREE.LensFlarePlugin)},THREE.WebGLRenderTarget=function(t,e,n){this.width=t,this.height=e,n=n||{},this.wrapS=void 0!==n.wrapS?n.wrapS:THREE.ClampToEdgeWrapping,this.wrapT=void 0!==n.wrapT?n.wrapT:THREE.ClampToEdgeWrapping,this.magFilter=void 0!==n.magFilter?n.magFilter:THREE.LinearFilter,this.minFilter=void 0!==n.minFilter?n.minFilter:THREE.LinearMipMapLinearFilter,this.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,this.offset=new THREE.Vector2(0,0),this.repeat=new THREE.Vector2(1,1),this.format=void 0!==n.format?n.format:THREE.RGBAFormat,this.type=void 0!==n.type?n.type:THREE.UnsignedByteType,this.depthBuffer=void 0!==n.depthBuffer?n.depthBuffer:!0,this.stencilBuffer=void 0!==n.stencilBuffer?n.stencilBuffer:!0,this.generateMipmaps=!0,this.shareDepthFrom=null
},THREE.WebGLRenderTarget.prototype={constructor:THREE.WebGLRenderTarget,setSize:function(t,e){this.width=t,this.height=e},clone:function(){var t=new THREE.WebGLRenderTarget(this.width,this.height);return t.wrapS=this.wrapS,t.wrapT=this.wrapT,t.magFilter=this.magFilter,t.minFilter=this.minFilter,t.anisotropy=this.anisotropy,t.offset.copy(this.offset),t.repeat.copy(this.repeat),t.format=this.format,t.type=this.type,t.depthBuffer=this.depthBuffer,t.stencilBuffer=this.stencilBuffer,t.generateMipmaps=this.generateMipmaps,t.shareDepthFrom=this.shareDepthFrom,t},dispose:function(){this.dispatchEvent({type:"dispose"})}},THREE.EventDispatcher.prototype.apply(THREE.WebGLRenderTarget.prototype),THREE.WebGLRenderTargetCube=function(t,e,n){THREE.WebGLRenderTarget.call(this,t,e,n),this.activeCubeFace=0},THREE.WebGLRenderTargetCube.prototype=Object.create(THREE.WebGLRenderTarget.prototype),THREE.WebGLProgram=function(){var t=0;return function(e,n,r,i){var o=e.context,a=r.defines,s=r.__webglShader.uniforms,h=r.attributes,u=r.__webglShader.vertexShader,c=r.__webglShader.fragmentShader,l=r.index0AttributeName;void 0===l&&!0===i.morphTargets&&(l="position");var f="SHADOWMAP_TYPE_BASIC";i.shadowMapType===THREE.PCFShadowMap?f="SHADOWMAP_TYPE_PCF":i.shadowMapType===THREE.PCFSoftShadowMap&&(f="SHADOWMAP_TYPE_PCF_SOFT");var p,d;p=[];for(var m in a)d=a[m],!1!==d&&(d="#define "+m+" "+d,p.push(d));p=p.join("\n"),a=o.createProgram(),r instanceof THREE.RawShaderMaterial?e=r="":(r=["precision "+i.precision+" float;","precision "+i.precision+" int;",p,i.supportsVertexTextures?"#define VERTEX_TEXTURES":"",e.gammaInput?"#define GAMMA_INPUT":"",e.gammaOutput?"#define GAMMA_OUTPUT":"","#define MAX_DIR_LIGHTS "+i.maxDirLights,"#define MAX_POINT_LIGHTS "+i.maxPointLights,"#define MAX_SPOT_LIGHTS "+i.maxSpotLights,"#define MAX_HEMI_LIGHTS "+i.maxHemiLights,"#define MAX_SHADOWS "+i.maxShadows,"#define MAX_BONES "+i.maxBones,i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.lightMap?"#define USE_LIGHTMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.vertexColors?"#define USE_COLOR":"",i.skinning?"#define USE_SKINNING":"",i.useVertexTexture?"#define BONE_TEXTURE":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals?"#define USE_MORPHNORMALS":"",i.wrapAround?"#define WRAP_AROUND":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+f:"",i.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",i.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 modelMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\nuniform vec3 cameraPosition;\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv;\nattribute vec2 uv2;\n#ifdef USE_COLOR\n	attribute vec3 color;\n#endif\n#ifdef USE_MORPHTARGETS\n	attribute vec3 morphTarget0;\n	attribute vec3 morphTarget1;\n	attribute vec3 morphTarget2;\n	attribute vec3 morphTarget3;\n	#ifdef USE_MORPHNORMALS\n		attribute vec3 morphNormal0;\n		attribute vec3 morphNormal1;\n		attribute vec3 morphNormal2;\n		attribute vec3 morphNormal3;\n	#else\n		attribute vec3 morphTarget4;\n		attribute vec3 morphTarget5;\n		attribute vec3 morphTarget6;\n		attribute vec3 morphTarget7;\n	#endif\n#endif\n#ifdef USE_SKINNING\n	attribute vec4 skinIndex;\n	attribute vec4 skinWeight;\n#endif\n"].join("\n"),e=["precision "+i.precision+" float;","precision "+i.precision+" int;",i.bumpMap||i.normalMap?"#extension GL_OES_standard_derivatives : enable":"",p,"#define MAX_DIR_LIGHTS "+i.maxDirLights,"#define MAX_POINT_LIGHTS "+i.maxPointLights,"#define MAX_SPOT_LIGHTS "+i.maxSpotLights,"#define MAX_HEMI_LIGHTS "+i.maxHemiLights,"#define MAX_SHADOWS "+i.maxShadows,i.alphaTest?"#define ALPHATEST "+i.alphaTest:"",e.gammaInput?"#define GAMMA_INPUT":"",e.gammaOutput?"#define GAMMA_OUTPUT":"",i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.lightMap?"#define USE_LIGHTMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.vertexColors?"#define USE_COLOR":"",i.metal?"#define METAL":"",i.wrapAround?"#define WRAP_AROUND":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+f:"",i.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",i.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 viewMatrix;\nuniform vec3 cameraPosition;\n"].join("\n")),u=new THREE.WebGLShader(o,o.VERTEX_SHADER,r+u),c=new THREE.WebGLShader(o,o.FRAGMENT_SHADER,e+c),o.attachShader(a,u),o.attachShader(a,c),void 0!==l&&o.bindAttribLocation(a,0,l),o.linkProgram(a),!1===o.getProgramParameter(a,o.LINK_STATUS)&&(console.error("THREE.WebGLProgram: Could not initialise shader."),console.error("gl.VALIDATE_STATUS",o.getProgramParameter(a,o.VALIDATE_STATUS)),console.error("gl.getError()",o.getError())),""!==o.getProgramInfoLog(a)&&console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",o.getProgramInfoLog(a)),o.deleteShader(u),o.deleteShader(c),l="viewMatrix modelViewMatrix projectionMatrix normalMatrix modelMatrix cameraPosition morphTargetInfluences bindMatrix bindMatrixInverse".split(" "),i.useVertexTexture?(l.push("boneTexture"),l.push("boneTextureWidth"),l.push("boneTextureHeight")):l.push("boneGlobalMatrices"),i.logarithmicDepthBuffer&&l.push("logDepthBufFC");for(var g in s)l.push(g);for(s=l,g={},l=0,e=s.length;e>l;l++)f=s[l],g[f]=o.getUniformLocation(a,f);for(this.uniforms=g,l="position normal uv uv2 tangent color skinIndex skinWeight lineDistance".split(" "),s=0;s<i.maxMorphTargets;s++)l.push("morphTarget"+s);for(s=0;s<i.maxMorphNormals;s++)l.push("morphNormal"+s);for(var v in h)l.push(v);for(i=l,h={},v=0,s=i.length;s>v;v++)g=i[v],h[g]=o.getAttribLocation(a,g);return this.attributes=h,this.id=t++,this.code=n,this.usedTimes=1,this.program=a,this.vertexShader=u,this.fragmentShader=c,this}}(),THREE.WebGLShader=function(){var t=function(t){t=t.split("\n");for(var e=0;e<t.length;e++)t[e]=e+1+": "+t[e];return t.join("\n")};return function(e,n,r){return n=e.createShader(n),e.shaderSource(n,r),e.compileShader(n),!1===e.getShaderParameter(n,e.COMPILE_STATUS)&&console.error("THREE.WebGLShader: Shader couldn't compile."),""!==e.getShaderInfoLog(n)&&(console.warn("THREE.WebGLShader: gl.getShaderInfoLog()",e.getShaderInfoLog(n)),console.warn(t(r))),n}}(),THREE.RenderableVertex=function(){this.position=new THREE.Vector3,this.positionWorld=new THREE.Vector3,this.positionScreen=new THREE.Vector4,this.visible=!0},THREE.RenderableVertex.prototype.copy=function(t){this.positionWorld.copy(t.positionWorld),this.positionScreen.copy(t.positionScreen)},THREE.RenderableFace=function(){this.id=0,this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.v3=new THREE.RenderableVertex,this.normalModel=new THREE.Vector3,this.vertexNormalsModel=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],this.vertexNormalsLength=0,this.color=new THREE.Color,this.material=null,this.uvs=[new THREE.Vector2,new THREE.Vector2,new THREE.Vector2],this.z=0},THREE.RenderableObject=function(){this.id=0,this.object=null,this.z=0},THREE.RenderableSprite=function(){this.id=0,this.object=null,this.rotation=this.z=this.y=this.x=0,this.scale=new THREE.Vector2,this.material=null},THREE.RenderableLine=function(){this.id=0,this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.vertexColors=[new THREE.Color,new THREE.Color],this.material=null,this.z=0},THREE.GeometryUtils={merge:function(t,e,n){console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead.");var r;e instanceof THREE.Mesh&&(e.matrixAutoUpdate&&e.updateMatrix(),r=e.matrix,e=e.geometry),t.merge(e,r,n)},center:function(t){return console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),t.center()}},THREE.ImageUtils={crossOrigin:void 0,loadTexture:function(t,e,n,r){var i=new THREE.ImageLoader;i.crossOrigin=this.crossOrigin;var o=new THREE.Texture(void 0,e);return i.load(t,function(t){o.image=t,o.needsUpdate=!0,n&&n(o)},void 0,function(t){r&&r(t)}),o.sourceFile=t,o},loadTextureCube:function(t,e,n,r){var i=new THREE.ImageLoader;i.crossOrigin=this.crossOrigin;var o=new THREE.CubeTexture([],e);o.flipY=!1;var a=0;e=function(e){i.load(t[e],function(t){o.images[e]=t,a+=1,6===a&&(o.needsUpdate=!0,n&&n(o))})},r=0;for(var s=t.length;s>r;++r)e(r);return o},loadCompressedTexture:function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},loadCompressedTextureCube:function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")},getNormalMap:function(t,e){var n=function(t){var e=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);return[t[0]/e,t[1]/e,t[2]/e]};e|=1;var r=t.width,i=t.height,o=document.createElement("canvas");o.width=r,o.height=i;var a=o.getContext("2d");a.drawImage(t,0,0);for(var s=a.getImageData(0,0,r,i).data,h=a.createImageData(r,i),u=h.data,c=0;r>c;c++)for(var l=0;i>l;l++){var f=0>l-1?0:l-1,p=l+1>i-1?i-1:l+1,d=0>c-1?0:c-1,m=c+1>r-1?r-1:c+1,g=[],v=[0,0,s[4*(l*r+c)]/255*e];for(g.push([-1,0,s[4*(l*r+d)]/255*e]),g.push([-1,-1,s[4*(f*r+d)]/255*e]),g.push([0,-1,s[4*(f*r+c)]/255*e]),g.push([1,-1,s[4*(f*r+m)]/255*e]),g.push([1,0,s[4*(l*r+m)]/255*e]),g.push([1,1,s[4*(p*r+m)]/255*e]),g.push([0,1,s[4*(p*r+c)]/255*e]),g.push([-1,1,s[4*(p*r+d)]/255*e]),f=[],d=g.length,p=0;d>p;p++){var m=g[p],y=g[(p+1)%d],m=[m[0]-v[0],m[1]-v[1],m[2]-v[2]],y=[y[0]-v[0],y[1]-v[1],y[2]-v[2]];f.push(n([m[1]*y[2]-m[2]*y[1],m[2]*y[0]-m[0]*y[2],m[0]*y[1]-m[1]*y[0]]))}for(g=[0,0,0],p=0;p<f.length;p++)g[0]+=f[p][0],g[1]+=f[p][1],g[2]+=f[p][2];g[0]/=f.length,g[1]/=f.length,g[2]/=f.length,v=4*(l*r+c),u[v]=(g[0]+1)/2*255|0,u[v+1]=(g[1]+1)/2*255|0,u[v+2]=255*g[2]|0,u[v+3]=255}return a.putImageData(h,0,0),o},generateDataTexture:function(t,e,n){var r=t*e,i=new Uint8Array(3*r),o=Math.floor(255*n.r),a=Math.floor(255*n.g);n=Math.floor(255*n.b);for(var s=0;r>s;s++)i[3*s]=o,i[3*s+1]=a,i[3*s+2]=n;return t=new THREE.DataTexture(i,t,e,THREE.RGBFormat),t.needsUpdate=!0,t}},THREE.SceneUtils={createMultiMaterialObject:function(t,e){for(var n=new THREE.Object3D,r=0,i=e.length;i>r;r++)n.add(new THREE.Mesh(t,e[r]));return n},detach:function(t,e,n){t.applyMatrix(e.matrixWorld),e.remove(t),n.add(t)},attach:function(t,e,n){var r=new THREE.Matrix4;r.getInverse(n.matrixWorld),t.applyMatrix(r),e.remove(t),n.add(t)}},THREE.FontUtils={faces:{},face:"helvetiker",weight:"normal",style:"normal",size:150,divisions:10,getFace:function(){try{return this.faces[this.face][this.weight][this.style]}catch(t){throw"The font "+this.face+" with "+this.weight+" weight and "+this.style+" style is missing."}},loadFace:function(t){var e=t.familyName.toLowerCase();return this.faces[e]=this.faces[e]||{},this.faces[e][t.cssFontWeight]=this.faces[e][t.cssFontWeight]||{},this.faces[e][t.cssFontWeight][t.cssFontStyle]=t,this.faces[e][t.cssFontWeight][t.cssFontStyle]=t},drawText:function(t){var e=this.getFace(),n=this.size/e.resolution,r=0,i=String(t).split(""),o=i.length,a=[];for(t=0;o>t;t++){var s=new THREE.Path,s=this.extractGlyphPoints(i[t],e,n,r,s),r=r+s.offset;a.push(s.path)}return{paths:a,offset:r/2}},extractGlyphPoints:function(t,e,n,r,i){var o,a,s,h,u,c,l,f,p,d,m,g=[],v=e.glyphs[t]||e.glyphs["?"];if(v){if(v.o)for(e=v._cachedOutline||(v._cachedOutline=v.o.split(" ")),h=e.length,t=0;h>t;)switch(s=e[t++]){case"m":s=e[t++]*n+r,u=e[t++]*n,i.moveTo(s,u);break;case"l":s=e[t++]*n+r,u=e[t++]*n,i.lineTo(s,u);break;case"q":if(s=e[t++]*n+r,u=e[t++]*n,f=e[t++]*n+r,p=e[t++]*n,i.quadraticCurveTo(f,p,s,u),o=g[g.length-1])for(c=o.x,l=o.y,o=1,a=this.divisions;a>=o;o++){var y=o/a;THREE.Shape.Utils.b2(y,c,f,s),THREE.Shape.Utils.b2(y,l,p,u)}break;case"b":if(s=e[t++]*n+r,u=e[t++]*n,f=e[t++]*n+r,p=e[t++]*n,d=e[t++]*n+r,m=e[t++]*n,i.bezierCurveTo(f,p,d,m,s,u),o=g[g.length-1])for(c=o.x,l=o.y,o=1,a=this.divisions;a>=o;o++)y=o/a,THREE.Shape.Utils.b3(y,c,f,d,s),THREE.Shape.Utils.b3(y,l,p,m,u)}return{offset:v.ha*n,path:i}}}},THREE.FontUtils.generateShapes=function(t,e){e=e||{};var n=void 0!==e.curveSegments?e.curveSegments:4,r=void 0!==e.font?e.font:"helvetiker",i=void 0!==e.weight?e.weight:"normal",o=void 0!==e.style?e.style:"normal";for(THREE.FontUtils.size=void 0!==e.size?e.size:100,THREE.FontUtils.divisions=n,THREE.FontUtils.face=r,THREE.FontUtils.weight=i,THREE.FontUtils.style=o,n=THREE.FontUtils.drawText(t).paths,r=[],i=0,o=n.length;o>i;i++)Array.prototype.push.apply(r,n[i].toShapes());return r},function(t){var e=function(t){for(var e=t.length,n=0,r=e-1,i=0;e>i;r=i++)n+=t[r].x*t[i].y-t[i].x*t[r].y;return.5*n};return t.Triangulate=function(t,n){var r=t.length;if(3>r)return null;var i,o,a,s=[],h=[],u=[];if(0<e(t))for(o=0;r>o;o++)h[o]=o;else for(o=0;r>o;o++)h[o]=r-1-o;var c=2*r;for(o=r-1;r>2;){if(0>=c--){console.log("Warning, unable to triangulate polygon!");break}i=o,i>=r&&(i=0),o=i+1,o>=r&&(o=0),a=o+1,a>=r&&(a=0);var l;t:{var f=l=void 0,p=void 0,d=void 0,m=void 0,g=void 0,v=void 0,y=void 0,E=void 0,f=t[h[i]].x,p=t[h[i]].y,d=t[h[o]].x,m=t[h[o]].y,g=t[h[a]].x,v=t[h[a]].y;if(1e-10>(d-f)*(v-p)-(m-p)*(g-f))l=!1;else{var x=void 0,T=void 0,b=void 0,R=void 0,w=void 0,_=void 0,H=void 0,M=void 0,S=void 0,C=void 0,S=M=H=E=y=void 0,x=g-d,T=v-m,b=f-g,R=p-v,w=d-f,_=m-p;for(l=0;r>l;l++)if(y=t[h[l]].x,E=t[h[l]].y,!(y===f&&E===p||y===d&&E===m||y===g&&E===v)&&(H=y-f,M=E-p,S=y-d,C=E-m,y-=g,E-=v,S=x*C-T*S,H=w*M-_*H,M=b*E-R*y,S>=-1e-10&&M>=-1e-10&&H>=-1e-10)){l=!1;break t}l=!0}}if(l){for(s.push([t[h[i]],t[h[o]],t[h[a]]]),u.push([h[i],h[o],h[a]]),i=o,a=o+1;r>a;i++,a++)h[i]=h[a];r--,c=2*r}}return n?u:s},t.Triangulate.area=e,t}(THREE.FontUtils),self._typeface_js={faces:THREE.FontUtils.faces,loadFace:THREE.FontUtils.loadFace},THREE.typeface_js=self._typeface_js,THREE.Curve=function(){},THREE.Curve.prototype.getPoint=function(){return console.log("Warning, getPoint() not implemented!"),null},THREE.Curve.prototype.getPointAt=function(t){return t=this.getUtoTmapping(t),this.getPoint(t)},THREE.Curve.prototype.getPoints=function(t){t||(t=5);var e,n=[];for(e=0;t>=e;e++)n.push(this.getPoint(e/t));return n},THREE.Curve.prototype.getSpacedPoints=function(t){t||(t=5);var e,n=[];for(e=0;t>=e;e++)n.push(this.getPointAt(e/t));return n},THREE.Curve.prototype.getLength=function(){var t=this.getLengths();return t[t.length-1]},THREE.Curve.prototype.getLengths=function(t){if(t||(t=this.__arcLengthDivisions?this.__arcLengthDivisions:200),this.cacheArcLengths&&this.cacheArcLengths.length==t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var e,n,r=[],i=this.getPoint(0),o=0;for(r.push(0),n=1;t>=n;n++)e=this.getPoint(n/t),o+=e.distanceTo(i),r.push(o),i=e;return this.cacheArcLengths=r},THREE.Curve.prototype.updateArcLengths=function(){this.needsUpdate=!0,this.getLengths()},THREE.Curve.prototype.getUtoTmapping=function(t,e){var n,r=this.getLengths(),i=0,o=r.length;n=e?e:t*r[o-1];for(var a,s=0,h=o-1;h>=s;)if(i=Math.floor(s+(h-s)/2),a=r[i]-n,0>a)s=i+1;else{if(!(a>0)){h=i;break}h=i-1}return i=h,r[i]==n?i/(o-1):(s=r[i],r=(i+(n-s)/(r[i+1]-s))/(o-1))},THREE.Curve.prototype.getTangent=function(t){var e=t-1e-4;return t+=1e-4,0>e&&(e=0),t>1&&(t=1),e=this.getPoint(e),this.getPoint(t).clone().sub(e).normalize()},THREE.Curve.prototype.getTangentAt=function(t){return t=this.getUtoTmapping(t),this.getTangent(t)},THREE.Curve.Utils={tangentQuadraticBezier:function(t,e,n,r){return 2*(1-t)*(n-e)+2*t*(r-n)},tangentCubicBezier:function(t,e,n,r,i){return-3*e*(1-t)*(1-t)+3*n*(1-t)*(1-t)-6*t*n*(1-t)+6*t*r*(1-t)-3*t*t*r+3*t*t*i},tangentSpline:function(t){return 6*t*t-6*t+(3*t*t-4*t+1)+(-6*t*t+6*t)+(3*t*t-2*t)},interpolate:function(t,e,n,r,i){t=.5*(n-t),r=.5*(r-e);var o=i*i;return(2*e-2*n+t+r)*i*o+(-3*e+3*n-2*t-r)*o+t*i+e}},THREE.Curve.create=function(t,e){return t.prototype=Object.create(THREE.Curve.prototype),t.prototype.getPoint=e,t},THREE.CurvePath=function(){this.curves=[],this.bends=[],this.autoClose=!1},THREE.CurvePath.prototype=Object.create(THREE.Curve.prototype),THREE.CurvePath.prototype.add=function(t){this.curves.push(t)},THREE.CurvePath.prototype.checkConnection=function(){},THREE.CurvePath.prototype.closePath=function(){var t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);t.equals(e)||this.curves.push(new THREE.LineCurve(e,t))},THREE.CurvePath.prototype.getPoint=function(t){var e=t*this.getLength(),n=this.getCurveLengths();for(t=0;t<n.length;){if(n[t]>=e)return e=n[t]-e,t=this.curves[t],e=1-e/t.getLength(),t.getPointAt(e);t++}return null},THREE.CurvePath.prototype.getLength=function(){var t=this.getCurveLengths();return t[t.length-1]},THREE.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length)return this.cacheLengths;var t,e=[],n=0,r=this.curves.length;for(t=0;r>t;t++)n+=this.curves[t].getLength(),e.push(n);return this.cacheLengths=e},THREE.CurvePath.prototype.getBoundingBox=function(){var t,e,n,r,i,o,a=this.getPoints();t=e=Number.NEGATIVE_INFINITY,r=i=Number.POSITIVE_INFINITY;var s,h,u,c,l=a[0]instanceof THREE.Vector3;for(c=l?new THREE.Vector3:new THREE.Vector2,h=0,u=a.length;u>h;h++)s=a[h],s.x>t?t=s.x:s.x<r&&(r=s.x),s.y>e?e=s.y:s.y<i&&(i=s.y),l&&(s.z>n?n=s.z:s.z<o&&(o=s.z)),c.add(s);return a={minX:r,minY:i,maxX:t,maxY:e},l&&(a.maxZ=n,a.minZ=o),a},THREE.CurvePath.prototype.createPointsGeometry=function(t){return t=this.getPoints(t,!0),this.createGeometry(t)},THREE.CurvePath.prototype.createSpacedPointsGeometry=function(t){return t=this.getSpacedPoints(t,!0),this.createGeometry(t)},THREE.CurvePath.prototype.createGeometry=function(t){for(var e=new THREE.Geometry,n=0;n<t.length;n++)e.vertices.push(new THREE.Vector3(t[n].x,t[n].y,t[n].z||0));return e},THREE.CurvePath.prototype.addWrapPath=function(t){this.bends.push(t)},THREE.CurvePath.prototype.getTransformedPoints=function(t,e){var n,r,i=this.getPoints(t);for(e||(e=this.bends),n=0,r=e.length;r>n;n++)i=this.getWrapPoints(i,e[n]);return i},THREE.CurvePath.prototype.getTransformedSpacedPoints=function(t,e){var n,r,i=this.getSpacedPoints(t);for(e||(e=this.bends),n=0,r=e.length;r>n;n++)i=this.getWrapPoints(i,e[n]);return i},THREE.CurvePath.prototype.getWrapPoints=function(t,e){var n,r,i,o,a,s,h=this.getBoundingBox();for(n=0,r=t.length;r>n;n++)i=t[n],o=i.x,a=i.y,s=o/h.maxX,s=e.getUtoTmapping(s,o),o=e.getPoint(s),s=e.getTangent(s),s.set(-s.y,s.x).multiplyScalar(a),i.x=o.x+s.x,i.y=o.y+s.y;return t},THREE.Gyroscope=function(){THREE.Object3D.call(this)},THREE.Gyroscope.prototype=Object.create(THREE.Object3D.prototype),THREE.Gyroscope.prototype.updateMatrixWorld=function(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.parent?(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorld.decompose(this.translationWorld,this.quaternionWorld,this.scaleWorld),this.matrix.decompose(this.translationObject,this.quaternionObject,this.scaleObject),this.matrixWorld.compose(this.translationWorld,this.quaternionObject,this.scaleWorld)):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);for(var e=0,n=this.children.length;n>e;e++)this.children[e].updateMatrixWorld(t)},THREE.Gyroscope.prototype.translationWorld=new THREE.Vector3,THREE.Gyroscope.prototype.translationObject=new THREE.Vector3,THREE.Gyroscope.prototype.quaternionWorld=new THREE.Quaternion,THREE.Gyroscope.prototype.quaternionObject=new THREE.Quaternion,THREE.Gyroscope.prototype.scaleWorld=new THREE.Vector3,THREE.Gyroscope.prototype.scaleObject=new THREE.Vector3,THREE.Path=function(t){THREE.CurvePath.call(this),this.actions=[],t&&this.fromPoints(t)},THREE.Path.prototype=Object.create(THREE.CurvePath.prototype),THREE.PathActions={MOVE_TO:"moveTo",LINE_TO:"lineTo",QUADRATIC_CURVE_TO:"quadraticCurveTo",BEZIER_CURVE_TO:"bezierCurveTo",CSPLINE_THRU:"splineThru",ARC:"arc",ELLIPSE:"ellipse"},THREE.Path.prototype.fromPoints=function(t){this.moveTo(t[0].x,t[0].y);for(var e=1,n=t.length;n>e;e++)this.lineTo(t[e].x,t[e].y)},THREE.Path.prototype.moveTo=function(){var t=Array.prototype.slice.call(arguments);this.actions.push({action:THREE.PathActions.MOVE_TO,args:t})},THREE.Path.prototype.lineTo=function(t,e){var n=Array.prototype.slice.call(arguments),r=this.actions[this.actions.length-1].args,r=new THREE.LineCurve(new THREE.Vector2(r[r.length-2],r[r.length-1]),new THREE.Vector2(t,e));this.curves.push(r),this.actions.push({action:THREE.PathActions.LINE_TO,args:n})},THREE.Path.prototype.quadraticCurveTo=function(t,e,n,r){var i=Array.prototype.slice.call(arguments),o=this.actions[this.actions.length-1].args,o=new THREE.QuadraticBezierCurve(new THREE.Vector2(o[o.length-2],o[o.length-1]),new THREE.Vector2(t,e),new THREE.Vector2(n,r));this.curves.push(o),this.actions.push({action:THREE.PathActions.QUADRATIC_CURVE_TO,args:i})},THREE.Path.prototype.bezierCurveTo=function(t,e,n,r,i,o){var a=Array.prototype.slice.call(arguments),s=this.actions[this.actions.length-1].args,s=new THREE.CubicBezierCurve(new THREE.Vector2(s[s.length-2],s[s.length-1]),new THREE.Vector2(t,e),new THREE.Vector2(n,r),new THREE.Vector2(i,o));this.curves.push(s),this.actions.push({action:THREE.PathActions.BEZIER_CURVE_TO,args:a})},THREE.Path.prototype.splineThru=function(t){var e=Array.prototype.slice.call(arguments),n=this.actions[this.actions.length-1].args,n=[new THREE.Vector2(n[n.length-2],n[n.length-1])];Array.prototype.push.apply(n,t),n=new THREE.SplineCurve(n),this.curves.push(n),this.actions.push({action:THREE.PathActions.CSPLINE_THRU,args:e})},THREE.Path.prototype.arc=function(t,e,n,r,i,o){var a=this.actions[this.actions.length-1].args;this.absarc(t+a[a.length-2],e+a[a.length-1],n,r,i,o)},THREE.Path.prototype.absarc=function(t,e,n,r,i,o){this.absellipse(t,e,n,n,r,i,o)},THREE.Path.prototype.ellipse=function(t,e,n,r,i,o,a){var s=this.actions[this.actions.length-1].args;this.absellipse(t+s[s.length-2],e+s[s.length-1],n,r,i,o,a)},THREE.Path.prototype.absellipse=function(t,e,n,r,i,o,a){var s=Array.prototype.slice.call(arguments),h=new THREE.EllipseCurve(t,e,n,r,i,o,a);this.curves.push(h),h=h.getPoint(1),s.push(h.x),s.push(h.y),this.actions.push({action:THREE.PathActions.ELLIPSE,args:s})},THREE.Path.prototype.getSpacedPoints=function(t){t||(t=40);for(var e=[],n=0;t>n;n++)e.push(this.getPoint(n/t));return e},THREE.Path.prototype.getPoints=function(t,e){if(this.useSpacedPoints)return console.log("tata"),this.getSpacedPoints(t,e);t=t||12;var n,r,i,o,a,s,h,u,c,l,f,p,d,m=[];for(n=0,r=this.actions.length;r>n;n++)switch(i=this.actions[n],o=i.action,i=i.args,o){case THREE.PathActions.MOVE_TO:m.push(new THREE.Vector2(i[0],i[1]));break;case THREE.PathActions.LINE_TO:m.push(new THREE.Vector2(i[0],i[1]));break;case THREE.PathActions.QUADRATIC_CURVE_TO:for(a=i[2],s=i[3],c=i[0],l=i[1],0<m.length?(o=m[m.length-1],f=o.x,p=o.y):(o=this.actions[n-1].args,f=o[o.length-2],p=o[o.length-1]),i=1;t>=i;i++)d=i/t,o=THREE.Shape.Utils.b2(d,f,c,a),d=THREE.Shape.Utils.b2(d,p,l,s),m.push(new THREE.Vector2(o,d));break;case THREE.PathActions.BEZIER_CURVE_TO:for(a=i[4],s=i[5],c=i[0],l=i[1],h=i[2],u=i[3],0<m.length?(o=m[m.length-1],f=o.x,p=o.y):(o=this.actions[n-1].args,f=o[o.length-2],p=o[o.length-1]),i=1;t>=i;i++)d=i/t,o=THREE.Shape.Utils.b3(d,f,c,h,a),d=THREE.Shape.Utils.b3(d,p,l,u,s),m.push(new THREE.Vector2(o,d));break;case THREE.PathActions.CSPLINE_THRU:for(o=this.actions[n-1].args,d=[new THREE.Vector2(o[o.length-2],o[o.length-1])],o=t*i[0].length,d=d.concat(i[0]),d=new THREE.SplineCurve(d),i=1;o>=i;i++)m.push(d.getPointAt(i/o));break;case THREE.PathActions.ARC:for(a=i[0],s=i[1],l=i[2],h=i[3],o=i[4],c=!!i[5],f=o-h,p=2*t,i=1;p>=i;i++)d=i/p,c||(d=1-d),d=h+d*f,o=a+l*Math.cos(d),d=s+l*Math.sin(d),m.push(new THREE.Vector2(o,d));break;case THREE.PathActions.ELLIPSE:for(a=i[0],s=i[1],l=i[2],u=i[3],h=i[4],o=i[5],c=!!i[6],f=o-h,p=2*t,i=1;p>=i;i++)d=i/p,c||(d=1-d),d=h+d*f,o=a+l*Math.cos(d),d=s+u*Math.sin(d),m.push(new THREE.Vector2(o,d))}return n=m[m.length-1],1e-10>Math.abs(n.x-m[0].x)&&1e-10>Math.abs(n.y-m[0].y)&&m.splice(m.length-1,1),e&&m.push(m[0]),m},THREE.Path.prototype.toShapes=function(t,e){function n(t){for(var e=[],n=0,r=t.length;r>n;n++){var i=t[n],o=new THREE.Shape;o.actions=i.actions,o.curves=i.curves,e.push(o)}return e}function r(t,e){for(var n=e.length,r=!1,i=n-1,o=0;n>o;i=o++){var a=e[i],s=e[o],h=s.x-a.x,u=s.y-a.y;if(1e-10<Math.abs(u)){if(0>u&&(a=e[o],h=-h,s=e[i],u=-u),!(t.y<a.y||t.y>s.y))if(t.y==a.y){if(t.x==a.x)return!0}else{if(i=u*(t.x-a.x)-h*(t.y-a.y),0==i)return!0;0>i||(r=!r)}}else if(t.y==a.y&&(s.x<=t.x&&t.x<=a.x||a.x<=t.x&&t.x<=s.x))return!0}return r}var i=function(t){var e,n,r,i,o=[],a=new THREE.Path;for(e=0,n=t.length;n>e;e++)r=t[e],i=r.args,r=r.action,r==THREE.PathActions.MOVE_TO&&0!=a.actions.length&&(o.push(a),a=new THREE.Path),a[r].apply(a,i);return 0!=a.actions.length&&o.push(a),o}(this.actions);if(0==i.length)return[];if(!0===e)return n(i);var o,a,s,h=[];if(1==i.length)return a=i[0],s=new THREE.Shape,s.actions=a.actions,s.curves=a.curves,h.push(s),h;var u=!THREE.Shape.Utils.isClockWise(i[0].getPoints()),u=t?!u:u;s=[];var c,l=[],f=[],p=0;l[p]=void 0,f[p]=[];var d,m;for(d=0,m=i.length;m>d;d++)a=i[d],c=a.getPoints(),o=THREE.Shape.Utils.isClockWise(c),(o=t?!o:o)?(!u&&l[p]&&p++,l[p]={s:new THREE.Shape,p:c},l[p].s.actions=a.actions,l[p].s.curves=a.curves,u&&p++,f[p]=[]):f[p].push({h:a,p:c[0]});if(!l[0])return n(i);if(1<l.length){for(d=!1,m=[],a=0,i=l.length;i>a;a++)s[a]=[];for(a=0,i=l.length;i>a;a++)for(o=f[a],u=0;u<o.length;u++){p=o[u],c=!0;for(var g=0;g<l.length;g++)r(p.p,l[g].p)&&(a!=g&&m.push({froms:a,tos:g,hole:u}),c?(c=!1,s[g].push(p)):d=!0);c&&s[a].push(p)}0<m.length&&(d||(f=s))}for(d=0,m=l.length;m>d;d++)for(s=l[d].s,h.push(s),a=f[d],i=0,o=a.length;o>i;i++)s.holes.push(a[i].h);return h},THREE.Shape=function(){THREE.Path.apply(this,arguments),this.holes=[]},THREE.Shape.prototype=Object.create(THREE.Path.prototype),THREE.Shape.prototype.extrude=function(t){return new THREE.ExtrudeGeometry(this,t)},THREE.Shape.prototype.makeGeometry=function(t){return new THREE.ShapeGeometry(this,t)},THREE.Shape.prototype.getPointsHoles=function(t){var e,n=this.holes.length,r=[];for(e=0;n>e;e++)r[e]=this.holes[e].getTransformedPoints(t,this.bends);return r},THREE.Shape.prototype.getSpacedPointsHoles=function(t){var e,n=this.holes.length,r=[];for(e=0;n>e;e++)r[e]=this.holes[e].getTransformedSpacedPoints(t,this.bends);return r},THREE.Shape.prototype.extractAllPoints=function(t){return{shape:this.getTransformedPoints(t),holes:this.getPointsHoles(t)}},THREE.Shape.prototype.extractPoints=function(t){return this.useSpacedPoints?this.extractAllSpacedPoints(t):this.extractAllPoints(t)},THREE.Shape.prototype.extractAllSpacedPoints=function(t){return{shape:this.getTransformedSpacedPoints(t),holes:this.getSpacedPointsHoles(t)}},THREE.Shape.Utils={triangulateShape:function(t,e){function n(t,e,n){return t.x!=e.x?t.x<e.x?t.x<=n.x&&n.x<=e.x:e.x<=n.x&&n.x<=t.x:t.y<e.y?t.y<=n.y&&n.y<=e.y:e.y<=n.y&&n.y<=t.y}function r(t,e,r,i,o){var a=e.x-t.x,s=e.y-t.y,h=i.x-r.x,u=i.y-r.y,c=t.x-r.x,l=t.y-r.y,f=s*h-a*u,p=s*c-a*l;if(1e-10<Math.abs(f)){if(f>0){if(0>p||p>f)return[];if(h=u*c-h*l,0>h||h>f)return[]}else{if(p>0||f>p)return[];if(h=u*c-h*l,h>0||f>h)return[]}return 0==h?!o||0!=p&&p!=f?[t]:[]:h==f?!o||0!=p&&p!=f?[e]:[]:0==p?[r]:p==f?[i]:(o=h/f,[{x:t.x+o*a,y:t.y+o*s}])}return 0!=p||u*c!=h*l?[]:(s=0==a&&0==s,h=0==h&&0==u,s&&h?t.x!=r.x||t.y!=r.y?[]:[t]:s?n(r,i,t)?[t]:[]:h?n(t,e,r)?[r]:[]:(0!=a?(t.x<e.x?(a=t,h=t.x,s=e,t=e.x):(a=e,h=e.x,s=t,t=t.x),r.x<i.x?(e=r,f=r.x,u=i,r=i.x):(e=i,f=i.x,u=r,r=r.x)):(t.y<e.y?(a=t,h=t.y,s=e,t=e.y):(a=e,h=e.y,s=t,t=t.y),r.y<i.y?(e=r,f=r.y,u=i,r=i.y):(e=i,f=i.y,u=r,r=r.y)),f>=h?f>t?[]:t==f?o?[]:[e]:r>=t?[e,s]:[e,u]:h>r?[]:h==r?o?[]:[a]:r>=t?[a,s]:[a,u]))}function i(t,e,n,r){var i=e.x-t.x,o=e.y-t.y;e=n.x-t.x,n=n.y-t.y;var a=r.x-t.x;return r=r.y-t.y,t=i*n-o*e,i=i*r-o*a,1e-10<Math.abs(t)?(e=a*n-r*e,t>0?i>=0&&e>=0:i>=0||e>=0):i>0}var o,a,s,h,u,c={};for(s=t.concat(),o=0,a=e.length;a>o;o++)Array.prototype.push.apply(s,e[o]);for(o=0,a=s.length;a>o;o++)u=s[o].x+":"+s[o].y,void 0!==c[u]&&console.log("Duplicate point",u),c[u]=o;o=function(t,e){function n(t,e){var n=g.length-1,r=t-1;0>r&&(r=n);var o=t+1;return o>n&&(o=0),(n=i(g[t],g[r],g[o],s[e]))?(n=s.length-1,r=e-1,0>r&&(r=n),o=e+1,o>n&&(o=0),(n=i(s[e],s[r],s[o],g[t]))?!0:!1):!1}function o(t,e){var n,i;for(n=0;n<g.length;n++)if(i=n+1,i%=g.length,i=r(t,e,g[n],g[i],!0),0<i.length)return!0;return!1}function a(t,n){var i,o,a,s;for(i=0;i<v.length;i++)for(o=e[v[i]],a=0;a<o.length;a++)if(s=a+1,s%=o.length,s=r(t,n,o[a],o[s],!0),0<s.length)return!0;return!1}var s,h,u,c,l,f,p,d,m,g=t.concat(),v=[],y=[],E=0;for(h=e.length;h>E;E++)v.push(E);p=0;for(var x=2*v.length;0<v.length;){if(x--,0>x){console.log("Infinite Loop! Holes left:"+v.length+", Probably Hole outside Shape!");break}for(u=p;u<g.length;u++){for(c=g[u],h=-1,E=0;E<v.length;E++)if(l=v[E],f=c.x+":"+c.y+":"+l,void 0===y[f]){for(s=e[l],d=0;d<s.length;d++)if(l=s[d],n(u,d)&&!o(c,l)&&!a(c,l)){h=d,v.splice(E,1),p=g.slice(0,u+1),l=g.slice(u),d=s.slice(h),m=s.slice(0,h+1),g=p.concat(d).concat(m).concat(l),p=u;break}if(h>=0)break;y[f]=!0}if(h>=0)break}}return g}(t,e);var l=THREE.FontUtils.Triangulate(o,!1);for(o=0,a=l.length;a>o;o++)for(h=l[o],s=0;3>s;s++)u=h[s].x+":"+h[s].y,u=c[u],void 0!==u&&(h[s]=u);return l.concat()},isClockWise:function(t){return 0>THREE.FontUtils.Triangulate.area(t)},b2p0:function(t,e){var n=1-t;return n*n*e},b2p1:function(t,e){return 2*(1-t)*t*e},b2p2:function(t,e){return t*t*e},b2:function(t,e,n,r){return this.b2p0(t,e)+this.b2p1(t,n)+this.b2p2(t,r)},b3p0:function(t,e){var n=1-t;return n*n*n*e},b3p1:function(t,e){var n=1-t;return 3*n*n*t*e},b3p2:function(t,e){return 3*(1-t)*t*t*e},b3p3:function(t,e){return t*t*t*e},b3:function(t,e,n,r,i){return this.b3p0(t,e)+this.b3p1(t,n)+this.b3p2(t,r)+this.b3p3(t,i)}},THREE.LineCurve=function(t,e){this.v1=t,this.v2=e},THREE.LineCurve.prototype=Object.create(THREE.Curve.prototype),THREE.LineCurve.prototype.getPoint=function(t){var e=this.v2.clone().sub(this.v1);return e.multiplyScalar(t).add(this.v1),e},THREE.LineCurve.prototype.getPointAt=function(t){return this.getPoint(t)},THREE.LineCurve.prototype.getTangent=function(){return this.v2.clone().sub(this.v1).normalize()},THREE.QuadraticBezierCurve=function(t,e,n){this.v0=t,this.v1=e,this.v2=n},THREE.QuadraticBezierCurve.prototype=Object.create(THREE.Curve.prototype),THREE.QuadraticBezierCurve.prototype.getPoint=function(t){var e;return e=THREE.Shape.Utils.b2(t,this.v0.x,this.v1.x,this.v2.x),t=THREE.Shape.Utils.b2(t,this.v0.y,this.v1.y,this.v2.y),new THREE.Vector2(e,t)},THREE.QuadraticBezierCurve.prototype.getTangent=function(t){var e;return e=THREE.Curve.Utils.tangentQuadraticBezier(t,this.v0.x,this.v1.x,this.v2.x),t=THREE.Curve.Utils.tangentQuadraticBezier(t,this.v0.y,this.v1.y,this.v2.y),e=new THREE.Vector2(e,t),e.normalize(),e},THREE.CubicBezierCurve=function(t,e,n,r){this.v0=t,this.v1=e,this.v2=n,this.v3=r},THREE.CubicBezierCurve.prototype=Object.create(THREE.Curve.prototype),THREE.CubicBezierCurve.prototype.getPoint=function(t){var e;return e=THREE.Shape.Utils.b3(t,this.v0.x,this.v1.x,this.v2.x,this.v3.x),t=THREE.Shape.Utils.b3(t,this.v0.y,this.v1.y,this.v2.y,this.v3.y),new THREE.Vector2(e,t)},THREE.CubicBezierCurve.prototype.getTangent=function(t){var e;return e=THREE.Curve.Utils.tangentCubicBezier(t,this.v0.x,this.v1.x,this.v2.x,this.v3.x),t=THREE.Curve.Utils.tangentCubicBezier(t,this.v0.y,this.v1.y,this.v2.y,this.v3.y),e=new THREE.Vector2(e,t),e.normalize(),e
},THREE.SplineCurve=function(t){this.points=void 0==t?[]:t},THREE.SplineCurve.prototype=Object.create(THREE.Curve.prototype),THREE.SplineCurve.prototype.getPoint=function(t){var e,n=new THREE.Vector2,r=[],i=this.points;return e=(i.length-1)*t,t=Math.floor(e),e-=t,r[0]=0==t?t:t-1,r[1]=t,r[2]=t>i.length-2?i.length-1:t+1,r[3]=t>i.length-3?i.length-1:t+2,n.x=THREE.Curve.Utils.interpolate(i[r[0]].x,i[r[1]].x,i[r[2]].x,i[r[3]].x,e),n.y=THREE.Curve.Utils.interpolate(i[r[0]].y,i[r[1]].y,i[r[2]].y,i[r[3]].y,e),n},THREE.EllipseCurve=function(t,e,n,r,i,o,a){this.aX=t,this.aY=e,this.xRadius=n,this.yRadius=r,this.aStartAngle=i,this.aEndAngle=o,this.aClockwise=a},THREE.EllipseCurve.prototype=Object.create(THREE.Curve.prototype),THREE.EllipseCurve.prototype.getPoint=function(t){var e;return e=this.aEndAngle-this.aStartAngle,0>e&&(e+=2*Math.PI),e>2*Math.PI&&(e-=2*Math.PI),e=!0===this.aClockwise?this.aEndAngle+(1-t)*(2*Math.PI-e):this.aStartAngle+t*e,t=this.aX+this.xRadius*Math.cos(e),e=this.aY+this.yRadius*Math.sin(e),new THREE.Vector2(t,e)},THREE.ArcCurve=function(t,e,n,r,i,o){THREE.EllipseCurve.call(this,t,e,n,n,r,i,o)},THREE.ArcCurve.prototype=Object.create(THREE.EllipseCurve.prototype),THREE.LineCurve3=THREE.Curve.create(function(t,e){this.v1=t,this.v2=e},function(t){var e=new THREE.Vector3;return e.subVectors(this.v2,this.v1),e.multiplyScalar(t),e.add(this.v1),e}),THREE.QuadraticBezierCurve3=THREE.Curve.create(function(t,e,n){this.v0=t,this.v1=e,this.v2=n},function(t){var e,n;return e=THREE.Shape.Utils.b2(t,this.v0.x,this.v1.x,this.v2.x),n=THREE.Shape.Utils.b2(t,this.v0.y,this.v1.y,this.v2.y),t=THREE.Shape.Utils.b2(t,this.v0.z,this.v1.z,this.v2.z),new THREE.Vector3(e,n,t)}),THREE.CubicBezierCurve3=THREE.Curve.create(function(t,e,n,r){this.v0=t,this.v1=e,this.v2=n,this.v3=r},function(t){var e,n;return e=THREE.Shape.Utils.b3(t,this.v0.x,this.v1.x,this.v2.x,this.v3.x),n=THREE.Shape.Utils.b3(t,this.v0.y,this.v1.y,this.v2.y,this.v3.y),t=THREE.Shape.Utils.b3(t,this.v0.z,this.v1.z,this.v2.z,this.v3.z),new THREE.Vector3(e,n,t)}),THREE.SplineCurve3=THREE.Curve.create(function(t){this.points=void 0==t?[]:t},function(t){var e,n=new THREE.Vector3,r=[],i=this.points;t*=i.length-1,e=Math.floor(t),t-=e,r[0]=0==e?e:e-1,r[1]=e,r[2]=e>i.length-2?i.length-1:e+1,r[3]=e>i.length-3?i.length-1:e+2,e=i[r[0]];var o=i[r[1]],a=i[r[2]],r=i[r[3]];return n.x=THREE.Curve.Utils.interpolate(e.x,o.x,a.x,r.x,t),n.y=THREE.Curve.Utils.interpolate(e.y,o.y,a.y,r.y,t),n.z=THREE.Curve.Utils.interpolate(e.z,o.z,a.z,r.z,t),n}),THREE.ClosedSplineCurve3=THREE.Curve.create(function(t){this.points=void 0==t?[]:t},function(t){var e,n=new THREE.Vector3,r=[],i=this.points;return e=(i.length-0)*t,t=Math.floor(e),e-=t,t+=t>0?0:(Math.floor(Math.abs(t)/i.length)+1)*i.length,r[0]=(t-1)%i.length,r[1]=t%i.length,r[2]=(t+1)%i.length,r[3]=(t+2)%i.length,n.x=THREE.Curve.Utils.interpolate(i[r[0]].x,i[r[1]].x,i[r[2]].x,i[r[3]].x,e),n.y=THREE.Curve.Utils.interpolate(i[r[0]].y,i[r[1]].y,i[r[2]].y,i[r[3]].y,e),n.z=THREE.Curve.Utils.interpolate(i[r[0]].z,i[r[1]].z,i[r[2]].z,i[r[3]].z,e),n}),THREE.AnimationHandler={LINEAR:0,CATMULLROM:1,CATMULLROM_FORWARD:2,add:function(){console.warn("THREE.AnimationHandler.add() has been deprecated.")},get:function(){console.warn("THREE.AnimationHandler.get() has been deprecated.")},remove:function(){console.warn("THREE.AnimationHandler.remove() has been deprecated.")},animations:[],init:function(t){if(!0!==t.initialized){for(var e=0;e<t.hierarchy.length;e++){for(var n=0;n<t.hierarchy[e].keys.length;n++)if(0>t.hierarchy[e].keys[n].time&&(t.hierarchy[e].keys[n].time=0),void 0!==t.hierarchy[e].keys[n].rot&&!(t.hierarchy[e].keys[n].rot instanceof THREE.Quaternion)){var r=t.hierarchy[e].keys[n].rot;t.hierarchy[e].keys[n].rot=(new THREE.Quaternion).fromArray(r)}if(t.hierarchy[e].keys.length&&void 0!==t.hierarchy[e].keys[0].morphTargets){for(r={},n=0;n<t.hierarchy[e].keys.length;n++)for(var i=0;i<t.hierarchy[e].keys[n].morphTargets.length;i++){var o=t.hierarchy[e].keys[n].morphTargets[i];r[o]=-1}for(t.hierarchy[e].usedMorphTargets=r,n=0;n<t.hierarchy[e].keys.length;n++){var a={};for(o in r){for(i=0;i<t.hierarchy[e].keys[n].morphTargets.length;i++)if(t.hierarchy[e].keys[n].morphTargets[i]===o){a[o]=t.hierarchy[e].keys[n].morphTargetsInfluences[i];break}i===t.hierarchy[e].keys[n].morphTargets.length&&(a[o]=0)}t.hierarchy[e].keys[n].morphTargetsInfluences=a}}for(n=1;n<t.hierarchy[e].keys.length;n++)t.hierarchy[e].keys[n].time===t.hierarchy[e].keys[n-1].time&&(t.hierarchy[e].keys.splice(n,1),n--);for(n=0;n<t.hierarchy[e].keys.length;n++)t.hierarchy[e].keys[n].index=n}return t.initialized=!0,t}},parse:function(t){var e=function(t,n){n.push(t);for(var r=0;r<t.children.length;r++)e(t.children[r],n)},n=[];if(t instanceof THREE.SkinnedMesh)for(var r=0;r<t.skeleton.bones.length;r++)n.push(t.skeleton.bones[r]);else e(t,n);return n},play:function(t){-1===this.animations.indexOf(t)&&this.animations.push(t)},stop:function(t){t=this.animations.indexOf(t),-1!==t&&this.animations.splice(t,1)},update:function(t){for(var e=0;e<this.animations.length;e++)this.animations[e].update(t)}},THREE.Animation=function(t,e){this.root=t,this.data=THREE.AnimationHandler.init(e),this.hierarchy=THREE.AnimationHandler.parse(t),this.currentTime=0,this.timeScale=1,this.isPlaying=!1,this.loop=!0,this.weight=0,this.interpolationType=THREE.AnimationHandler.LINEAR},THREE.Animation.prototype.keyTypes=["pos","rot","scl"],THREE.Animation.prototype.play=function(t,e){this.currentTime=void 0!==t?t:0,this.weight=void 0!==e?e:1,this.isPlaying=!0,this.reset(),THREE.AnimationHandler.play(this)},THREE.Animation.prototype.stop=function(){this.isPlaying=!1,THREE.AnimationHandler.stop(this)},THREE.Animation.prototype.reset=function(){for(var t=0,e=this.hierarchy.length;e>t;t++){var n=this.hierarchy[t];n.matrixAutoUpdate=!0,void 0===n.animationCache&&(n.animationCache={}),void 0===n.animationCache[this.data.name]&&(n.animationCache[this.data.name]={},n.animationCache[this.data.name].prevKey={pos:0,rot:0,scl:0},n.animationCache[this.data.name].nextKey={pos:0,rot:0,scl:0},n.animationCache[this.data.name].originalMatrix=n.matrix);for(var n=n.animationCache[this.data.name],r=0;3>r;r++){for(var i=this.keyTypes[r],o=this.data.hierarchy[t].keys[0],a=this.getNextKeyWith(i,t,1);a.time<this.currentTime&&a.index>o.index;)o=a,a=this.getNextKeyWith(i,t,a.index+1);n.prevKey[i]=o,n.nextKey[i]=a}}},THREE.Animation.prototype.update=function(){var t=[],e=new THREE.Vector3,n=new THREE.Vector3,r=new THREE.Quaternion,i=function(t,e){var n,r,i,a,s,h,u=[],c=[];return n=(t.length-1)*e,r=Math.floor(n),n-=r,u[0]=0===r?r:r-1,u[1]=r,u[2]=r>t.length-2?r:r+1,u[3]=r>t.length-3?r:r+2,r=t[u[0]],a=t[u[1]],s=t[u[2]],h=t[u[3]],u=n*n,i=n*u,c[0]=o(r[0],a[0],s[0],h[0],n,u,i),c[1]=o(r[1],a[1],s[1],h[1],n,u,i),c[2]=o(r[2],a[2],s[2],h[2],n,u,i),c},o=function(t,e,n,r,i,o,a){return t=.5*(n-t),r=.5*(r-e),(2*(e-n)+t+r)*a+(-3*(e-n)-2*t-r)*o+t*i+e};return function(o){if(!1!==this.isPlaying&&(this.currentTime+=o*this.timeScale,0!==this.weight)){if(o=this.data.length,!0===this.loop&&this.currentTime>o)this.currentTime%=o,this.reset();else if(!1===this.loop&&this.currentTime>o)return void this.stop();o=0;for(var a=this.hierarchy.length;a>o;o++)for(var s=this.hierarchy[o],h=s.animationCache[this.data.name],u=0;3>u;u++){var c=this.keyTypes[u],l=h.prevKey[c],f=h.nextKey[c];if(f.time<=this.currentTime){for(l=this.data.hierarchy[o].keys[0],f=this.getNextKeyWith(c,o,1);f.time<this.currentTime&&f.index>l.index;)l=f,f=this.getNextKeyWith(c,o,f.index+1);h.prevKey[c]=l,h.nextKey[c]=f}s.matrixAutoUpdate=!0,s.matrixWorldNeedsUpdate=!0;var p=(this.currentTime-l.time)/(f.time-l.time),d=l[c],m=f[c];0>p&&(p=0),p>1&&(p=1),"pos"===c?this.interpolationType===THREE.AnimationHandler.LINEAR?(n.x=d[0]+(m[0]-d[0])*p,n.y=d[1]+(m[1]-d[1])*p,n.z=d[2]+(m[2]-d[2])*p,s instanceof THREE.Bone?(l=this.weight/(this.weight+s.accumulatedPosWeight),s.position.lerp(n,l),s.accumulatedPosWeight+=this.weight):s.position.copy(n)):(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD)&&(t[0]=this.getPrevKeyWith("pos",o,l.index-1).pos,t[1]=d,t[2]=m,t[3]=this.getNextKeyWith("pos",o,f.index+1).pos,p=.33*p+.33,f=i(t,p),l=1,s instanceof THREE.Bone&&(l=this.weight/(this.weight+s.accumulatedPosWeight),s.accumulatedPosWeight+=this.weight),c=s.position,c.x+=(f[0]-c.x)*l,c.y+=(f[1]-c.y)*l,c.z+=(f[2]-c.z)*l,this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD&&(p=i(t,1.01*p),e.set(p[0],p[1],p[2]),e.sub(c),e.y=0,e.normalize(),p=Math.atan2(e.x,e.z),s.rotation.set(0,p,0))):"rot"===c?(THREE.Quaternion.slerp(d,m,r,p),s instanceof THREE.Bone?0===s.accumulatedRotWeight?(s.quaternion.copy(r),s.accumulatedRotWeight=this.weight):(l=this.weight/(this.weight+s.accumulatedRotWeight),THREE.Quaternion.slerp(s.quaternion,r,s.quaternion,l),s.accumulatedRotWeight+=this.weight):s.quaternion.copy(r)):"scl"===c&&(n.x=d[0]+(m[0]-d[0])*p,n.y=d[1]+(m[1]-d[1])*p,n.z=d[2]+(m[2]-d[2])*p,s instanceof THREE.Bone?(l=this.weight/(this.weight+s.accumulatedSclWeight),s.scale.lerp(n,l),s.accumulatedSclWeight+=this.weight):s.scale.copy(n))}return!0}}}(),THREE.Animation.prototype.getNextKeyWith=function(t,e,n){var r=this.data.hierarchy[e].keys;for(n=this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD?n<r.length-1?n:r.length-1:n%r.length;n<r.length;n++)if(void 0!==r[n][t])return r[n];return this.data.hierarchy[e].keys[0]},THREE.Animation.prototype.getPrevKeyWith=function(t,e,n){var r=this.data.hierarchy[e].keys;for(n=this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD?n>0?n:0:n>=0?n:n+r.length;n>=0;n--)if(void 0!==r[n][t])return r[n];return this.data.hierarchy[e].keys[r.length-1]},THREE.KeyFrameAnimation=function(t){this.root=t.node,this.data=THREE.AnimationHandler.init(t),this.hierarchy=THREE.AnimationHandler.parse(this.root),this.currentTime=0,this.timeScale=.001,this.isPlaying=!1,this.loop=this.isPaused=!0,t=0;for(var e=this.hierarchy.length;e>t;t++){var n=this.data.hierarchy[t].sids,r=this.hierarchy[t];if(this.data.hierarchy[t].keys.length&&n){for(var i=0;i<n.length;i++){var o=n[i],a=this.getNextKeyWith(o,t,0);a&&a.apply(o)}r.matrixAutoUpdate=!1,this.data.hierarchy[t].node.updateMatrix(),r.matrixWorldNeedsUpdate=!0}}},THREE.KeyFrameAnimation.prototype.play=function(t){if(this.currentTime=void 0!==t?t:0,!1===this.isPlaying){this.isPlaying=!0;var e,n,r=this.hierarchy.length;for(t=0;r>t;t++)e=this.hierarchy[t],n=this.data.hierarchy[t],void 0===n.animationCache&&(n.animationCache={},n.animationCache.prevKey=null,n.animationCache.nextKey=null,n.animationCache.originalMatrix=e.matrix),e=this.data.hierarchy[t].keys,e.length&&(n.animationCache.prevKey=e[0],n.animationCache.nextKey=e[1],this.startTime=Math.min(e[0].time,this.startTime),this.endTime=Math.max(e[e.length-1].time,this.endTime));this.update(0)}this.isPaused=!1,THREE.AnimationHandler.play(this)},THREE.KeyFrameAnimation.prototype.stop=function(){this.isPaused=this.isPlaying=!1,THREE.AnimationHandler.stop(this);for(var t=0;t<this.data.hierarchy.length;t++){var e=this.hierarchy[t],n=this.data.hierarchy[t];if(void 0!==n.animationCache){var r=n.animationCache.originalMatrix;r.copy(e.matrix),e.matrix=r,delete n.animationCache}}},THREE.KeyFrameAnimation.prototype.update=function(t){if(!1!==this.isPlaying){this.currentTime+=t*this.timeScale,t=this.data.length,!0===this.loop&&this.currentTime>t&&(this.currentTime%=t),this.currentTime=Math.min(this.currentTime,t),t=0;for(var e=this.hierarchy.length;e>t;t++){var n=this.hierarchy[t],r=this.data.hierarchy[t],i=r.keys,r=r.animationCache;if(i.length){var o=r.prevKey,a=r.nextKey;if(a.time<=this.currentTime){for(;a.time<this.currentTime&&a.index>o.index;)o=a,a=i[o.index+1];r.prevKey=o,r.nextKey=a}a.time>=this.currentTime?o.interpolate(a,this.currentTime):o.interpolate(a,a.time),this.data.hierarchy[t].node.updateMatrix(),n.matrixWorldNeedsUpdate=!0}}}},THREE.KeyFrameAnimation.prototype.getNextKeyWith=function(t,e,n){for(e=this.data.hierarchy[e].keys,n%=e.length;n<e.length;n++)if(e[n].hasTarget(t))return e[n];return e[0]},THREE.KeyFrameAnimation.prototype.getPrevKeyWith=function(t,e,n){for(e=this.data.hierarchy[e].keys,n=n>=0?n:n+e.length;n>=0;n--)if(e[n].hasTarget(t))return e[n];return e[e.length-1]},THREE.MorphAnimation=function(t){this.mesh=t,this.frames=t.morphTargetInfluences.length,this.currentTime=0,this.duration=1e3,this.loop=!0,this.isPlaying=!1},THREE.MorphAnimation.prototype={play:function(){this.isPlaying=!0},pause:function(){this.isPlaying=!1},update:function(){var t=0,e=0;return function(n){if(!1!==this.isPlaying){this.currentTime+=n,!0===this.loop&&this.currentTime>this.duration&&(this.currentTime%=this.duration),this.currentTime=Math.min(this.currentTime,this.duration),n=this.duration/this.frames;var r=Math.floor(this.currentTime/n);r!=e&&(this.mesh.morphTargetInfluences[t]=0,this.mesh.morphTargetInfluences[e]=1,this.mesh.morphTargetInfluences[r]=0,t=e,e=r),this.mesh.morphTargetInfluences[r]=this.currentTime%n/n,this.mesh.morphTargetInfluences[t]=1-this.mesh.morphTargetInfluences[r]}}}()},THREE.BoxGeometry=function(t,e,n,r,i,o){function a(t,e,n,r,i,o,a,h){var u,c=s.widthSegments,l=s.heightSegments,f=i/2,p=o/2,d=s.vertices.length;"x"===t&&"y"===e||"y"===t&&"x"===e?u="z":"x"===t&&"z"===e||"z"===t&&"x"===e?(u="y",l=s.depthSegments):("z"===t&&"y"===e||"y"===t&&"z"===e)&&(u="x",c=s.depthSegments);var m=c+1,g=l+1,v=i/c,y=o/l,E=new THREE.Vector3;for(E[u]=a>0?1:-1,i=0;g>i;i++)for(o=0;m>o;o++){var x=new THREE.Vector3;x[t]=(o*v-f)*n,x[e]=(i*y-p)*r,x[u]=a,s.vertices.push(x)}for(i=0;l>i;i++)for(o=0;c>o;o++)p=o+m*i,t=o+m*(i+1),e=o+1+m*(i+1),n=o+1+m*i,r=new THREE.Vector2(o/c,1-i/l),a=new THREE.Vector2(o/c,1-(i+1)/l),u=new THREE.Vector2((o+1)/c,1-(i+1)/l),f=new THREE.Vector2((o+1)/c,1-i/l),p=new THREE.Face3(p+d,t+d,n+d),p.normal.copy(E),p.vertexNormals.push(E.clone(),E.clone(),E.clone()),p.materialIndex=h,s.faces.push(p),s.faceVertexUvs[0].push([r,a,f]),p=new THREE.Face3(t+d,e+d,n+d),p.normal.copy(E),p.vertexNormals.push(E.clone(),E.clone(),E.clone()),p.materialIndex=h,s.faces.push(p),s.faceVertexUvs[0].push([a.clone(),u,f.clone()])}THREE.Geometry.call(this),this.parameters={width:t,height:e,depth:n,widthSegments:r,heightSegments:i,depthSegments:o},this.widthSegments=r||1,this.heightSegments=i||1,this.depthSegments=o||1;var s=this;r=t/2,i=e/2,o=n/2,a("z","y",-1,-1,n,e,r,0),a("z","y",1,-1,n,e,-r,1),a("x","z",1,1,t,n,i,2),a("x","z",1,-1,t,n,-i,3),a("x","y",1,-1,t,e,o,4),a("x","y",-1,-1,t,e,-o,5),this.mergeVertices()},THREE.BoxGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.CircleGeometry=function(t,e,n,r){THREE.Geometry.call(this),this.parameters={radius:t,segments:e,thetaStart:n,thetaLength:r},t=t||50,e=void 0!==e?Math.max(3,e):8,n=void 0!==n?n:0,r=void 0!==r?r:2*Math.PI;var i,o=[];i=new THREE.Vector3;var a=new THREE.Vector2(.5,.5);for(this.vertices.push(i),o.push(a),i=0;e>=i;i++){var s=new THREE.Vector3,h=n+i/e*r;s.x=t*Math.cos(h),s.y=t*Math.sin(h),this.vertices.push(s),o.push(new THREE.Vector2((s.x/t+1)/2,(s.y/t+1)/2))}for(n=new THREE.Vector3(0,0,1),i=1;e>=i;i++)this.faces.push(new THREE.Face3(i,i+1,0,[n.clone(),n.clone(),n.clone()])),this.faceVertexUvs[0].push([o[i].clone(),o[i+1].clone(),a.clone()]);this.computeFaceNormals(),this.boundingSphere=new THREE.Sphere(new THREE.Vector3,t)},THREE.CircleGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.CubeGeometry=function(t,e,n,r,i,o){return console.warn("THEE.CubeGeometry has been renamed to THREE.BoxGeometry."),new THREE.BoxGeometry(t,e,n,r,i,o)},THREE.CylinderGeometry=function(t,e,n,r,i,o){THREE.Geometry.call(this),this.parameters={radiusTop:t,radiusBottom:e,height:n,radialSegments:r,heightSegments:i,openEnded:o},t=void 0!==t?t:20,e=void 0!==e?e:20,n=void 0!==n?n:100,r=r||8,i=i||1,o=void 0!==o?o:!1;var a,s,h=n/2,u=[],c=[];for(s=0;i>=s;s++){var l=[],f=[],p=s/i,d=p*(e-t)+t;for(a=0;r>=a;a++){var m=a/r,g=new THREE.Vector3;g.x=d*Math.sin(m*Math.PI*2),g.y=-p*n+h,g.z=d*Math.cos(m*Math.PI*2),this.vertices.push(g),l.push(this.vertices.length-1),f.push(new THREE.Vector2(m,1-p))}u.push(l),c.push(f)}for(n=(e-t)/n,a=0;r>a;a++)for(0!==t?(l=this.vertices[u[0][a]].clone(),f=this.vertices[u[0][a+1]].clone()):(l=this.vertices[u[1][a]].clone(),f=this.vertices[u[1][a+1]].clone()),l.setY(Math.sqrt(l.x*l.x+l.z*l.z)*n).normalize(),f.setY(Math.sqrt(f.x*f.x+f.z*f.z)*n).normalize(),s=0;i>s;s++){var p=u[s][a],d=u[s+1][a],m=u[s+1][a+1],g=u[s][a+1],v=l.clone(),y=l.clone(),E=f.clone(),x=f.clone(),T=c[s][a].clone(),b=c[s+1][a].clone(),R=c[s+1][a+1].clone(),w=c[s][a+1].clone();this.faces.push(new THREE.Face3(p,d,g,[v,y,x])),this.faceVertexUvs[0].push([T,b,w]),this.faces.push(new THREE.Face3(d,m,g,[y.clone(),E,x.clone()])),this.faceVertexUvs[0].push([b.clone(),R,w.clone()])}if(!1===o&&t>0)for(this.vertices.push(new THREE.Vector3(0,h,0)),a=0;r>a;a++)p=u[0][a],d=u[0][a+1],m=this.vertices.length-1,v=new THREE.Vector3(0,1,0),y=new THREE.Vector3(0,1,0),E=new THREE.Vector3(0,1,0),T=c[0][a].clone(),b=c[0][a+1].clone(),R=new THREE.Vector2(b.x,0),this.faces.push(new THREE.Face3(p,d,m,[v,y,E])),this.faceVertexUvs[0].push([T,b,R]);if(!1===o&&e>0)for(this.vertices.push(new THREE.Vector3(0,-h,0)),a=0;r>a;a++)p=u[s][a+1],d=u[s][a],m=this.vertices.length-1,v=new THREE.Vector3(0,-1,0),y=new THREE.Vector3(0,-1,0),E=new THREE.Vector3(0,-1,0),T=c[s][a+1].clone(),b=c[s][a].clone(),R=new THREE.Vector2(b.x,1),this.faces.push(new THREE.Face3(p,d,m,[v,y,E])),this.faceVertexUvs[0].push([T,b,R]);this.computeFaceNormals()},THREE.CylinderGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.ExtrudeGeometry=function(t,e){"undefined"!=typeof t&&(THREE.Geometry.call(this),t=t instanceof Array?t:[t],this.addShapeList(t,e),this.computeFaceNormals())},THREE.ExtrudeGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.ExtrudeGeometry.prototype.addShapeList=function(t,e){for(var n=t.length,r=0;n>r;r++)this.addShape(t[r],e)},THREE.ExtrudeGeometry.prototype.addShape=function(t,e){function n(t,e,n){return e||console.log("die"),e.clone().multiplyScalar(n).add(t)}function r(t,e,n){var r=THREE.Math.sign,i=1,i=t.x-e.x,o=t.y-e.y,a=n.x-t.x,s=n.y-t.y,h=i*i+o*o;if(1e-10<Math.abs(i*s-o*a)){var u=Math.sqrt(h),r=Math.sqrt(a*a+s*s),h=e.x-o/u;if(e=e.y+i/u,a=((n.x-s/r-h)*s-(n.y+a/r-e)*a)/(i*s-o*a),n=h+i*a-t.x,t=e+o*a-t.y,i=n*n+t*t,2>=i)return new THREE.Vector2(n,t);i=Math.sqrt(i/2)}else t=!1,i>1e-10?a>1e-10&&(t=!0):-1e-10>i?-1e-10>a&&(t=!0):r(o)==r(s)&&(t=!0),t?(n=-o,t=i,i=Math.sqrt(h)):(n=i,t=o,i=Math.sqrt(h/2));return new THREE.Vector2(n/i,t/i)}function i(n,r){var i,o;for(B=n.length;0<=--B;){i=B,o=B-1,0>o&&(o=n.length-1);for(var a=0,s=y+2*m,a=0;s>a;a++){var h=V*a,u=V*(a+1),c=r+i+h,h=r+o+h,l=r+o+u,u=r+i+u,f=n,p=a,d=s,g=i,v=o,c=c+S,h=h+S,l=l+S,u=u+S;M.faces.push(new THREE.Face3(c,h,u,null,null,b)),M.faces.push(new THREE.Face3(h,l,u,null,null,b)),c=R.generateSideWallUV(M,t,f,e,c,h,l,u,p,d,g,v),M.faceVertexUvs[0].push([c[0],c[1],c[3]]),M.faceVertexUvs[0].push([c[1],c[2],c[3]])}}}function o(t,e,n){M.vertices.push(new THREE.Vector3(t,e,n))}function a(n,r,i,o){n+=S,r+=S,i+=S,M.faces.push(new THREE.Face3(n,r,i,null,null,T)),n=o?R.generateBottomUV(M,t,e,n,r,i):R.generateTopUV(M,t,e,n,r,i),M.faceVertexUvs[0].push(n)}var s,h,u,c,l,f=void 0!==e.amount?e.amount:100,p=void 0!==e.bevelThickness?e.bevelThickness:6,d=void 0!==e.bevelSize?e.bevelSize:p-2,m=void 0!==e.bevelSegments?e.bevelSegments:3,g=void 0!==e.bevelEnabled?e.bevelEnabled:!0,v=void 0!==e.curveSegments?e.curveSegments:12,y=void 0!==e.steps?e.steps:1,E=e.extrudePath,x=!1,T=e.material,b=e.extrudeMaterial,R=void 0!==e.UVGenerator?e.UVGenerator:THREE.ExtrudeGeometry.WorldUVGenerator;E&&(s=E.getSpacedPoints(y),x=!0,g=!1,h=void 0!==e.frames?e.frames:new THREE.TubeGeometry.FrenetFrames(E,y,!1),u=new THREE.Vector3,c=new THREE.Vector3,l=new THREE.Vector3),g||(d=p=m=0);var w,_,H,M=this,S=this.vertices.length,E=t.extractPoints(v),v=E.shape,C=E.holes;if(E=!THREE.Shape.Utils.isClockWise(v)){for(v=v.reverse(),_=0,H=C.length;H>_;_++)w=C[_],THREE.Shape.Utils.isClockWise(w)&&(C[_]=w.reverse());E=!1}var A=THREE.Shape.Utils.triangulateShape(v,C),L=v;for(_=0,H=C.length;H>_;_++)w=C[_],v=v.concat(w);var P,D,z,F,k,N,V=v.length,I=A.length,E=[],B=0;for(z=L.length,P=z-1,D=B+1;z>B;B++,P++,D++)P===z&&(P=0),D===z&&(D=0),E[B]=r(L[B],L[P],L[D]);var U,O=[],W=E.concat();for(_=0,H=C.length;H>_;_++){for(w=C[_],U=[],B=0,z=w.length,P=z-1,D=B+1;z>B;B++,P++,D++)P===z&&(P=0),D===z&&(D=0),U[B]=r(w[B],w[P],w[D]);O.push(U),W=W.concat(U)}for(P=0;m>P;P++){for(z=P/m,F=p*(1-z),D=d*Math.sin(z*Math.PI/2),B=0,z=L.length;z>B;B++)k=n(L[B],E[B],D),o(k.x,k.y,-F);for(_=0,H=C.length;H>_;_++)for(w=C[_],U=O[_],B=0,z=w.length;z>B;B++)k=n(w[B],U[B],D),o(k.x,k.y,-F)}for(D=d,B=0;V>B;B++)k=g?n(v[B],W[B],D):v[B],x?(c.copy(h.normals[0]).multiplyScalar(k.x),u.copy(h.binormals[0]).multiplyScalar(k.y),l.copy(s[0]).add(c).add(u),o(l.x,l.y,l.z)):o(k.x,k.y,0);for(z=1;y>=z;z++)for(B=0;V>B;B++)k=g?n(v[B],W[B],D):v[B],x?(c.copy(h.normals[z]).multiplyScalar(k.x),u.copy(h.binormals[z]).multiplyScalar(k.y),l.copy(s[z]).add(c).add(u),o(l.x,l.y,l.z)):o(k.x,k.y,f/y*z);for(P=m-1;P>=0;P--){for(z=P/m,F=p*(1-z),D=d*Math.sin(z*Math.PI/2),B=0,z=L.length;z>B;B++)k=n(L[B],E[B],D),o(k.x,k.y,f+F);for(_=0,H=C.length;H>_;_++)for(w=C[_],U=O[_],B=0,z=w.length;z>B;B++)k=n(w[B],U[B],D),x?o(k.x,k.y+s[y-1].y,s[y-1].x+F):o(k.x,k.y,f+F)}!function(){if(g){var t;for(t=0*V,B=0;I>B;B++)N=A[B],a(N[2]+t,N[1]+t,N[0]+t,!0);for(t=y+2*m,t*=V,B=0;I>B;B++)N=A[B],a(N[0]+t,N[1]+t,N[2]+t,!1)}else{for(B=0;I>B;B++)N=A[B],a(N[2],N[1],N[0],!0);for(B=0;I>B;B++)N=A[B],a(N[0]+V*y,N[1]+V*y,N[2]+V*y,!1)}}(),function(){var t=0;for(i(L,t),t+=L.length,_=0,H=C.length;H>_;_++)w=C[_],i(w,t),t+=w.length}()},THREE.ExtrudeGeometry.WorldUVGenerator={generateTopUV:function(t,e,n,r,i,o){return e=t.vertices[i].x,i=t.vertices[i].y,n=t.vertices[o].x,o=t.vertices[o].y,[new THREE.Vector2(t.vertices[r].x,t.vertices[r].y),new THREE.Vector2(e,i),new THREE.Vector2(n,o)]},generateBottomUV:function(t,e,n,r,i,o){return this.generateTopUV(t,e,n,r,i,o)},generateSideWallUV:function(t,e,n,r,i,o,a,s,h,u,c,l){e=t.vertices[i].x,n=t.vertices[i].y,i=t.vertices[i].z,r=t.vertices[o].x,h=t.vertices[o].y,o=t.vertices[o].z,u=t.vertices[a].x,c=t.vertices[a].y,a=t.vertices[a].z,l=t.vertices[s].x;var f=t.vertices[s].y;return t=t.vertices[s].z,.01>Math.abs(n-h)?[new THREE.Vector2(e,1-i),new THREE.Vector2(r,1-o),new THREE.Vector2(u,1-a),new THREE.Vector2(l,1-t)]:[new THREE.Vector2(n,1-i),new THREE.Vector2(h,1-o),new THREE.Vector2(c,1-a),new THREE.Vector2(f,1-t)]}},THREE.ExtrudeGeometry.__v1=new THREE.Vector2,THREE.ExtrudeGeometry.__v2=new THREE.Vector2,THREE.ExtrudeGeometry.__v3=new THREE.Vector2,THREE.ExtrudeGeometry.__v4=new THREE.Vector2,THREE.ExtrudeGeometry.__v5=new THREE.Vector2,THREE.ExtrudeGeometry.__v6=new THREE.Vector2,THREE.ShapeGeometry=function(t,e){THREE.Geometry.call(this),!1==t instanceof Array&&(t=[t]),this.addShapeList(t,e),this.computeFaceNormals()},THREE.ShapeGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.ShapeGeometry.prototype.addShapeList=function(t,e){for(var n=0,r=t.length;r>n;n++)this.addShape(t[n],e);return this},THREE.ShapeGeometry.prototype.addShape=function(t,e){void 0===e&&(e={});var n,r,i,o=e.material,a=void 0===e.UVGenerator?THREE.ExtrudeGeometry.WorldUVGenerator:e.UVGenerator,s=this.vertices.length;n=t.extractPoints(void 0!==e.curveSegments?e.curveSegments:12);var h=n.shape,u=n.holes;if(!THREE.Shape.Utils.isClockWise(h))for(h=h.reverse(),n=0,r=u.length;r>n;n++)i=u[n],THREE.Shape.Utils.isClockWise(i)&&(u[n]=i.reverse());var c=THREE.Shape.Utils.triangulateShape(h,u);for(n=0,r=u.length;r>n;n++)i=u[n],h=h.concat(i);for(u=h.length,r=c.length,n=0;u>n;n++)i=h[n],this.vertices.push(new THREE.Vector3(i.x,i.y,0));for(n=0;r>n;n++)u=c[n],h=u[0]+s,i=u[1]+s,u=u[2]+s,this.faces.push(new THREE.Face3(h,i,u,null,null,o)),this.faceVertexUvs[0].push(a.generateBottomUV(this,t,e,h,i,u))},THREE.LatheGeometry=function(t,e,n,r){THREE.Geometry.call(this),e=e||12,n=n||0,r=r||2*Math.PI;for(var i=1/(t.length-1),o=1/e,a=0,s=e;s>=a;a++)for(var h=n+a*o*r,u=Math.cos(h),c=Math.sin(h),h=0,l=t.length;l>h;h++){var f=t[h],p=new THREE.Vector3;p.x=u*f.x-c*f.y,p.y=c*f.x+u*f.y,p.z=f.z,this.vertices.push(p)}for(n=t.length,a=0,s=e;s>a;a++)for(h=0,l=t.length-1;l>h;h++){e=c=h+n*a,r=c+n;var u=c+1+n,c=c+1,f=a*o,p=h*i,d=f+o,m=p+i;this.faces.push(new THREE.Face3(e,r,c)),this.faceVertexUvs[0].push([new THREE.Vector2(f,p),new THREE.Vector2(d,p),new THREE.Vector2(f,m)]),this.faces.push(new THREE.Face3(r,u,c)),this.faceVertexUvs[0].push([new THREE.Vector2(d,p),new THREE.Vector2(d,m),new THREE.Vector2(f,m)])}this.mergeVertices(),this.computeFaceNormals(),this.computeVertexNormals()},THREE.LatheGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.PlaneGeometry=function(t,e,n,r){THREE.Geometry.call(this),this.parameters={width:t,height:e,widthSegments:n,heightSegments:r};var i=t/2,o=e/2;n=n||1,r=r||1;var a=n+1,s=r+1,h=t/n,u=e/r,c=new THREE.Vector3(0,0,1);for(t=0;s>t;t++){var l=t*u-o;for(e=0;a>e;e++)this.vertices.push(new THREE.Vector3(e*h-i,-l,0))}for(t=0;r>t;t++)for(e=0;n>e;e++){var f=e+a*t,i=e+a*(t+1),o=e+1+a*(t+1),s=e+1+a*t,h=new THREE.Vector2(e/n,1-t/r),u=new THREE.Vector2(e/n,1-(t+1)/r),l=new THREE.Vector2((e+1)/n,1-(t+1)/r),p=new THREE.Vector2((e+1)/n,1-t/r),f=new THREE.Face3(f,i,s);f.normal.copy(c),f.vertexNormals.push(c.clone(),c.clone(),c.clone()),this.faces.push(f),this.faceVertexUvs[0].push([h,u,p]),f=new THREE.Face3(i,o,s),f.normal.copy(c),f.vertexNormals.push(c.clone(),c.clone(),c.clone()),this.faces.push(f),this.faceVertexUvs[0].push([u.clone(),l,p.clone()])}},THREE.PlaneGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.RingGeometry=function(t,e,n,r,i,o){THREE.Geometry.call(this),t=t||0,e=e||50,i=void 0!==i?i:0,o=void 0!==o?o:2*Math.PI,n=void 0!==n?Math.max(3,n):8,r=void 0!==r?Math.max(1,r):8;var a,s=[],h=t,u=(e-t)/r;for(t=0;r+1>t;t++){for(a=0;n+1>a;a++){var c=new THREE.Vector3,l=i+a/n*o;c.x=h*Math.cos(l),c.y=h*Math.sin(l),this.vertices.push(c),s.push(new THREE.Vector2((c.x/e+1)/2,(c.y/e+1)/2))}h+=u}for(e=new THREE.Vector3(0,0,1),t=0;r>t;t++)for(i=t*(n+1),a=0;n>a;a++)o=l=a+i,u=l+n+1,c=l+n+2,this.faces.push(new THREE.Face3(o,u,c,[e.clone(),e.clone(),e.clone()])),this.faceVertexUvs[0].push([s[o].clone(),s[u].clone(),s[c].clone()]),o=l,u=l+n+2,c=l+1,this.faces.push(new THREE.Face3(o,u,c,[e.clone(),e.clone(),e.clone()])),this.faceVertexUvs[0].push([s[o].clone(),s[u].clone(),s[c].clone()]);this.computeFaceNormals(),this.boundingSphere=new THREE.Sphere(new THREE.Vector3,h)},THREE.RingGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.SphereGeometry=function(t,e,n,r,i,o,a){THREE.Geometry.call(this),this.parameters={radius:t,widthSegments:e,heightSegments:n,phiStart:r,phiLength:i,thetaStart:o,thetaLength:a},t=t||50,e=Math.max(3,Math.floor(e)||8),n=Math.max(2,Math.floor(n)||6),r=void 0!==r?r:0,i=void 0!==i?i:2*Math.PI,o=void 0!==o?o:0,a=void 0!==a?a:Math.PI;var s,h,u=[],c=[];for(h=0;n>=h;h++){var l=[],f=[];for(s=0;e>=s;s++){var p=s/e,d=h/n,m=new THREE.Vector3;m.x=-t*Math.cos(r+p*i)*Math.sin(o+d*a),m.y=t*Math.cos(o+d*a),m.z=t*Math.sin(r+p*i)*Math.sin(o+d*a),this.vertices.push(m),l.push(this.vertices.length-1),f.push(new THREE.Vector2(p,1-d))}u.push(l),c.push(f)}for(h=0;n>h;h++)for(s=0;e>s;s++){r=u[h][s+1],i=u[h][s],o=u[h+1][s],a=u[h+1][s+1];var l=this.vertices[r].clone().normalize(),f=this.vertices[i].clone().normalize(),p=this.vertices[o].clone().normalize(),d=this.vertices[a].clone().normalize(),m=c[h][s+1].clone(),g=c[h][s].clone(),v=c[h+1][s].clone(),y=c[h+1][s+1].clone();Math.abs(this.vertices[r].y)===t?(m.x=(m.x+g.x)/2,this.faces.push(new THREE.Face3(r,o,a,[l,p,d])),this.faceVertexUvs[0].push([m,v,y])):Math.abs(this.vertices[o].y)===t?(v.x=(v.x+y.x)/2,this.faces.push(new THREE.Face3(r,i,o,[l,f,p])),this.faceVertexUvs[0].push([m,g,v])):(this.faces.push(new THREE.Face3(r,i,a,[l,f,d])),this.faceVertexUvs[0].push([m,g,y]),this.faces.push(new THREE.Face3(i,o,a,[f.clone(),p,d.clone()])),this.faceVertexUvs[0].push([g.clone(),v,y.clone()]))}this.computeFaceNormals(),this.boundingSphere=new THREE.Sphere(new THREE.Vector3,t)},THREE.SphereGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.TextGeometry=function(t,e){e=e||{};var n=THREE.FontUtils.generateShapes(t,e);e.amount=void 0!==e.height?e.height:50,void 0===e.bevelThickness&&(e.bevelThickness=10),void 0===e.bevelSize&&(e.bevelSize=8),void 0===e.bevelEnabled&&(e.bevelEnabled=!1),THREE.ExtrudeGeometry.call(this,n,e)},THREE.TextGeometry.prototype=Object.create(THREE.ExtrudeGeometry.prototype),THREE.TorusGeometry=function(t,e,n,r,i){THREE.Geometry.call(this),this.parameters={radius:t,tube:e,radialSegments:n,tubularSegments:r,arc:i},t=t||100,e=e||40,n=n||8,r=r||6,i=i||2*Math.PI;for(var o=new THREE.Vector3,a=[],s=[],h=0;n>=h;h++)for(var u=0;r>=u;u++){var c=u/r*i,l=h/n*Math.PI*2;o.x=t*Math.cos(c),o.y=t*Math.sin(c);var f=new THREE.Vector3;f.x=(t+e*Math.cos(l))*Math.cos(c),f.y=(t+e*Math.cos(l))*Math.sin(c),f.z=e*Math.sin(l),this.vertices.push(f),a.push(new THREE.Vector2(u/r,h/n)),s.push(f.clone().sub(o).normalize())}for(h=1;n>=h;h++)for(u=1;r>=u;u++)t=(r+1)*h+u-1,e=(r+1)*(h-1)+u-1,i=(r+1)*(h-1)+u,o=(r+1)*h+u,c=new THREE.Face3(t,e,o,[s[t].clone(),s[e].clone(),s[o].clone()]),this.faces.push(c),this.faceVertexUvs[0].push([a[t].clone(),a[e].clone(),a[o].clone()]),c=new THREE.Face3(e,i,o,[s[e].clone(),s[i].clone(),s[o].clone()]),this.faces.push(c),this.faceVertexUvs[0].push([a[e].clone(),a[i].clone(),a[o].clone()]);this.computeFaceNormals()},THREE.TorusGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.TorusKnotGeometry=function(t,e,n,r,i,o,a){function s(t,e,n,r,i){var o=Math.cos(t),a=Math.sin(t);return t*=e/n,e=Math.cos(t),o*=r*(2+e)*.5,a=r*(2+e)*a*.5,r=i*r*Math.sin(t)*.5,new THREE.Vector3(o,a,r)}THREE.Geometry.call(this),this.parameters={radius:t,tube:e,radialSegments:n,tubularSegments:r,p:i,q:o,heightScale:a},t=t||100,e=e||40,n=n||64,r=r||8,i=i||2,o=o||3,a=a||1;for(var h=Array(n),u=new THREE.Vector3,c=new THREE.Vector3,l=new THREE.Vector3,f=0;n>f;++f){h[f]=Array(r);var p=f/n*2*i*Math.PI,d=s(p,o,i,t,a),p=s(p+.01,o,i,t,a);for(u.subVectors(p,d),c.addVectors(p,d),l.crossVectors(u,c),c.crossVectors(l,u),l.normalize(),c.normalize(),p=0;r>p;++p){var m=p/r*2*Math.PI,g=-e*Math.cos(m),m=e*Math.sin(m),v=new THREE.Vector3;v.x=d.x+g*c.x+m*l.x,v.y=d.y+g*c.y+m*l.y,v.z=d.z+g*c.z+m*l.z,h[f][p]=this.vertices.push(v)-1}}for(f=0;n>f;++f)for(p=0;r>p;++p)i=(f+1)%n,o=(p+1)%r,t=h[f][p],e=h[i][p],i=h[i][o],o=h[f][o],a=new THREE.Vector2(f/n,p/r),u=new THREE.Vector2((f+1)/n,p/r),c=new THREE.Vector2((f+1)/n,(p+1)/r),l=new THREE.Vector2(f/n,(p+1)/r),this.faces.push(new THREE.Face3(t,e,o)),this.faceVertexUvs[0].push([a,u,l]),this.faces.push(new THREE.Face3(e,i,o)),this.faceVertexUvs[0].push([u.clone(),c,l.clone()]);this.computeFaceNormals(),this.computeVertexNormals()},THREE.TorusKnotGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.TubeGeometry=function(t,e,n,r,i){THREE.Geometry.call(this),this.parameters={path:t,segments:e,radius:n,radialSegments:r,closed:i},e=e||64,n=n||1,r=r||8,i=i||!1;var o,a,s,h,u,c,l,f,p,d=[],m=e+1,g=new THREE.Vector3;for(l=new THREE.TubeGeometry.FrenetFrames(t,e,i),f=l.normals,p=l.binormals,this.tangents=l.tangents,this.normals=f,this.binormals=p,l=0;m>l;l++)for(d[l]=[],s=l/(m-1),c=t.getPointAt(s),o=f[l],a=p[l],s=0;r>s;s++)h=s/r*2*Math.PI,u=-n*Math.cos(h),h=n*Math.sin(h),g.copy(c),g.x+=u*o.x+h*a.x,g.y+=u*o.y+h*a.y,g.z+=u*o.z+h*a.z,d[l][s]=this.vertices.push(new THREE.Vector3(g.x,g.y,g.z))-1;for(l=0;e>l;l++)for(s=0;r>s;s++)m=i?(l+1)%e:l+1,g=(s+1)%r,t=d[l][s],n=d[m][s],m=d[m][g],g=d[l][g],f=new THREE.Vector2(l/e,s/r),p=new THREE.Vector2((l+1)/e,s/r),o=new THREE.Vector2((l+1)/e,(s+1)/r),a=new THREE.Vector2(l/e,(s+1)/r),this.faces.push(new THREE.Face3(t,n,g)),this.faceVertexUvs[0].push([f,p,a]),this.faces.push(new THREE.Face3(n,m,g)),this.faceVertexUvs[0].push([p.clone(),o,a.clone()]);
this.computeFaceNormals(),this.computeVertexNormals()},THREE.TubeGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.TubeGeometry.FrenetFrames=function(t,e,n){new THREE.Vector3;var r=new THREE.Vector3;new THREE.Vector3;var i=[],o=[],a=[],s=new THREE.Vector3,h=new THREE.Matrix4;e+=1;var u,c,l;for(this.tangents=i,this.normals=o,this.binormals=a,u=0;e>u;u++)c=u/(e-1),i[u]=t.getTangentAt(c),i[u].normalize();for(o[0]=new THREE.Vector3,a[0]=new THREE.Vector3,t=Number.MAX_VALUE,u=Math.abs(i[0].x),c=Math.abs(i[0].y),l=Math.abs(i[0].z),t>=u&&(t=u,r.set(1,0,0)),t>=c&&(t=c,r.set(0,1,0)),t>=l&&r.set(0,0,1),s.crossVectors(i[0],r).normalize(),o[0].crossVectors(i[0],s),a[0].crossVectors(i[0],o[0]),u=1;e>u;u++)o[u]=o[u-1].clone(),a[u]=a[u-1].clone(),s.crossVectors(i[u-1],i[u]),1e-4<s.length()&&(s.normalize(),r=Math.acos(THREE.Math.clamp(i[u-1].dot(i[u]),-1,1)),o[u].applyMatrix4(h.makeRotationAxis(s,r))),a[u].crossVectors(i[u],o[u]);if(n)for(r=Math.acos(THREE.Math.clamp(o[0].dot(o[e-1]),-1,1)),r/=e-1,0<i[0].dot(s.crossVectors(o[0],o[e-1]))&&(r=-r),u=1;e>u;u++)o[u].applyMatrix4(h.makeRotationAxis(i[u],r*u)),a[u].crossVectors(i[u],o[u])},THREE.PolyhedronGeometry=function(t,e,n,r){function i(t){var e=t.normalize().clone();e.index=h.vertices.push(e)-1;var n=Math.atan2(t.z,-t.x)/2/Math.PI+.5;return t=Math.atan2(-t.y,Math.sqrt(t.x*t.x+t.z*t.z))/Math.PI+.5,e.uv=new THREE.Vector2(n,1-t),e}function o(t,e,n){var r=new THREE.Face3(t.index,e.index,n.index,[t.clone(),e.clone(),n.clone()]);h.faces.push(r),g.copy(t).add(e).add(n).divideScalar(3),r=Math.atan2(g.z,-g.x),h.faceVertexUvs[0].push([s(t.uv,t,r),s(e.uv,e,r),s(n.uv,n,r)])}function a(t,e){var n=Math.pow(2,e);Math.pow(4,e);for(var r=i(h.vertices[t.a]),a=i(h.vertices[t.b]),s=i(h.vertices[t.c]),u=[],c=0;n>=c;c++){u[c]=[];for(var l=i(r.clone().lerp(s,c/n)),f=i(a.clone().lerp(s,c/n)),p=n-c,d=0;p>=d;d++)u[c][d]=0==d&&c==n?l:i(l.clone().lerp(f,d/p))}for(c=0;n>c;c++)for(d=0;2*(n-c)-1>d;d++)r=Math.floor(d/2),0==d%2?o(u[c][r+1],u[c+1][r],u[c][r]):o(u[c][r+1],u[c+1][r+1],u[c+1][r])}function s(t,e,n){return 0>n&&1===t.x&&(t=new THREE.Vector2(t.x-1,t.y)),0===e.x&&0===e.z&&(t=new THREE.Vector2(n/2/Math.PI+.5,t.y)),t.clone()}THREE.Geometry.call(this),n=n||1,r=r||0;for(var h=this,u=0,c=t.length;c>u;u+=3)i(new THREE.Vector3(t[u],t[u+1],t[u+2]));t=this.vertices;for(var l=[],f=u=0,c=e.length;c>u;u+=3,f++){var p=t[e[u]],d=t[e[u+1]],m=t[e[u+2]];l[f]=new THREE.Face3(p.index,d.index,m.index,[p.clone(),d.clone(),m.clone()])}for(var g=new THREE.Vector3,u=0,c=l.length;c>u;u++)a(l[u],r);for(u=0,c=this.faceVertexUvs[0].length;c>u;u++)e=this.faceVertexUvs[0][u],r=e[0].x,t=e[1].x,l=e[2].x,f=Math.max(r,Math.max(t,l)),p=Math.min(r,Math.min(t,l)),f>.9&&.1>p&&(.2>r&&(e[0].x+=1),.2>t&&(e[1].x+=1),.2>l&&(e[2].x+=1));for(u=0,c=this.vertices.length;c>u;u++)this.vertices[u].multiplyScalar(n);this.mergeVertices(),this.computeFaceNormals(),this.boundingSphere=new THREE.Sphere(new THREE.Vector3,n)},THREE.PolyhedronGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.IcosahedronGeometry=function(t,e){this.parameters={radius:t,detail:e};var n=(1+Math.sqrt(5))/2;THREE.PolyhedronGeometry.call(this,[-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],t,e)},THREE.IcosahedronGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.OctahedronGeometry=function(t,e){this.parameters={radius:t,detail:e},THREE.PolyhedronGeometry.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],t,e)},THREE.OctahedronGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.TetrahedronGeometry=function(t,e){THREE.PolyhedronGeometry.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],t,e)},THREE.TetrahedronGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.ParametricGeometry=function(t,e,n){THREE.Geometry.call(this);var r,i,o,a,s=this.vertices,h=this.faces,u=this.faceVertexUvs[0],c=e+1;for(r=0;n>=r;r++)for(a=r/n,i=0;e>=i;i++)o=i/e,o=t(o,a),s.push(o);var l,f,p,d;for(r=0;n>r;r++)for(i=0;e>i;i++)t=r*c+i,s=r*c+i+1,a=(r+1)*c+i+1,o=(r+1)*c+i,l=new THREE.Vector2(i/e,r/n),f=new THREE.Vector2((i+1)/e,r/n),p=new THREE.Vector2((i+1)/e,(r+1)/n),d=new THREE.Vector2(i/e,(r+1)/n),h.push(new THREE.Face3(t,s,o)),u.push([l,f,d]),h.push(new THREE.Face3(s,a,o)),u.push([f.clone(),p,d.clone()]);this.computeFaceNormals(),this.computeVertexNormals()},THREE.ParametricGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.AxisHelper=function(t){t=t||1;var e=new Float32Array([0,0,0,t,0,0,0,0,0,0,t,0,0,0,0,0,0,t]),n=new Float32Array([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1]);t=new THREE.BufferGeometry,t.addAttribute("position",new THREE.BufferAttribute(e,3)),t.addAttribute("color",new THREE.BufferAttribute(n,3)),e=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors}),THREE.Line.call(this,t,e,THREE.LinePieces)},THREE.AxisHelper.prototype=Object.create(THREE.Line.prototype),THREE.ArrowHelper=function(){var t=new THREE.Geometry;t.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,1,0));var e=new THREE.CylinderGeometry(0,.5,1,5,1);return e.applyMatrix((new THREE.Matrix4).makeTranslation(0,-.5,0)),function(n,r,i,o,a,s){THREE.Object3D.call(this),void 0===o&&(o=16776960),void 0===i&&(i=1),void 0===a&&(a=.2*i),void 0===s&&(s=.2*a),this.position.copy(r),this.line=new THREE.Line(t,new THREE.LineBasicMaterial({color:o})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new THREE.Mesh(e,new THREE.MeshBasicMaterial({color:o})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(n),this.setLength(i,a,s)}}(),THREE.ArrowHelper.prototype=Object.create(THREE.Object3D.prototype),THREE.ArrowHelper.prototype.setDirection=function(){var t,e=new THREE.Vector3;return function(n){.99999<n.y?this.quaternion.set(0,0,0,1):-.99999>n.y?this.quaternion.set(1,0,0,0):(e.set(n.z,0,-n.x).normalize(),t=Math.acos(n.y),this.quaternion.setFromAxisAngle(e,t))}}(),THREE.ArrowHelper.prototype.setLength=function(t,e,n){void 0===e&&(e=.2*t),void 0===n&&(n=.2*e),this.line.scale.set(1,t,1),this.line.updateMatrix(),this.cone.scale.set(n,e,n),this.cone.position.y=t,this.cone.updateMatrix()},THREE.ArrowHelper.prototype.setColor=function(t){this.line.material.color.set(t),this.cone.material.color.set(t)},THREE.BoxHelper=function(t){var e=new THREE.BufferGeometry;e.addAttribute("position",new THREE.BufferAttribute(new Float32Array(72),3)),THREE.Line.call(this,e,new THREE.LineBasicMaterial({color:16776960}),THREE.LinePieces),void 0!==t&&this.update(t)},THREE.BoxHelper.prototype=Object.create(THREE.Line.prototype),THREE.BoxHelper.prototype.update=function(t){var e=t.geometry;null===e.boundingBox&&e.computeBoundingBox();var n=e.boundingBox.min,e=e.boundingBox.max,r=this.geometry.attributes.position.array;r[0]=e.x,r[1]=e.y,r[2]=e.z,r[3]=n.x,r[4]=e.y,r[5]=e.z,r[6]=n.x,r[7]=e.y,r[8]=e.z,r[9]=n.x,r[10]=n.y,r[11]=e.z,r[12]=n.x,r[13]=n.y,r[14]=e.z,r[15]=e.x,r[16]=n.y,r[17]=e.z,r[18]=e.x,r[19]=n.y,r[20]=e.z,r[21]=e.x,r[22]=e.y,r[23]=e.z,r[24]=e.x,r[25]=e.y,r[26]=n.z,r[27]=n.x,r[28]=e.y,r[29]=n.z,r[30]=n.x,r[31]=e.y,r[32]=n.z,r[33]=n.x,r[34]=n.y,r[35]=n.z,r[36]=n.x,r[37]=n.y,r[38]=n.z,r[39]=e.x,r[40]=n.y,r[41]=n.z,r[42]=e.x,r[43]=n.y,r[44]=n.z,r[45]=e.x,r[46]=e.y,r[47]=n.z,r[48]=e.x,r[49]=e.y,r[50]=e.z,r[51]=e.x,r[52]=e.y,r[53]=n.z,r[54]=n.x,r[55]=e.y,r[56]=e.z,r[57]=n.x,r[58]=e.y,r[59]=n.z,r[60]=n.x,r[61]=n.y,r[62]=e.z,r[63]=n.x,r[64]=n.y,r[65]=n.z,r[66]=e.x,r[67]=n.y,r[68]=e.z,r[69]=e.x,r[70]=n.y,r[71]=n.z,this.geometry.attributes.position.needsUpdate=!0,this.geometry.computeBoundingSphere(),this.matrixAutoUpdate=!1,this.matrixWorld=t.matrixWorld},THREE.BoundingBoxHelper=function(t,e){var n=void 0!==e?e:8947848;this.object=t,this.box=new THREE.Box3,THREE.Mesh.call(this,new THREE.BoxGeometry(1,1,1),new THREE.MeshBasicMaterial({color:n,wireframe:!0}))},THREE.BoundingBoxHelper.prototype=Object.create(THREE.Mesh.prototype),THREE.BoundingBoxHelper.prototype.update=function(){this.box.setFromObject(this.object),this.box.size(this.scale),this.box.center(this.position)},THREE.CameraHelper=function(t){function e(t,e,r){n(t,r),n(e,r)}function n(t,e){r.vertices.push(new THREE.Vector3),r.colors.push(new THREE.Color(e)),void 0===o[t]&&(o[t]=[]),o[t].push(r.vertices.length-1)}var r=new THREE.Geometry,i=new THREE.LineBasicMaterial({color:16777215,vertexColors:THREE.FaceColors}),o={};e("n1","n2",16755200),e("n2","n4",16755200),e("n4","n3",16755200),e("n3","n1",16755200),e("f1","f2",16755200),e("f2","f4",16755200),e("f4","f3",16755200),e("f3","f1",16755200),e("n1","f1",16755200),e("n2","f2",16755200),e("n3","f3",16755200),e("n4","f4",16755200),e("p","n1",16711680),e("p","n2",16711680),e("p","n3",16711680),e("p","n4",16711680),e("u1","u2",43775),e("u2","u3",43775),e("u3","u1",43775),e("c","t",16777215),e("p","c",3355443),e("cn1","cn2",3355443),e("cn3","cn4",3355443),e("cf1","cf2",3355443),e("cf3","cf4",3355443),THREE.Line.call(this,r,i,THREE.LinePieces),this.camera=t,this.matrixWorld=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update()},THREE.CameraHelper.prototype=Object.create(THREE.Line.prototype),THREE.CameraHelper.prototype.update=function(){var t=new THREE.Vector3,e=new THREE.Camera,n=new THREE.Projector;return function(){function r(r,o,a,s){if(t.set(o,a,s),n.unprojectVector(t,e),r=i.pointMap[r],void 0!==r)for(o=0,a=r.length;a>o;o++)i.geometry.vertices[r[o]].copy(t)}var i=this;e.projectionMatrix.copy(this.camera.projectionMatrix),r("c",0,0,-1),r("t",0,0,1),r("n1",-1,-1,-1),r("n2",1,-1,-1),r("n3",-1,1,-1),r("n4",1,1,-1),r("f1",-1,-1,1),r("f2",1,-1,1),r("f3",-1,1,1),r("f4",1,1,1),r("u1",.7,1.1,-1),r("u2",-.7,1.1,-1),r("u3",0,2,-1),r("cf1",-1,0,1),r("cf2",1,0,1),r("cf3",0,-1,1),r("cf4",0,1,1),r("cn1",-1,0,-1),r("cn2",1,0,-1),r("cn3",0,-1,-1),r("cn4",0,1,-1),this.geometry.verticesNeedUpdate=!0}}(),THREE.DirectionalLightHelper=function(t,e){THREE.Object3D.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrixWorld=t.matrixWorld,this.matrixAutoUpdate=!1,e=e||1;var n=new THREE.Geometry;n.vertices.push(new THREE.Vector3(-e,e,0),new THREE.Vector3(e,e,0),new THREE.Vector3(e,-e,0),new THREE.Vector3(-e,-e,0),new THREE.Vector3(-e,e,0));var r=new THREE.LineBasicMaterial({fog:!1});r.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.lightPlane=new THREE.Line(n,r),this.add(this.lightPlane),n=new THREE.Geometry,n.vertices.push(new THREE.Vector3,new THREE.Vector3),r=new THREE.LineBasicMaterial({fog:!1}),r.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.targetLine=new THREE.Line(n,r),this.add(this.targetLine),this.update()},THREE.DirectionalLightHelper.prototype=Object.create(THREE.Object3D.prototype),THREE.DirectionalLightHelper.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},THREE.DirectionalLightHelper.prototype.update=function(){var t=new THREE.Vector3,e=new THREE.Vector3,n=new THREE.Vector3;return function(){t.setFromMatrixPosition(this.light.matrixWorld),e.setFromMatrixPosition(this.light.target.matrixWorld),n.subVectors(e,t),this.lightPlane.lookAt(n),this.lightPlane.material.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.targetLine.geometry.vertices[1].copy(n),this.targetLine.geometry.verticesNeedUpdate=!0,this.targetLine.material.color.copy(this.lightPlane.material.color)}}(),THREE.EdgesHelper=function(t,e){var n=void 0!==e?e:16777215,r=[0,0],i={},o=function(t,e){return t-e},a=["a","b","c"],s=new THREE.BufferGeometry,h=t.geometry.clone();h.mergeVertices(),h.computeFaceNormals();for(var u=h.vertices,h=h.faces,c=0,l=0,f=h.length;f>l;l++)for(var p=h[l],d=0;3>d;d++){r[0]=p[a[d]],r[1]=p[a[(d+1)%3]],r.sort(o);var m=r.toString();void 0===i[m]?(i[m]={vert1:r[0],vert2:r[1],face1:l,face2:void 0},c++):i[m].face2=l}s.addAttribute("position",new THREE.Float32Attribute(6*c,3)),r=s.attributes.position.array,o=0;for(m in i)a=i[m],(void 0===a.face2||.9999>h[a.face1].normal.dot(h[a.face2].normal))&&(c=u[a.vert1],r[o++]=c.x,r[o++]=c.y,r[o++]=c.z,c=u[a.vert2],r[o++]=c.x,r[o++]=c.y,r[o++]=c.z);THREE.Line.call(this,s,new THREE.LineBasicMaterial({color:n}),THREE.LinePieces),this.matrixAutoUpdate=!1,this.matrixWorld=t.matrixWorld},THREE.EdgesHelper.prototype=Object.create(THREE.Line.prototype),THREE.FaceNormalsHelper=function(t,e,n,r){this.object=t,this.size=void 0!==e?e:1,t=void 0!==n?n:16776960,r=void 0!==r?r:1,e=new THREE.Geometry,n=0;for(var i=this.object.geometry.faces.length;i>n;n++)e.vertices.push(new THREE.Vector3,new THREE.Vector3);THREE.Line.call(this,e,new THREE.LineBasicMaterial({color:t,linewidth:r}),THREE.LinePieces),this.matrixAutoUpdate=!1,this.normalMatrix=new THREE.Matrix3,this.update()},THREE.FaceNormalsHelper.prototype=Object.create(THREE.Line.prototype),THREE.FaceNormalsHelper.prototype.update=function(){var t=this.geometry.vertices,e=this.object,n=e.geometry.vertices,r=e.geometry.faces,i=e.matrixWorld;e.updateMatrixWorld(!0),this.normalMatrix.getNormalMatrix(i);for(var o=e=0,a=r.length;a>e;e++,o+=2){var s=r[e];t[o].copy(n[s.a]).add(n[s.b]).add(n[s.c]).divideScalar(3).applyMatrix4(i),t[o+1].copy(s.normal).applyMatrix3(this.normalMatrix).normalize().multiplyScalar(this.size).add(t[o])}return this.geometry.verticesNeedUpdate=!0,this},THREE.GridHelper=function(t,e){var n=new THREE.Geometry,r=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors});this.color1=new THREE.Color(4473924),this.color2=new THREE.Color(8947848);for(var i=-t;t>=i;i+=e){n.vertices.push(new THREE.Vector3(-t,0,i),new THREE.Vector3(t,0,i),new THREE.Vector3(i,0,-t),new THREE.Vector3(i,0,t));var o=0===i?this.color1:this.color2;n.colors.push(o,o,o,o)}THREE.Line.call(this,n,r,THREE.LinePieces)},THREE.GridHelper.prototype=Object.create(THREE.Line.prototype),THREE.GridHelper.prototype.setColors=function(t,e){this.color1.set(t),this.color2.set(e),this.geometry.colorsNeedUpdate=!0},THREE.HemisphereLightHelper=function(t,e){for(THREE.Object3D.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrixWorld=t.matrixWorld,this.matrixAutoUpdate=!1,this.colors=[new THREE.Color,new THREE.Color],t=new THREE.SphereGeometry(e,4,2),t.applyMatrix((new THREE.Matrix4).makeRotationX(-Math.PI/2)),e=0;8>e;e++)t.faces[e].color=this.colors[4>e?0:1];e=new THREE.MeshBasicMaterial({vertexColors:THREE.FaceColors,wireframe:!0}),this.lightSphere=new THREE.Mesh(t,e),this.add(this.lightSphere),this.update()},THREE.HemisphereLightHelper.prototype=Object.create(THREE.Object3D.prototype),THREE.HemisphereLightHelper.prototype.dispose=function(){this.lightSphere.geometry.dispose(),this.lightSphere.material.dispose()},THREE.HemisphereLightHelper.prototype.update=function(){var t=new THREE.Vector3;return function(){this.colors[0].copy(this.light.color).multiplyScalar(this.light.intensity),this.colors[1].copy(this.light.groundColor).multiplyScalar(this.light.intensity),this.lightSphere.lookAt(t.setFromMatrixPosition(this.light.matrixWorld).negate()),this.lightSphere.geometry.colorsNeedUpdate=!0}}(),THREE.PointLightHelper=function(t,e){this.light=t,this.light.updateMatrixWorld();var n=new THREE.SphereGeometry(e,4,2),r=new THREE.MeshBasicMaterial({wireframe:!0,fog:!1});r.color.copy(this.light.color).multiplyScalar(this.light.intensity),THREE.Mesh.call(this,n,r),this.matrixWorld=this.light.matrixWorld,this.matrixAutoUpdate=!1},THREE.PointLightHelper.prototype=Object.create(THREE.Mesh.prototype),THREE.PointLightHelper.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},THREE.PointLightHelper.prototype.update=function(){this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)},THREE.SkeletonHelper=function(t){this.bones=this.getBoneList(t);for(var e=new THREE.Geometry,n=0;n<this.bones.length;n++)this.bones[n].parent instanceof THREE.Bone&&(e.vertices.push(new THREE.Vector3),e.vertices.push(new THREE.Vector3),e.colors.push(new THREE.Color(0,0,1)),e.colors.push(new THREE.Color(0,1,0)));n=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors,depthTest:!1,depthWrite:!1,transparent:!0}),THREE.Line.call(this,e,n,THREE.LinePieces),this.root=t,this.matrixWorld=t.matrixWorld,this.matrixAutoUpdate=!1,this.update()},THREE.SkeletonHelper.prototype=Object.create(THREE.Line.prototype),THREE.SkeletonHelper.prototype.getBoneList=function(t){var e=[];t instanceof THREE.Bone&&e.push(t);for(var n=0;n<t.children.length;n++)e.push.apply(e,this.getBoneList(t.children[n]));return e},THREE.SkeletonHelper.prototype.update=function(){for(var t=this.geometry,e=(new THREE.Matrix4).getInverse(this.root.matrixWorld),n=new THREE.Matrix4,r=0,i=0;i<this.bones.length;i++){var o=this.bones[i];o.parent instanceof THREE.Bone&&(n.multiplyMatrices(e,o.matrixWorld),t.vertices[r].setFromMatrixPosition(n),n.multiplyMatrices(e,o.parent.matrixWorld),t.vertices[r+1].setFromMatrixPosition(n),r+=2)}t.verticesNeedUpdate=!0,t.computeBoundingSphere()},THREE.SpotLightHelper=function(t){THREE.Object3D.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrixWorld=t.matrixWorld,this.matrixAutoUpdate=!1,t=new THREE.CylinderGeometry(0,1,1,8,1,!0),t.applyMatrix((new THREE.Matrix4).makeTranslation(0,-.5,0)),t.applyMatrix((new THREE.Matrix4).makeRotationX(-Math.PI/2));var e=new THREE.MeshBasicMaterial({wireframe:!0,fog:!1});this.cone=new THREE.Mesh(t,e),this.add(this.cone),this.update()},THREE.SpotLightHelper.prototype=Object.create(THREE.Object3D.prototype),THREE.SpotLightHelper.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},THREE.SpotLightHelper.prototype.update=function(){var t=new THREE.Vector3,e=new THREE.Vector3;return function(){var n=this.light.distance?this.light.distance:1e4,r=n*Math.tan(this.light.angle);this.cone.scale.set(r,r,n),t.setFromMatrixPosition(this.light.matrixWorld),e.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(e.sub(t)),this.cone.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)}}(),THREE.VertexNormalsHelper=function(t,e,n,r){this.object=t,this.size=void 0!==e?e:1,e=void 0!==n?n:16711680,r=void 0!==r?r:1,n=new THREE.Geometry,t=t.geometry.faces;for(var i=0,o=t.length;o>i;i++)for(var a=0,s=t[i].vertexNormals.length;s>a;a++)n.vertices.push(new THREE.Vector3,new THREE.Vector3);THREE.Line.call(this,n,new THREE.LineBasicMaterial({color:e,linewidth:r}),THREE.LinePieces),this.matrixAutoUpdate=!1,this.normalMatrix=new THREE.Matrix3,this.update()},THREE.VertexNormalsHelper.prototype=Object.create(THREE.Line.prototype),THREE.VertexNormalsHelper.prototype.update=function(){var t=new THREE.Vector3;return function(e){e=["a","b","c","d"],this.object.updateMatrixWorld(!0),this.normalMatrix.getNormalMatrix(this.object.matrixWorld);for(var n=this.geometry.vertices,r=this.object.geometry.vertices,i=this.object.geometry.faces,o=this.object.matrixWorld,a=0,s=0,h=i.length;h>s;s++)for(var u=i[s],c=0,l=u.vertexNormals.length;l>c;c++){var f=u.vertexNormals[c];n[a].copy(r[u[e[c]]]).applyMatrix4(o),t.copy(f).applyMatrix3(this.normalMatrix).normalize().multiplyScalar(this.size),t.add(n[a]),a+=1,n[a].copy(t),a+=1}return this.geometry.verticesNeedUpdate=!0,this}}(),THREE.VertexTangentsHelper=function(t,e,n,r){this.object=t,this.size=void 0!==e?e:1,e=void 0!==n?n:255,r=void 0!==r?r:1,n=new THREE.Geometry,t=t.geometry.faces;for(var i=0,o=t.length;o>i;i++)for(var a=0,s=t[i].vertexTangents.length;s>a;a++)n.vertices.push(new THREE.Vector3),n.vertices.push(new THREE.Vector3);THREE.Line.call(this,n,new THREE.LineBasicMaterial({color:e,linewidth:r}),THREE.LinePieces),this.matrixAutoUpdate=!1,this.update()},THREE.VertexTangentsHelper.prototype=Object.create(THREE.Line.prototype),THREE.VertexTangentsHelper.prototype.update=function(){var t=new THREE.Vector3;return function(e){e=["a","b","c","d"],this.object.updateMatrixWorld(!0);for(var n=this.geometry.vertices,r=this.object.geometry.vertices,i=this.object.geometry.faces,o=this.object.matrixWorld,a=0,s=0,h=i.length;h>s;s++)for(var u=i[s],c=0,l=u.vertexTangents.length;l>c;c++){var f=u.vertexTangents[c];n[a].copy(r[u[e[c]]]).applyMatrix4(o),t.copy(f).transformDirection(o).multiplyScalar(this.size),t.add(n[a]),a+=1,n[a].copy(t),a+=1}return this.geometry.verticesNeedUpdate=!0,this}}(),THREE.WireframeHelper=function(t,e){var n=void 0!==e?e:16777215,r=[0,0],i={},o=function(t,e){return t-e},a=["a","b","c"],s=new THREE.BufferGeometry;if(t.geometry instanceof THREE.Geometry){for(var h=t.geometry.vertices,u=t.geometry.faces,c=0,l=new Uint32Array(6*u.length),f=0,p=u.length;p>f;f++)for(var d=u[f],m=0;3>m;m++){r[0]=d[a[m]],r[1]=d[a[(m+1)%3]],r.sort(o);var g=r.toString();void 0===i[g]&&(l[2*c]=r[0],l[2*c+1]=r[1],i[g]=!0,c++)}for(r=new Float32Array(6*c),f=0,p=c;p>f;f++)for(m=0;2>m;m++)c=h[l[2*f+m]],a=6*f+3*m,r[a+0]=c.x,r[a+1]=c.y,r[a+2]=c.z;s.addAttribute("position",new THREE.BufferAttribute(r,3))}else if(t.geometry instanceof THREE.BufferGeometry){if(void 0!==t.geometry.attributes.index){for(var h=t.geometry.attributes.position.array,p=t.geometry.attributes.index.array,u=t.geometry.offsets,c=0,l=new Uint32Array(2*p.length),d=0,v=u.length;v>d;++d)for(var m=u[d].start,g=u[d].count,a=u[d].index,f=m,y=m+g;y>f;f+=3)for(m=0;3>m;m++)r[0]=a+p[f+m],r[1]=a+p[f+(m+1)%3],r.sort(o),g=r.toString(),void 0===i[g]&&(l[2*c]=r[0],l[2*c+1]=r[1],i[g]=!0,c++);for(r=new Float32Array(6*c),f=0,p=c;p>f;f++)for(m=0;2>m;m++)a=6*f+3*m,c=3*l[2*f+m],r[a+0]=h[c],r[a+1]=h[c+1],r[a+2]=h[c+2]}else for(h=t.geometry.attributes.position.array,c=h.length/3,l=c/3,r=new Float32Array(6*c),f=0,p=l;p>f;f++)for(m=0;3>m;m++)a=18*f+6*m,l=9*f+3*m,r[a+0]=h[l],r[a+1]=h[l+1],r[a+2]=h[l+2],c=9*f+(m+1)%3*3,r[a+3]=h[c],r[a+4]=h[c+1],r[a+5]=h[c+2];s.addAttribute("position",new THREE.BufferAttribute(r,3))}THREE.Line.call(this,s,new THREE.LineBasicMaterial({color:n}),THREE.LinePieces),this.matrixAutoUpdate=!1,this.matrixWorld=t.matrixWorld},THREE.WireframeHelper.prototype=Object.create(THREE.Line.prototype),THREE.ImmediateRenderObject=function(){THREE.Object3D.call(this),this.render=function(){}},THREE.ImmediateRenderObject.prototype=Object.create(THREE.Object3D.prototype),THREE.LensFlare=function(t,e,n,r,i){THREE.Object3D.call(this),this.lensFlares=[],this.positionScreen=new THREE.Vector3,this.customUpdateCallback=void 0,void 0!==t&&this.add(t,e,n,r,i)},THREE.LensFlare.prototype=Object.create(THREE.Object3D.prototype),THREE.LensFlare.prototype.add=function(t,e,n,r,i,o){void 0===e&&(e=-1),void 0===n&&(n=0),void 0===o&&(o=1),void 0===i&&(i=new THREE.Color(16777215)),void 0===r&&(r=THREE.NormalBlending),n=Math.min(n,Math.max(0,n)),this.lensFlares.push({texture:t,size:e,distance:n,x:0,y:0,z:0,scale:1,rotation:1,opacity:o,color:i,blending:r})},THREE.LensFlare.prototype.updateLensFlares=function(){var t,e,n=this.lensFlares.length,r=2*-this.positionScreen.x,i=2*-this.positionScreen.y;for(t=0;n>t;t++)e=this.lensFlares[t],e.x=this.positionScreen.x+r*e.distance,e.y=this.positionScreen.y+i*e.distance,e.wantedRotation=e.x*Math.PI*.25,e.rotation+=.25*(e.wantedRotation-e.rotation)},THREE.MorphBlendMesh=function(t,e){THREE.Mesh.call(this,t,e),this.animationsMap={},this.animationsList=[];var n=this.geometry.morphTargets.length;this.createAnimation("__default",0,n-1,n/1),this.setAnimationWeight("__default",1)},THREE.MorphBlendMesh.prototype=Object.create(THREE.Mesh.prototype),THREE.MorphBlendMesh.prototype.createAnimation=function(t,e,n,r){e={startFrame:e,endFrame:n,length:n-e+1,fps:r,duration:(n-e)/r,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1},this.animationsMap[t]=e,this.animationsList.push(e)},THREE.MorphBlendMesh.prototype.autoCreateAnimations=function(t){for(var e,n=/([a-z]+)_?(\d+)/,r={},i=this.geometry,o=0,a=i.morphTargets.length;a>o;o++){var s=i.morphTargets[o].name.match(n);if(s&&1<s.length){var h=s[1];r[h]||(r[h]={start:1/0,end:-1/0}),s=r[h],o<s.start&&(s.start=o),o>s.end&&(s.end=o),e||(e=h)}}for(h in r)s=r[h],this.createAnimation(h,s.start,s.end,t);this.firstAnimation=e},THREE.MorphBlendMesh.prototype.setAnimationDirectionForward=function(t){(t=this.animationsMap[t])&&(t.direction=1,t.directionBackwards=!1)},THREE.MorphBlendMesh.prototype.setAnimationDirectionBackward=function(t){(t=this.animationsMap[t])&&(t.direction=-1,t.directionBackwards=!0)},THREE.MorphBlendMesh.prototype.setAnimationFPS=function(t,e){var n=this.animationsMap[t];n&&(n.fps=e,n.duration=(n.end-n.start)/n.fps)},THREE.MorphBlendMesh.prototype.setAnimationDuration=function(t,e){var n=this.animationsMap[t];n&&(n.duration=e,n.fps=(n.end-n.start)/n.duration)},THREE.MorphBlendMesh.prototype.setAnimationWeight=function(t,e){var n=this.animationsMap[t];n&&(n.weight=e)},THREE.MorphBlendMesh.prototype.setAnimationTime=function(t,e){var n=this.animationsMap[t];n&&(n.time=e)},THREE.MorphBlendMesh.prototype.getAnimationTime=function(t){var e=0;return(t=this.animationsMap[t])&&(e=t.time),e},THREE.MorphBlendMesh.prototype.getAnimationDuration=function(t){var e=-1;return(t=this.animationsMap[t])&&(e=t.duration),e},THREE.MorphBlendMesh.prototype.playAnimation=function(t){var e=this.animationsMap[t];e?(e.time=0,e.active=!0):console.warn("animation["+t+"] undefined")},THREE.MorphBlendMesh.prototype.stopAnimation=function(t){(t=this.animationsMap[t])&&(t.active=!1)},THREE.MorphBlendMesh.prototype.update=function(t){for(var e=0,n=this.animationsList.length;n>e;e++){var r=this.animationsList[e];if(r.active){var i=r.duration/r.length;r.time+=r.direction*t,r.mirroredLoop?(r.time>r.duration||0>r.time)&&(r.direction*=-1,r.time>r.duration&&(r.time=r.duration,r.directionBackwards=!0),0>r.time&&(r.time=0,r.directionBackwards=!1)):(r.time%=r.duration,0>r.time&&(r.time+=r.duration));var o=r.startFrame+THREE.Math.clamp(Math.floor(r.time/i),0,r.length-1),a=r.weight;o!==r.currentFrame&&(this.morphTargetInfluences[r.lastFrame]=0,this.morphTargetInfluences[r.currentFrame]=1*a,this.morphTargetInfluences[o]=0,r.lastFrame=r.currentFrame,r.currentFrame=o),i=r.time%i/i,r.directionBackwards&&(i=1-i),this.morphTargetInfluences[r.currentFrame]=i*a,this.morphTargetInfluences[r.lastFrame]=(1-i)*a}}},THREE.LensFlarePlugin=function(){function t(t,n){var r=e.createProgram(),i=e.createShader(e.FRAGMENT_SHADER),o=e.createShader(e.VERTEX_SHADER),a="precision "+n+" float;\n";return e.shaderSource(i,a+t.fragmentShader),e.shaderSource(o,a+t.vertexShader),e.compileShader(i),e.compileShader(o),e.attachShader(r,i),e.attachShader(r,o),e.linkProgram(r),r}var e,n,r,i,o,a,s,h,u,c,l,f,p,d=[];this.init=function(d){e=d.context,n=d,r=d.getPrecision(),i=new Float32Array(16),o=new Uint16Array(6),d=0,i[d++]=-1,i[d++]=-1,i[d++]=0,i[d++]=0,i[d++]=1,i[d++]=-1,i[d++]=1,i[d++]=0,i[d++]=1,i[d++]=1,i[d++]=1,i[d++]=1,i[d++]=-1,i[d++]=1,i[d++]=0,i[d++]=1,d=0,o[d++]=0,o[d++]=1,o[d++]=2,o[d++]=0,o[d++]=2,o[d++]=3,a=e.createBuffer(),s=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,a),e.bufferData(e.ARRAY_BUFFER,i,e.STATIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,s),e.bufferData(e.ELEMENT_ARRAY_BUFFER,o,e.STATIC_DRAW),h=e.createTexture(),u=e.createTexture(),e.bindTexture(e.TEXTURE_2D,h),e.texImage2D(e.TEXTURE_2D,0,e.RGB,16,16,0,e.RGB,e.UNSIGNED_BYTE,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.bindTexture(e.TEXTURE_2D,u),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,16,16,0,e.RGBA,e.UNSIGNED_BYTE,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),0>=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS)?(c=!1,l=t(THREE.ShaderFlares.lensFlare,r)):(c=!0,l=t(THREE.ShaderFlares.lensFlareVertexTexture,r)),f={},p={},f.vertex=e.getAttribLocation(l,"position"),f.uv=e.getAttribLocation(l,"uv"),p.renderType=e.getUniformLocation(l,"renderType"),p.map=e.getUniformLocation(l,"map"),p.occlusionMap=e.getUniformLocation(l,"occlusionMap"),p.opacity=e.getUniformLocation(l,"opacity"),p.color=e.getUniformLocation(l,"color"),p.scale=e.getUniformLocation(l,"scale"),p.rotation=e.getUniformLocation(l,"rotation"),p.screenPosition=e.getUniformLocation(l,"screenPosition")},this.render=function(t,r,i,o){if(d.length=0,t.traverseVisible(function(t){t instanceof THREE.LensFlare&&d.push(t)}),0!==d.length){t=new THREE.Vector3;var m=o/i,g=.5*i,v=.5*o,y=16/o,E=new THREE.Vector2(y*m,y),x=new THREE.Vector3(1,1,0),T=new THREE.Vector2(1,1),b=p,y=f;e.useProgram(l),e.enableVertexAttribArray(f.vertex),e.enableVertexAttribArray(f.uv),e.uniform1i(b.occlusionMap,0),e.uniform1i(b.map,1),e.bindBuffer(e.ARRAY_BUFFER,a),e.vertexAttribPointer(y.vertex,2,e.FLOAT,!1,16,0),e.vertexAttribPointer(y.uv,2,e.FLOAT,!1,16,8),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,s),e.disable(e.CULL_FACE),e.depthMask(!1);for(var R=0,w=d.length;w>R;R++){y=16/o,E.set(y*m,y);var _=d[R];if(t.set(_.matrixWorld.elements[12],_.matrixWorld.elements[13],_.matrixWorld.elements[14]),t.applyMatrix4(r.matrixWorldInverse),t.applyProjection(r.projectionMatrix),x.copy(t),T.x=x.x*g+g,T.y=x.y*v+v,c||0<T.x&&T.x<i&&0<T.y&&T.y<o){e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,h),e.copyTexImage2D(e.TEXTURE_2D,0,e.RGB,T.x-8,T.y-8,16,16,0),e.uniform1i(b.renderType,0),e.uniform2f(b.scale,E.x,E.y),e.uniform3f(b.screenPosition,x.x,x.y,x.z),e.disable(e.BLEND),e.enable(e.DEPTH_TEST),e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,u),e.copyTexImage2D(e.TEXTURE_2D,0,e.RGBA,T.x-8,T.y-8,16,16,0),e.uniform1i(b.renderType,1),e.disable(e.DEPTH_TEST),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,h),e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0),_.positionScreen.copy(x),_.customUpdateCallback?_.customUpdateCallback(_):_.updateLensFlares(),e.uniform1i(b.renderType,2),e.enable(e.BLEND);for(var H=0,M=_.lensFlares.length;M>H;H++){var S=_.lensFlares[H];.001<S.opacity&&.001<S.scale&&(x.x=S.x,x.y=S.y,x.z=S.z,y=S.size*S.scale/o,E.x=y*m,E.y=y,e.uniform3f(b.screenPosition,x.x,x.y,x.z),e.uniform2f(b.scale,E.x,E.y),e.uniform1f(b.rotation,S.rotation),e.uniform1f(b.opacity,S.opacity),e.uniform3f(b.color,S.color.r,S.color.g,S.color.b),n.setBlending(S.blending,S.blendEquation,S.blendSrc,S.blendDst),n.setTexture(S.texture,1),e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0))}}}e.enable(e.CULL_FACE),e.enable(e.DEPTH_TEST),e.depthMask(!0)}}},THREE.ShadowMapPlugin=function(){function t(e,n,r){if(n.visible){var i=e.__webglObjects[n.id];if(i&&n.castShadow&&(!1===n.frustumCulled||!0===s.intersectsObject(n)))for(var o=0,a=i.length;a>o;o++){var h=i[o];n._modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,n.matrixWorld),f.push(h)}for(o=0,a=n.children.length;a>o;o++)t(e,n.children[o],r)}}var e,n,r,i,o,a,s=new THREE.Frustum,h=new THREE.Matrix4,u=new THREE.Vector3,c=new THREE.Vector3,l=new THREE.Vector3,f=[];this.init=function(t){e=t.context,n=t,t=THREE.ShaderLib.depthRGBA;var s=THREE.UniformsUtils.clone(t.uniforms);r=new THREE.ShaderMaterial({fragmentShader:t.fragmentShader,vertexShader:t.vertexShader,uniforms:s}),i=new THREE.ShaderMaterial({fragmentShader:t.fragmentShader,vertexShader:t.vertexShader,uniforms:s,morphTargets:!0}),o=new THREE.ShaderMaterial({fragmentShader:t.fragmentShader,vertexShader:t.vertexShader,uniforms:s,skinning:!0}),a=new THREE.ShaderMaterial({fragmentShader:t.fragmentShader,vertexShader:t.vertexShader,uniforms:s,morphTargets:!0,skinning:!0}),r._shadowPass=!0,i._shadowPass=!0,o._shadowPass=!0,a._shadowPass=!0},this.render=function(t,e){n.shadowMapEnabled&&n.shadowMapAutoUpdate&&this.update(t,e)},this.update=function(p,d){var m,g,v,y,E,x,T,b,R=[];for(y=0,e.clearColor(1,1,1,1),e.disable(e.BLEND),e.enable(e.CULL_FACE),e.frontFace(e.CCW),e.cullFace(n.shadowMapCullFace===THREE.CullFaceFront?e.FRONT:e.BACK),n.setDepthTest(!0),m=0,g=p.__lights.length;g>m;m++)if(v=p.__lights[m],v.castShadow)if(v instanceof THREE.DirectionalLight&&v.shadowCascade)for(E=0;E<v.shadowCascadeCount;E++){var w;
if(v.shadowCascadeArray[E])w=v.shadowCascadeArray[E];else{T=v;var _=E;w=new THREE.DirectionalLight,w.isVirtual=!0,w.onlyShadow=!0,w.castShadow=!0,w.shadowCameraNear=T.shadowCameraNear,w.shadowCameraFar=T.shadowCameraFar,w.shadowCameraLeft=T.shadowCameraLeft,w.shadowCameraRight=T.shadowCameraRight,w.shadowCameraBottom=T.shadowCameraBottom,w.shadowCameraTop=T.shadowCameraTop,w.shadowCameraVisible=T.shadowCameraVisible,w.shadowDarkness=T.shadowDarkness,w.shadowBias=T.shadowCascadeBias[_],w.shadowMapWidth=T.shadowCascadeWidth[_],w.shadowMapHeight=T.shadowCascadeHeight[_],w.pointsWorld=[],w.pointsFrustum=[],b=w.pointsWorld,x=w.pointsFrustum;for(var H=0;8>H;H++)b[H]=new THREE.Vector3,x[H]=new THREE.Vector3;b=T.shadowCascadeNearZ[_],T=T.shadowCascadeFarZ[_],x[0].set(-1,-1,b),x[1].set(1,-1,b),x[2].set(-1,1,b),x[3].set(1,1,b),x[4].set(-1,-1,T),x[5].set(1,-1,T),x[6].set(-1,1,T),x[7].set(1,1,T),w.originalCamera=d,x=new THREE.Gyroscope,x.position.copy(v.shadowCascadeOffset),x.add(w),x.add(w.target),d.add(x),v.shadowCascadeArray[E]=w,console.log("Created virtualLight",w)}_=v,b=E,T=_.shadowCascadeArray[b],T.position.copy(_.position),T.target.position.copy(_.target.position),T.lookAt(T.target),T.shadowCameraVisible=_.shadowCameraVisible,T.shadowDarkness=_.shadowDarkness,T.shadowBias=_.shadowCascadeBias[b],x=_.shadowCascadeNearZ[b],_=_.shadowCascadeFarZ[b],T=T.pointsFrustum,T[0].z=x,T[1].z=x,T[2].z=x,T[3].z=x,T[4].z=_,T[5].z=_,T[6].z=_,T[7].z=_,R[y]=w,y++}else R[y]=v,y++;for(m=0,g=R.length;g>m;m++){if(v=R[m],v.shadowMap||(E=THREE.LinearFilter,n.shadowMapType===THREE.PCFSoftShadowMap&&(E=THREE.NearestFilter),v.shadowMap=new THREE.WebGLRenderTarget(v.shadowMapWidth,v.shadowMapHeight,{minFilter:E,magFilter:E,format:THREE.RGBAFormat}),v.shadowMapSize=new THREE.Vector2(v.shadowMapWidth,v.shadowMapHeight),v.shadowMatrix=new THREE.Matrix4),!v.shadowCamera){if(v instanceof THREE.SpotLight)v.shadowCamera=new THREE.PerspectiveCamera(v.shadowCameraFov,v.shadowMapWidth/v.shadowMapHeight,v.shadowCameraNear,v.shadowCameraFar);else{if(!(v instanceof THREE.DirectionalLight)){console.error("Unsupported light type for shadow");continue}v.shadowCamera=new THREE.OrthographicCamera(v.shadowCameraLeft,v.shadowCameraRight,v.shadowCameraTop,v.shadowCameraBottom,v.shadowCameraNear,v.shadowCameraFar)}p.add(v.shadowCamera),!0===p.autoUpdate&&p.updateMatrixWorld()}if(v.shadowCameraVisible&&!v.cameraHelper&&(v.cameraHelper=new THREE.CameraHelper(v.shadowCamera),v.shadowCamera.add(v.cameraHelper)),v.isVirtual&&w.originalCamera==d){for(E=d,y=v.shadowCamera,x=v.pointsFrustum,T=v.pointsWorld,u.set(1/0,1/0,1/0),c.set(-1/0,-1/0,-1/0),_=0;8>_;_++)b=T[_],b.copy(x[_]),THREE.ShadowMapPlugin.__projector.unprojectVector(b,E),b.applyMatrix4(y.matrixWorldInverse),b.x<u.x&&(u.x=b.x),b.x>c.x&&(c.x=b.x),b.y<u.y&&(u.y=b.y),b.y>c.y&&(c.y=b.y),b.z<u.z&&(u.z=b.z),b.z>c.z&&(c.z=b.z);y.left=u.x,y.right=c.x,y.top=c.y,y.bottom=u.y,y.updateProjectionMatrix()}for(y=v.shadowMap,x=v.shadowMatrix,E=v.shadowCamera,E.position.setFromMatrixPosition(v.matrixWorld),l.setFromMatrixPosition(v.target.matrixWorld),E.lookAt(l),E.updateMatrixWorld(),E.matrixWorldInverse.getInverse(E.matrixWorld),v.cameraHelper&&(v.cameraHelper.visible=v.shadowCameraVisible),v.shadowCameraVisible&&v.cameraHelper.update(),x.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),x.multiply(E.projectionMatrix),x.multiply(E.matrixWorldInverse),h.multiplyMatrices(E.projectionMatrix,E.matrixWorldInverse),s.setFromMatrix(h),n.setRenderTarget(y),n.clear(),f.length=0,t(p,p,E),v=0,y=f.length;y>v;v++)T=f[v],x=T.object,T=T.buffer,_=x.material instanceof THREE.MeshFaceMaterial?x.material.materials[0]:x.material,b=void 0!==x.geometry.morphTargets&&0<x.geometry.morphTargets.length&&_.morphTargets,H=x instanceof THREE.SkinnedMesh&&_.skinning,b=x.customDepthMaterial?x.customDepthMaterial:H?b?a:o:b?i:r,n.setMaterialFaces(_),T instanceof THREE.BufferGeometry?n.renderBufferDirect(E,p.__lights,null,b,T,x):n.renderBuffer(E,p.__lights,null,b,T,x);for(_=p.__webglObjectsImmediate,v=0,y=_.length;y>v;v++)T=_[v],x=T.object,x.visible&&x.castShadow&&(x._modelViewMatrix.multiplyMatrices(E.matrixWorldInverse,x.matrixWorld),n.renderImmediateObject(E,p.__lights,null,r,x))}m=n.getClearColor(),g=n.getClearAlpha(),e.clearColor(m.r,m.g,m.b,g),e.enable(e.BLEND),n.shadowMapCullFace===THREE.CullFaceFront&&e.cullFace(e.BACK)}},THREE.ShadowMapPlugin.__projector=new THREE.Projector,THREE.SpritePlugin=function(){function t(t,e){return t.z!==e.z?e.z-t.z:e.id-t.id}var e,n,r,i,o,a,s,h,u,c,l,f,p,d,m,g,v,y,E,x,T,b,R,w,_,H=[];this.init=function(t){y=t.context,E=t,T=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1]),b=new Uint16Array([0,1,2,0,2,3]),R=y.createBuffer(),w=y.createBuffer(),y.bindBuffer(y.ARRAY_BUFFER,R),y.bufferData(y.ARRAY_BUFFER,T,y.STATIC_DRAW),y.bindBuffer(y.ELEMENT_ARRAY_BUFFER,w),y.bufferData(y.ELEMENT_ARRAY_BUFFER,b,y.STATIC_DRAW),t=y.createProgram();var H=y.createShader(y.VERTEX_SHADER),M=y.createShader(y.FRAGMENT_SHADER);y.shaderSource(H,["precision "+E.getPrecision()+" float;","uniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform float rotation;\nuniform vec2 scale;\nuniform vec2 uvOffset;\nuniform vec2 uvScale;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvoid main() {\nvUV = uvOffset + uv * uvScale;\nvec2 alignedPosition = position * scale;\nvec2 rotatedPosition;\nrotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\nrotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\nvec4 finalPosition;\nfinalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\nfinalPosition.xy += rotatedPosition;\nfinalPosition = projectionMatrix * finalPosition;\ngl_Position = finalPosition;\n}"].join("\n")),y.shaderSource(M,["precision "+E.getPrecision()+" float;","uniform vec3 color;\nuniform sampler2D map;\nuniform float opacity;\nuniform int fogType;\nuniform vec3 fogColor;\nuniform float fogDensity;\nuniform float fogNear;\nuniform float fogFar;\nuniform float alphaTest;\nvarying vec2 vUV;\nvoid main() {\nvec4 texture = texture2D( map, vUV );\nif ( texture.a < alphaTest ) discard;\ngl_FragColor = vec4( color * texture.xyz, texture.a * opacity );\nif ( fogType > 0 ) {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat fogFactor = 0.0;\nif ( fogType == 1 ) {\nfogFactor = smoothstep( fogNear, fogFar, depth );\n} else {\nconst float LOG2 = 1.442695;\nfloat fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n}\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n}\n}"].join("\n")),y.compileShader(H),y.compileShader(M),y.attachShader(t,H),y.attachShader(t,M),y.linkProgram(t),_=t,g=y.getAttribLocation(_,"position"),v=y.getAttribLocation(_,"uv"),e=y.getUniformLocation(_,"uvOffset"),n=y.getUniformLocation(_,"uvScale"),r=y.getUniformLocation(_,"rotation"),i=y.getUniformLocation(_,"scale"),o=y.getUniformLocation(_,"color"),a=y.getUniformLocation(_,"map"),s=y.getUniformLocation(_,"opacity"),h=y.getUniformLocation(_,"modelViewMatrix"),u=y.getUniformLocation(_,"projectionMatrix"),c=y.getUniformLocation(_,"fogType"),l=y.getUniformLocation(_,"fogDensity"),f=y.getUniformLocation(_,"fogNear"),p=y.getUniformLocation(_,"fogFar"),d=y.getUniformLocation(_,"fogColor"),m=y.getUniformLocation(_,"alphaTest"),t=document.createElement("canvas"),t.width=8,t.height=8,H=t.getContext("2d"),H.fillStyle="white",H.fillRect(0,0,8,8),x=new THREE.Texture(t),x.needsUpdate=!0},this.render=function(T,b,M,S){if(H.length=0,T.traverseVisible(function(t){t instanceof THREE.Sprite&&H.push(t)}),0!==H.length){y.useProgram(_),y.enableVertexAttribArray(g),y.enableVertexAttribArray(v),y.disable(y.CULL_FACE),y.enable(y.BLEND),y.bindBuffer(y.ARRAY_BUFFER,R),y.vertexAttribPointer(g,2,y.FLOAT,!1,16,0),y.vertexAttribPointer(v,2,y.FLOAT,!1,16,8),y.bindBuffer(y.ELEMENT_ARRAY_BUFFER,w),y.uniformMatrix4fv(u,!1,b.projectionMatrix.elements),y.activeTexture(y.TEXTURE0),y.uniform1i(a,0),S=M=0;var C=T.fog;C?(y.uniform3f(d,C.color.r,C.color.g,C.color.b),C instanceof THREE.Fog?(y.uniform1f(f,C.near),y.uniform1f(p,C.far),y.uniform1i(c,1),S=M=1):C instanceof THREE.FogExp2&&(y.uniform1f(l,C.density),y.uniform1i(c,2),S=M=2)):(y.uniform1i(c,0),S=M=0);for(var C=0,A=H.length;A>C;C++){var L=H[C],P=L.material;L._modelViewMatrix.multiplyMatrices(b.matrixWorldInverse,L.matrixWorld),L.z=-L._modelViewMatrix.elements[14]}for(H.sort(t),b=[],C=0,A=H.length;A>C;C++)L=H[C],P=L.material,y.uniform1f(m,P.alphaTest),y.uniformMatrix4fv(h,!1,L._modelViewMatrix.elements),b[0]=L.scale.x,b[1]=L.scale.y,L=0,T.fog&&P.fog&&(L=S),M!==L&&(y.uniform1i(c,L),M=L),null!==P.map?(y.uniform2f(e,P.map.offset.x,P.map.offset.y),y.uniform2f(n,P.map.repeat.x,P.map.repeat.y)):(y.uniform2f(e,0,0),y.uniform2f(n,1,1)),y.uniform1f(s,P.opacity),y.uniform3f(o,P.color.r,P.color.g,P.color.b),y.uniform1f(r,P.rotation),y.uniform2fv(i,b),E.setBlending(P.blending,P.blendEquation,P.blendSrc,P.blendDst),E.setDepthTest(P.depthTest),E.setDepthWrite(P.depthWrite),P.map&&P.map.image&&P.map.image.width?E.setTexture(P.map,0):E.setTexture(x,0),y.drawElements(y.TRIANGLES,6,y.UNSIGNED_SHORT,0);y.enable(y.CULL_FACE)}}},THREE.DepthPassPlugin=function(){function t(e,n,r){if(n.visible){var i=e.__webglObjects[n.id];if(i&&(!1===n.frustumCulled||!0===s.intersectsObject(n)))for(var o=0,a=i.length;a>o;o++){var h=i[o];n._modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,n.matrixWorld),u.push(h)}for(o=0,a=n.children.length;a>o;o++)t(e,n.children[o],r)}}this.enabled=!1,this.renderTarget=null;var e,n,r,i,o,a,s=new THREE.Frustum,h=new THREE.Matrix4,u=[];this.init=function(t){e=t.context,n=t,t=THREE.ShaderLib.depthRGBA;var s=THREE.UniformsUtils.clone(t.uniforms);r=new THREE.ShaderMaterial({fragmentShader:t.fragmentShader,vertexShader:t.vertexShader,uniforms:s}),i=new THREE.ShaderMaterial({fragmentShader:t.fragmentShader,vertexShader:t.vertexShader,uniforms:s,morphTargets:!0}),o=new THREE.ShaderMaterial({fragmentShader:t.fragmentShader,vertexShader:t.vertexShader,uniforms:s,skinning:!0}),a=new THREE.ShaderMaterial({fragmentShader:t.fragmentShader,vertexShader:t.vertexShader,uniforms:s,morphTargets:!0,skinning:!0}),r._shadowPass=!0,i._shadowPass=!0,o._shadowPass=!0,a._shadowPass=!0},this.render=function(t,e){this.enabled&&this.update(t,e)},this.update=function(c,l){var f,p,d,m,g;e.clearColor(1,1,1,1),e.disable(e.BLEND),n.setDepthTest(!0),!0===c.autoUpdate&&c.updateMatrixWorld(),l.matrixWorldInverse.getInverse(l.matrixWorld),h.multiplyMatrices(l.projectionMatrix,l.matrixWorldInverse),s.setFromMatrix(h),n.setRenderTarget(this.renderTarget),n.clear(),u.length=0,t(c,c,l);var v;for(f=0,p=u.length;p>f;f++)d=u[f],g=d.object,d=d.buffer,g instanceof THREE.PointCloud&&!g.customDepthMaterial||((v=g.material instanceof THREE.MeshFaceMaterial?g.material.materials[0]:g.material)&&n.setMaterialFaces(g.material),m=void 0!==g.geometry.morphTargets&&0<g.geometry.morphTargets.length&&v.morphTargets,v=g instanceof THREE.SkinnedMesh&&v.skinning,m=g.customDepthMaterial?g.customDepthMaterial:v?m?a:o:m?i:r,d instanceof THREE.BufferGeometry?n.renderBufferDirect(l,c.__lights,null,m,d,g):n.renderBuffer(l,c.__lights,null,m,d,g));for(m=c.__webglObjectsImmediate,f=0,p=m.length;p>f;f++)d=m[f],g=d.object,g.visible&&(g._modelViewMatrix.multiplyMatrices(l.matrixWorldInverse,g.matrixWorld),n.renderImmediateObject(l,c.__lights,null,r,g));f=n.getClearColor(),p=n.getClearAlpha(),e.clearColor(f.r,f.g,f.b,p),e.enable(e.BLEND)}},THREE.ShaderFlares={lensFlareVertexTexture:{vertexShader:"uniform lowp int renderType;\nuniform vec3 screenPosition;\nuniform vec2 scale;\nuniform float rotation;\nuniform sampler2D occlusionMap;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nvUV = uv;\nvec2 pos = position;\nif( renderType == 2 ) {\nvec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );\nvVisibility =        visibility.r / 9.0;\nvVisibility *= 1.0 - visibility.g / 9.0;\nvVisibility *=       visibility.b / 9.0;\nvVisibility *= 1.0 - visibility.a / 9.0;\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",fragmentShader:"uniform lowp int renderType;\nuniform sampler2D map;\nuniform float opacity;\nuniform vec3 color;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nif( renderType == 0 ) {\ngl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );\n} else if( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nvec4 texture = texture2D( map, vUV );\ntexture.a *= opacity * vVisibility;\ngl_FragColor = texture;\ngl_FragColor.rgb *= color;\n}\n}"},lensFlare:{vertexShader:"uniform lowp int renderType;\nuniform vec3 screenPosition;\nuniform vec2 scale;\nuniform float rotation;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvoid main() {\nvUV = uv;\nvec2 pos = position;\nif( renderType == 2 ) {\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",fragmentShader:"precision mediump float;\nuniform lowp int renderType;\nuniform sampler2D map;\nuniform sampler2D occlusionMap;\nuniform float opacity;\nuniform vec3 color;\nvarying vec2 vUV;\nvoid main() {\nif( renderType == 0 ) {\ngl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );\n} else if( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nfloat visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a;\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a;\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a;\nvisibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;\nvisibility = ( 1.0 - visibility / 4.0 );\nvec4 texture = texture2D( map, vUV );\ntexture.a *= opacity * visibility;\ngl_FragColor = texture;\ngl_FragColor.rgb *= color;\n}\n}"}};var THREEx=THREEx||{};THREEx.FullScreen=THREEx.FullScreen||{},THREEx.FullScreen.available=function(){return this._hasWebkitFullScreen||this._hasMozFullScreen},THREEx.FullScreen.activated=function(){return this._hasWebkitFullScreen?document.webkitIsFullScreen:this._hasMozFullScreen?document.mozFullScreen:void console.assert(!1)},THREEx.FullScreen.request=function(t){t=t||document.body,this._hasWebkitFullScreen?t.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT):this._hasMozFullScreen?t.mozRequestFullScreen():console.assert(!1)},THREEx.FullScreen.cancel=function(){this._hasWebkitFullScreen?document.webkitCancelFullScreen():this._hasMozFullScreen?document.mozCancelFullScreen():console.assert(!1)},THREEx.FullScreen._hasWebkitFullScreen="webkitCancelFullScreen"in document?!0:!1,THREEx.FullScreen._hasMozFullScreen="mozCancelFullScreen"in document?!0:!1,THREEx.FullScreen.bindKey=function(t){t=t||{};var e=t.charCode||"f".charCodeAt(0),n=void 0!==t.dblclick?t.dblclick:!1,r=t.element,i=function(){THREEx.FullScreen.activated()?THREEx.FullScreen.cancel():THREEx.FullScreen.request(r)},o=function(t){t.which===e&&i()}.bind(this);return document.addEventListener("keypress",o,!1),n&&document.addEventListener("dblclick",i,!1),{unbind:function(){document.removeEventListener("keypress",o,!1),n&&document.removeEventListener("dblclick",i,!1)}}};var THREEx=THREEx||{};THREEx.WindowResize=function(t,e,n){n=n||function(){return{width:window.innerWidth,height:window.innerHeight}};var r=function(){var r=n();t.setSize(r.width,r.height),e.aspect=r.width/r.height,e.updateProjectionMatrix()};return window.addEventListener("resize",r,!1),{trigger:function(){r()},destroy:function(){window.removeEventListener("resize",r)}}},Detector={canvas:!!window.CanvasRenderingContext2D,webgl:function(){try{return!!window.WebGLRenderingContext&&!!document.createElement("canvas").getContext("experimental-webgl")}catch(t){return!1}}(),workers:!!window.Worker,fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob,getWebGLErrorMessage:function(){var t=document.createElement("div");return t.id="webgl-error-message",t.style.fontFamily="monospace",t.style.fontSize="13px",t.style.fontWeight="normal",t.style.textAlign="center",t.style.background="#fff",t.style.color="#000",t.style.padding="1.5em",t.style.width="400px",t.style.margin="5em auto 0",this.webgl||(t.innerHTML=window.WebGLRenderingContext?['Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br />','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join("\n"):['Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br/>','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join("\n")),t},addGetWebGLMessage:function(t){var e,n,r;t=t||{},e=void 0!==t.parent?t.parent:document.body,n=void 0!==t.id?t.id:"oldie",r=Detector.getWebGLErrorMessage(),r.id=n,e.appendChild(r)}},THREE.TrackballControls=function(t,e){function n(t){l.enabled!==!1&&(window.removeEventListener("keydown",n),m=d,d===f.NONE&&(t.keyCode!==l.keys[f.ROTATE]||l.noRotate?t.keyCode!==l.keys[f.ZOOM]||l.noZoom?t.keyCode!==l.keys[f.PAN]||l.noPan||(d=f.PAN):d=f.ZOOM:d=f.ROTATE))}function r(){l.enabled!==!1&&(d=m,window.addEventListener("keydown",n,!1))}function i(t){l.enabled!==!1&&(t.preventDefault(),t.stopPropagation(),d===f.NONE&&(d=t.button),d!==f.ROTATE||l.noRotate?d!==f.ZOOM||l.noZoom?d!==f.PAN||l.noPan||(R=w=l.getMouseOnScreen(t.clientX,t.clientY)):E=x=l.getMouseOnScreen(t.clientX,t.clientY):v=y=l.getMouseProjectionOnBall(t.clientX,t.clientY),document.addEventListener("mousemove",o,!1),document.addEventListener("mouseup",a,!1))}function o(t){l.enabled!==!1&&(t.preventDefault(),t.stopPropagation(),d!==f.ROTATE||l.noRotate?d!==f.ZOOM||l.noZoom?d!==f.PAN||l.noPan||(w=l.getMouseOnScreen(t.clientX,t.clientY)):x=l.getMouseOnScreen(t.clientX,t.clientY):y=l.getMouseProjectionOnBall(t.clientX,t.clientY))}function a(t){l.enabled!==!1&&(t.preventDefault(),t.stopPropagation(),d=f.NONE,document.removeEventListener("mousemove",o),document.removeEventListener("mouseup",a))}function s(t){if(l.enabled!==!1){t.preventDefault(),t.stopPropagation();var e=0;t.wheelDelta?e=t.wheelDelta/40:t.detail&&(e=-t.detail/3),E.y+=.01*e}}function h(t){if(l.enabled!==!1)switch(t.touches.length){case 1:d=f.TOUCH_ROTATE,v=y=l.getMouseProjectionOnBall(t.touches[0].pageX,t.touches[0].pageY);break;case 2:d=f.TOUCH_ZOOM;var e=t.touches[0].pageX-t.touches[1].pageX,n=t.touches[0].pageY-t.touches[1].pageY;b=T=Math.sqrt(e*e+n*n);break;case 3:d=f.TOUCH_PAN,R=w=l.getMouseOnScreen(t.touches[0].pageX,t.touches[0].pageY);break;default:d=f.NONE}}function u(t){if(l.enabled!==!1)switch(t.preventDefault(),t.stopPropagation(),t.touches.length){case 1:y=l.getMouseProjectionOnBall(t.touches[0].pageX,t.touches[0].pageY);break;case 2:var e=t.touches[0].pageX-t.touches[1].pageX,n=t.touches[0].pageY-t.touches[1].pageY;b=Math.sqrt(e*e+n*n);break;case 3:w=l.getMouseOnScreen(t.touches[0].pageX,t.touches[0].pageY);break;default:d=f.NONE}}function c(t){if(l.enabled!==!1){switch(t.touches.length){case 1:v=y=l.getMouseProjectionOnBall(t.touches[0].pageX,t.touches[0].pageY);break;case 2:T=b=0;break;case 3:R=w=l.getMouseOnScreen(t.touches[0].pageX,t.touches[0].pageY)}d=f.NONE}}var l=this,f={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM:4,TOUCH_PAN:5};this.object=t,this.domElement=void 0!==e?e:document,this.enabled=!0,this.screen={width:0,height:0,offsetLeft:0,offsetTop:0},this.radius=(this.screen.width+this.screen.height)/4,this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.keys=[65,83,68],this.target=new THREE.Vector3;var p=new THREE.Vector3,d=f.NONE,m=f.NONE,g=new THREE.Vector3,v=new THREE.Vector3,y=new THREE.Vector3,E=new THREE.Vector2,x=new THREE.Vector2,T=0,b=0,R=new THREE.Vector2,w=new THREE.Vector2;this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone();var _={type:"change"};this.handleResize=function(){this.screen.width=window.innerWidth,this.screen.height=window.innerHeight,this.screen.offsetLeft=0,this.screen.offsetTop=0,this.radius=(this.screen.width+this.screen.height)/4},this.handleEvent=function(t){"function"==typeof this[t.type]&&this[t.type](t)},this.getMouseOnScreen=function(t,e){return new THREE.Vector2((t-l.screen.offsetLeft)/l.radius*.5,(e-l.screen.offsetTop)/l.radius*.5)},this.getMouseProjectionOnBall=function(t,e){var n=new THREE.Vector3((t-.5*l.screen.width-l.screen.offsetLeft)/l.radius,(.5*l.screen.height+l.screen.offsetTop-e)/l.radius,0),r=n.length();r>1?n.normalize():n.z=Math.sqrt(1-r*r),g.copy(l.object.position).sub(l.target);var i=l.object.up.clone().setLength(n.y);return i.add(l.object.up.clone().cross(g).setLength(n.x)),i.add(g.setLength(n.z)),i},this.rotateCamera=function(){var t=Math.acos(v.dot(y)/v.length()/y.length());if(t){var e=(new THREE.Vector3).crossVectors(v,y).normalize();quaternion=new THREE.Quaternion,t*=l.rotateSpeed,quaternion.setFromAxisAngle(e,-t),g.applyQuaternion(quaternion),l.object.up.applyQuaternion(quaternion),y.applyQuaternion(quaternion),l.staticMoving?v.copy(y):(quaternion.setFromAxisAngle(e,t*(l.dynamicDampingFactor-1)),v.applyQuaternion(quaternion))}},this.zoomCamera=function(){if(d===f.TOUCH_ZOOM){var t=T/b;T=b,g.multiplyScalar(t)}else{var t=1+(x.y-E.y)*l.zoomSpeed;1!==t&&t>0&&(g.multiplyScalar(t),l.staticMoving?E.copy(x):E.y+=(x.y-E.y)*this.dynamicDampingFactor)}},this.panCamera=function(){var t=w.clone().sub(R);if(t.lengthSq()){t.multiplyScalar(g.length()*l.panSpeed);var e=g.clone().cross(l.object.up).setLength(t.x);e.add(l.object.up.clone().setLength(t.y)),l.object.position.add(e),l.target.add(e),l.staticMoving?R=w:R.add(t.subVectors(w,R).multiplyScalar(l.dynamicDampingFactor))}},this.checkDistances=function(){l.noZoom&&l.noPan||(l.object.position.lengthSq()>l.maxDistance*l.maxDistance&&l.object.position.setLength(l.maxDistance),g.lengthSq()<l.minDistance*l.minDistance&&l.object.position.addVectors(l.target,g.setLength(l.minDistance)))},this.update=function(){g.subVectors(l.object.position,l.target),l.noRotate||l.rotateCamera(),l.noZoom||l.zoomCamera(),l.noPan||l.panCamera(),l.object.position.addVectors(l.target,g),l.checkDistances(),l.object.lookAt(l.target),p.distanceToSquared(l.object.position)>0&&(l.dispatchEvent(_),p.copy(l.object.position))},this.reset=function(){d=f.NONE,m=f.NONE,l.target.copy(l.target0),l.object.position.copy(l.position0),l.object.up.copy(l.up0),g.subVectors(l.object.position,l.target),l.object.lookAt(l.target),l.dispatchEvent(_),p.copy(l.object.position)},this.domElement.addEventListener("contextmenu",function(t){t.preventDefault()},!1),this.domElement.addEventListener("mousedown",i,!1),this.domElement.addEventListener("mousewheel",s,!1),this.domElement.addEventListener("DOMMouseScroll",s,!1),this.domElement.addEventListener("touchstart",h,!1),this.domElement.addEventListener("touchend",c,!1),this.domElement.addEventListener("touchmove",u,!1),window.addEventListener("keydown",n,!1),window.addEventListener("keyup",r,!1),this.handleResize()},THREE.TrackballControls.prototype=Object.create(THREE.EventDispatcher.prototype);var toxi;!function(){var t,e,n;!function(r){function i(t,e){return x.call(t,e)}function o(t,e){var n,r,i,o,a,s,h,u,c,l,f,p=e&&e.split("/"),d=y.map,m=d&&d["*"]||{};if(t&&"."===t.charAt(0))if(e){for(p=p.slice(0,p.length-1),t=t.split("/"),a=t.length-1,y.nodeIdCompat&&b.test(t[a])&&(t[a]=t[a].replace(b,"")),t=p.concat(t),c=0;c<t.length;c+=1)if(f=t[c],"."===f)t.splice(c,1),c-=1;else if(".."===f){if(1===c&&(".."===t[2]||".."===t[0]))break;c>0&&(t.splice(c-1,2),c-=2)}t=t.join("/")}else 0===t.indexOf("./")&&(t=t.substring(2));if((p||m)&&d){for(n=t.split("/"),c=n.length;c>0;c-=1){if(r=n.slice(0,c).join("/"),p)for(l=p.length;l>0;l-=1)if(i=d[p.slice(0,l).join("/")],i&&(i=i[r])){o=i,s=c;break}if(o)break;!h&&m&&m[r]&&(h=m[r],u=c)}!o&&h&&(o=h,s=u),o&&(n.splice(0,s,o),t=n.join("/"))}return t}function a(t,e){return function(){return p.apply(r,T.call(arguments,0).concat([t,e]))}}function s(t){return function(e){return o(e,t)}}function h(t){return function(e){g[t]=e}}function u(t){if(i(v,t)){var e=v[t];delete v[t],E[t]=!0,f.apply(r,e)}if(!i(g,t)&&!i(E,t))throw new Error("No "+t);return g[t]}function c(t){var e,n=t?t.indexOf("!"):-1;return n>-1&&(e=t.substring(0,n),t=t.substring(n+1,t.length)),[e,t]}function l(t){return function(){return y&&y.config&&y.config[t]||{}}}var f,p,d,m,g={},v={},y={},E={},x=Object.prototype.hasOwnProperty,T=[].slice,b=/\.js$/;d=function(t,e){var n,r=c(t),i=r[0];return t=r[1],i&&(i=o(i,e),n=u(i)),i?t=n&&n.normalize?n.normalize(t,s(e)):o(t,e):(t=o(t,e),r=c(t),i=r[0],t=r[1],i&&(n=u(i))),{f:i?i+"!"+t:t,n:t,pr:i,p:n}},m={require:function(t){return a(t)},exports:function(t){var e=g[t];return"undefined"!=typeof e?e:g[t]={}},module:function(t){return{id:t,uri:"",exports:g[t],config:l(t)}}},f=function(t,e,n,o){var s,c,l,f,p,y,x=[],T=typeof n;if(o=o||t,"undefined"===T||"function"===T){for(e=!e.length&&n.length?["require","exports","module"]:e,p=0;p<e.length;p+=1)if(f=d(e[p],o),c=f.f,"require"===c)x[p]=m.require(t);else if("exports"===c)x[p]=m.exports(t),y=!0;else if("module"===c)s=x[p]=m.module(t);else if(i(g,c)||i(v,c)||i(E,c))x[p]=u(c);else{if(!f.p)throw new Error(t+" missing "+c);f.p.load(f.n,a(o,!0),h(c),{}),x[p]=g[c]}l=n?n.apply(g[t],x):void 0,t&&(s&&s.exports!==r&&s.exports!==g[t]?g[t]=s.exports:l===r&&y||(g[t]=l))}else t&&(g[t]=n)},t=e=p=function(t,e,n,i,o){if("string"==typeof t)return m[t]?m[t](e):u(d(t,e).f);if(!t.splice){if(y=t,y.deps&&p(y.deps,y.callback),!e)return;e.splice?(t=e,e=n,n=null):t=r}return e=e||function(){},"function"==typeof n&&(n=i,i=o),i?f(r,t,e,n):setTimeout(function(){f(r,t,e,n)},4),p},p.config=function(t){return p(t)},t._defined=g,n=function(t,e,n){e.splice||(n=e,e=[]),i(g,t)||i(v,t)||(v[t]=[t,e,n])},n.amd={jQuery:!0}}(),n("almond",function(){}),n("toxi/internals/has",["require","exports","module"],function(t,e){var n=function(t,e){if(void 0===t||"object"!=typeof t)return!1;var n,r=0,i=e.length;for(r=0;i>r;r++)if(n=e[r],!(n in t))return!1;return!0};e.property=function(t,e){return hasOwnProperty.call(t,e)},e.all=n,e.typedArrays=function(){return"undefined"!=typeof Int32Array&&"undefined"!=typeof Float32Array&&"undefined"!=typeof Uint8Array},e.XY=function(t){return t&&"number"==typeof t.x&&"number"==typeof t.y},e.XYZ=function(t){return t&&"number"==typeof t.x&&"number"==typeof t.y&&"number"==typeof t.z},e.XYWidthHeight=function(t){return t&&"number"==typeof t.x&&"number"==typeof t.y&&"number"==typeof t.width&&"number"==typeof t.height}}),n("toxi/internals/is",["./has","exports"],function(t,e){var n=function(e){return function(n){return t.all(n,e)}};e.Array=Array.isArray||function(t){return"[object Array]"==t.toString()},e.Object=function(t){return"object"==typeof t},e.undef=function(t){return void 0===t},e.existy=function(t){return null!=t},e.String=function(t){return"string"==typeof t},e.Number=function(t){return"number"==typeof t},e.Function=function(t){return"function"==typeof t},e.AABB=n(["setExtent","getNormalForPoint"]),e.ColorGradient=n(["gradient","interpolator","maxDither","addColorAt","calcGradient"]),e.ColorList=n(["add","addAll","adjustBrightness","adjustSaturation"]),e.ColorRange=n(["add","addAlphaRange","addBrightnessRange","addHueRange"]),e.Circle=n(["getCircumference","getRadius","intersectsCircle"]),e.FloatRange=n(["min","max","adjustCurrentBy","getMedian"]),e.Hue=n(["getHue","isPrimary"]),e.Line2D=n(["closestPointTo","intersectLine","getLength"]),e.Matrix4x4=n(["identity","invert","setFrustrum"]),e.Rect=n(["x","y","width","height","getArea","getCentroid","getDimensions"]),e.Sphere=n(["x","y","z","radius","toMesh"]),e.ScaleMap=n(["mapFunction","setInputRange","setOutputRange","getMappedValueFor"]),e.TColor=n(["rgb","cmyk","hsv"]),e.ParticleBehavior=n(["applyBehavior","configure"]),e.VerletParticle2D=n(["x","y","weight"])}),n("toxi/internals/extend",["require"],function(){return function(t,e){if("function"!=typeof t)throw Error("childClass was not function, possible circular: ",t);if("function"!=typeof e)throw Error("superClass was not function, possible circular: ",e);t.prototype=Object.create(e.prototype),t.constructor=t,t.prototype.parent=e.prototype}}),n("toxi/internals/each",["require"],function(){var t={};return function(e,n,r){if(null!=e)if(Array.prototype.forEach&&e.forEach===Array.prototype.forEach)e.forEach(n,r);else if(e.length===+e.length){for(var i=0,o=e.length;o>i;i++)if(i in e&&n.call(r,e[i],i,e)===t)return}else for(var a in e)if(hasOwnProperty.call(e,a)&&n.call(r,e[a],a,e)===t)return}}),n("toxi/internals/bind",["require"],function(){var t={};return function(e,n){var r,i,o=Function.prototype,a=Array.prototype.slice;return e.bind===o.bind&&o.bind?o.bind.apply(e,a.call(arguments,1)):(r=a.call(arguments,2),i=function(){if(!(this instanceof i))return e.apply(n,r.concat(a.call(arguments)));t.prototype=e.prototype;var o=new t;t.prototype=null;var s=e.apply(o,r.concat(a.call(arguments)));return Object(s)===s?s:o})}}),n("toxi/internals/keys",["require"],function(){return Object.keys||function(t){if(t!==Object(t))throw new TypeError("Invalid object");var e=[];for(var n in t)exports.has(t,n)&&e.push(n);return e}}),n("toxi/internals/values",["./has"],function(t){return function(e){var n=[];for(var r in e)t.property(e,r)&&n.push(e[r]);return n}}),n("toxi/internals/filter",[],function(){return function(t,e,n){var r=[];return null==t?r:Array.prototype.filter&&t.filter===Array.prototype.filter?t.filter(e,n):(exports.each(t,function(t,i,o){e.call(n,t,i,o)&&(r[r.length]=t)}),r)}}),n("toxi/internals/mixin",["./each"],function(t){return function(e,n){return t(n,function(t,n){e[n]=t}),e}}),n("toxi/internals/Iterator",["./is"],function(t){var e=function(t){this.__it=t.slice(0)};e.prototype={hasNext:function(){return this.__it.length>0},next:function(){return this.__it.shift()}};var n=function(t){this.__obj={},this.__keys=[];for(var n in t)this.__obj[n]=t[n],this.__keys.push(n);this.__it=new e(this.__keys)};n.prototype={hasNext:function(){return this.__it.hasNext()},next:function(){var t=this.__it.next();return this.__obj[t]}};var r=function(r){return t.array(r)?new e(r):new n(r)};return r}),n("toxi/internals/LinkedMap",["./each"],function(t){var e=function(t){this.__list=[],this.__map={},this.__inverseMap={},"function"==typeof t&&(this.generateKey=t)};return e.prototype={each:function(e){t(this.__map,e)},get:function(t){var e=this,n=function(){return void 0!==e.__inverseMap[t]?t:e.__map[t]},r=n();return void 0===r&&(t=this.generateKey(t),r=n()),r},generateKey:function(t){return t.toString()},getArray:function(){return this.__list},has:function(t){var e=this,n=function(t){return void 0!==e.__map[t]||void 0!==e.__inverseMap[t]};return n(t)?!0:n(this.generateKey(t))},put:function(t,e){t=this.generateKey(t),this.__map[t]=e,this.__inverseMap[e]=t,this.__list.push(e)},remove:function(t){t=this.get(t);var e=this.__inverseMap[t];return delete this.__inverseMap[t],delete this.__map[e],this.__list.splice(this.__list.indexOf(t),1)[0]},size:function(){return this.__list.length
},values:function(){return this.getArray().slice(0)}},e}),n("toxi/internals/numberComparator",[],function(){return function(t,e){return t==e?0:e>t?-1:t>e?1:void 0}}),n("toxi/internals/removeItemFrom",[],function(){return function(t,e){var n=e.indexOf(t);return n>-1?e.splice(n,1):void 0}}),n("toxi/internals",["require","exports","module","./internals/is","./internals/has","./internals/extend","./internals/each","./internals/bind","./internals/keys","./internals/values","./internals/filter","./internals/mixin","./internals/Iterator","./internals/LinkedMap","./internals/numberComparator","./internals/removeItemFrom"],function(t,e){e.is=t("./internals/is"),e.has=t("./internals/has"),e.extend=t("./internals/extend"),e.each=t("./internals/each"),e.bind=t("./internals/bind"),e.keys=t("./internals/keys"),e.values=t("./internals/values"),e.filter=t("./internals/filter"),e.mixin=t("./internals/mixin"),e.Iterator=t("./internals/Iterator"),e.LinkedMap=t("./internals/LinkedMap"),e.numberComparator=t("./internals/numberComparator"),e.removeItemFrom=t("./internals/removeItemFrom")}),n("toxi/color/accessors",["require","exports","module","../internals","../internals"],function(t,e){function n(t,n){var o=t+"Accessor",a=t.toLowerCase();e[o]=function(t){this.component=t,this.compare=i(this.compare,this)},e[o].prototype.compare=function(t,e){var n=t[a][this.component],i=e[a][this.component];return r(n,i)},e[o].prototype.getComponentValueFor=function(t){return t[a][this.component]},e[o].prototype.setComponentValueFor=function(t,e){t["set"+n[this.component]](e)}}var r=t("../internals").numberComparator,i=t("../internals").bind;n("RGB",["Red","Green","Blue"]),n("HSV",["Hue","Saturation","Brightness"]),n("CMYK",["Cyan","Magenta","Yellow","Black"]);var o=function(){};o.prototype.compare=function(t,e){return r(t.luminance(),e.luminance())},o.prototype.getComponentValueFor=function(t){return t.luminance()},o.prototype.setComponentValueFor=function(){};var a=function(){};a.prototype.compare=function(t,e){return r(t.alpha(),e.alpha())},a.prototype.getComponentValueFor=function(t){return t.alpha()},a.prototype.setComponentValueFor=function(t,e){t.setAlpha(e)},e.LuminanceAccessor=o,e.AlphaAccessor=a}),n("toxi/color/HSVAccessor",["require","./accessors"],function(t){return t("./accessors").HSVAccessor}),n("toxi/color/RGBAccessor",["require","./accessors"],function(t){return t("./accessors").RGBAccessor}),n("toxi/color/CMYKAccessor",["require","./accessors"],function(t){return t("./accessors").CMYKAccessor}),n("toxi/color/AlphaAccessor",["require","./accessors"],function(t){return t("./accessors").AlphaAccessor}),n("toxi/color/LuminanceAccessor",["require","./accessors"],function(t){return t("./accessors").LuminanceAccessor}),n("toxi/color/accessCriteria",["require","exports","module","./HSVAccessor","./RGBAccessor","./CMYKAccessor","./AlphaAccessor","./LuminanceAccessor"],function(t,e){var n=t("./HSVAccessor"),r=t("./RGBAccessor"),i=t("./CMYKAccessor"),o=t("./AlphaAccessor"),a=t("./LuminanceAccessor");e.HUE=new n(0),e.SATURATION=new n(1),e.BRIGHTNESS=new n(2),e.RED=new r(0),e.GREEN=new r(1),e.BLUE=new r(2),e.CYAN=new i(0),e.MAGENTA=new i(1),e.YELLOW=new i(2),e.BLACK=new i(3),e.ALPHA=new o,e.LUMINANCE=new a}),n("toxi/color/distanceProxies",["require","exports","module"],function(t,e){function n(t){var n=t+"DistanceProxy";e[n]=function(){},e[n].prototype.distanceBetween=function(e,n){return e["distanceTo"+t](n)}}n("HSV"),n("RGB"),n("CMYK")}),n("toxi/color/CMYKDistanceProxy",["require","./distanceProxies"],function(t){return t("./distanceProxies").CMYKDistanceProxy}),n("toxi/math/mathUtils",[],function(){var t={};return t.SQRT2=Math.sqrt(2),t.SQRT3=Math.sqrt(3),t.LOG2=Math.log(2),t.PI=3.141592653589793,t.INV_PI=1/t.PI,t.HALF_PI=t.PI/2,t.THIRD_PI=t.PI/3,t.QUARTER_PI=t.PI/4,t.TWO_PI=2*t.PI,t.THREE_HALVES_PI=t.TWO_PI-t.HALF_PI,t.PI_SQUARED=t.PI*t.PI,t.EPS=1.1920928955078125e-7,t.DEG2RAD=t.PI/180,t.RAD2DEG=180/t.PI,t.SHIFT23=1<<23,t.INV_SHIFT23=1/t.SHIFT23,t.SIN_A=-4/(t.PI*t.PI),t.SIN_B=4/t.PI,t.SIN_P=.225,t.abs=Math.abs,t.ceilPowerOf2=function(t){for(var e=1;t>e;)e<<=1;return e},t.clip=function(t,e,n){return e>t?e:t>n?n:t},t.clipNormalized=function(t){return 0>t?0:t>1?1:t},t.cos=Math.cos,t.degrees=function(e){return e*t.RAD2DEG},t.fastCos=function(e){return t.fastSin(e+(e>t.HALF_PI?-t.THREE_HALVES_PI:t.HALF_PI))},t.fastSin=function(e){return e=t.SIN_B*e+t.SIN_A*e*Math.abs(e),t.SIN_P*(e*Math.abs(e)-e)+e},t.flipCoin=function(){return Math.random()<.5},t.floor=function(t){var e=~~t;return 0>t&&t!=e&&e--,e},t.floorPowerOf2=function(e){return~~Math.pow(2,parseInt(Math.log(e)/t.LOG2,10))},t.max=function(t,e,n){return void 0===n?Math.max(t,e):t>e?t>n?t:n:e>n?e:n},t.min=function(t,e,n){return void 0===n?Math.min(t,e):e>t?n>t?t:n:n>e?e:n},t.normalizedRandom=function(){return 2*Math.random()-1},t.radians=function(e){return e*t.DEG2RAD},t.random=function(t,e,n){return 1===arguments.length?Math.random()*arguments[0]:(2==arguments.length&&(n=e,e=t,t=Math.random),e||n?n?t()*(n-e)+e:(n=e,t()*n):Math.random())},t.reduceAngle=function(e){return e%=t.TWO_PI,Math.abs(e)>t.PI&&(e-=t.TWO_PI),Math.abs(e)>t.HALF_PI&&(e=t.PI-e),e},t.sign=function(t){return 0>t?-1:t>0?1:0},t.sin=function(e){return e=t.reduceAngle(e),Math.abs(e)<=t.QUARTER_PI?t.fastSin(e):t.fastCos(t.HALF_PI-e)},t}),n("toxi/math/LinearInterpolation",[],function(){var t=function(){},e=function(t,e,n){return t+(e-t)*n};return t.interpolate=e,t.prototype.interpolate=e,t}),n("toxi/geom/vectors",["require","exports","module","../math/mathUtils","../internals/has","../internals/is"],function(t,e){var n,r,i=t("../math/mathUtils"),o=t("../internals/has"),a=t("../internals/is"),s=o.XY,h=a.Rect;n=function(t,e){s(t)?(e=t.y,t=t.x):(t=t||0,e=e||0),this.x=t,this.y=e},n.Axis={X:{getVector:function(){return n.X_AXIS},toString:function(){return"Vec2D.Axis.X"}},Y:{getVector:function(){return n.Y_AXIS},toString:function(){return"Vec2D.Axis.Y"}}};var u=function(){var t={x:0,y:0};return function(e,n){return e&&"number"==typeof e.x&&"number"==typeof e.y?e:(void 0!==e&&void 0===n?n=e:void 0===e?e=0:void 0===n&&(n=0),t.x=e,t.y=n,t)}}();n.prototype={abs:function(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this},add:function(t,e){var r=new n(t,e);return r.x+=this.x,r.y+=this.y,r},addSelf:function(t,e){var n=u(t,e);return this.x+=n.x,this.y+=n.y,this},angleBetween:function(t,e){if(void 0===e){{this.dot(t)}return Math.acos(this.dot(t))}var n=e?this.getNormalized().dot(t.getNormalized()):this.dot(t);return Math.acos(n)},clear:function(){return this.x=this.y=0,this},compareTo:function(t){return this.x==t.x&&this.y==t.y?0:this.magSquared()-t.magSquared()},constrain:function(t,e){return s(t)&&s(e)?(this.x=i.clip(this.x,t.x,e.x),this.y=i.clip(this.y,t.y,e.y)):h(t)&&(this.x=i.clip(this.x,t.x,t.x+t.width),this.y=i.clip(this.y,t.y,t.y+t.height)),this},copy:function(){return new n(this)},cross:function(t){return this.x*t.y-this.y*t.x},distanceTo:function(t){if(void 0!==t){var e=this.x-t.x,n=this.y-t.y;return Math.sqrt(e*e+n*n)}return 0/0},distanceToSquared:function(t){if(void 0!==t){var e=this.x-t.x,n=this.y-t.y;return e*e+n*n}return 0/0},dot:function(t){return this.x*t.x+this.y*t.y},equals:function(t){return s(t)?this.x==t.x&&this.y==t.y:!1},equalsWithTolerance:function(t,e){return s(t)&&i.abs(this.x-t.x)<e&&i.abs(this.y-t.y)<e?!0:!1},floor:function(){return this.x=i.floor(this.x),this.y=i.floor(this.y),this},frac:function(){return this.x-=i.floor(this.x),this.y-=i.floor(this.y),this},getAbs:function(){return new n(this).abs()},getComponent:function(t){return"number"==typeof t&&(t=0===t?n.Axis.X:n.Axis.Y),t==n.Axis.X?this.x:t==n.Axis.Y?this.y:0},getConstrained:function(t){return new n(this).constrain(t)},getFloored:function(){return new n(this).floor()},getFrac:function(){return new n(this).frac()},getInverted:function(){return new n(-this.x,-this.y)},getLimited:function(t){return this.magSquared()>t*t?this.getNormalizedTo(t):new n(this)},getNormalized:function(){return new n(this).normalize()},getNormalizedTo:function(t){return new n(this).normalizeTo(t)},getPerpendicular:function(){return new n(this).perpendicular()},getReciprocal:function(){return new n(this).reciprocal()},getReflected:function(t){return new n(this).reflect(t)},getRotated:function(t){return new n(this).rotate(t)},getSignum:function(){return new n(this).signum()},heading:function(){return Math.atan2(this.y,this.x)},interpolateTo:function(t,e,r){return void 0===r?new n(this.x+(t.x-this.x)*e,this.y+(t.y-this.y)*e):new n(r.interpolate(this.x,t.x,e),r.interpolate(this.y,t.y,e))},interpolateToSelf:function(t,e,n){return void 0===n?(this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e):(this.x=n.interpolate(this.x,t.x,e),this.y=n.interpolate(this.y,t.y,e)),this},invert:function(){return this.x*=-1,this.y*=-1,this},isInCircle:function(t,e){var n=this.sub(t).magSquared();return e*e>=n},isInRectangle:function(t){return this.x<t.x||this.x>t.x+t.width?!1:this.y<t.y||this.y>t.y+t.height?!1:!0},isInTriangle:function(t,e,n){var r=this.sub(t).normalize(),o=this.sub(e).normalize(),a=this.sub(n).normalize(),s=Math.acos(r.dot(o));return s+=Math.acos(o.dot(a)),s+=Math.acos(a.dot(r)),Math.abs(s-i.TWO_PI)<=.005},isMajorAxis:function(t){var e=Math.abs(this.x),n=Math.abs(this.y),r=1-t;return e>r?t>n:n>r?t>e:!1},isZeroVector:function(){return Math.abs(this.x)<i.EPS&&Math.abs(this.y)<i.EPS},jitter:function(t,e){var n=u(t,e);return this.x+=i.normalizedRandom()*n.x,this.y+=i.normalizedRandom()*n.y,this},limit:function(t){return this.magSquared()>t*t?this.normalize().scaleSelf(t):this},magnitude:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},magSquared:function(){return this.x*this.x+this.y*this.y},max:function(t){return new n(i.max(this.x,t.x),i.max(this.y,t.y))},maxSelf:function(t){return this.x=i.max(this.x,t.x),this.y=i.max(this.y,t.y),this},min:function(t){return new n(i.min(this.x,t.x),i.min(this.y,t.y))},minSelf:function(t){return this.x=i.min(this.x,t.x),this.y=i.min(this.y,t.y),this},normalize:function(){var t=this.x*this.x+this.y*this.y;return t>0&&(t=1/Math.sqrt(t),this.x*=t,this.y*=t),this},normalizeTo:function(t){var e=Math.sqrt(this.x*this.x+this.y*this.y);return e>0&&(e=t/e,this.x*=e,this.y*=e),this},perpendicular:function(){var t=this.x;return this.x=-this.y,this.y=t,this},positiveHeading:function(){var t=Math.sqrt(this.x*this.x+this.y*this.y);return this.y>=0?Math.acos(this.x/t):Math.acos(-this.x/t)+i.PI},reciprocal:function(){return this.x=1/this.x,this.y=1/this.y,this},reflect:function(t){return this.set(t.scale(2*this.dot(t)).subSelf(this))},rotate:function(t){var e=Math.cos(t),n=Math.sin(t),r=e*this.x-n*this.y;return this.y=n*this.x+e*this.y,this.x=r,this},roundToAxis:function(){return Math.abs(this.x)<.5?this.x=0:(this.x=this.x<0?-1:1,this.y=0),Math.abs(this.y)<.5?this.y=0:(this.y=this.y<0?-1:1,this.x=0),this},scale:function(t,e){var r=u(t,e);return new n(this.x*r.x,this.y*r.y)},scaleSelf:function(t,e){var n=u(t,e);return this.x*=n.x,this.y*=n.y,this},set:function(t,e){var n=u(t,e);return this.x=n.x,this.y=n.y,this},setComponent:function(t,e){return"number"==typeof t&&(t=0===t?n.Axis.X:n.Axis.Y),t===n.Axis.X?this.x=e:t===n.Axis.Y&&(this.y=e),this},signum:function(){return this.x=this.x<0?-1:0===this.x?0:1,this.y=this.y<0?-1:0===this.y?0:1,this},sub:function(t,e){var r=u(t,e);return new n(this.x-r.x,this.y-r.y)},subSelf:function(t,e){var n=u(t,e);return this.x-=n.x,this.y-=n.y,this},tangentNormalOfEllipse:function(t,e){var r=this.sub(t),i=e.x*e.x,o=e.y*e.y;return new n(r.x/i,r.y/o).normalize()},toArray:function(){return[this.x,this.y]},toCartesian:function(){var t=this.x*Math.cos(this.y);return this.y=this.x*Math.sin(this.y),this.x=t,this},toPolar:function(){var t=Math.sqrt(this.x*this.x+this.y*this.y);return this.y=Math.atan2(this.y,this.x),this.x=t,this},toString:function(){var t="{x:"+this.x+", y:"+this.y+"}";return t}},n.prototype.bisect=function(t){var e=this.sub(t),n=this.add(t),i=e.dot(n);return new r(e.x,e.y,-i/2)},n.prototype.to3DXY=function(){return new r(this.x,this.y,0)},n.prototype.to3DXZ=function(){return new r(this.x,0,this.y)},n.prototype.to3DYZ=function(){return new r(0,this.x,this.y)},n.X_AXIS=new n(1,0),n.Y_AXIS=new n(0,1),n.ZERO=new n,n.MIN_VALUE=new n(Number.MIN_VALUE,Number.MIN_VALUE),n.MAX_VALUE=new n(Number.MAX_VALUE,Number.MAX_VALUE),n.fromTheta=function(t){return new n(Math.cos(t),Math.sin(t))},n.max=function(t,e){return new n(i.max(t.x,e.x),i.max(t.y,e.y))},n.min=function(t,e){return new n(i.min(t.x,e.x),i.min(t.y,e.y))},n.randomVector=function(){var t=new n(2*Math.random()-1,2*Math.random()-1);return t.normalize()},r=function(t,e,n){o.XYZ(t)?(this.x=t.x,this.y=t.y,this.z=t.z):void 0===t?(this.x=0,this.y=0,this.z=0):(this.x=t,this.y=e,this.z=n)},r.prototype={abs:function(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this.z=Math.abs(this.z),this},add:function(t,e,n){return o.XYZ(t)?new r(this.x+t.x,this.y+t.y,this.z+t.z):new r(this.x+t,this.y+e,this.z+n)},addSelf:function(t,e,n){return void 0!==t&&void 0!==e&&void 0!==n?(this.x+=t,this.y+=e,this.z+=n):(this.x+=t.x,this.y+=t.y,this.z+=t.z),this},angleBetween:function(t,e){var n;return n=e?this.getNormalized().dot(t.getNormalized()):this.dot(t),Math.acos(n)},clear:function(){return this.x=this.y=this.z=0,this},compareTo:function(t){return this.x==t.x&&this.y==t.y&&this.z==t.z?0:this.magSquared()-t.magSqaured()},constrain:function(t,e){var n;return a.AABB(t)?(e=t.getMax(),n=t.getMin()):n=t,this.x=i.clip(this.x,n.x,e.x),this.y=i.clip(this.y,n.y,e.y),this.z=i.clip(this.z,n.z,e.z),this},copy:function(){return new r(this)},cross:function(t){return new r(this.y*t.z-t.y*this.z,this.z*t.x-t.z*this.x,this.x*t.y-t.x*this.y)},crossInto:function(t){var e=t.x,n=t.y,r=t.z;return result.x=this.y*r-n*this.z,result.y=this.z*e-r*this.x,result.z=this.x*n-e*this.y,result},crossSelf:function(t){var e=this.y*t.z-t.y*this.z,n=this.z*t.x-t.z*this.x;return this.z=this.x*t.y-t.x*this.y,this.y=n,this.x=e,this},distanceTo:function(t){if(void 0!==t){var e=this.x-t.x,n=this.y-t.y,r=this.z-t.z;return Math.sqrt(e*e+n*n+r*r)}return 0/0},distanceToSquared:function(t){if(void 0!==t){var e=this.x-t.x,n=this.y-t.y,r=this.z-t.z;return e*e+n*n+r*r}return 0/0},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},equals:function(t){return o.XYZ(t)?this.x==t.x&&this.y==t.y&&this.z==t.z:!1},equalsWithTolerance:function(t,e){return Math.abs(this.x-t.x)<e&&Math.abs(this.y-t.y)<e&&Math.abs(this.z-t.z)<e?!0:!1},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},frac:function(){return this.x-=Math.floor(this.x),this.y-=Math.floor(this.y),this.z-=Math.floor(this.z),this},getAbs:function(){return new r(this).abs()},getComponent:function(t){switch("number"==typeof t&&(t=t===r.Axis.X?0:t===r.Axis.Y?1:2),t){case 0:return this.x;case 1:return this.y;case 2:return this.z}},getConstrained:function(t){return new r(this).constrain(t)},getFloored:function(){return new r(this).floor()},getFrac:function(){return new r(this).frac()},getInverted:function(){return new r(-this.x,-this.y,-this.z)},getLimited:function(t){return this.magSquared()>t*t?this.getNormalizedTo(t):new r(this)},getNormalized:function(){return new r(this).normalize()},getNormalizedTo:function(t){return new r(this).normalizeTo(t)},getReciprocal:function(){return this.copy().reciprocal()},getReflected:function(t){return this.copy().reflect(t)},getRotatedAroundAxis:function(t,e){return new r(this).rotateAroundAxis(t,e)},getRotatedX:function(t){return new r(this).rotateX(t)},getRotatedY:function(t){return new r(this).rotateY(t)},getRotatedZ:function(t){return new r(this).rotateZ(t)},getSignum:function(){return new r(this).signum()},headingXY:function(){return Math.atan2(this.y,this.x)},headingXZ:function(){return Math.atan2(this.z,this.x)},headingYZ:function(){return Math.atan2(this.y,this.z)},immutable:function(){return this},interpolateTo:function(t,e,n){return void 0===n?new r(this.x+(t.x-this.x)*e,this.y+(t.y-this.y)*e,this.z+(t.z-this.z)*e):new r(n.interpolate(this.y,t.y,e),n.interpolate(this.y,t.y,e),n.interpolate(this.z,t.z,e))},interpolateToSelf:function(t,e,n){return void 0===n?(this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e):(this.x=n.interpolate(this.x,t.x,e),this.y=n.interpolate(this.y,t.y,e),this.z=n.interpolate(this.z,t.z,e)),this},invert:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},isInAABB:function(t,e){if(e){var n=e.x;if(this.x<t.x-n||this.x>t.x+n)return!1;if(n=e.y,this.y<t.y-n||this.y>t.y+n)return!1;if(n=e.y,this.z<t.z-n||this.y>t.z+n)return!1}return!0},isMajorAxis:function(t){var e=i.abs(this.x),n=i.abs(this.y),r=i.abs(this.z),o=1-t;if(e>o){if(t>n)return t>r}else if(n>o){if(t>e)return t>r}else if(r>o&&t>e)return t>n;return!1},isZeroVector:function(){return Math.abs(this.x)<i.EPS&&Math.abs(this.y)<i.EPS&&i.abs(this.z)<i.EPS},jitter:function(t,e,n){return(void 0===e||void 0===n)&&(e=n=t),this.x+=i.normalizedRandom()*t,this.y+=i.normalizedRandom()*e,this.z+=i.normalizedRandom()*n,this},limit:function(t){return this.magSquared()>t*t?this.normalize().scaleSelf(t):this},magnitude:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},magSquared:function(){return this.x*this.x+this.y*this.y+this.z*this.z},maxSelf:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this},minSelf:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this},modSelf:function(t,e,n){return(void 0===e||void 0===n)&&(e=n=t),this.x%=t,this.y%=e,this.z%=n,this},normalize:function(){var t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);return t>0&&(t=1/t,this.x*=t,this.y*=t,this.z*=t),this},normalizeTo:function(t){var e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);return e>0&&(e=t/e,this.x*=e,this.y*=e,this.z*=e),this},reciprocal:function(){return this.x=1/this.x,this.y=1/this.y,this.z=1/this.z,this},reflect:function(t){return this.set(t.scale(2*this.dot(t)).subSelf(this))},rotateAroundAxis:function(t,e){var n=t.x,r=t.y,i=t.z,o=n*this.x,a=n*this.y,s=n*this.z,h=r*this.x,u=r*this.y,c=r*this.z,l=i*this.x,f=i*this.y,p=i*this.z,d=Math.sin(e),m=Math.cos(e),g=n*(o+u+p)+(this.x*(r*r+i*i)-n*(u+p))*m+(-f+c)*d,v=r*(o+u+p)+(this.y*(n*n+i*i)-r*(o+p))*m+(l-s)*d,y=i*(o+u+p)+(this.z*(n*n+r*r)-i*(o+u))*m+(-h+a)*d;return this.x=g,this.y=v,this.z=y,this},rotateX:function(t){var e=Math.cos(t),n=Math.sin(t),r=e*this.z-n*this.y;return this.y=n*this.z+e*this.y,this.z=r,this},rotateY:function(t){var e=Math.cos(t),n=Math.sin(t),r=e*this.x-n*this.z;return this.z=n*this.x+e*this.z,this.x=r,this},rotateZ:function(t){var e=Math.cos(t),n=Math.sin(t),r=e*this.x-n*this.y;return this.y=n*this.x+e*this.y,this.x=r,this},roundToAxis:function(){return Math.abs(this.x)<.5?this.x=0:(this.x=this.x<0?-1:1,this.y=this.z=0),Math.abs(this.y)<.5?this.y=0:(this.y=this.y<0?-1:1,this.x=this.z=0),Math.abs(this.z)<.5?this.z=0:(this.z=this.z<0?-1:1,this.x=this.y=0),this},scale:function(t,e,n){return o.XYZ(t)?new r(this.x*t.x,this.y*t.y,this.z*t.z):((void 0===e||void 0===n)&&(e=n=t),new r(this.x*t,this.y*e,this.z*n))},scaleSelf:function(t,e,n){return o.XYZ(t)?(this.x*=t.x,this.y*=t.y,this.z*=t.z,this):((void 0===e||void 0===n)&&(e=n=t),this.x*=t,this.y*=e,this.z*=n,this)},set:function(t,e,n){return o.XYZ(t)?(this.x=t.x,this.y=t.y,this.z=t.z,this):((void 0===e||void 0===n)&&(e=n=t),this.x=t,this.y=e,this.z=n,this)},setXY:function(t){return this.x=t.x,this.y=t.y,this},shuffle:function(t){for(var e,n=0;t>n;n++)switch(Math.floor(3*Math.random())){case 0:e=this.x,this.x=this.y,this.z=e;break;case 1:e=this.x,this.x=this.z,this.z=e;break;case 2:e=this.y,this.y=this.z,this.z=e}return this},signum:function(){return this.x=this.x<0?-1:0===this.x?0:1,this.y=this.y<0?-1:0===this.y?0:1,this.z=this.z<0?-1:0===this.z?0:1,this},sub:function(t,e,n){return o.XYZ(t)?new r(this.x-t.x,this.y-t.y,this.z-t.z):((void 0===e||void 0===n)&&(e=n=t),new r(this.x-t,this.y-e,this.z-n))},subSelf:function(t,e,n){return o.XYZ(t)?(this.x-=t.x,this.y-=t.y,this.z-=t.z,this):((void 0===e||void 0===n)&&(e=n=t),this.x-=t,this.y-=e,this.z-=n,this)},to2DXY:function(){return new n(this.x,this.y)},to2DXZ:function(){return new n(this.x,this.z)},to2DYZ:function(){return new n(this.y,this.z)},toArray:function(){return[this.x,this.y,this.z]},toArray4:function(t){var e=this.toArray();return e[3]=t,e},toCartesian:function(){var t=this.x*Math.cos(this.z),e=t*Math.cos(this.y),n=this.x*Math.sin(this.z),r=t*Math.sin(this.y);return this.x=e,this.y=n,this.z=r,this},toSpherical:function(){var t=Math.abs(this.x)<=i.EPS?i.EPS:this.x,e=this.z,n=Math.sqrt(t*t+this.y*this.y+e*e);return this.z=Math.asin(this.y/n),this.y=Math.atan(e/t)+(0>t?Math.PI:0),this.x=n,this},toString:function(){return"[ x: "+this.x+", y: "+this.y+", z: "+this.z+"]"}},r.MIN_VALUE=new r(Number.MIN_VALUE,Number.MIN_VALUE,Number.MIN_VALUE),r.MAX_VALUE=new r(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),r.fromXYTheta=function(t){return new r(Math.cos(t),Math.sin(t),0)},r.fromXZTheta=function(t){return new r(Math.cos(t),0,Math.sin(t))},r.fromYZTheta=function(t){return new r(0,Math.cos(t),Math.sin(t))},r.max=function(t,e){return new r(Math.max(t.x,e.x),Math.max(t.y,e.y),Math.max(t.z,e.z))},r.min=function(t,e){return new r(Math.min(t.x,e.x),Math.min(t.y,e.y),Math.min(t.z,e.z))},r.randomVector=function(){var t=new r(2*Math.random()-1,2*Math.random()-1,2*Math.random()-1);return t.normalize()},r.ZERO=new r(0,0,0),r.X_AXIS=new r(1,0,0),r.Y_AXIS=new r(0,1,0),r.Z_AXIS=new r(0,0,1),r.Axis={X:{getVector:function(){return r.X_AXIS},toString:function(){return"Vec3D.Axis.X"}},Y:{getVector:function(){return r.Y_AXIS},toString:function(){return"Vec3D.Axis.Y"}},Z:{getVector:function(){return r.Z_AXIS},toString:function(){return"Vec3D.Axis.Z"}}},e.Vec2D=n,e.Vec3D=r}),n("toxi/color/Hue",["../internals/LinkedMap","../internals/each"],function(t,e){var n,r=new t,i=[];return n=function(t,e,n){this._isPrimary=n===!0,this.name=t,this.hue=e,r.put(t,this),this._isPrimary&&i.push(this)},n.prototype={constructor:n,getHue:function(){return this.hue},getName:function(){return this.name},isPrimary:function(){return this._isPrimary},toString:function(){return"Hue: ID:"+this.name+" @ "+parseInt(360*this.hue,10)+" degrees"}},n.PRESETS={},e([["red",!0],["orange",!0],["yellow",!0],["lime"],["green",!0],["teal"],["cyan"],["azure"],["blue",!0],["indigo"],["purple",!0],["pink",!0]],function(t,e){var r=t[0],i=r.toUpperCase(),o=t[1];n[i]=new n(r,30*e/360,o),n.PRESETS[i]=n[i]}),n.PRIMARY_VARIANCE=.01,n.getClosest=function(t,n){t%=1,n=n===!0;var o,a=Number.MAX_VALUE,s=n?i:r.getArray();return e(s,function(e){var n=Math.min(Math.abs(e.getHue()-t),Math.abs(1+e.getHue()-t));a>n&&(a=n,o=e)}),o},n.getForName=function(t){return r.get(t)},n.isPrimary=function(t,e){e="number"==typeof e?e:n.PRIMARY_VARIANCE;for(var r=!1,o=0,a=i.length;a>o;o++){var s=i[o];if(Math.abs(t-s.getHue())<e){r=!0;break}}return r},n}),n("toxi/color/TColor",["require","exports","module","../math/mathUtils","../geom/vectors","../internals/numberComparator","../internals/is","./Hue"],function(t,e,n){function r(t){return t[0]=Math.floor(360*t[0]),t[1]=Math.floor(100*t[1]),t[2]=Math.floor(100*t[2]),t}function i(t,e){return(e=e||!1)?(t[0]=Math.floor(100*t[0]),t[1]=Math.floor(100*t[1]),t[2]=Math.floor(100*t[2]),"rgba("+t[0]+"%,"+t[1]+"%,"+t[2]+"%,"+t[3]+")"):(t[0]=Math.floor(255*t[0]),t[1]=Math.floor(255*t[1]),t[2]=Math.floor(255*t[2]),t)}var o=t("../internals/numberComparator"),a=t("../internals/is"),s=t("../math/mathUtils"),h=t("../geom/vectors"),u=h.Vec2D,c=h.Vec3D,l=t("./Hue"),f=function(t){return 0>t&&(t=4294967295+t+1),t.toString(16)},p=function(t){if(this.rgb=[],this.hsv=[],this.cmyk=[],this._alpha=1,void 0!==t){var e=t.toCMYKAArray();this.cmyk=e.splice(0,4),this.hsv=t.toHSVAArray().splice(0,3),this.rgb=t.toRGBAArray().splice(0,3),this._alpha=t._alpha}};p.prototype={add:function(t){return this.copy().addSelf(t)},addSelf:function(t){return this.rgb[0]=s.min(this.rgb[0]+t.rgb[0],1),this.rgb[1]=s.min(this.rgb[1]+t.rgb[1],1),this.rgb[2]=s.min(this.rgb[2]+t.rgb[2],1),this.setRGB(this.rgb)},adjustConstrast:function(t){return this.hsv[2]<.5?this.darken(t):this.lighten(t)},adjustHSV:function(t,e,n){return this.setHSV([this.hsv[0]+t,this.hsv[1]+e,this.hsv[2]+n])},adjustRGB:function(t,e,n){return this.setRGB([this.rgb[0]+t,this.rgb[1]+e,this.rgb[2]+n])},alpha:function(){return this._alpha},analog:function(t,e){var n=s.degrees(t);return this.rotateRYB(n*s.normalizedRandom()),this.hsv[1]+=e*s.normalizedRandom(),this.hsv[2]+=e*s.normalizedRandom(),this.setHSV(this.hsv)},black:function(){return this.cmyk[3]},blend:function(t,e){void 0===e&&(e=.5);var n=t.toRGBAArray();return this.rgb[0]+=(n[0]-this.rgb[0])*e,this.rgb[1]+=(n[1]-this.rgb[1])*e,this.rgb[2]+=(n[2]-this.rgb[2])*e,this._alpha+=(t._alpha-this._alpha)*e,this.setRGB(this.rgb)},blue:function(){return this.rgb[2]},brightness:function(){return this.hsv[2]},complement:function(){return this.rotateRYB(180)},copy:function(){return new p(this)},cyan:function(){return this.cmyk[0]},darken:function(t){return this.hsv[2]=s.clip(this.hsv[2]-t,0,1),this.setHSV(this.hsv)},desaturate:function(t){return this.hsv[1]=s.clip(this.hsv[1]-t,0,1),this.setHSV(this.hsv)},differenceTo:function(t){return p.newRGB(Math.abs(this.rgb[0]-t.rgb[0]),Math.abs(this.rgb[1]-t.rgb[1]),Math.abs(this.rgb[2]-t.rgb[2]))},distanceToCMYK:function(t){var e=t.toCMYKAArray(),n=this.cmyk[0]-e[0],r=this.cmyk[1]-e[1],i=this.cmyk[2]-e[2],o=this.cmyk[3]-e[3];return Math.sqrt(n*n+r*r+i*i+o*o)},distanceToHSV:function(t){var e=this.hsv[0]*s.TWO_PI,n=t.hue()*s.TWO_PI,r=new c(s.cos(e)*this.hsv[1],s.sin(e)*this.hsv[1],this.hsv[2]),i=new c(s.cos(n)*t.saturation(),s.sin(n)*t.saturation(),t.brightness());return r.distanceTo(i)},distanceToRGB:function(t){var e=t.toRGBAArray(),n=this.rgb[0]-e[0],r=this.rgb[1]-e[1],i=this.rgb[2]-e[2];return Math.sqrt(n*n+r*r+i*i)},equals:function(t){if(a.TColor(t)){var e=t,n=e.rgb[0]-this.rgb[0],r=e.rgb[1]-this.rgb[1],i=e.rgb[2]-this.rgb[2],o=e.alpha()-this._alpha,s=Math.sqrt(n*n+r*r+i*i+o*o);return s<p.EPS}return!1},getAnalog:function(t,e){return new p(this).analog(t,e)},getBlended:function(t,e){return new p(this).blend(t,e)},getClosestHue:function(t){return l.getClosest(this.hsv[0],t===!0)},getComplement:function(){return new p(this).complement()},getComponentValue:function(t){return t.getComponentValueFor(this)},getDarkened:function(t){return new p(this).darken(t)},getDesaturated:function(t){return new p(this).desaturate(t)},getDifferenceTo:function(t){return this.copy().differenceTo(t)},getInverted:function(){return new p(this).invert()},getLightened:function(t){return new p(this).lighten(t)},getRotatedRYB:function(t){return new p(this).rotateRYB(t)},getSaturated:function(t){return new p(this).saturate(t)},green:function(){return this.rgb[1]},hue:function(){return this.hsv[0]},invert:function(){return this.rgb[0]=1-this.rgb[0],this.rgb[1]=1-this.rgb[1],this.rgb[2]=1-this.rgb[2],this.setRGB(this.rgb)},isBlack:function(){return this.rgb[0]<=p.BLACK_POINT&&this.rgb[0]===this.rgb[1]&&this.rgb[0]===this.rgb[2]},isGrey:function(){return this.hsv[1]<p.GREY_THRESHOLD},isWhite:function(){return this.rgb[0]>=p.WHITE_POINT&&this.rgb[0]===this.rgb[1]&&this.rgb[0]===this.rgb[2]},lighten:function(t){return this.hsv[2]=s.clip(this.hsv[2]+t,0,1),this.setHSV(this.hsv)},luminance:function(){return.299*this.rgb[0]+.587*this.rgb[1]+.114*this.rgb[2]},magenta:function(){return this.cmyk[1]},red:function(){return this.rgb[0]},rotateRYB:function(t){var e,n,r=(parseInt(s.degrees(t),10),360*this.hsv[0]),i=0;t%=360;var o=0;for(i=0;i<p.RYB_WHEEL.length-1;i++)if(e=p.RYB_WHEEL[i],n=p.RYB_WHEEL[i+1],n.y<e.y&&(n.y+=360),e.y<=r&&r<=n.y){o=e.x+(n.x-e.x)*(r-e.y)/(n.y-e.y);break}for(o=(o+t)%360,i=0;i<p.RYB_WHEEL.length-1;i++)if(e=p.RYB_WHEEL[i],n=p.RYB_WHEEL[i+1],n.y<e.y&&(n.y+=360),e.x<=o&&o<=n.x){r=e.y+(n.y-e.y)*(o-e.x)/(n.x-e.x);break}return this.hsv[0]=r%360/360,this.setHSV(this.hsv)},saturate:function(t){return this.hsv[1]=s.clip(this.hsv[1]+t,0,1),this.setHSV(this.hsv)},saturation:function(){return this.hsv[1]},setAlpha:function(t){return this._alpha=t,this},setARGB:function(t){return this.setRGB((t>>16&255)*p.INV8BIT,(t>>8&255)*p.INV8BIT,(255&t)*p.INV8BIT),this._alpha=(t>>>24)*p.INV8BIT,this},setBlack:function(t){return this.cmyk[3]=t,this.setCMYK(this.cmyk)},setBlue:function(t){return this.rgb[2]=t,this.setRGB(this.rgb)},setBrightness:function(t){return this.hsv[2]=s.clip(t,0,1),this.setHSV(this.hsv)},setCMYK:function(t,e,n,r){return a.Array(t)&&(e=t[1],n=t[2],r=t[3],t=t[0]),this.cmyk[0]=t,this.cmyk[1]=e,this.cmyk[2]=n,this.cmyk[3]=r,this.rgb=p.cmykToRGB(this.cmyk[0],this.cmyk[1],this.cmyk[2],this.cmyk[3]),this.hsv=p.rgbToHSV(this.rgb[0],this.rgb[1],this.rgb[2]),this},setComponent:function(t,e){return t.setComponentValueFor(this,e),this},setCyan:function(t){return this.cmyk[0]=t,this.setCMYK(this.cmyk)},setGreen:function(t){return this.rgb[1]=t,this.setRGB(this.rgb)},setHSV:function(t,e,n){a.Array(t)&&(e=t[1],n=t[2],t=t[0]);var r=[t,e,n];return this.hsv[0]=r[0]%1,this.hsv[0]<0&&this.hsv[0]++,this.hsv[1]=s.clip(r[1],0,1),this.hsv[2]=s.clip(r[2],0,1),this.rgb=p.hsvToRGB(this.hsv[0],this.hsv[1],this.hsv[2]),this.cmyk=p.rgbToCMYK(this.rgb[0],this.rgb[1],this.rgb[2]),this},setHue:function(t){return t%=1,0>t&&t++,this.hsv[0]=t,this.setHSV(this.hsv)},setMagenta:function(t){return this.cmyk[1]=t,this.setCMYK(this.cmyk)},setRed:function(t){return this.rgb[0]=t,this.setRGB(this.rgb)},setRGB:function(t,e,n){return a.Array(t)&&(e=t[1],n=t[2],t=t[0]),this.rgb[0]=s.clip(t,0,1),this.rgb[1]=s.clip(e,0,1),this.rgb[2]=s.clip(n,0,1),this.cmyk=p.rgbToCMYK(this.rgb[0],this.rgb[1],this.rgb[2]),this.hsv=p.rgbToHSV(this.rgb[0],this.rgb[1],this.rgb[2]),this},setSaturation:function(t){return this.hsv[1]=s.clip(t,0,1),this.setHSV(this.hsv)},setYellow:function(t){return this.cmyk[2]=t,this.setCMYK(this.cmyk)},sub:function(t){return this.copy().subSelf(t)},subSelf:function(t){return this.rgb[0]=s.max(this.rgb[0]-t.rgb[0],0),this.rgb[1]=s.max(this.rgb[1]-t.rgb[1],0),this.rgb[2]=s.max(this.rgb[2]-t.rgb[2],0),this.setRGB(this.rgb)},toARGB:function(){var t=parseInt(255*this.rgb[0],10),e=parseInt(255*this.rgb[1],10),n=parseInt(255*this.rgb[2],10),r=parseInt(255*this._alpha,10);return t<<16|e<<8|n|r<<24},toCMYKAArray:function(t){return void 0===t&&(t=[]),t[0]=this.cmyk[0],t[1]=this.cmyk[1],t[2]=this.cmyk[2],t[3]=this.cmyk[3],t[4]=this._alpha,t},toHex:function(){var t=f(this.toARGB());return t.length>6&&(t=t.substring(2)),t},toHexCSS:function(){return"#"+this.toHex()},toHSVAArray:function(t){return void 0===t&&(t=[]),t[0]=this.hsv[0],t[1]=this.hsv[1],t[2]=this.hsv[2],t[3]=this._alpha,t},toHSLCSS:function(){var t=r(this.toHSVAArray());return"hsl("+t[0]+","+t[1]+"%,"+t[2]+"%)"},toHSLACSS:function(){var t=r(this.toHSVAArray());return"hsla("+t[0]+","+t[1]+"%,"+t[2]+"%,"+t[3]+")"},toInt:function(){return Number("0x"+this.toHex())},toRGBAArray:function(t,e){return t=t||[],e=e||0,t[e++]=this.rgb[0],t[e++]=this.rgb[1],t[e++]=this.rgb[2],t[e]=this._alpha,t},toRGBADecimalArray:function(t,e){return t=t||[],e=e||0,t[e++]=255*this.rgb[0],t[e++]=255*this.rgb[1],t[e++]=255*this.rgb[2],t[e]=255*this._alpha,t},toRGBCSS:function(t){var e=i(this.toRGBAArray(),t);return"rgb("+e[0]+","+e[1]+","+e[2]+")"},toRGBACSS:function(t){var e=i(this.toRGBAArray(),t);return"rgba("+e[0]+","+e[1]+","+e[2]+","+e[3]+")"},toString:function(){return"TColor: rgb: "+this.rgb[0]+", "+this.rgb[1]+", "+this.rgb[2]+" hsv: "+this.hsv[0]+","+this.hsv[1]+","+this.hsv[2]+" cmyk: "+this.cmyk[0]+", "+this.cmyk[1]+","+this.cmyk[2]+","+this.cmyk[3]+" alpha: "+this._alpha},yellow:function(){return this.cmyk[2]}},p.INV60DEGREES=60/360,p.INV8BIT=1/255,p.EPS=.001,p.BLACK_POINT=.08,p.WHITE_POINT=1,p.GREY_THRESHOLD=.01,p.cmykToRGB=function(t,e,n,r,i){return void 0===i&&(i=[0,0,0]),i[0]=1-Math.min(1,t+r),i[1]=1-Math.min(1,e+r),i[2]=1-Math.min(1,n+r),i},p.hexToRGB=function(t,e){return void 0===e&&(e=[]),t="#"==t.charAt(0)?t.substring(1,7):t,e[0]=parseInt(t.substring(0,2),16)*p.INV8BIT,e[1]=parseInt(t.substring(2,4),16)*p.INV8BIT,e[2]=parseInt(t.substring(4,6),16)*p.INV8BIT,e
},p.hsvToRGB=function(t,e,n,r){if(void 0===r&&(r=[]),0===e)r[0]=r[1]=r[2]=n;else{t/=p.INV60DEGREES;var i=parseInt(t,10),o=t-i,a=n*(1-e),s=n*(1-e*o),h=n*(1-e*(1-o));0===i?(r[0]=n,r[1]=h,r[2]=a):1==i?(r[0]=s,r[1]=n,r[2]=a):2==i?(r[0]=a,r[1]=n,r[2]=h):3==i?(r[0]=a,r[1]=s,r[2]=n):4==i?(r[0]=h,r[1]=a,r[2]=n):(r[0]=n,r[1]=a,r[2]=s)}return r},p.labToRGB=function(t,e,n,r){void 0===r&&(r=[]);var i=(t+16)/116,o=e/500+i,a=i-n/200,s=0;for(r[0]=o,r[1]=i,r[2]=a,s=0;3>s;s++){var h=Math.pow(r[s],3);r[s]=h>.008856?h:(r[s]-16/116)/7.787}o=.95047*r[0],i=r[1],a=1.08883*r[2],r[0]=3.2406*o+-1.5372*i+a*-.4986,r[1]=o*-.9689+1.8758*i+.0415*a,r[2]=.0557*o+i*-.204+1.057*a;var u=1/2.4;for(s=0;3>s;s++)r[s]=r[s]>.0031308?1.055*Math.pow(r[s],u)-.055:12.92*r[s];return r},p.newARGB=function(t){return p.newRGBA((t>>16&255)*p.INV8BIT,(t>>8&255)*p.INV8BIT,(255&t)*p.INV8BIT,(t>>>24)*p.INV8BIT)},p.newCMYK=function(t,e,n,r){return p.newCMYKA(t,e,n,r,1)},p.newCMYKA=function(t,e,n,r,i){var o=new p;return o.setCMYK([t,e,n,r]),o.setAlpha(s.clip(i,0,1)),o},p.newCSS=function(t){function e(e){var n=t.substr(0,t.length-1);return n.substr(e.length+1,n.length).split(",")}function n(t){var e=0,n=t.length;for(e=0;n>e;e++)t[e]=Number(t[e]);return t}for(;t.indexOf(" ")>-1;)t=t.replace(" ","");t=t.toLowerCase();var r={"#":function(){return p.newHex(t.substr(1,t.length))},rgba:function(){var t=n(e("rgba"));return p.newRGBA(t[0]/255,t[1]/255,t[2]/255,t[3])},rgb:function(){var t=n(e("rgb"));return p.newRGBA(t[0]/255,t[1]/255,t[2]/255,1)},hsla:function(t){return t=t||e("hsla"),t[0]=Number(t[0])/360,t[1]=Number(t[1].substr(0,t[1].length-1))/100,t[2]=Number(t[2].substr(0,t[2].length-1))/100,t[3]=Number(t[3]),p.newHSVA(t[0],t[1],t[2],t[3])},hsl:function(){var t=e("hsl");return t.push(1),r.hsla(t)}};if(void 0!==p.X11[t])return p.X11[t].copy();for(var i in r)if(t.indexOf(i)>-1)return r[i]()},p.newGray=function(t){return p.newGrayAlpha(t,1)},p.newGrayAlpha=function(t,e){var n=new p;return n.setRGB([t,t,t]),n.setAlpha(e),n},p.newHex=function(t){var e=new p;return e.setRGB(p.hexToRGB(t)),e.setAlpha(1),e},p.newHSV=function(t,e,n){return p.newHSVA(t,e,n,1)},p.newHSVA=function(t,e,n,r){var i=new p;return i.setHSV(t,e,n),i.setAlpha(s.clip(r,0,1)),i},p.newRandom=function(){return p.newRGBA(Math.random(),Math.random(),Math.random(),1)},p.newRGB=function(t,e,n){return p.newRGBA(t,e,n,1)},p.newRGBA=function(t,e,n,r){var i=new p;return i.setRGB(t,e,n),i.setAlpha(s.clip(r,0,1)),i},p.rgbToCMYK=function(t,e,n,r){return void 0===r&&(r=[]),r[0]=1-t,r[1]=1-e,r[2]=1-n,r[3]=s.min(r[0],r[1],r[2]),r[0]=s.clip(r[0]-r[3],0,1),r[1]=s.clip(r[1]-r[3],0,1),r[2]=s.clip(r[2]-r[3],0,1),r[3]=s.clip(r[3],0,1),r},p.rgbToHex=function(t,e,n){var r=f(255*s.clip(t,0,1))+f(255*s.clip(e,0,1))+f(255*s.clip(n,0,1));return r},p.rgbToHSV=function(t,e,n,r){void 0===r&&(r=[]);var i=0,a=0,h=s.max(t,e,n),u=h-s.min(t,e,n);return 0!==h&&(a=u/h),0!==a&&(i=0===o(t,h)?(e-n)/u:0===o(e,h)?2+(n-t)/u:4+(t-e)/u),i*=p.INV60DEGREES,0>i&&(i+=1),r[0]=i,r[1]=a,r[2]=h,r},p.RED=p.newRGB(1,0,0),p.RYB_WHEEL=[new u(0,0),new u(15,8),new u(30,17),new u(45,26),new u(60,34),new u(75,41),new u(90,48),new u(105,54),new u(120,60),new u(135,81),new u(150,103),new u(165,123),new u(180,138),new u(195,155),new u(210,171),new u(225,187),new u(240,204),new u(255,219),new u(270,234),new u(285,251),new u(300,267),new u(315,282),new u(330,298),new u(345,329),new u(360,0)],p.GREEN=p.newRGB(0,1,0),p.BLUE=p.newRGB(0,0,1),p.CYAN=p.newRGB(0,1,1),p.MAGENTA=p.newRGB(1,0,1),p.YELLOW=p.newRGB(1,1,0),p.BLACK=p.newRGB(0,0,0),p.WHITE=p.newRGB(1,1,1),p.X11={},function(){var t,e,n={indianred:[205,92,92],lightcoral:[240,128,128],salmon:[250,128,114],darksalmon:[233,150,122],lightsalmon:[255,160,122],red:[255,0,0],crimson:[220,20,60],fireBrick:[178,34,34],darkred:[139,0,0],pink:[255,192,203],lightpink:[255,182,193],hotpink:[255,105,180],deeppink:[255,20,147],mediumvioletred:[199,21,133],palevioletred:[219,112,147],coral:[255,127,80],tomato:[255,99,71],orangered:[255,69,0],darkorange:[255,140,0],orange:[255,165,0],gold:[255,215,0],yellow:[255,255,0],lightyellow:[255,255,224],lemonchiffon:[255,250,205],lightgoldenrodyellow:[250,250,210],papayawhip:[255,239,213],moccasin:[255,228,181],peachpuff:[255,218,185],palegoldenrod:[238,232,170],khaki:[240,230,140],darkkhaki:[189,183,107],lavender:[230,230,250],thistle:[216,191,216],plum:[221,160,221],violet:[238,130,238],orchid:[218,112,214],fuchsia:[255,0,255],Magenta:[255,0,255],mediumorchid:[186,85,211],mediumpurple:[147,112,219],blueviolet:[138,43,226],darkviolet:[148,0,211],darkorchid:[153,50,204],darkmagenta:[139,0,139],purple:[128,0,128],indigo:[75,0,130],darkslateblue:[72,61,139],slateblue:[106,90,205],mediumslateblue:[123,104,238],greenyellow:[173,255,47],chartreuse:[127,255,0],lawngreen:[124,252,0],lime:[0,255,0],limegreen:[50,205,50],palegreen:[152,251,152],lightgreen:[144,238,144],mediumspringgreen:[0,250,154],springgreen:[0,255,127],mediumseagreen:[60,179,113],seagreen:[46,139,87],forestgreen:[34,139,34],green:[0,128,0],darkgreen:[0,100,0],yellowgreen:[154,205,50],olivedrab:[107,142,35],olive:[128,128,0],darkolivegreen:[85,107,47],mediumaquamarine:[102,205,170],darkseagreen:[143,188,143],lightseagreen:[32,178,170],darkcyan:[0,139,139],teal:[0,128,128],aqua:[0,255,255],cyan:[0,255,255],lightcyan:[224,255,255],paleturquoise:[175,238,238],aquamarine:[127,255,212],turquoise:[64,224,208],mediumturquoise:[72,209,204],darkturquoise:[0,206,209],cadetblue:[95,158,160],steelblue:[70,130,180],lightsteelblue:[176,196,222],powderblue:[176,224,230],lightblue:[173,216,230],skyblue:[135,206,235],lightskyblue:[135,206,250],deepskyblue:[0,191,255],dodgerblue:[30,144,255],cornflowerblue:[100,149,237],royalblue:[65,105,225],blue:[0,0,255],mediumblue:[0,0,205],darkblue:[0,0,139],navy:[0,0,128],midnightblue:[25,25,112],cornsilk:[255,248,220],blanchedalmond:[255,235,205],bisque:[255,228,196],navajowhite:[255,222,173],wheat:[245,222,179],burlywood:[222,184,135],tan:[210,180,140],rosybrown:[188,143,143],sandybrown:[244,164,96],goldenrod:[218,165,32],darkgoldenrod:[184,134,11],Peru:[205,133,63],chocolate:[210,105,30],saddlebrown:[139,69,19],sienna:[160,82,45],brown:[165,42,42],maroon:[128,0,0],white:[255,255,255],snow:[255,250,250],honeydew:[240,255,240],mintcream:[245,255,250],azure:[240,255,255],aliceblue:[240,248,255],ghostwhite:[248,248,255],whitesmoke:[245,245,245],seashell:[255,245,238],beige:[245,245,220],oldlace:[253,245,230],floralwhite:[255,250,240],ivory:[255,255,240],antiquewhite:[250,235,215],linen:[250,240,230],lavenderblush:[255,240,245],mistyrose:[255,228,225],gainsboro:[220,220,220],lightgray:[211,211,211],silver:[192,192,192],darkgray:[169,169,169],gray:[128,128,128],dimgray:[105,105,105],lightslategray:[119,136,153],slategray:[112,128,144],darkslategray:[47,79,79],black:[0,0,0],bark:[64,48,33]};for(t in n)n.hasOwnProperty(t)&&(e=n[t],p.X11[t]=p.newRGB(e[0]/255,e[1]/255,e[2]/255),t.indexOf("gray")>=0&&(p.X11[t.replace("gray","grey")]=p.X11[t]));p.X11.transparent=p.newRGBA(0,0,0,0)}(),n.exports=p}),n("toxi/color/HSVDistanceProxy",["require","./distanceProxies"],function(t){return t("./distanceProxies").HSVDistanceProxy}),n("toxi/color/RGBDistanceProxy",["require","./distanceProxies"],function(t){return t("./distanceProxies").RGBDistanceProxy}),n("toxi/color/ProximityComparator",["require"],function(){var t=function(t,e){this.col=t,this.proxy=e};return t.prototype.compare=function(t,e){var n=this.proxy.distanceBetween(this.col,t),r=this.proxy.distanceBetween(this.col,e);return r>n?-1:n>r?1:0},t}),n("toxi/color/ColorList",["require","exports","module","../internals/is","../internals/each","../internals/Iterator","../math/mathUtils","./TColor","./HSVDistanceProxy","./RGBDistanceProxy","./ProximityComparator","./accessCriteria"],function(t,e,n){var r=t("../internals/is"),i=t("../internals/each"),o=t("../internals/Iterator"),a=t("../math/mathUtils"),s=t("./TColor"),h=t("./HSVDistanceProxy"),u=t("./RGBDistanceProxy"),c=t("./ProximityComparator"),f=t("./accessCriteria"),p=function(t){if(arguments.length>1)return p.call(this,arguments);this.colors=[];var e=0;if(r.Array(t)&&t.length)if("number"==typeof t[0])for(e=0,l=t.length;l>e;e++)this.colors.push(s.newARGB(t[e]));else this.addAll(t);else if(r.ColorList(t))for(e=0,l=t.size();l>e;e++)this.add(t.get(e));else r.TColor(t)&&this.add(t)};p.prototype={constructor:p,add:function(t){return this.colors.push(t.copy()),this},addAll:function(t){var e=this;return r.Array(t)?i(t,function(t){e.colors.push(t)}):this.colors.push(t),this},adjustBrightness:function(t){return i(this.colors,function(e){e.lighten(t)}),this},adjustSaturation:function(t){return i(this.colors,function(e){e.saturate(t)}),this},clusterSort:function(t,e,n,r){var i,o=this.colors.slice(0),a=[],s=1,h=0,u=o.length;o.sort(t.compare).reverse();for(var c=0;u>c;c++){var l=o[c];l.getComponentValue(t)<s&&(i=o.slice(h,c),i.sort(e.compare),a.push.apply(a,i),s-=1/n,h=c)}return i=[],Array.prototype.push.apply(i,o.slice(h,o.length)),i.sort(e.compare),a.push.apply(a,i),r&&a.reverse(),this.colors=a,this},complement:function(){return this.each(function(t){t.complement()}),this},contains:function(t){for(var e=0,n=this.colors.length;n>e;e++)if(this.colors[e].equals(t))return!0;return!1},each:function(t){return i(this.colors,t),this},get:function(t){return 0>t&&(t+=this.colors.length),this.colors[t]},getAverage:function(){var t=0,e=0,n=0,r=0;this.each(function(i){t+=i.rgb[0],e+=i.rgb[1],n+=i.rgb[2],r+=i.alpha()});var i=this.colors.length;return i>0?s.newRGBA(t/i,e/i,n/i,r/i):void 0},getBlended:function(t){for(var e=[],n=this.colors.length,r=0;n>r;r++){var i=r>0?r-1:e.length-1,o=this.colors[i];e.push(this.colors[r].getBlended(o,t))}return new p(e)},getDarkest:function(){var t,e=Number.MAX_VALUE;return this.each(function(n){var r=n.luminance();e>r&&(t=n,e=r)}),t},getLightest:function(){var t,e=Number.MIN_VALUE;return this.each(function(n){var r=n.luminance();r>e&&(t=n,e=r)}),t},getRandom:function(){var t=Math.floor(a.random(this.colors.length));return this.colors[t]},getReverse:function(){return new p(this.colors).reverse()},invert:function(){return this.each(function(t){t.invert()}),this},iterator:function(){return new o(this.colors)},reverse:function(){return this.colors.reverse(),this},rotateRYB:function(t,e){var n;return n=t!==Math.floor(t)||e?a.degrees(t):t,this.each(function(t){t.rotateRYB(n)}),this},size:function(){return this.colors.length},sort:function(){return this.sortByCriteria(f.HUE,!1)},sortByComparator:function(t,e){return"function"==typeof t&&"undefined"==typeof t.compare&&(t={compare:t}),this.colors.sort(t.compare),e&&this.colors.reverse(),this},sortByCriteria:function(t,e){return this.sortByComparator(t,e)},sortByDistance:function(t,e){if(1===arguments.length&&(e=arguments[0],t=new h),0===this.colors.length)return this;var n=this.getDarkest(),r=this.colors.slice(0),i=[];r.splice(r.indexOf(n),1),i.push(n);for(var o=0;r.length>1;){for(var a=r[0],s=i[o],u=t.distanceBetween(a,s),c=r.length-1;c>=0;c--){var l=r[c],f=t.distanceBetween(l,s);u>f&&(a=l,u=f)}r.splice(r.indexOf(a),1),i.push(a),o++}return i.push(r[0]),e&&i.reverse(),this.colors=i,this},sortByProximityTo:function(t,e,n){return 2==arguments.length&&(t=arguments[0],e=new u,n=arguments[1]),this.sortByComparator(new c(t,e),n)},toARGBArray:function(){var t=[];return this.each(function(e){t.push(e.toARGB())}),t}},p.createFromARGBArray=function(t,e,n,r){if(r=r||100,e=a.min(e,t.length),!n&&e==t.length)return new p(t);var i,o=[],h=s.BLACK.copy(),u=0,c=!0,l=0;for(u=0;e>u;u++)if(n){c=!0,l=0;do i=a.random(t.length),h.setARGB(t[i]),c=!(o.indexOf(h)>=0);while(!c&&++l<r);if(!(r>l))break;o.push(h.copy())}else i=a.random(t.length),o.push(s.newARGB(t[i]));return new p(o)},p.createUsingStrategy=function(){throw new Error("Not allowed, use toxi/color/createListUsingStrategy instead")},n.exports=p}),n("toxi/color/ColorGradient",["require","exports","module","../internals","../internals","../math/mathUtils","../math/LinearInterpolation","./ColorList"],function(t,e,n){var r=t("../internals").filter,i=t("../internals").numberComparator,o=t("../math/mathUtils"),a=t("../math/LinearInterpolation"),s=t("./ColorList"),h=function(t,e){this.pos=t,this.color=e};h.prototype={compareTo:function(t){return 0===i(t.pos,this.pos)?0:this.pos<t.pos?-1:1},getColor:function(){return this.color},getPosition:function(){return this.pos}};var u=function(){this.gradient=[],this.interpolator=new a,this.maxDither=0};u.prototype={addColorAt:function(t,e){this.gradient.push(new h(t,e))},calcGradient:function(t,e){if(0===arguments.length){t=this.gradient[0].getPosition();var n=this.gradient[this.gradient.length-1].getPosition();e=Math.floor(n-t)}var i=new s;if(0===this.gradient.length)return i;var a,h,u=0,c=t+e,l=0,f=this.gradient.length;for(l=0;f>l;l++)this.gradient[l].pos<t&&(a=this.gradient[l]);var p,d=void 0===a;d?(p=this.gradient,a=this.gradient[0]):p=r(this.gradient,function(t){return t.pos>=a.pos});var m=0;if(l=0,f=p.length,a!==p[f-1])if(h=p[l],d){var g=a.pos-t;m=o.abs(g)>0?1/g:1}else h.pos-a.pos>0&&(m=1/(h.pos-a.pos));for(;c>t;){if(u=d?1-(a.pos-t)*m:(t-a.pos)*m,u>1&&(a=h,d=!1,l++,l<p.length&&(h=p[l],m=a!==p[f-1]?1/(h.pos-a.pos):0,u=(t-a.pos)*m)),a!==p[f-1]){var v=o.clip(u+o.normalizedRandom()*this.maxDither,0,1);v=this.interpolator.interpolate(0,1,v),i.add(a.color.getBlended(h.color,v))}else i.add(a.color.copy());t++}return i},getGradientPoints:function(){return this.gradient},getInterpolator:function(){return this.interpolator},getMaxDither:function(){return this.maxDither},setInterpolator:function(t){this.interpolator=t},setMaxDither:function(t){this.maxDither=o.clip(t,0,1)}},n.exports=u}),n("toxi/util/datatypes/FloatRange",["require","exports","module","../../math/mathUtils"],function(t,e,n){var r=t("../../math/mathUtils"),i=function(t,e){if(t=t||0,e="number"==typeof e?e:1,t>e){var n=e;e=t,t=n}this.min=t,this.max=e,this.currValue=t};i.prototype={adjustCurrentBy:function(t){return this.setCurrent(this.currValue+t)},copy:function(){var t=new i(this.min,this.max);return t.currValue=this.currValue,t},getAt:function(t){return this.min+(this.max-this.min-r.EPS)*t},getCurrent:function(){return this.currValue},getMedian:function(){return.5*(this.min+this.max)},getRange:function(){return this.max-this.min},isValueInRange:function(t){return t>=this.min&&t<=this.max},pickRandom:function(){return this.currValue=r.random(this.min,this.max),this.currValue},setCurrent:function(t){return this.currValue=r.clip(t,this.min,this.max),this.currValue},toArray:function(t){for(var e=[],n=this.min;n<this.max;)e.push(n),n+=t;return e},toString:function(){return"FloatRange: "+this.min+" -> "+this.max}},n.exports=i}),n("toxi/color/ColorRange",["./TColor","./ColorList","../util/datatypes/FloatRange","../internals/is","../internals/each","../math/mathUtils"],function(t,e,n,r,i,o){var a,s,h,u,c=1;return h=function(t,e){t.push.apply(t,e)},s=function(t){return function(e,i){return this[t.toLowerCase()+"Constraint"].push(r.FloatRange(e)?e:new n(e,i)),this}},u=function(t){return t[Math.floor(Math.random()*t.length)]},a=function(t,e,i,o,a,s){var h,u=this;if(0===arguments.length)return this;r.ColorList(t)&&(h=t,t=h.get(0)),r.Hue(t)&&(t=new n(t.getHue(),t.getHue())),r.TColor(t)&&(t=new n(t.hue(),t.hue())),this.hueConstraint=[r.FloatRange(t)?t:new n(0,1)],this.saturationConstraint=[r.FloatRange(e)?e:new n(0,1)],this.brightnessConstraint=[r.FloatRange(i)?i:new n(0,1)],this.alphaConstraint=[r.FloatRange(o)?o:new n(1,1)],this.black=r.FloatRange(a)?a:new n(0,1),this.white=r.FloatRange(s)?s:new n(0,1),h&&(this.hueConstraint=[],h.each(function(t){u.add(t)}));for(var l=arguments.length-1;l>=0;l--)if("string"==typeof arguments[l]){this.name=arguments[l];break}this.name||(this.name="untitled"+c++)},a.prototype={constructor:a,add:function(t){return r.ColorRange(t)?(h(this.hueConstraint,t.hueConstraint),h(this.saturationConstraint,t.saturationConstraint),h(this.brightnessConstraint,t.brightnessConstraint),h(this.alphaConstraint,t.alphaConstraint),this.black.min=Math.min(this.black.min,t.black.min),this.black.max=Math.max(this.black.max,t.black.max),this.white.min=Math.min(this.white.min,t.white.min),this.white.max=Math.max(this.white.max,t.white.max)):(this.hueConstraint.push(new n(t.hue(),t.hue())),this.saturationConstraint.push(new n(t.saturation(),t.saturation())),this.brightnessConstraint.push(new n(t.brightness(),t.brightness())),this.alphaConstraint.push(new n(t.alpha(),t.alpha()))),this},addAlphaRange:s("alpha"),addBrightnessRange:s("brightness"),addHue:function(t){return this.hueConstraint.push(new n(t.getHue(),t.getHue())),this},addHueRange:s("hue"),addSaturationRange:s("saturation"),contains:function(t){var e=this.isValueInConstraint(t.hue(),this.hueConstraint);return e&=this.isValueInConstraint(t.saturation(),this.saturationConstraint),e&=this.isValueInConstraint(t.brightness(),this.brightnessConstraint),e&=this.isValueInConstraint(t.alpha(),this.alphaConstraint),e||!1},copy:function(t,e){e="number"==typeof e?e:0;var r=new a;if(r.name=this.name,t){var i=t.hue()+e*o.normalizedRandom();r.hueConstraint=[new n(i,i)],r.alphaConstraint=[new n(t.alpha(),t.alpha())]}else r.hueConstraint=[].concat(this.hueConstraint),r.alphaConstraint=[].concat(this.alphaConstraint);return r.saturationConstraint=[].concat(this.saturationConstraint),r.brightnessConstraint=[].concat(this.brightnessConstraint),r.black=this.black.copy(),r.white=this.white.copy(),r},getColor:function(e,n){if(r.Hue(e))return t.newHSVA(e.getHue(),u(this.saturationConstraint).pickRandom(),u(this.brightnessConstraint).pickRandom(),u(this.alphaConstraint).pickRandom());var i,a,s,h,c=e;if(c){if(c.isBlack())return t.newHSVA(c.hue(),0,this.black.pickRandom(),c.alpha());if(c.isWhite())return t.newHSVA(c.hue(),0,this.white.pickRandom(),c.alpha());if(c.isGrey())return t.newHSVA(c.hue(),0,o.flipCoin()?this.black.pickRandom():this.white.pickRandom(),c.alpha());i=c.hue()+n*o.normalizedRandom(),h=c.alpha()}else i=u(this.hueConstraint).pickRandom(),h=u(this.alphaConstraint).pickRandom();return a=u(this.saturationConstraint).pickRandom(),s=u(this.brightnessConstraint).pickRandom(),t.newHSVA(i,a,s,h)},getColors:function(t,n,r){arguments.length<3&&(r=a.DEFAULT_VARIANCE),1===arguments.length&&(n=t,t=void 0);for(var i=new e,o=0;n>o;o++)i.add(this.getColor(t,r));return i},getGrayscale:function(e,n){return this.getColor(t.newGray(e),n)},getName:function(){return this.name},getSum:function(t){return this.copy().add(t)},isValueInConstraint:function(t,e){var n=!1;return i(e,function(e){n|=e.isValueInRange(t)}),n}},a.DEFAULT_VARIANCE=.035,function(t,e){a.PRESETS={},i({light:[e,new t(.3,.7),new t(.9,1),e,new t(.15,.3),e],dark:[e,new t(.7,1),new t(.15,.4),e,e,new t(.5,.75)],bright:[e,new t(.8,1),new t(.8,1)],weak:[e,new t(.15,.3),new t(.7,1),e,new t(.2,.2),e],neutral:[e,new t(.25,.35),new t(.3,.7),e,new t(.15,.15),new t(.9,1)],fresh:[e,new t(.4,.8),new t(.8,1),e,new t(.05,.3),new t(.8,1)],soft:[e,new t(.2,.3),new t(.6,.9),e,new t(.05,.15),new t(.6,.9)],hard:[e,new t(.9,1),new t(.4,1)],warm:[e,new t(.6,.9),new t(.4,.9),e,new t(.2,.2),new t(.8,1)],cool:[e,new t(.05,.2),new t(.9,1),e,e,new t(.95,1)],intense:[e,new t(.9,1),new t(.2,.35)]},function(t,e){t.push(e);var n=e.toUpperCase();a[n]=new a,a.apply(a[n],t),a.PRESETS[n]=a[n]}),a.INTENSE.addBrightnessRange(new t(.8,1))}(n,void 0),a.getPresetForName=function(t){return a.PRESETS[t.toUpperCase()]},a}),n("toxi/color/namedColor",["./TColor","../internals","exports"],function(t,e,n){var r=e.each,i=[],o={};r(t.X11,function(t,e){var r=e.toUpperCase();i.push(r),o[r]=t,o[e]=t,n[r]=t}),n.getForName=function(t){return o[t]||o[t.toLowerCase()]},n.getNames=function(){return i.slice(0)}}),n("toxi/color/ColorTheme",["../internals/each","../math/mathUtils","./ColorRange","./namedColor","./ColorList"],function(t,e,n,r,i){var o,a;return a=function(t,e,n){this.range=t,this.color=e,this.weight=n},a.prototype.getColor=function(){return this.range.getColor(this.color,n.DEFAULT_VARIANCE)},o=function(t){this.name=t,this.parts=[],this._weightedSum=0},o.prototype={constructor:o,addRange:function(e,i,o){var s,h,u=this;return 3===arguments.length?(this.parts.push(new a(e,i,o)),this._weightedSum+=o):(t(e.split(" "),function(t){n.getPresetForName(t)?s=n.getPresetForName(t):r.getForName(t)&&(h=r.getForName(t))}),s&&u.addRange(s,h,i)),this},getColor:function(){for(var t,e,n=Math.random(),r=0,i=this.parts.length;i>r;r++){if(t=this.parts[r],e=t.weight/this._weightedSum,e>=n)return t.getColor();n-=e}return null},getColors:function(t){for(var e=new i,n=0;t>n;n++)e.add(this.getColor());return e},getName:function(){return this.name}},o}),n("toxi/color/theory/strategies",["../../internals/has","../../internals/is","exports"],function(t,e,n){var t=t.all,r=e.TColor;n.create=function(t,e,n){2===arguments.length&&(n=e,e=function(){});var i=t.charAt(0).toLowerCase()+t.slice(1,t.length);e.prototype.constructor=e,e.prototype.getName=function(){return i},e.prototype.toString=e.prototype.getName;for(var o in n)e.prototype[o]=n[o];return function(t){e.prototype.createListFromColor=function(e){if(!r(e))throw new Error("src color was not a valid TColor");return t.call(this,e)}}(e.prototype.createListFromColor),e},n.wrap=function(t,e,n,r){return n>t-e?t+r:t-e}}),n("toxi/color/theory/SingleComplementStrategy",["./strategies","../ColorList"],function(t,e){var n=function(){return"complement"};return t.create("SingleComplement",{createListFromColor:function(t){var n=new e(t);return n.add(t.getComplement()),n},getName:n,toString:n})}),n("toxi/color/theory/ComplementaryStrategy",["./strategies","../ColorList"],function(t,e){var n=function(t,e){var n=t.brightness();return t.setBrightness(n>e?.1+.25*n:1-.25*n),t};return t.create("Complementary",{createListFromColor:function(t){var r,i=new e(t);return i.add(n(t.copy(),.4)),r=t.copy(),r.lighten(.3),r.setSaturation(.1+.3*r.saturation()),i.add(r),i.add(n(t.getComplement(),.3)),i.add(t.getComplement()),r=t.getComplement(),r.lighten(.3),r.setSaturation(.1+.25*r.saturation()),i.add(r),i}})}),n("toxi/color/theory/SplitComplementaryStrategy",["./strategies","../ColorList"],function(t,e){return t.create("SplitComplementary",{createListFromColor:function(t){var n=new e(t);return n.add(t.getRotatedRYB(150).lighten(.1)),n.add(t.getRotatedRYB(210).lighten(.1)),n}})}),n("toxi/color/theory/LeftSplitComplementaryStrategy",["./strategies","../ColorList","./ComplementaryStrategy"],function(t,e,n){var r;return t.create("LeftSplitComplementary",{createListFromColor:function(t){r=r||new n;for(var e,i=t.getComplement().rotateRYB(-30).lighten(.1),o=r.createListFromColor(t),a=3;6>a;a++)e=o.get(a),e.setHue(i.hue());return o}})}),n("toxi/color/theory/RightSplitComplementaryStrategy",["./strategies","../ColorList","./ComplementaryStrategy"],function(t,e,n){var r;return t.create("RightSplitComplementary",{createListFromColor:function(t){r=r||new n;for(var e,i=t.getComplement().rotateRYB(30).lighten(.1),o=r.createListFromColor(t),a=3;6>a;a++)e=o.get(a),e.setHue(i.hue());return o}})}),n("toxi/color/theory/AnalagousStrategy",["./strategies","../../geom/vectors","../../math/mathUtils","../../internals","../ColorList"],function(t,e,n,r,i){var o=r.each,a=e.Vec2D,s=[new a(1,2.2),new a(2,1),new a(-1,-.5),new a(-2,1)];return t.create("Analagous",function(t,e){this.contrast="number"==typeof e?e:.25,this.theta=n.radians("number"==typeof t?t:10)},{createListFromColor:function(t){var e=this;this.contrast=n.clipNormalized(this.contrast);var r=new i(t);return o(s,function(n){var i=t.getRotatedRYB(e.theta*n.x),o=.44-.1*n.y;i.setBrightness(t.brightness()-e.contras*n.y<o?o:t.brightness()-e.contrast*n.y),i.desaturate(.05),r.add(i)}),r},toString:function(){return"analagous contrast: "+this.contrast+" theta: "+n.degrees(this.theta)}})}),n("toxi/color/theory/MonochromeTheoryStrategy",["./strategies","../ColorList"],function(t,e){var n=t.wrap;return t.create("Monochrome",{createListFromColor:function(t){var r=new e(t),i=t.copy();return i.setBrightness(n(i.brightness(),.5,.2,.3)),i.setSaturation(n(i.saturation(),.3,.1,.3)),r.add(i),i=t.copy(),i.setBrightness(n(i.brightness(),.2,.2,.6)),r.add(i),i=t.copy(),i.setBrightness(Math.max(.2,i.brightness()+.2*(1-i.brightness()))),i.setSaturation(n(i.saturation(),.3,.1,.3)),r.add(i),i=t.copy(),i.setBrightness(n(i.brightness(),.5,.2,.3)),r.add(i),r}})}),n("toxi/color/theory/TriadTheoryStrategy",["./strategies","../ColorList"],function(t,e){var n=function(){return"triad"};return t.create("TriadTheory",{createListFromColor:function(t){var n=new e(t);return n.add(t.getRotatedRYB(120).lighten(.1)),n.add(t.getRotatedRYB(-120).lighten(.1)),n},getName:n,toString:toString})}),n("toxi/color/theory/TetradTheoryStrategy",["./strategies","../ColorList"],function(t,e){var n=function(){return"tetrad"},r=function(t){return t[t.brightness()<.5?"lighten":"darken"](.2)};return t.create("TetradTheory",function(t){this.theta="number"==typeof t?t:90},{createListFromColor:function(t){var n=new e(t);return n.add(r(t.getRotatedRYB(this.theta))),n.add(r(t.getRotatedRYB(2*this.theta))),n.add(t.getRotatedRYB(3*this.theta).lighten(.1)),n},getName:n,toString:n})}),n("toxi/color/theory/CompoundTheoryStrategy",["./strategies","../ColorList"],function(t,e){var n=t.wrap;return t.create("Compound",function(t){this._isFlipped=t===!0},{createListFromColor:function(t){var r,i=new e(t),o=this._isFlipped?-1:1;return r=t.getRotatedRYB(30*o),r.setBrightness(n(r.brightness(),.25,.6,.25)),i.add(r),r=t.getRotatedRYB(30*o),r.setSaturation(n(r.saturation(),.4,.1,.4)),r.setBrightness(n(r.brightness(),.4,.2,.4)),i.add(r),r=t.getRotatedRYB(160*o),r.setSaturation(n(r.saturation(),.25,.1,.25)),r.setBrightness(Math.max(.2,r.brightness())),i.add(r),r=t.getRotatedRYB(150*o),r.setSaturation(n(r.saturation(),.1,.8,.1)),r.setBrightness(n(r.brightness(),.3,.6,.3)),i.add(r),i},isFlipped:function(){return this._isFlipped},setFlipped:function(t){this._isFlipped=t},toString:function(){return"Compound"+(this.isFlipped()?"_flipped":"")}})}),n("toxi/color/theory/colorTheoryRegistry",["require","exports","module","../../internals","./SingleComplementStrategy","./ComplementaryStrategy","./SplitComplementaryStrategy","./LeftSplitComplementaryStrategy","./RightSplitComplementaryStrategy","./AnalagousStrategy","./MonochromeTheoryStrategy","./TriadTheoryStrategy","./TetradTheoryStrategy","./CompoundTheoryStrategy"],function(t,e){var n=t("../../internals"),r=n.each,i=n.keys,o=n.values,a={},s={SINGLE_COMPLEMENT:t("./SingleComplementStrategy"),COMPLEMENTARY:t("./ComplementaryStrategy"),SPLIT_COMPLEMENTARY:t("./SplitComplementaryStrategy"),LEFT_SPLIT_COMPLEMENTARY:t("./LeftSplitComplementaryStrategy"),RIGHT_SPLIT_COMPLEMENTARY:t("./RightSplitComplementaryStrategy"),ANALAGOUS:t("./AnalagousStrategy"),MONOCHROME:t("./MonochromeTheoryStrategy"),TRIAD:t("./TriadTheoryStrategy"),TETRAD:t("./TetradTheoryStrategy"),COMPOUND:t("./CompoundTheoryStrategy")};e.getRegisteredNames=function(){return i(a)},e.getRegisteredStrategies=function(){return o(a)},e.getStrategyForName=function(t){return a[t]},e.registerImplementation=function(t){a[t.getName()]=t},r(s,function(t,n){e[n]=new s[n],e.registerImplementation(e[n])})}),n("toxi/color/createListUsingStrategy",["./theory/colorTheoryRegistry"],function(t){return function(e,n){"string"==typeof e&&(e=t.getStrategyForName(e));var r;return void 0!==e&&(r=e.createListFromColor(n)),r}}),n("toxi/color/HistEntry",["require"],function(){var t=function(t){this.col=t,this.freq=1};return t.prototype={constructor:t,compareTo:function(t){return parseInt(t.freq-this.freq,10)},getColor:function(){return this.col},getFrequency:function(){return this.freq}},t}),n("toxi/color/Histogram",["require","../internals","../internals","./HistEntry","./ColorList"],function(t){var e=t("../internals").each,n=t("../internals").Iterator,r=t("./HistEntry"),i=t("./ColorList"),o=function(t){this.palette=t};return o.prototype={constructor:o,compute:function(t,n){var i=this;this.entries=[];var o=1;return this.palette.each(function(e){var a,s,h=0,u=i.entries.length;for(h=0;u>h;h++)if(s=i.entries[h],s.col.distanceToRGB(e)<t){n&&s.col.blend(e,1/(s.freq+1)),a=s;break}void 0!==a?(a.freq++,a.freq>o&&(o=a.freq)):i.entries.push(new r(e))}),this.entries.sort(),o=1/this.palette.size(),e(this.entries,function(t){t.freq*=o}),this.entries},getEntries:function(){return this.entries},getPalette:function(){return this.palette},iterator:function(){return new n(this.entries)},setPalette:function(t){this.palette=t}},o.newFromARGBArray=function(t,e,n,r){var a=new o(i.createFromARGBArray(t,e,!1));return a.compute(n,r),a},o}),n("toxi/color/theory",["require","exports","module","./theory/AnalagousStrategy","./theory/colorTheoryRegistry","./theory/ComplementaryStrategy","./theory/CompoundTheoryStrategy","./theory/LeftSplitComplementaryStrategy","./theory/MonochromeTheoryStrategy","./theory/RightSplitComplementaryStrategy","./theory/SingleComplementStrategy","./theory/SplitComplementaryStrategy","./theory/TetradTheoryStrategy","./theory/TriadTheoryStrategy","./theory/strategies"],function(t,e){e.AnalagousStrategy=t("./theory/AnalagousStrategy"),e.colorTheoryRegistry=t("./theory/colorTheoryRegistry"),e.ColorTheoryRegistry=e.colorTheoryRegistry,e.ComplementartyStrategy=t("./theory/ComplementaryStrategy"),e.CompoundTheoryStrategy=t("./theory/CompoundTheoryStrategy"),e.LeftSplitComplementaryStrategy=t("./theory/LeftSplitComplementaryStrategy"),e.MonochromeTheoryStrategy=t("./theory/MonochromeTheoryStrategy"),e.RightSplitComplementaryStrategy=t("./theory/RightSplitComplementaryStrategy"),e.SingleComplementStrategy=t("./theory/SingleComplementStrategy"),e.SplitComplementaryStrategy=t("./theory/SplitComplementaryStrategy"),e.TetradTheoryStrategy=t("./theory/TetradTheoryStrategy"),e.TriadTheoryStrategy=t("./theory/TriadTheoryStrategy"),e.strategies=t("./theory/strategies")}),n("toxi/math/ScaleMap",["require","exports","module","./mathUtils","./LinearInterpolation"],function(t,e,n){var r=t("./mathUtils"),i=t("./LinearInterpolation"),o=function(t,e){this.min=t,this.max=e};o.prototype.toString=function(){return"{ min: "+this.min+", max: "+this.max+"}"};var a=function(t,e,n,r){if(1==arguments.length&&void 0!==arguments[0].input&&void 0!==arguments[0].output){var o=arguments[0];n=o.output.min,r=o.output.max,e=o.input.max,t=o.input.min}this.mapFunction=new i,this.setInputRange(t,e),this.setOutputRange(n,r)};a.prototype={getClippedValueFor:function(t){var e=r.clipNormalized((t-this._in.min)/this._interval);return this.mapFunction.interpolate(0,this.mapRange,e)+this._out.min},getInputMedian:function(){return.5*(this._in.min+this._in.max)},getInputRange:function(){return this._in},getMappedMedian:function(){return this.getMappedValueFor(.5)},getMappedValueFor:function(t){var e=(t-this._in.min)/this._interval;return this.mapFunction.interpolate(0,this.mapRange,e)+this._out.min},getOutputMedian:function(){return.5*(this._out.min+this._out.max)},getOutputRange:function(){return this._out},setInputRange:function(t,e){this._in=new o(t,e),this._interval=e-t},setMapFunction:function(t){this.mapFunction=t},setOutputRange:function(t,e){this._out=new o(t,e),this.mapRange=e-t},toString:function(){return"ScaleMap, inputRange: "+this._in.toString()+" outputRange: "+this._out.toString()}},n.exports=a}),n("toxi/color/ToneMap",["toxi/internals/is","toxi/math/ScaleMap","./ColorList","./ColorGradient"],function(t,e,n,r){var i;return i=function(i,o,a,s,h){var u=arguments.length;if(u>3)if(4===u)a=new n(a,s);else{var c=a;a=new r,a.addColorAt(0,c),a.addColorAt(h-1,s),a=a.calcGradient(0,h)}t.ColorGradient(a)&&(a=a.calcGradient()),this.map=new e(i,o,0,a.size()-1),this.colors=a},i.prototype={constructor:i,getARGBToneFor:function(t){return this.getToneFor(t).toARGB()},getToneFor:function(t){var e;return e=this.colors.size()>2?Math.floor(this.map.getClippedValueFor(t)+.5):t>=this.map.getInputMedian()?1:0,this.colors.get(e)},getToneMappedArray:function(t,e,n){if("number"!=typeof n)n=0;else if(0>n)throw new Error("offset into target pixel array is negative");
e=e||new Array(t.length);for(var r=0,i=t.length;i>r;r++)e[n++]=this.getToneFor(t[r]).toARGB();return e},setMapFunction:function(t){this.map.setMapFunction(t)}},i}),n("toxi/color",["require","exports","module","./color/accessCriteria","./color/AlphaAccessor","./color/CMYKAccessor","./color/CMYKDistanceProxy","./color/ColorGradient","./color/ColorList","./color/ColorRange","./color/ColorTheme","./color/createListUsingStrategy","./color/HistEntry","./color/Histogram","./color/HSVAccessor","./color/HSVDistanceProxy","./color/Hue","./color/LuminanceAccessor","./color/namedColor","./color/ProximityComparator","./color/RGBAccessor","./color/RGBDistanceProxy","./color/TColor","./color/theory","./color/ToneMap"],function(t,e){e.accessCriteria=t("./color/accessCriteria"),e.AccessCriteria=e.accessCriteria,e.AlphaAccessor=t("./color/AlphaAccessor"),e.CMYKAccessor=t("./color/CMYKAccessor"),e.CMYKDDistanceProxy=t("./color/CMYKDistanceProxy"),e.ColorGradient=t("./color/ColorGradient"),e.ColorList=t("./color/ColorList"),e.ColorRange=t("./color/ColorRange"),e.ColorTheme=t("./color/ColorTheme"),e.createListUsingStrategy=t("./color/createListUsingStrategy"),e.HistEntry=t("./color/HistEntry"),e.Histogram=t("./color/Histogram"),e.HSVAccessor=t("./color/HSVAccessor"),e.HSVDistanceProxy=t("./color/HSVDistanceProxy"),e.Hue=t("./color/Hue"),e.LuminanceAccessor=t("./color/LuminanceAccessor"),e.namedColor=t("./color/namedColor"),e.NamedColor=e.namedColor,e.ProximityComparator=t("./color/ProximityComparator"),e.RGBAccessor=t("./color/RGBAccessor"),e.RGBDistanceProxy=t("./color/RGBDistanceProxy"),e.TColor=t("./color/TColor"),e.theory=t("./color/theory"),e.ToneMap=t("./color/ToneMap")}),n("toxi/geom/Vec3D",["require","exports","module","./vectors"],function(t,e,n){n.exports=t("./vectors").Vec3D}),n("toxi/geom/Ray3D",["require","exports","module","../internals","./Vec3D","./Line3D"],function(t,e,n){var r=t("../internals").extend,i=t("./Vec3D"),o=t("./Line3D"),a=function(t,e,n,r){var o,a;4==arguments.length?(o=new i(t,e,n),a=r):2==arguments.length?(o=t,a=e):(o=new i,a=i.Y_AXIS.copy()),i.apply(this,[o]),this.dir=a};r(a,i),a.prototype.getDirection=function(){return this.dir.copy()},a.prototype.getDistanceToPoint=function(t){var e=t.sub(this);return e.distanceTo(this.dir.scale(e.dot(this.dir)))},a.prototype.getPointAtDistance=function(t){return this.add(this.dir.scale(t))},a.prototype.setDirection=function(t){return this.dir.set(t).normalize(),this},a.prototype.toLine3DWithPointAtDistance=function(t){return new o(this,this.getPointAtDistance(t))},a.prototype.toString=function(){return"origin: "+this.parent.toString.call(this)+" dir: "+this.dir},n.exports=a}),n("toxi/geom/Line3D",["require","exports","module","../math/mathUtils","./Ray3D"],function(t,e,n){var r=t("../math/mathUtils"),i=t("./Ray3D"),o=function(t,e){this.a=t,this.b=e};o.prototype={constructor:o,closestLineTo:function(t){var e=t.a.sub(t.b);if(e.isZeroVector())return new o.LineIntersection(o.LineIntersection.Type.NON_INTERSECTING);var n=this.b.sub(this.a);if(n.isZeroVector())return new o.LineIntersection(o.LineIntersection.Type.NON_INTERSECTING);var i=this.a.sub(t.a),a=i.x*e.x+i.y*e.y+i.z*e.z,s=e.x*n.x+e.y*n.y+e.z*n.z,h=i.x*n.x+i.y*n.y+i.z*n.z,u=e.x*e.x+e.y*e.y+e.z*e.z,c=n.x*n.x+n.y*n.y+n.z*n.z,l=c*u-s*s;if(Math.abs(l)<r.EPS)return new o.LineIntersection(o.LineIntersection.Type.NON_INTERSECTING);var f=a*s-h*u,p=f/l,d=(a+s*p)/u,m=this.a.add(n.scaleSelf(p)),g=t.a.add(e.scaleSelf(d));return new o.LineIntersection(o.LineIntersection.Type.INTERSECTING,new o(m,g),p,d)},closestPointTo:function(t){var e=this.b.sub(this.a),n=t.sub(this.a).dot(e)/e.magSquared();return 0>n?this.a.copy():n>1?this.b.copy():this.a.add(e.scaleSelf(n))},copy:function(){return new o(this.a.copy(),this.b.copy())},equals:function(t){return this==t?!0:typeof t!=o?!1:(this.a.equals(t.a)||this.a.equals(l.b))&&(this.b.equals(l.b)||this.b.equals(l.a))},getDirection:function(){return this.b.sub(this.a).normalize()},getLength:function(){return this.a.distanceTo(this.b)},getLengthSquared:function(){return this.a.distanceToSquared(this.b)},getMidPoint:function(){return this.a.add(this.b).scaleSelf(.5)},getNormal:function(){return this.b.cross(this.a)},hasEndPoint:function(t){return this.a.equals(t)||this.b.equals(t)},offsetAndGrowBy:function(t,e,n){var r=this.getMidPoint(),i=this.getDirection(),o=this.a.cross(i).normalize();return void 0!==n&&r.sub(n).dot(o)<0&&o.invert(),o.normalizeTo(t),this.a.addSelf(o),this.b.addSelf(o),i.scaleSelf(e),this.a.subSelf(i),this.b.addSelf(i),this},set:function(t,e){return this.a=t,this.b=e,this},splitIntoSegments:function(t,e,n){return o.splitIntoSegments(this.a,this.b,e,t,n)},toRay3D:function(){return new i(this.a.copy(),this.getDirection())},toString:function(){return this.a.toString()+" -> "+this.b.toString()}},o.splitIntoSegments=function(t,e,n,r,i){void 0===r&&(r=[]),i&&r.push(t.copy());var o=t.distanceTo(e);if(o>n)for(var a=t.copy(),s=e.sub(t).limit(n);o>n;)a.addSelf(s),r.push(a.copy()),o-=n;return r.push(e.copy()),r},o.LineIntersection=function(t,e,n,r){this.type=t,void 0===n&&(n=0),void 0===r&&(r=0),this.line=e,this.coeff=[n,r]},o.LineIntersection.prototype={getCoefficient:function(){return this.coeff},getLength:function(){return void 0===this.line?void 0:this.line.getLength()},getLine:function(){return void 0===this.line?void 0:this.line.copy()},getType:function(){return this.type},isIntersectionInside:function(){return this.type==o.LineIntersection.Type.INTERSECTING&&this.coeff[0]>=0&&this.coeff[0]<=1&&this.coeff[1]>=0&&this.coeff[1]<=1},toString:function(){return"type: "+this.type+" line: "+this.line}},o.LineIntersection.Type={NON_INTERSECTING:0,INTERSECTING:1},n.exports=o}),n("toxi/geom/Matrix4x4",["require","exports","module","../math/mathUtils","./Vec3D","../internals"],function(t,e,n){var r=t("../math/mathUtils"),i=t("../internals"),o=t("./Vec3D"),a=function(t,e,n,r,o,a,s,h,u,c,l,f,p,d,m,g){this.temp=[],this.matrix=[];var v=this;if(0===arguments.length)this.matrix[0]=[1,0,0,0],this.matrix[1]=[0,1,0,0],this.matrix[2]=[0,0,1,0],this.matrix[3]=[0,0,0,1];else if("number"==typeof t){var y=[t,e,n,r],E=[o,a,s,h],x=[u,c,l,f],T=[p,d,m,g];this.matrix=[y,E,x,T]}else if(i.is.Array(t)){var b=t;if(9!=b.length&&16!=b.length)throw new Error("Matrix4x4: Array length must == 9 or 16");16==b.length?(this.matrix=[],this.matrix[0]=b.slice(0,4),this.matrix[1]=b.slice(4,8),this.matrix[2]=b.slice(8,12),this.matrix[3]=b.slice(12)):(this.matrix[0]=b.slice(0,3),this.matrix[0][3]=0/0,this.matrix[1]=b.slice(3,6),this.matrix[1][3]=0/0,this.matrix[2]=b.slice(6,9),this.matrix[2][3]=0/0,this.matrix[3]=[0/0,0/0,0/0,0/0])}else if(i.is.Matrix4x4(t)){var R,w,_=t,H=0,M=0;if(16==_.matrix.length)for(H=0;4>H;H++)this.matrix[H]=[_.matrix[H][0],_.matrix[H][1],_.matrix[H][2],_.matrix[H][3]];else if(4==_.matrix.length)for(R=_.matrix.length,H=0;R>H;H++)for(w=_.matrix[H].length,v.matrix[H]=[],M=0;w>M;M++)v.matrix[H][M]=_.matrix[H][M]}else console.error("Matrix4x4: incorrect parameters used to construct new instance")};a.prototype={add:function(t){var e=new a(this);return e.addSelf(t)},addSelf:function(t){for(var e=0;4>e;e++){var n=this.matrix[e],r=t.matrix[e];n[0]+=r[0],n[1]+=r[1],n[2]+=r[2],n[3]+=r[3]}return this},applyTo:function(t){return this.applyToSelf(new o(t))},applyToSelf:function(t){for(var e=0;4>e;e++){var n=this.matrix[e];this.temp[e]=t.x*n[0]+t.y*n[1]+t.z*n[2]+n[3]}return t.set(this.temp[0],this.temp[1],this.temp[2]).scaleSelf(1/this.temp[3]),t},copy:function(){return new a(this)},getInverted:function(){return new a(this).invert()},getRotatedAroundAxis:function(t,e){return new a(this).rotateAroundAxis(t,e)},getRotatedX:function(t){return new a(this).rotateX(t)},getRotatedY:function(t){return new a(this).rotateY(t)},getRotatedZ:function(t){return new a(this).rotateZ(t)},getTransposed:function(){return new a(this).transpose()},identity:function(){var t=this.matrix[0];return t[1]=t[2]=t[3]=0,t=this.matrix[1],t[0]=t[2]=t[3]=0,t=this.matrix[2],t[0]=t[1]=t[3]=0,t=this.matrix[3],t[0]=t[1]=t[2]=0,this.matrix[0][0]=1,this.matrix[1][1]=1,this.matrix[2][2]=1,this.matrix[3][3]=1,this},invert:function(){var t=[],e=[],n=[],r=this.toArray(),i=0;for(i=0;4>i;i++){var o=i<<2;e[i]=r[o],e[i+4]=r[o+1],e[i+8]=r[o+2],e[i+12]=r[o+3]}t[0]=e[10]*e[15],t[1]=e[11]*e[14],t[2]=e[9]*e[15],t[3]=e[11]*e[13],t[4]=e[9]*e[14],t[5]=e[10]*e[13],t[6]=e[8]*e[15],t[7]=e[11]*e[12],t[8]=e[8]*e[14],t[9]=e[10]*e[12],t[10]=e[8]*e[13],t[11]=e[9]*e[12];var a=e[0],s=e[1],h=e[2],u=e[3],c=e[4],l=e[5],f=e[6],p=e[7];n[0]=t[0]*l+t[3]*f+t[4]*p,n[0]-=t[1]*l+t[2]*f+t[5]*p,n[1]=t[1]*c+t[6]*f+t[9]*p,n[1]-=t[0]*c+t[7]*f+t[8]*p,n[2]=t[2]*c+t[7]*l+t[10]*p,n[2]-=t[3]*c+t[6]*l+t[11]*p,n[3]=t[5]*c+t[8]*l+t[11]*f,n[3]-=t[4]*c+t[9]*l+t[10]*f,n[4]=t[1]*s+t[2]*h+t[5]*u,n[4]-=t[0]*s+t[3]*h+t[4]*u,n[5]=t[0]*a+t[7]*h+t[8]*u,n[5]-=t[1]*a+t[6]*h+t[9]*u,n[6]=t[3]*a+t[6]*s+t[11]*u,n[6]-=t[2]*a+t[7]*s+t[10]*u,n[7]=t[4]*a+t[9]*s+t[10]*h,n[7]-=t[5]*a+t[8]*s+t[11]*h,t[0]=h*p,t[1]=u*f,t[2]=s*p,t[3]=u*l,t[4]=s*f,t[5]=h*l,t[6]=a*p,t[7]=u*c,t[8]=a*f,t[9]=h*c,t[10]=a*l,t[11]=s*c,a=e[8],s=e[9],h=e[10],u=e[11],c=e[12],l=e[13],f=e[14],p=e[15],n[8]=t[0]*l+t[3]*f+t[4]*p,n[8]-=t[1]*l+t[2]*f+t[5]*p,n[9]=t[1]*c+t[6]*f+t[9]*p,n[9]-=t[0]*c+t[7]*f+t[8]*p,n[10]=t[2]*c+t[7]*l+t[10]*p,n[10]-=t[3]*c+t[6]*l+t[11]*p,n[11]=t[5]*c+t[8]*l+t[11]*f,n[11]-=t[4]*c+t[9]*l+t[10]*f,n[12]=t[2]*h+t[5]*u+t[1]*s,n[12]-=t[4]*u+t[0]*s+t[3]*h,n[13]=t[8]*u+t[0]*a+t[7]*h,n[13]-=t[6]*h+t[9]*u+t[1]*a,n[14]=t[6]*s+t[11]*u+t[3]*a,n[14]-=t[10]*u+t[2]*a+t[7]*s,n[15]=t[10]*h+t[4]*a+t[9]*s,n[15]-=t[8]*s+t[11]*h+t[5]*a;var d=1/(e[0]*n[0]+e[1]*n[1]+e[2]*n[2]+e[3]*n[3]);for(i=0,k=0;4>i;i++)for(var m=this.matrix[i],g=0;4>g;g++)m[g]=n[k++]*d;return this},multiply:function(t){return"number"==typeof t?new a(this).multiply(t):new a(this).multiplySelf(t)},multiplySelf:function(t){var e,n=0;if("number"==typeof t){for(n=0;4>n;n++)e=this.matrix[n],e[0]*=t,e[1]*=t,e[2]*=t,e[3]*=t;return this}var r=t.matrix[0],i=t.matrix[1],o=t.matrix[2],a=t.matrix[3];for(n=0;4>n;n++){e=this.matrix[n];for(var s=0;4>s;s++)this.temp[s]=e[0]*r[s]+e[1]*i[s]+e[2]*o[s]+e[3]*a[s];e[0]=this.temp[0],e[1]=this.temp[1],e[2]=this.temp[2],e[3]=this.temp[3]}return this},rotateAroundAxis:function(t,e){var n,r,i,o,a,h,u,c;return n=t.x,r=t.y,i=t.z,o=Math.sin(e),a=Math.cos(e),h=1-a,u=h*n,c=h*r,s.set(u*n+a,u*r+o*i,u*i-o*r,0,u*r-o*i,c*r+a,c*i+o*n,0,u*i+o*r,c*i-o*n,h*i*i+a,0,0,0,0,1),this.multiplySelf(s)},rotateX:function(t){return s.identity(),s.matrix[1][1]=s.matrix[2][2]=Math.cos(t),s.matrix[2][1]=Math.sin(t),s.matrix[1][2]=-s.matrix[2][1],this.multiplySelf(s)},rotateY:function(t){return s.identity(),s.matrix[0][0]=s.matrix[2][2]=Math.cos(t),s.matrix[0][2]=Math.sin(t),s.matrix[2][0]=-s.matrix[0][2],this.multiplySelf(s)},rotateZ:function(t){return s.identity(),s.matrix[0][0]=s.matrix[1][1]=Math.cos(t),s.matrix[1][0]=Math.sin(t),s.matrix[0][1]=-s.matrix[1][0],this.multiplySelf(s)},scale:function(t,e,n){return new a(this).scaleSelf(t,e,n)},scaleSelf:function(t,e,n){return i.has.XYZ(t)?(e=t.y,n=t.z,t=t.x):(void 0===e||void 0===n)&&(e=t,n=t),s.identity(),s.matrix[0][0]=t,s.matrix[1][1]=e,s.matrix[2][2]=n,this.multiplySelf(s)},set:function(t,e,n,r,i,o,a,s,h,u,c,l,f,p,d,m){var g;if("number"==typeof t)g=this.matrix[0],g[0]=t,g[1]=e,g[2]=n,g[3]=r,g=this.matrix[1],g[0]=i,g[1]=o,g[2]=a,g[3]=s,g=this.matrix[2],g[0]=h,g[1]=u,g[2]=c,g[3]=l,g=this.matrix[3],g[0]=f,g[1]=p,g[2]=d,g[3]=m;else for(var v=0;4>v;v++){g=this.matrix[v];var y=g.matrix[v];g[0]=y[0],g[1]=y[1],g[2]=y[2],g[3]=y[3]}return this},setFrustrum:function(t,e,n,r,i,o){var a=e-t,s=n-r,h=o-i;return this.set(2*i/a,0,(t+e)/a,0,0,2*i/s,(n+r)/s,0,0,0,-(i+o)/h,-2*i*o/h,0,0,-1,0)},setOrtho:function(t,e,n,r,i,o){var a=[2/(e-t),0,0,(t+e)/(e-t),0,2/(n-r),0,(n+r)/(n-r),0,0,-2/(o-i),(o+i)/(o-i),0,0,0,1];return this.set.apply(this,a)},setPerspective:function(t,e,n,i){var o=n*Math.tan(.5*r.radians(t)),a=e*o;return this.setFrustrum(-a,a,o,-o,n,i)},setPosition:function(t,e,n){return this.matrix[0][3]=t,this.matrix[1][3]=e,this.matrix[2][3]=n,this},setScale:function(t,e,n){return this.matrix[0][0]=t,this.matrix[1][1]=e,this.matrix[2][2]=n,this},sub:function(t){return new a(this).subSelf(t)},subSelf:function(t){for(var e=0;4>e;e++){var n=this.matrix[e],r=t.matrix[e];n[0]-=r[0],n[1]-=r[1],n[2]-=r[2],n[3]-=r[3]}return this},toArray:function(t){void 0===t&&(t=[]);for(var e=0,n=0;4>e;e++)for(var r=this.matrix[e],i=0;4>i;i++)t[n++]=r[i];return t},toFloatArray:function(t){return new Float32Array(this.toArray(t))},toString:function(){return"| "+this.matrix[0][0]+" "+this.matrix[0][1]+" "+this.matrix[0][2]+" "+this.matrix[0][3]+" |\n| "+this.matrix[1][0]+" "+this.matrix[1][1]+" "+this.matrix[1][2]+" "+this.matrix[1][3]+" |\n| "+this.matrix[2][0]+" "+this.matrix[2][1]+" "+this.matrix[2][2]+" "+this.matrix[2][3]+" |\n| "+this.matrix[3][0]+" "+this.matrix[3][1]+" "+this.matrix[3][2]+" "+this.matrix[3][3]+" |"},toTransposedFloatArray:function(t){void 0===t&&(t=[]);for(var e=0,n=0;4>e;e++)for(var r=0;4>r;r++)t[n++]=this.matrix[r][e];return t},translate:function(t,e,n){return new a(this).translateSelf(t,e,n)},translateSelf:function(t,e,n){return i.has.XYZ(t)&&(e=t.y,n=t.z,t=t.x),s.identity(),s.setPosition(t,e,n),this.multiplySelf(s)},transpose:function(){return this.set(this.matrix[0][0],this.matrix[1][0],this.matrix[2][0],this.matrix[3][0],this.matrix[0][1],this.matrix[1][1],this.matrix[2][1],this.matrix[3][1],this.matrix[0][2],this.matrix[1][2],this.matrix[2][2],this.matrix[3][2],this.matrix[0][3],this.matrix[1][3],this.matrix[2][3],this.matrix[3][3])}};var s=new a;n.exports=a}),n("toxi/geom/Vec2D",["require","exports","module","./vectors"],function(t,e,n){n.exports=t("./vectors").Vec2D}),n("toxi/geom/AABB",["require","exports","module","../internals","../math/mathUtils","./Vec2D","./Vec3D","./mesh/meshCommon"],function(t,e,n){var r=t("../internals"),i=t("./Vec3D"),o=t("./Vec2D"),a=t("../math/mathUtils"),s=function(t,e){void 0===t?(i.call(this),this.setExtent(new i)):"number"==typeof t?(i.call(this,new i),this.setExtent(t)):r.has.XYZ(t)&&(i.call(this,t),this.setExtent(void 0===e&&r.is.AABB(t)?t.getExtent():"number"==typeof e?new i(e,e,e):e))};r.extend(s,i),s.fromMinMax=function(t,e){var n=i.min(t,e),r=i.max(t,e);return new s(n.interpolateTo(r,.5),r.sub(n).scaleSelf(.5))},s.prototype.containsPoint=function(t){return t.isInAABB(this)},s.prototype.copy=function(){return new s(this)},s.prototype.getExtent=function(){return this.extent.copy()},s.prototype.getMax=function(){return this.max.copy()},s.prototype.getMin=function(){return this.min.copy()},s.prototype.getNormalForPoint=function(t){t=t.sub(this);var e=this.extent.sub(t.getAbs()),n=t.getSignum(),r=i.X_AXIS.scale(n.x),o=e.x;return e.y<o&&(o=e.y,r=i.Y_AXIS.scale(n.y)),e.z<o&&(r=i.Z_AXIS.scale(n.z)),r},s.prototype.includePoint=function(t){return this.min.minSelf(t),this.max.maxSelf(t),this.set(this.min.interpolateTo(this.max,.5)),this.extent.set(this.max.sub(this.min).scaleSelf(.5)),this},s.prototype.intersectsBox=function(t){var e=t.sub(this);return Math.abs(e.x)<=this.extent.x+t.extent.x&&Math.abs(e.y)<=this.extent.y+t.extent.y&&Math.abs(e.z)<=this.extent.z+t.extent.z},s.prototype.intersectsRay=function(t,e,n){var r=t.getDirection().reciprocal(),i=r.x<0,o=r.y<0,a=r.z<0,s=i?this.max:this.min,h=(s.x-t.x)*r.x;s=i?this.min:this.max;var u=(s.x-t.x)*r.x;s=o?this.max:this.min;var c=(s.y-t.y)*r.y;s=o?this.min:this.max;var l=(s.y-t.y)*r.y;if(h>l||c>u)return null;c>h&&(h=c),u>l&&(u=l),s=a?this.max:this.min;var f=(s.z-t.z)*r.z;s=a?this.min:this.max;var p=(s.z-t.z)*r.z;return h>p||f>u?null:(f>h&&(h=f),u>p&&(u=p),n>h&&u>e?t.getPointAtDistance(h):void 0)},s.prototype.intersectsSphere=function(t,e){1==arguments.length&&(e=t.radius);var n,r=0;return t.x<this.min.x?(n=t.x-this.min.x,r=n*n):t.x>this.max.x&&(n=t.x-this.max.x,r+=n*n),t.y<this.min.y?(n=t.y-this.min.y,r+=n*n):t.y>this.max.y&&(n=t.y-this.max.y,r+=n*n),t.z<this.min.z?(n=t.z-this.min.z,r+=n*n):t.z>this.max.z&&(n=t.z-this.max.z,r+=n*n),e*e>=r},s.prototype.intersectsTriangle=function(t){var e,n,r,i,o,s,h,u;if(e=t.a.sub(this),n=t.b.sub(this),r=t.c.sub(this),o=n.sub(e),s=r.sub(n),h=e.sub(r),u=o.getAbs(),this.testAxis(o.z,-o.y,u.z,u.y,e.y,e.z,r.y,r.z,this.extent.y,this.extent.z))return!1;if(this.testAxis(-o.z,o.x,u.z,u.x,e.x,e.z,r.x,r.z,this.extent.x,this.extent.z))return!1;if(this.testAxis(o.y,-o.x,u.y,u.x,n.x,n.y,r.x,r.y,this.extent.x,this.extent.y))return!1;if(u=s.getAbs(),this.testAxis(s.z,-s.y,u.z,u.y,e.y,e.z,r.y,r.z,this.extent.y,this.extent.z))return!1;if(this.testAxis(-s.z,s.x,u.z,u.x,e.x,e.z,r.x,r.z,this.extent.x,this.extent.z))return!1;if(this.testAxis(s.y,-s.x,u.y,u.x,e.x,e.y,n.x,n.y,this.extent.x,this.extent.y))return!1;if(u=h.getAbs(),this.testAxis(h.z,-h.y,u.z,u.y,e.y,e.z,n.y,n.z,this.extent.y,this.extent.z))return!1;if(this.testAxis(-h.z,h.x,u.z,u.x,e.x,e.z,n.x,n.z,this.extent.x,this.extent.z))return!1;if(this.testAxis(h.y,-h.x,u.y,u.x,n.x,n.y,r.x,r.y,this.extent.x,this.extent.y))return!1;if(a.min(e.x,n.x,r.x)>this.extent.x||a.max(e.x,n.x,r.x)<-this.extent.x)return!1;if(a.min(e.y,n.y,r.y)>this.extent.y||a.max(e.y,n.y,r.y)<-this.extent.y)return!1;if(a.min(e.z,n.z,r.z)>this.extent.z||a.max(e.z,n.z,r.z)<-this.extent.z)return!1;i=o.cross(s);var c=-i.dot(e);return this.planeBoxOverlap(i,c,this.extent)?!0:!1},s.prototype.planeBoxOverlap=function(t,e,n){var r=new i,o=new i;return t.x>0?(r.x=-n.x,o.x=n.x):(r.x=n.x,o.x=-n.x),t.y>0?(r.y=-n.y,o.y=n.y):(r.y=n.y,o.y=-n.y),t.z>0?(r.z=-n.z,o.z=n.z):(r.z=n.z,o.z=-n.z),t.dot(r)+e>0?!1:t.dot(o)+e>=0?!0:!1},s.prototype.set=function(t,e,n){return r.is.AABB(t)?(this.extent.set(t.extent),i.set.apply(this,[t])):(r.has.XYZ(t)&&(e=t.y,n=t.z,t=t.a),this.x=t,this.y=e,this.z=n,this.updateBounds(),this)},s.prototype.setExtent=function(t){return this.extent=t.copy(),this.updateBounds()},s.prototype.testAxis=function(t,e,n,r,i,o,a,s,h,u){var c,l,f=t*i+e*o,p=t*a+e*s;p>f?(c=f,l=p):(c=p,l=f);var d=n*h+r*u;return c>d||-d>l},s.prototype.toMesh=function(e){if(void 0===e){var n=t("./mesh/meshCommon").TriangleMesh;e=new n("aabb",8,12)}var r=this.min,a=this.max,s=new i(r.x,r.y,a.z),h=new i(a.x,r.y,a.z),u=new i(a.x,r.y,r.z),c=new i(r.x,a.y,r.z),l=new i(r.x,a.y,a.z),f=new i(a.x,a.y,r.z),p=new o(0,0),d=new o(1,0),m=new o(1,1),g=new o(0,1);return e.addFace(r,s,l,g,m,d),e.addFace(r,l,c,g,d,p),e.addFace(s,h,a,g,m,d),e.addFace(s,a,l,g,d,p),e.addFace(h,u,f,g,m,d),e.addFace(h,f,a,g,d,p),e.addFace(u,r,c,g,m,d),e.addFace(u,c,f,g,d,p),e.addFace(c,l,f,p,g,d),e.addFace(l,a,f,g,m,d),e.addFace(r,u,s,g,m,p),e.addFace(s,u,h,p,m,d),e},s.prototype.toString=function(){return"<aabb> pos: "+i.prototype.toString.call(this)+" ext: "+this.extent.toString()},s.prototype.updateBounds=function(){return void 0!==this.extent&&(this.min=this.sub(this.extent),this.max=this.add(this.extent)),this},n.exports=s}),n("toxi/geom/Triangle3D",["require","exports","module","../math/mathUtils","./Vec3D","./Line3D","./AABB"],function(t,e,n){var r=t("../math/mathUtils"),i=t("./Vec3D"),o=t("./Line3D"),s=t("./AABB"),h=function(t,e,n){this.a=t,this.b=e,this.c=n};h.createEquilateralFrom=function(t,e){var n=t.interpolateTo(e,.5),i=e.sub(t),o=t.cross(i.normalize());return n.addSelf(o.normalizeTo(i.magnitude()*r.SQRT3/2)),new h(t,e,n)},h.isClockwiseInXY=function(t,e,n){var r=(e.x-t.x)*(n.y-t.y)-(n.x-t.x)*(e.y-t.y);return 0>r},h.isClockwiseInXZ=function(t,e,n){var r=(e.x-t.x)*(n.z-t.z)-(n.x-t.x)*(e.z-t.z);return 0>r},h.isClockwiseInYZ=function(t,e,n){var r=(e.y-t.y)*(n.z-t.z)-(n.y-t.y)*(e.z-t.z);return 0>r},h.prototype={closestPointOnSurface:function(t){var e=this.b.sub(this.a),n=this.c.sub(this.a),r=this.c.sub(this.b),i=t.sub(this.a),o=t.sub(this.b),s=t.sub(this.c),h=a.sub(this.p),u=b.sub(this.p),l=c.sub(this.p),f=i.dot(e),p=i.dot(n);if(0>=f&&0>=p)return this.a;var d=o.dot(this.a.sub(this.b)),m=s.dot(this.a.sub(this.c)),g=o.dot(r),v=s.dot(this.b.sub(this.c));if(0>=d&&0>=g)return this.b;if(0>=m&&0>=v)return this.c;var y=e.cross(n),E=y.dot(h.crossSelf(u));if(0>=E&&f>=0&&d>=0)return this.a.add(e.scaleSelf(f/(f+d)));var x=y.dot(u.crossSelf(l));if(0>=x&&g>=0&&v>=0)return this.b.add(r.scaleSelf(g/(g+v)));var T=y.dot(l.crossSelf(h));if(0>=T&&p>=0&&m>=0)return this.a.add(n.scaleSelf(p/(p+m)));var R=x/(x+T+E),w=T/(x+T+E),_=1-R-w;return this.a.scale(R).addSelf(this.b.scale(w)).addSelf(this.c.scale(_))},computeCentroid:function(){return this.centroid=this.a.add(this.b).addSelf(this.c).scaleSelf(1/3),this.centroid},computeNormal:function(){return this.normal=this.a.sub(this.c).crossSelf(this.a.sub(this.b)).normalize(),this.normal},containsPoint:function(t){if(t.equals(this.a)||t.equals(this.b)||t.equals(this.c))return!0;var e=t.sub(this.a).normalize(),n=t.sub(this.b).normalize(),i=t.sub(this.c).normalize(),o=Math.acos(e.dot(n));return o+=Math.acos(n.dot(i)),o+=Math.acos(i.dot(e)),r.abs(o-r.TWO_PI)<=.005},flipVertexOrder:function(){this.a;return this.a=this.c,this.c=this.t,this},fromBarycentric:function(t){return new i(this.a.x*t.x+this.b.x*t.y+this.c.x*t.z,this.a.y*t.x+this.b.y*t.y+this.c.y*t.z,this.a.z*t.x+this.b.z*t.y+this.c.z*t.z)},getBoundingBox:function(){var t=i.min(i.min(this.a,this.b),this.c),e=i.max(i.max(this.a,this.b),this.c);return s.fromMinMax(t,e)},getClosestPointTo:function(t){var e=new o(this.a,this.b),n=e.closestPointTo(t),r=e.set(this.b,this.c).closestPointTo(t),i=e.set(this.c,this.a).closestPointTo(t),a=t.sub(n).magSquared(),s=t.sub(r).magSquared(),h=t.sub(i).magSquared(),u=a,c=n;return u>s&&(u=s,c=r),u>h&&(c=i),c},isClockwiseInXY:function(){return h.isClockwiseInXY(this.a,this.b,this.c)},isClockwiseInXZ:function(){return h.isClockwiseInXY(this.a,this.b,this.c)},isClockwiseInYZ:function(){return h.isClockwiseInXY(this.a,this.b,this.c)},set:function(t,e,n){this.a=t,this.b=e,this.c=n},toBarycentric:function(t){var e=b.sub(this.a).cross(this.c.sub(this.a)),n=e.getNormalized(),r=n.dot(e),o=n.dot(this.b.sub(t).cross(this.c.sub(t))),a=o/r,s=n.dot(this.c.sub(t).cross(this.a.sub(t))),h=s/r,u=1-a-h;return new i(a,h,u)},toString:function(){return"Triangle: "+this.a+","+this.b+","+this.c}},n.exports=h}),n("toxi/geom/mesh/Face",["require","exports","module","../Triangle3D","../../internals"],function(t,e,n){var r,i;!function(){var e=t("../Triangle3D");r=function(t,e,n,r,i,o){this.a=t,this.b=e,this.c=n;var a=this.a.sub(this.c),s=this.a.sub(this.b),h=a.crossSelf(s);this.normal=h.normalize(),this.a.addFaceNormal(this.normal),this.b.addFaceNormal(this.normal),this.c.addFaceNormal(this.normal),void 0!==r&&(this.uvA=r,this.uvB=i,this.uvC=o)},r.prototype={computeNormal:function(){this.normal=this.a.sub(this.c).crossSelf(this.a.sub(this.b)).normalize()},flipVertexOrder:function(){var t=this.a;this.a=this.b,this.b=t,this.normal.invert()},getCentroid:function(){return this.a.add(this.b).addSelf(this.c).scale(1/3)},getClass:function(){return"Face"},getVertices:function(t){return void 0!==t?(t[0]=this.a,t[1]=this.b,t[2]=this.c):t=[this.a,this.b,this.c],t},toString:function(){return this.getClass()+" "+this.a+", "+this.b+", "+this.c},toTriangle:function(){return new e(this.a.copy(),this.b.copy(),this.c.copy())}}}(),function(){var e,n=t("../../internals");i=function(t,e,n,i,o,a){r.call(this,t,e,n,i,o,a),this.edges=[]},n.extend(i,r),e=i.prototype,e.addEdge=function(t){this.edges.push(t)},e.getEdges=function(){return this.edges},e.getVertices=function(t){return void 0!==t?(t[0]=this.a,t[1]=this.b,t[2]=this.c):t=[this.a,this.b,this.c],t}}(),r.WEFace=i,n.exports=r}),n("toxi/geom/Quaternion",["require","exports","module","../math/mathUtils","./Matrix4x4"],function(t,e,n){var r=t("../math/mathUtils"),i=t("./Matrix4x4"),o=function(t,e,n,r){4==arguments.length?(this.w=t,this.x=e,this.y=n,this.z=r):2==arguments.length?(this.x=e.x,this.y=e.y,this.z=e.z,this.w=t):1==arguments.length&&(this.w=q.w,this.x=q.x,this.y=q.y,this.z=q.z)};o.prototype={add:function(t){return new o(this.x+t.x,this.y+t.y,this.z+t.z,this.w+t.w)},addSelf:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},copy:function(){return new o(this.w,this.x,this.y,this.z)},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},getConjugate:function(){var t=new o;return t.x=-this.x,t.y=-this.y,t.z=-this.z,t.w=w,t},identity:function(){return this.w=1,this.x=0,this.y=0,this.z=0,this},interpolateTo:function(t,e,n){return 3==arguments.length?this.copy().interpolateTo(t,n.interpolate(0,1,e)):this.copy().interpolateToSelf(t,e)},interpolateToSelf:function(t,e,n){3==arguments.length&&(e=n.interpolate(0,1,e));var i,o,a=r.clip(this.dot(t),-1,1);if(1-a>=r.EPS){var s=Math.acos(a),h=1/Math.sin(s);i=Math.sin(s*(1-e))*h,o=Math.sin(s*e)*h}else i=1-e,o=e;return 0>a?(this.w=i*this.w-o*t.w,this.x=i*this.x-o*t.x,this.y=i*this.y-o*t.y,this.z=i*this.z-o*t.z):(this.w=i*w+o*t.w,this.x=i*x+o*t.x,this.y=i*y+o*t.y,this.z=i*z+o*t.z),this},magnitude:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},multiply:function(t){var e=new o;return e.w=this.w*t.w-x*t.x-y*t.y-z*t.z,e.x=this.w*t.x+x*t.w+y*t.z-z*t.y,e.y=this.w*t.y+y*t.w+z*t.x-x*t.z,e.z=this.w*t.z+z*t.w+x*t.y-y*t.x,e},normalize:function(){var t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return t>r.EPS&&(t=1/t,this.x*=t,this.y*=t,this.z*=t,this.w*=t),this},scale:function(t){return new o(this.x*t,this.y*t,this.z*t,this.w*t)},scaleSelf:function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},set:function(t,e,n,r){return 4==arguments.length?(this.w=t,this.x=e,this.y=n,this.z=r):2==arguments.length?(this.w=t,this.x=v.x,this.y=v.y,this.z=v.z):(this.w=q.w,this.x=q.x,this.y=q.y,this.z=q.z),this},sub:function(t){return new o(this.x-t.x,this.y-t.y,this.z-t.z,this.w-t.w)},subSelf:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this},toArray:function(){return[this.w,this.x,this.y,this.z]},toAxisAngle:function(){var t=[],e=Math.sqrt(1-this.w*this.w);return e=e<r.EPS?1:1/e,t[0]=2*Math.acos(this.w),t[1]=this.x*e,t[2]=this.y*e,t[3]=this.z*e,t},toMatrix4x4:function(t){void 0===t&&(t=new i);var e=this.x+this.x,n=this.y+this.y,r=this.z+this.z,o=this.x*e,a=this.x*n,s=this.x*r,h=this.y*n,u=this.y*r,c=this.z*r,l=this.w*e,f=this.w*n,p=this.w*r;return t.set(1-(h+c),a-p,s+f,0,a+p,1-(o+c),u-l,0,s-f,u+l,1-(o+h),0,0,0,0,1)},toString:function(){return"{axis: ["+this.x+","+this.y+","+this.z+"], w: "+this.w+"}"}},o.DOT_THRESHOLD=.9995,o.createFromAxisAngle=function(t,e){e*=.5;var n=r.sin(e),i=r.cos(e),a=new o(i,t.getNormalizedTo(n));return a},o.createFromEuler=function(t,e,n){t*=.5,e*=.5,n*=.5;var i=r.sin(t),a=r.cos(t),s=r.sin(e),h=r.cos(e),u=r.sin(n),c=r.cos(n),l=a*h,f=i*s,p=new o;return p.x=u*l-c*f,p.y=c*i*h+u*a*s,p.z=c*a*s-u*i*h,p.w=c*l+u*f,p},o.createFromMatrix=function(t){var e=0,n=[],r=t.matrix[0][0]+t.matrix[1][1]+t.matrix[2][2];if(r>0)e=Math.sqrt(r+1),n[3]=.5*e,e=.5/e,n[0]=t.matrix[1][2]-t.matrix[2][1]*e,n[1]=t.matrix[2][0]-t.matrix[0][2]*e,n[2]=t.matrix[0][1]-t.matrix[1][0]*e;else{var i=[1,2,0],a=0,s=0,h=0;t.matrix[1][1]>t.matrix[0][0]&&(a=1),t.matrix[2][2]>t.matrix[a][a]&&(a=2),s=i[a],h=i[s],e=Math.sqrt(t.matrix[a][a]-(t.matrix[s][s]+t.matrix[h][h])+1),n[a]=.5*e,e=.5/e,n[3]=(t.matrix[s][h]-t.matrix[h][s])*e,n[s]=(t.matrix[a][s]+t.matrix[s][a])*e,n[h]=(t.matrix[a][h]+t.matrix[h][a])*e}return new o(n[3],n[0],n[1],n[2])},o.getAlignmentQuat=function(t,e){var n=t.getNormalized(),r=e.cross(n),i=r.magnitude()+1e-4,o=Math.atan2(i,e.dot(n));return this.createFromAxisAngle(r,o)},n.exports=o}),n("toxi/geom/mesh/Vertex",["require","exports","module","../../internals","../Vec3D"],function(t,e,n){var r,i;!function(){var e,n=t("../../internals").extend,i=t("../Vec3D");r=function(t,e){i.call(this,t),this.id=e,this.normal=new i},n(r,i),e=r.prototype,e.addFaceNormal=function(t){this.normal.addSelf(t)},e.clearNormal=function(){this.normal.clear()},e.computeNormal=function(){this.normal.normalize()},e.toString=function(){return this.id+": p: "+this.parent.toString.call(this)+" n:"+this.normal.toString()}}(),function(){var e,n=t("../../internals").extend;return i=function(t,e){r.call(this,t,e),this.edges=[]},n(i,r),e=i.prototype,e.addEdge=function(t){this.edges.push(t)},e.getNeighborInDirection=function(t,e){for(var n,r,i=1-e,o=this.getNeighbors(),a=0,s=o.length;s>a;a++)r=o[a].sub(this).normalize().dot(t),r>i&&(n=o[a],i=r);return n},e.getNeighbors=function(){for(var t=[],e=0,n=this.edges.length;n>e;e++)t.push(this.edges[e].getOtherEndFor(this));return t},e.removeEdge=function(t){this.edges.splice(this.edges.indexOf(t),1)},e.toString=function(){return this.id+" {"+this.x+","+this.y+","+this.z+"}"},i}(),r.WEVertex=i,n.exports=r}),n("toxi/geom/Sphere",["require","../internals","./mesh/meshCommon","./Vec3D","../math/mathUtils","./Vec3D","../internals"],function(t){var e,n;return function(){var r=t("../internals"),i=t("./mesh/meshCommon"),o=t("./Vec3D");e=function(t,e){void 0===t?(o.apply(this,[new o]),this.radius=1):r.has.XYZ(t)?(o.apply(this,[t]),this.radius=r.is.Sphere(t)?t.radius:e):(o.apply(this,[new o]),this.radius=t)},r.extend(e,o),e.prototype.containsPoint=function(t){var e=this.sub(t).magSquared();return e<=this.radius*this.radius},e.prototype.intersectRay=function(t){var e,n,r,i,o=t.sub(this),a=o.magSquared(),s=-o.dot(t.getDirection()),h=this.radius*this.radius-(a-s*s);return h>=0&&(h=Math.sqrt(h),n=s+h,r=s-h,0>n&&0>r||(n>0&&r>0?n>r&&(i=n,n=r,r=i):r>0&&(i=n,n=r,r=i)),e=[n,r]),e},e.prototype.intersectSphereTriangle=function(t,e){e.set(t.closestPointOnSurface(this));var n=e.sub(this);return n.magSquared()<=this.radius*this.radius},e.prototype.tangentPlaneNormalAt=function(t){return this.sub(t).normalize()},e.prototype.toMesh=function(){var t={mesh:void 0,resolution:0};1===arguments.length?"object"==typeof arguments[0]?(t.mesh=arguments[0].mesh,t.resolution=arguments[0].res||arguments[0].resolution):t.resolution=arguments[0]:(t.mesh=arguments[0],t.resolution=arguments[1]);var e=new i.SurfaceMeshBuilder(new n(this));return e.createMesh(t.mesh,t.resolution,1)}}(),function(e){var r=t("../math/mathUtils"),i=t("./Vec3D"),o=t("../internals");n=function(t){void 0===t&&(this.sphere=new e(new i,1)),this.sphere=o.is.Sphere(t)?t:new e(new i,t),this.phiRange=r.PI,this.thetaRange=r.TWO_PI},n.prototype={computeVertexFor:function(t,e,n){e-=r.HALF_PI;var i=r.cos(e),o=r.cos(n),a=r.sin(e),s=r.sin(n),h=r.sign(i)*r.abs(i);return t.x=h*r.sign(o)*r.abs(o),t.y=r.sign(a)*r.abs(a),t.z=h*r.sign(s)*r.abs(s),t.scaleSelf(this.sphere.radius).addSelf(this.sphere)},getPhiRange:function(){return this.phiRange},getPhiResolutionLimit:function(t){return t},getThetaRange:function(){return this.thetaRange},getThetaResolutionLimit:function(t){return t},setMaxPhi:function(t){this.phiRange=r.min(t/2,r.PI)},setMaxTheta:function(t){this.thetaRange=r.min(t,r.TWO_PI)}}}(e),e.SphereFunction=n,e}),n("toxi/geom/mesh/WingedEdge",["../../internals","../Line3D"],function(t,e){var n,r;return n=function(t,n,r,i){e.call(this,t,n),this.id=i,this.faces=[],this.addFace(r)},t.extend(n,e),r=n.prototype,r.addFace=function(t){return this.faces.push(t),this},r.getFaces=function(){return this.faces},r.getOtherEndFor=function(t){return this.a===t?this.b:this.b===t?this.a:void 0},r.remove=function(){for(var t=this,e=function(e){e.splice(e.indexOf(t),1)},n=0,r=this.faces.length;r>n;n++)e(this.faces[n].edges);e(this.a.edges),e(this.b.edges)},r.toString=function(){return"id: "+this.id+" "+e.prototype.toString.call(this)+" f: "+this.faces.length},n}),n("toxi/geom/mesh/subdiv/EdgeLengthComparator",[],function(){var t=function(){};return t.prototype.compare=function(t,e){return-parseInt(t.getLengthSquared()-e.getLengthSquared(),10)},t}),n("toxi/geom/mesh/subdiv/SubdivisionStrategy",["./EdgeLengthComparator"],function(t){var e,n;return e=function(){this._order=e.DEFAULT_ORDERING},e.DEFAULT_ORDERING=new t,n=e.prototype,n.getEdgeOrdering=function(){return this._order.compare},n.setEdgeOrdering=function(t){this._order=t},e}),n("toxi/geom/mesh/subdiv/MidpointSubdivision",["../../../internals","./SubdivisionStrategy"],function(t,e){var n=function(){e.call(this)};return t.extend(n,e),n.prototype.computeSplitPoints=function(t){var e=[];
return e.push(t.getMidPoint()),e},n}),n("toxi/math/Interpolation2D",["../internals"],function(t){var e={};return e.bilinear=function(e,n,r,i,o,a,s,h,u,c){var l,f,p,d,m,g,v,y,E,x;t.has.XY(e)?(l=e.x,f=e.y,p=n.x,d=n.y,m=r.x,g=r.y,v=i,y=o,E=a,x=s):(l=e,f=n,p=r,d=i,m=o,g=a,v=s,y=h,E=u,x=c);var T=1/((m-p)*(g-d)),b=(l-p)*T,R=(m-l)*T,w=f-d,_=g-f;return v*R*_+y*b*_+E*R*w+x*b*w},e}),n("toxi/geom/IsectData3D",["require","exports","module","./Vec3D"],function(t,e,n){var r=t("./Vec3D"),i=function(t){void 0!==t?(this.isIntersection=t.isIntersection,this.dist=t.dist,this.pos=t.pos.copy(),this.dir=t.dir.copy(),this.normal=t.normal.copy()):this.clear()};i.prototype={clear:function(){this.isIntersection=!1,this.dist=0,this.pos=new r,this.dir=new r,this.normal=new r},toString:function(){var t="isec: "+this.isIntersection;return this.isIntersection&&(t+=" at:"+this.pos+" dist:"+this.dist+" normal:"+this.normal),t}},n.exports=i}),n("toxi/geom/TriangleIntersector",["../math/mathUtils","./Triangle3D","./Vec3D","./IsectData3D"],function(t,e,n,r){var i=function(t){this.triangle=t||new e,this.isectData=new r};return i.prototype={getIntersectionData:function(){return this.isectData},getTriangle:function(){return this.triangle},intersectsRay:function(e){this.isectData.isIntersection=!1;var n=this.triangle.computeNormal(),r=n.dot(e.dir);if(0>r){var i=e.sub(this.triangle.a),o=-(n.x*i.x+n.y*i.y+n.z*i.z)/(n.x*e.dir.x+n.y*e.dir.y+n.z*e.dir.z);if(o>=t.EPS){var a=e.getPointAtDistance(o);this.triangle.containsPoint(a)&&(this.isectData.isIntersection=!0,this.isectData.pos=a,this.isectData.normal=n,this.isectData.dist=o,this.isectData.dir=this.isectData.pos.sub(e).normalize())}}return this.isectData.isIntersection},setTriangle:function(t){return this.triangle=t,this}},i}),n("toxi/geom/mesh/meshCommon",["require","exports","module","../Line3D","../../internals","../../math/mathUtils","../Matrix4x4","./Face","../Vec3D","../Triangle3D","../Quaternion","./Vertex","../AABB","../Sphere","../../internals","../Line3D","../Vec3D","./Vertex","./Face","./WingedEdge","./subdiv/MidpointSubdivision","../../internals","../../math/mathUtils","../../math/Interpolation2D","../Ray3D","../TriangleIntersector","../Triangle3D","../IsectData3D","../vectors","../vectors","../Vec3D","../Vec2D"],function(t,e){function n(t){var e=1e6,n=function(t){return Math.floor(t*e)/e};return"[ x: "+n(t.x)+", y: "+n(t.y)+", z: "+n(t.z)+"]"}function r(e){var n=t("../Line3D");return n.prototype.toString.call(e)}var i,o,a,s;!function(){var e=t("../../internals"),r=t("../../math/mathUtils"),a=t("../Matrix4x4"),s=t("./Face"),h=t("../Vec3D"),u=t("../Triangle3D"),c=t("../Quaternion"),l=t("./Vertex");i=function(t){return void 0===t&&(t="untitled"),this.init(t),this},i.__vertexKeyGenerator=n,i.DEFAULT_NUM_VERTICES=1e3,i.DEFAULT_NUM_FACES=3e3,i.DEFAULT_STRIDE=4,i.prototype={addFace:function(t,e,n,r,i,o,a){6==arguments.length&&(a=o,o=i,i=r,r=void 0);var h=this.__checkVertex(t),u=this.__checkVertex(e),c=this.__checkVertex(n);if(h.id===u.id||h.id===c.id||u.id===c.id);else{if(void 0!==r){var l=h.sub(c).crossSelf(h.sub(u));if(r.dot(l)<0){var f=h;h=u,u=f}}var p=new s(h,u,c,i,o,a);this.faces.push(p)}return this},addMesh:function(t){for(var e=t.getFaces().length,n=0;e>n;n++){var r=t.getFaces()[n];this.addFace(r.a,r.b,r.c)}return this},center:function(t){this.computeCentroid();for(var e=void 0!==t?t.sub(this.centroid):this.centroid.getInverted(),n=this.vertices.length,r=0;n>r;r++){var i=this.vertices[r];i.addSelf(e)}return this.getBoundingBox()},__checkVertex:function(t){var e=this.vertexMap.get(t);return void 0===e&&(e=this._createVertex(t,this.uniqueVertexID++),this.vertexMap.put(e,e)),e},clear:function(){return this.vertexMap=new e.LinkedMap(n),this.vertices=this.vertexMap.getArray(),this.faces=[],this.bounds=void 0,this},computeCentroid:function(){this.centroid.clear();for(var t=this.vertices.length,e=0;t>e;e++)this.centroid.addSelf(this.vertices[e]);return this.centroid.scaleSelf(1/this.vertexMap.size()).copy()},computeFaceNormals:function(){for(var t=this.faces.length,e=0;t>e;e++)this.faces[e].computeNormal()},computeVertexNormals:function(){var t=this.vertices.length,e=0;for(e=0;t>e;e++)this.vertices[e].clearNormal();for(t=this.faces.length,e=0;t>e;e++){var n=this.faces[e];n.a.addFaceNormal(n.normal),n.b.addFaceNormal(n.normal),n.c.addFaceNormal(n.normal)}for(t=this.vertices.length,e=0;t>e;e++)this.vertices[e].computeNormal();return this},copy:function(){for(var t=new i(this.name+"-copy",this.vertexMap.size(),this.faces.length),e=this.faces.length,n=0;e>n;n++){var r=this.faces[n];t.addFace(r.a,r.b,r.c,r.normal,r.uvA,r.uvB,r.uvC)}return t},_createVertex:function(t,e){var n=new l(t,e);return n},faceOutwards:function(){this.computeCentroid();for(var t=this.faces.length,e=0;t>e;e++){var n=this.faces[e],r=n.getCentroid().sub(this.centroid),i=r.dot(n.normal);0>i&&n.flipVertexOrder()}return this},flipVertexOrder:function(){for(var t=this.faces.length,e=0;t>e;e++){var n=this.faces[e],r=n.a;n.a=n.b,n.b=r,n.normal.invert()}return this},flipYAxis:function(){return this.transform((new a).scaleSelf(1,-1,1)),this.flipVerteAxOrder(),this},getBoundingBox:function(){for(var e=t("../AABB"),n=this,r=h.MAX_VALUE.copy(),i=h.MIN_VALUE.copy(),o=n.vertices.length,a=0;o>a;a++){var s=n.vertices[a];r.minSelf(s),i.maxSelf(s)}return n.bounds=e.fromMinMax(r,i),n.bounds},getBoundingSphere:function(){var e=t("../Sphere"),n=0;this.computeCentroid();for(var i=this.vertices.length,o=0;i>o;o++){var a=this.vertices[o];n=r.max(n,a.distanceToSquared(this.centroid))}var s=new e(this.centroid,Math.sqrt(n));return s},getClosestVertexToPoint:function(t){for(var e,n=Number.MAX_VALUE,r=this.vertices.length,i=0;r>i;i++){var o=this.vertices[i],a=o.distanceToSquared(t);n>a&&(e=o,n=a)}return e},getFaceNormalsAsArray:function(t,e,n){if(0===arguments.length)t=void 0,e=0,n=i.DEFAULT_STRIDE;else if(1==arguments.length&&"object"==typeof arguments[0]){var o=arguments[0];t=o.normals,e=o.offset,n=o.stride}n=r.max(n,3),void 0===t&&(t=[]);for(var a=e,s=this.faces.length,h=0;s>h;h++){var u=this.faces[h];t[a]=u.normal.x,t[a+1]=u.normal.y,t[a+2]=u.normal.z,a+=n,t[a]=u.normal.x,t[a+1]=u.normal.y,t[a+2]=u.normal.z,a+=n,t[a]=u.normal.x,t[a+1]=u.normal.y,t[a+2]=u.normal.z,a+=n}return t},getFaces:function(){return this.faces},getFacesAsArray:function(){for(var t=[],e=0,n=this.faces.length,r=0;n>r;r++){var i=this.faces[r];t[e++]=i.a.id,t[e++]=i.b.id,t[e++]=i.c.id}return t},getIntersectionData:function(){return this.intersector.getIntersectionData()},getMeshAsVertexArray:function(t,e,n){void 0===t&&(t=void 0),void 0===e&&(e=0),void 0===n&&(n=i.DEFAULT_STRIDE),n=r.max(n,3),void 0===t&&(t=[]);for(var o=0,a=this.faces.length,s=0;a>s;++s){var h=this.faces[s];t[o]=h.a.x,t[o+1]=h.a.y,t[o+2]=h.a.z,o+=n,t[o]=h.b.x,t[o+1]=h.b.y,t[o+2]=h.b.z,o+=n,t[o]=h.c.x,t[o+1]=h.c.y,t[o+2]=h.c.z,o+=n}return t},getNumFaces:function(){return this.faces.length},getNumVertices:function(){return this.vertexMap.size()},getRotatedAroundAxis:function(t,e){return this.copy().rotateAroundAxis(t,e)},getRotatedX:function(t){return this.copy().rotateX(t)},getRotatedY:function(t){return this.copy().rotateY(t)},getRotatedZ:function(t){return this.copy().rotateZ(t)},getScaled:function(t){return this.copy().scale(t)},getTranslated:function(t){return this.copy().translate(t)},getUniqueVerticesAsArray:function(){for(var t=[],e=0,n=this.vertices.length,r=0;n>e;r++){var i=this.vertices[r];t[e++]=i.x,t[e++]=i.y,t[e++]=i.z}return t},getVertexAtPoint:function(t){for(var e,n=0;n<this.vertices.length;n++)this.vertices[n].equals(t)&&(e=n);return this.vertices[e]},getVertexIndex:function(t){for(var e=-1,n=this.vertices.length,r=0;n>r;r++){var i=this.vertices[r];i.equals(t)&&(e=r)}return e},getVertexForID:function(t){for(var e,n=this.vertices.length,r=0;n>r;r++){var i=this.vertices[r];if(i.id==t){e=i;break}}return e},getVertexNormalsAsArray:function(t,e,n){void 0===e&&(e=0),void 0===n&&(n=i.DEFAULT_STRIDE),n=r.max(n,3),void 0===t&&(t=[]);for(var o=e,a=this.faces.length,s=0;a>s;s++){var h=this.faces[s];t[o]=h.a.normal.x,t[o+1]=h.a.normal.y,t[o+2]=h.a.normal.z,o+=n,t[o]=h.b.normal.x,t[o+1]=h.b.normal.y,t[o+2]=h.b.normal.z,o+=n,t[o]=h.c.normal.x,t[o+1]=h.c.normal.y,t[o+2]=h.c.normal.z,o+=n}return t},getVertices:function(){return this.vertices},handleSaveAsSTL:function(){throw Error("TriangleMesh.handleSaveAsSTL() currently not implemented")},init:function(t){this.setName(t),this.matrix=new a,this.centroid=new h,this.vertexMap=new e.LinkedMap(n),this.vertices=this.vertexMap.getArray(),this.faces=[],this.uniqueVertexID=0},intersectsRay:function(){throw Error("intersectsRay not yet implemented")},perforateFace:function(t,e){var n=t.getCentroid(),r=1-e,i=t.a.interpolateTo(n,r),o=t.b.interpolateTo(n,r),a=t.c.interpolateTo(n,r);return this.removeFace(t),this.addFace(t.a,o,i),this.addFace(t.a,t.b,o),this.addFace(t.b,a,o),this.addFace(t.b,t.c,a),this.addFace(t.c,i,a),this.addFace(t.c,t.a,i),new u(i,o,a)},pointTowards:function(t,e){return e=e||h.Z_AXIS,this.transform(c.getAlignmentQuat(t,e).toMatrix4x4(this.matrix),!0)},removeFace:function(t){for(var e=-1,n=this.faces.length,r=0;n>r;r++)if(this.faces[r]==t){e=r;break}e>-1&&this.faces.splice(e,1)},rotateAroundAxis:function(t,e){return this.transform(this.matrix.identity().rotateAroundAxis(t,e))},rotateX:function(t){return this.transform(this.matrix.identity().rotateX(t))},rotateY:function(t){return this.transform(this.matrix.identity().rotateY(t))},rotateZ:function(t){return this.transform(this.matrix.identity().rotateZ(t))},saveAsOBJ:function(t,e){void 0===e&&(e=!0);var n=t.getCurrVertexOffset()+1,r=t.getCurrNormalOffset()+1;t.newObject(this.name);var i,o=0,a=0,s=this.vertices.length,h=this.faces.length;for(o=0;s>o;o++)t.vertex(this.vertices[o]);if(e){for(o=0;s>o;o++)t.normal(this.vertices[o].normal);for(a=0;h>a;a++)i=this.faces[a],t.faceWithNormals(i.b.id+n,i.a.id+n,i.c.id+n,i.b.id+r,i.a.id+r,i.c.id+r)}else for(a=0;h>a;a++)i=this.faces[a],t.face(i.b.id+n,i.a.id+n,i.c.id+n)},saveAsSTL:function(){throw Error("TriangleMesh.saveAsSTL() currently not implemented")},scale:function(t){return this.transform(this.matrix.identity().scaleSelf(t))},setName:function(t){return this.name=t,this},toString:function(){return"TriangleMesh: "+this.name+" vertices: "+this.getNumVertices()+" faces: "+this.getNumFaces()},toWEMesh:function(){return new o(this.name).addMesh(this)},transform:function(t,e){void 0===e&&(e=!0);for(var n=this.vertices.length,r=0;n>r;r++){var i=this.vertices[r];i.set(t.applyTo(i))}return e&&this.computeFaceNormals(),this},translate:function(t,e,n){return 1==arguments.length&&(e=t.y,n=t.z,t=t.x),this.transform(this.matrix.identity().translateSelf(t,e,n))},updateVertex:function(t,e){var n=this.vertexMap.get(t);return void 0!==n&&(this.vertexMap.remove(n),n.set(e),this.vertexMap.put(e,n)),this}}}(),function(e){var i,a=t("../../internals"),s=t("../Line3D"),h=t("../Vec3D"),u=t("./Vertex").WEVertex,c=t("./Face").WEFace,l=t("./WingedEdge"),f=t("./subdiv/MidpointSubdivision");o=function(t){t=t||"untitled",e.call(this,t)},o.DEFAULT_NUM_FACES=e.DEFAULT_NUM_FACES,o.DEFAULT_NUM_VERTICES=e.DEFAULT_NUM_VERTICES,a.extend(o,e),i=o.prototype,i.addFace=function(t,e,n,r,i,o,a){6===arguments.length&&(a=o,o=i,i=r,r=void 0);var s,h,u,l=this.__checkVertex(t),f=this.__checkVertex(e),p=this.__checkVertex(n);return l.id===f.id||l.id===p.id||f.id===p.id?console.log("Ignoring invalid face: "+t+","+e+","+n):(void 0!==r&&null!==r&&(s=l.sub(p).crossSelf(l.sub(f)),r.dot(s)<0&&(h=l,l=f,f=h)),u=new c(l,f,p,i,o,a),this.faces.push(u),this.updateEdge(l,f,u),this.updateEdge(f,p,u),this.updateEdge(p,l,u)),this},i.center=function(t,n){e.prototype.center.call(this,t,n),this.rebuildIndex()},i.clear=function(){return e.prototype.clear.call(this),this.edgeMap=new a.LinkedMap(r),this.edges=this.edgeMap.getArray(),this},i.copy=function(){var t,e,n,r=new o(this.name+"-copy");for(e=this.faces.length,t=0;e>t;t++)n=this.faces[t],r.addFace(n.a,n.b,n.c,n.normal,n.uvA,n.uvB,n.uvC);return r},i._createVertex=function(t,e){var n=new u(t,e);return n},i.getNumEdges=function(){return this.edgeMap.size()},i.init=function(t){e.prototype.init.call(this,t),this.edgeMap=new a.LinkedMap(r),this.edges=this.edgeMap.getArray(),this.__edgeCheck=new s(new h,new h),this.__uniqueEdgeID=0},i.rebuildIndex=function(){var t=new a.LinkedMap(n),e=new a.LinkedMap(r);this.vertexMap.each(function(e){t.put(e,e)}),this.edgeMap.each(function(t){e.put(t,t)}),this.vertexMap=t,this.vertices=t.getArray(),this.edgeMap=e,this.edges=e.getArray()},i.removeEdge=function(t){var e=this;t.remove();var n=t.a;0===n.edges.length&&this.vertexMap.remove(n),n=t.b,0===n.edges.length&&this.vertexMap.remove(n),a.each(t.faces,function(t){e.removeFace(t)});var r=this.edgeMap.remove(this.__edgeCheck.set(t.a,t.b));if(r!==t)throw Error("Can't remove edge")},i.removeFace=function(t){var e=this,n=this.faces.indexOf(t);n>-1&&this.faces.splice(n,1),a.each(t.edges,function(n){n.faces.splice(n.faces.indexOf(t),1),0===n.faces.length&&e.removeEdge(n)})},i.removeUnusedVertices=function(){a.each(this.vertices,function(t,e){var n=!1;a.each(this.faces,function(e){return e.a==t||e.b==t||e.c==t?void(n=!0):void 0}),n||this.vertices.splice(e,1)})},i.removeVertices=function(t){a.each(t,function(t){a.each(t.edges,function(t){a.each(t.faces,function(t){this.removeFace(t)})})})},i.splitEdge=function(t,e,n){var r,i;3===arguments.length?r=this.edgeMap.get(this.__edgeCheck.set(t,e)):2==arguments.length&&(r=t,n=e),i=n.computeSplitPoints(r),this.splitFace(r.faces[0],r,i),r.faces.length>1&&this.splitFace(r.faces[1],r,i),this.removeEdge(r)},i.splitFace=function(t,e,n){var r,i,o,a,s,h;for(i=0;3>i;i++)if(o=t.edges[i],!o.equals(e)){r=o.a.equals(e.a)||o.a.equals(e.b)?o.b:o.a;break}for(s=n.length,i=0;s>i;i++)h=n[i],0===i?this.addFace(r,e.a,h,t.normal):this.addFace(r,a,h,t.normal),i===s-1&&this.addFace(r,h,e.b,t.normal),a=h},i.subdivide=function(t,e){1===arguments.length&&(e=t,t=new f),this.subdivideEdges(this.edges.slice(0),t,e)},i.subdivideEdges=function(t,e,n){t.sort(e.getEdgeOrdering()),n*=n;var r=0,i=t.length;for(r=0;i>r;r++){var o=t[r];this.edges.indexOf(o)>-1&&o.getLengthSquared()>=n&&this.splitEdge(o,e)}},i.subdivideFaceEdges=function(t,e,n){var r,i,o,a,s,h,u=[];for(s=this.faces.length,r=0;s>r;r++)for(o=this.faces[r],h=o.edges.length,i=0;h>i;i++)a=o.edges[i],u.indexOf(a)<0&&u.push(a);this.subdividEdges(u,e,n)},i.toString=function(){return"WETriangleMesh: "+this.name+" vertices: "+this.getNumVertices()+" faces: "+this.getNumFaces()+" edges:"+this.getNumEdges()},i.transform=function(t,e){(void 0===e||null===e)&&(e=!0);for(var n=0,r=this.vertices.length;r>n;n++)t.applyToSelf(this.vertices[n]);return this.rebuildIndex(),e&&this.computeFaceNormals(),this},i.updateEdge=function(t,e,n){this.__edgeCheck.set(t,e);var r=this.edgeMap.get(this.__edgeCheck);void 0!==r?r.addFace(n):(r=new l(t,e,n,this.__uniqueEdgeID++),this.edgeMap.put(r,r),t.addEdge(r),e.addEdge(r)),n.addEdge(r)}}(i),function(e){var n=t("../../internals"),r=t("../../math/mathUtils"),i=t("../../math/Interpolation2D"),o=t("../Ray3D"),s=t("../TriangleIntersector"),h=t("../Triangle3D"),u=t("../IsectData3D"),c=t("../vectors").Vec2D,l=t("../vectors").Vec3D;a=function(t,e,r){this.width=t,this._depth=e,n.has.XY(r)||(r=new c(r,r)),this.setScale(r),this.elevation=[];var i=0,o=t*e;for(i=0;o>i;i++)this.elevation[i]=0;this.__elevationLength=this.width*this._depth,this.vertices=[];var a=new l(parseInt(this.width/2,10),0,parseInt(this._depth/2,10)),s=this.getScale().to3DXZ();i=0;for(var h=0;h<this._depth;h++)for(var u=0;u<this.width;u++)this.vertices[i++]=new l(u,0,h).subSelf(a).scaleSelf(s)},a.prototype={getDepth:function(){return this._depth},getElevation:function(){return this.elevation},getHeightAtCell:function(t,e){return this.elevation[this._getIndex(t,e)]},getHeightAtPoint:function(t,e){var n=t/this._scale.x+.5*this.width,o=e/this._scale.y+.5*this._depth,a=0,s={xx:parseInt(n,10),zz:parseInt(o,10)};if(n>=0&n<this.width&&o>=0&&o<this._depth){var h=parseInt(r.min(n+1,this.width-1),10),u=parseInt(r.min(o+1,this._depth-1),10),c=this.getHeightAtCell(s.xx,s.zz),l=this.getHeightAtCell(h,s.zz),f=this.getHeightAtCell(s.xx,u),p=this.getHeightAtCell(h,u);a=i.bilinear(n,o,s.xx,s.zz,h,u,c,l,f,p)}return a},_getIndex:function(t,e){var n=e*this.width+t;if(0>n||n>this.__elevationLength)throw new Error("the given terrain cell is invalid: "+t+";"+e);return n},getScale:function(){return this._scale},getVertexAtCell:function(t,e){return this.vertices[this._getIndex(t,e)]},getWidth:function(){return this.width},intersectAtPoint:function(t,e){var n=t/this._scale.x+.5*this.width,i=e/this._scale.y+.5*this._depth,a=new u;if(n>=0&&n<this.width&&i>=0&&i<this._depth){var c=parseInt(r.min(n+1,this.width-1),10),f=parseInt(r.min(i+1,this._depth-1),10),p={xx:parseInt(n,10),zz:parseInt(i,10)},d=this.getVertexAtCell(p.xx,p.zz),m=this.getVertexAtCell(c,p.zz),g=this.getVertexAtCell(c,f),v=this.getVertexAtCell(p.xx,f),y=new o(new l(t,1e4,e),new l(0,-1,0)),E=new s(new h(d,m,v));E.intersectsRay(y)?a=E.getIntersectionData():(E.setTriangle(new h(m,g,v)),E.intersectsRay(y),a=E.getIntersectionData())}return a},setElevation:function(t){if(this.__elevationLength!=t.length)throw new Error("the given elevation array size does not match terrain");for(var e=0,n=t.length;n>e;e++)this.vertices[e].y=this.elevation[e]=t[e];return this},setHeightAtCell:function(t,e,n){var r=this._getIndex(t,e);return this.elevation[r]=n,this.vertices[r].y=n,this},setScale:function(t){n.has.XY(t)||(t=new c(t,t)),this._scale=t},toMesh:function(){var t={mesh:void 0,minX:0,minZ:0,maxX:this.width,maxZ:this._depth},n=this.vertices,i=this.width,o=this._depth;if(1==arguments.length&&"object"==typeof arguments[0]){var a=arguments[0];t.mesh=a.mesh||new e("terrain"),t.minX=a.minX||t.minX,t.minZ=a.minZ||t.minZ,t.maxX=a.maxX||t.maxX,t.maxZ=a.maxZ||t.maxZ}else arguments.length>=5&&(t.mesh=arguments[0],t.minX=arguments[1],t.minZ=arguments[2],t.maxX=arguments[3],t.maxZ=arguments[4]);t.mesh=t.mesh||new e("terrain"),t.minX=r.clip(t.minX,0,i-1),t.maxX=r.clip(t.maxX,0,i),t.minZ=r.clip(t.minZ,0,o-1),t.maxZ=r.clip(t.maxZ,0,o),t.minX++,t.minZ++;for(var s=t.minZ,h=t.minX*i;s<t.maxZ;s++,h+=i)for(var u=t.minX;u<t.maxX;u++)t.mesh.addFace(n[h-i+u-1],n[h-i+u],n[h+u-1]),t.mesh.addFace(n[h-i+u],n[h+u],n[h+u-1]);return t.mesh}}}(i),function(e){var n=t("../Vec3D"),r=t("../Vec2D");s=function(t){this.func=t},s.prototype={createMesh:function(){var t={mesh:void 0,resolution:0,size:1,isClosed:!0};if(1==arguments.length)if("object"==typeof arguments[0]){var i=arguments[0];t.mesh=i.mesh,t.resolution=i.res||i.resoultion||0,void 0!==i.size&&(t.size=i.size),void 0!==i.isClosed&&(t.isClosed=i.isClosed)}else t.resolution=arguments[0];else arguments.length>2&&(t.mesh=arguments[0],t.resolution=arguments[1],t.size=arguments[2],4==arguments.length&&(t.isClosed=arguments[3]));var o=t.mesh;(void 0===o||null===o)&&(o=new e);for(var a=new n,s=new n,h=new n,u=new n,c=new n,l=new n,f=this.func.getPhiResolutionLimit(t.resolution),p=this.func.getPhiRange(),d=this.func.getThetaResolutionLimit(t.resolution),m=this.func.getThetaRange(),g=1/f,v=1/d,y=1/t.resolution,E=new r,x=new r,T=new r,b=new r,R=0;f>R;R++)for(var w=R*p*y,_=(R+1)*p*y,H=0;d>=H;H++){var M=H*m*y,S=this.func;a=S.computeVertexFor(a,_,M).scaleSelf(t.size),T.set(H*v,1-(R+1)*g),s=S.computeVertexFor(s,w,M).scaleSelf(t.size),b.set(H*v,1-R*g),s.equalsWithTolerance(a,1e-4)&&s.set(a),H>0?(H==d&&t.isClosed&&(a.set(c),s.set(l)),o.addFace(h,u,a,E.copy(),x.copy(),T.copy()),o.addFace(u,s,a,x.copy(),b.copy(),T.copy())):(c.set(a),l.set(s)),h.set(a),u.set(s),E.set(T),x.set(b)}return o},getFunction:function(){return this.func},setFunction:function(t){this.func=t}}}(i),e.TriangleMesh=i,e.WETriangleMesh=o,e.Terrain=a,e.SurfaceMeshBuilder=s}),n("toxi/geom/mesh/TriangleMesh",["require","./meshCommon"],function(t){return t("./meshCommon").TriangleMesh}),n("toxi/geom/mesh/BezierPatch",["require","exports","module","../Vec3D","./TriangleMesh","../../internals/is"],function(t,e,n){var r=t("../Vec3D"),i=t("./TriangleMesh"),o=t("../../internals/is"),a=function(t){if(o.Array(t))this.points=t;else{this.points=[];for(var e=0;4>e;e++){this.points[e]=this.points[e]||[];for(var n=0;4>n;n++)this.points[e][n]=new r}}};a.prototype={computePointAt:function(t,e){return a.computePointAt(t,e,this.points)},set:function(t,e,n){return this.points[e][t].set(n),this},toMesh:function(t,e){var n,r;void 0===e?(n=new i,r=t):(n=t,r=e);for(var o=new Array(r+1),a=new Array(r+1),s=1/r,h=0;r>=h;h++){for(var u=0;r>=u;u++){var c=this.computePointAt(u*s,h*s,this.points);u>0&&h>0&&(n.addFace(c,o[u-1],a[u-1]),n.addFace(c,a[u-1],a[u])),o[u]=c}var l=a;a=o,o=l}return n}},a.computePointAt=function(t,e,n){var i=1-t,o=i*i*3*t,a=i*i*i,s=t*t,h=1-e,u=e*e*3,c=h*h*3,l=h*h*h,f=e*e*e,p=i*s*3,d=t*s,m=h*u,g=c*e,v=n[0],y=n[1],E=n[2],x=n[3],T=a*(v[0].x*l+v[1].x*g+v[2].x*m+v[3].x*f)+o*(y[0].x*l+y[1].x*g+y[2].x*m+y[3].x*f)+p*(E[0].x*l+E[1].x*g+E[2].x*m+E[3].x*f)+d*(x[0].x*l+x[1].x*g+x[2].x*m+x[3].x*f),b=a*(v[0].y*l+v[1].y*g+v[2].y*m+v[3].y*f)+o*(y[0].y*l+y[1].y*g+y[2].y*m+y[3].y*f)+p*(E[0].y*l+E[1].y*g+E[2].y*m+E[3].y*f)+d*(x[0].y*l+x[1].y*g+x[2].y*m+x[3].y*f),R=a*(v[0].z*l+v[1].z*g+v[2].z*m+v[3].z*f)+o*(y[0].z*l+y[1].z*g+y[2].z*m+y[3].z*f)+p*(E[0].z*l+E[1].z*g+E[2].z*m+E[3].z*f)+d*(x[0].z*l+x[1].z*g+x[2].z*m+x[3].z*f);return new r(T,b,R)},n.exports=a}),n("toxi/geom/mesh/VertexSelector",["require","exports","module"],function(t,e,n){var r=function(t){this.mesh=t,this.selection=[]};r.prototype={addSelection:function(t){return this.checkMeshIdentity(t.getMesh()),this.selection=this.selection.concat(t.getSelection()),this},checkMeshIdentity:function(t){if(t!=this.mesh)throw new Error("The given selector is not using the same mesh instance")},clearSelection:function(){return this.selection=[],this},getMesh:function(){return this.mesh},getSelection:function(){return this.selection},invertSelection:function(){for(var t=[],e=this.mesh.getVertices(),n=e.length,r=0;n>r;r++){var i=e[r];this.selection.indexOf(i)<0&&t.push(i)}return this.selection=t,this},selectSimilar:function(t){for(var e=t.length,n=0;e>n;n++){var r=t[n];this.selection.push(this.mesh.getClosestVertexToPoint(r))}return this},selectVertices:function(){return this},setMesh:function(t){this.mesh=t,this.clearSelection()},size:function(){return this.selection.length},subtractSelection:function(t){this.checkMeshIdentity(t.getMesh());var e,n=t.getSelection(),r=n.length;for(e=0;r>e;e++)this.selection.splice(this.selection.indexOf(n[e]),1);return this}},n.exports=r}),n("toxi/geom/mesh/BoxSelector",["require","exports","module","../../internals","./VertexSelector"],function(t,e,n){var r=t("../../internals").extend,i=t("./VertexSelector"),o=function(t,e){i.apply(this,[t]),this.box=e};r(o,i),o.prototype.selectVertices=function(){this.clearSelection();for(var t=this.mesh.getVertices(),e=t.length,n=0;e>n;n++){var r=t[n];this.box.containsPoint(r)&&this.selection.add(r)}return this},n.exports=o}),n("toxi/geom/mesh/DefaultSelector",["require","exports","module","../../internals","./VertexSelector"],function(t,e,n){var r=t("../../internals").extend,i=t("./VertexSelector"),o=function(t){i.call(this,t)};r(o,i),o.prototype.selectVertices=function(){return this.clearSelection(),this.selection=this.selection.concat(this.mesh.getVertices()),this},n.exports=o}),n("toxi/geom/mesh/OBJWriter",["../../internals"],function(t){var e=function(){this.buffer=[]};e.prototype.append=function(t){return this.buffer.push(t),this},e.prototype.toString=function(){return this.buffer.join("")};var n=function(){this.VERSION="0.3",this.__stringBuffer=new e,this.objStream=void 0,this.__filename="objwriter.obj",this._numVerticesWritten=0,this._numNormalsWritten=0};return n.prototype={beginSave:function(e){"string"==typeof e||t.hasProperties(e,["write","end","writable"]&&e.writable)&&(this.objStream=e),this._handleBeginSave()},endSave:function(){if(void 0!==this.objStream)try{this.objStream.destroy()}catch(t){}},face:function(t,e,n){this.__stringBuffer.append("f "+t+" "+e+" "+n+"\n")},faceList:function(){this.__stringBuffer.append("s off \n")},faceWithNormals:function(t,e,n,r,i,o){this.__stringBuffer.append("f "+t+"//"+r+" "+e+"//"+i+" "+n+"//"+o+"\n")},getCurrNormalOffset:function(){return this._numNormalsWritten},getCurrVertexOffset:function(){return this._numVerticesWritten},getOutput:function(){return this.__stringBuffer.toString()},_handleBeginSave:function(){this.numVerticesWritten=0,this.numNormalsWrittern=0,this.__stringBuffer.append("# generated by OBJExport (js) v"+this.VERSION+"\n")},newObject:function(t){this.__stringBuffer.append("o "+t+"\n")},normal:function(t){this.__stringBuffer.append("vn "+t.x+" "+t.y+" "+t.z+"\n"),this._numNormalsWritten++},vertex:function(t){this.__stringBuffer.append("v "+t.x+" "+t.y+" "+t.z+"\n"),this._numVerticesWritten++}},n}),n("toxi/geom/mesh/PlaneSelector",["require","exports","module","../../internals","./VertexSelector"],function(t,e,n){var r=t("../../internals").extend,i=t("./VertexSelector"),o=function(t,e,n,r){i.apply(this,[t]),this.plane=e,this.classifier=n,this.tolerances=void 0===r?1e-4:r};r(o,i),o.prototype.selectVertices=function(){this.clearSelection();for(var t=this.mesh.getVertices(),e=t.length,n=0;e>n;n++){var r=t[n];this.plane.classifyPoint(r,this.tolerance)==this.classifier&&this.selection.add(r)}return this},n.exports=o}),n("toxi/geom/mesh/SphereFunction",["require","../Sphere"],function(t){return t("../Sphere").SphereFunction}),n("toxi/geom/mesh/SphericalHarmonics",["require","exports","module","../../math/mathUtils"],function(t,e,n){var r=t("../../math/mathUtils"),i=function(t){this.m=t};i.prototype={computeVertexFor:function(t,e,n){var i=0;i+=Math.pow(r.sin(this.m[0]*n),this.m[1]),i+=Math.pow(r.cos(this.m[2]*n),this.m[3]),i+=Math.pow(r.sin(this.m[4]*e),this.m[5]),i+=Math.pow(r.cos(this.m[6]*e),this.m[7]);var o=r.sin(n);return t.x=i*o*r.cos(e),t.y=i*r.cos(n),t.z=i*o*r.sin(e),t},getPhiRange:function(){return r.TWO_PI},getPhiResolutionLimit:function(t){return t},getThetaRange:function(){return r.PI},getThetaResolutionLimit:function(t){return t}},n.exports=i}),n("toxi/geom/mesh/SurfaceMeshBuilder",["require","./meshCommon"],function(t){return t("./meshCommon").SurfaceMeshBuilder}),n("toxi/geom/mesh/SuperEllipsoid",["require","exports","module","../../math/mathUtils","./TriangleMesh"],function(t,e,n){var r=t("../../math/mathUtils"),i=(t("./TriangleMesh"),function(t,e){this.p1=t,this.p2=e});i.prototype={computeVertexFor:function(t,e,n){e-=r.HALF_PI;var i=r.cos(e),o=r.cos(n),a=r.sin(e),s=r.sin(n),h=r.sign(i)*Math.pow(r.abs(i),this.p1);return t.x=h*r.sign(o)*Math.pow(Math.abs(o),this.p2),t.y=r.sign(a)*Math.pow(Math.abs(a),this.p1),t.z=h*r.sign(s)*Math.pow(r.abs(s),this.p2),t},getPhiRange:function(){return r.TWO_PI},getPhiResolutionLimit:function(t){return t/2},getThetaRange:function(){return r.TWO_PI},getThetaResolutionLimit:function(t){return t}},n.exports=i}),n("toxi/geom/mesh/Terrain",["require","./meshCommon"],function(t){return t("./meshCommon").Terrain}),n("toxi/geom/mesh/WETriangleMesh",["require","./meshCommon"],function(t){return t("./meshCommon").WETriangleMesh}),n("toxi/geom/mesh",["require","exports","module","./mesh/TriangleMesh","./mesh/BezierPatch","./mesh/BoxSelector","./mesh/DefaultSelector","./mesh/Face","./mesh/OBJWriter","./mesh/PlaneSelector","./mesh/SphereFunction","./mesh/SphericalHarmonics","./mesh/SurfaceMeshBuilder","./mesh/SuperEllipsoid","./mesh/Terrain","./mesh/TriangleMesh","./mesh/Vertex","./mesh/VertexSelector","./mesh/WETriangleMesh"],function(t,e){e.TriangleMesh=t("./mesh/TriangleMesh"),e.BezierPatch=t("./mesh/BezierPatch"),e.BoxSelector=t("./mesh/BoxSelector"),e.DefaultSelector=t("./mesh/DefaultSelector"),e.Face=t("./mesh/Face"),e.OBJWriter=t("./mesh/OBJWriter"),e.PlaneSelector=t("./mesh/PlaneSelector"),e.SphereFunction=t("./mesh/SphereFunction"),e.SphericalHarmonics=t("./mesh/SphericalHarmonics"),e.SurfaceMeshBuilder=t("./mesh/SurfaceMeshBuilder"),e.SuperEllipsoid=t("./mesh/SuperEllipsoid"),e.Terrain=t("./mesh/Terrain"),e.TriangleMesh=t("./mesh/TriangleMesh"),e.Vertex=t("./mesh/Vertex"),e.VertexSelector=t("./mesh/VertexSelector"),e.WETriangleMesh=t("./mesh/WETriangleMesh")}),n("toxi/geom/BernsteinPolynomial",["require","exports","module"],function(t,e,n){var r=function(t){this.resolution=t;for(var e=[],n=[],r=[],i=[],o=0,a=1/(t-1),s=0;t>s;s++){var h=1-o,u=h*h,c=o*o;e[s]=h*u,n[s]=3*o*u,r[s]=3*c*h,i[s]=o*c,o+=a}this.b0=e,this.b1=n,this.b2=r,this.b3=i};n.exports=r}),n("toxi/geom/Ray2D",["require","exports","module","../internals","./Vec2D","./Line2D"],function(t,e,n){var r=t("../internals").extend,i=t("./Vec2D"),o=(t("./Line2D"),function(t,e,n){3==arguments.length?(i.apply(this,[t,e]),this.dir=n.getNormalized()):2==arguments.length?(i.apply(this,[t]),this.dir=e.getNormalized()):0===arguments.length&&(i.apply(this),this.dir=i.Y_AXIS.copy())});r(o,i),o.prototype.getDirection=function(){return this.dir.copy()},o.prototype.getDistanceToPoint=function(t){var e=t.sub(this);return e.distanceTo(this.dir.scale(e.dot(this.dir)))},o.prototype.getPointAtDistance=function(t){return this.add(this.dir.scale(t))},o.prototype.setDirection=function(t){return this.dir.set(t).normalize(),this},o.prototype.toLine2DWithPointAtDistance=function(e){var n=t("./Line2D");return new n(this,this.getPointAtDistance(e))},o.prototype.toString=function(){return"origin: "+i.prototype.toString.apply(this)+" dir: "+this.dir},n.exports=o}),n("toxi/geom/Line2D",["require","exports","module","./Ray2D","../internals"],function(t,e,n){var r=(t("./Ray2D"),t("../internals")),i=function(t,e){this.a=t,this.b=e};i.prototype={closestPointTo:function(t){var e=this.b.sub(this.a),n=t.sub(this.a).dot(e)/e.magSquared();return 0>n?this.a.copy():n>1?this.b.copy():this.a.add(e.scaleSelf(n))},copy:function(){return new i(this.a.copy(),this.b.copy())},equals:function(t){if(this==t)return!0;if(!r.is.Line2D(t))return!1;var e=t;return(this.a.equals(e.a)||this.a.equals(e.b))&&(this.b.equals(e.b)||this.b.equals(e.a))},getDirection:function(){return this.b.sub(this.a).normalize()},getLength:function(){return this.a.distanceTo(this.b)},getLengthSquared:function(){return this.a.distanceToSquared(this.b)},getMidPoint:function(){return this.a.add(this.b).scaleSelf(.5)},getNormal:function(){return this.b.sub(this.a).perpendicular()},getTheta:function(){return this.a.angleBetween(this.b,!0)},hasEndPoint:function(t){return this.a.equals(t)||this.b.equals(t)},intersectLine:function(t){var e,n=(t.b.y-t.a.y)*(this.b.x-this.a.x)-(t.b.x-t.a.x)*(this.b.y-this.a.y),r=(t.b.x-t.a.x)*(this.a.y-t.a.y)-(t.b.y-t.a.y)*(this.a.x-t.a.x),o=(this.b.x-this.a.x)*(this.a.y-t.a.y)-(this.b.y-this.a.y)*(this.a.x-t.a.x);if(0!==n){var a=r/n,s=o/n;e=a>=0&&1>=a&&s>=0&&1>=s?new i.LineIntersection(i.LineIntersection.Type.INTERSECTING,this.a.interpolateTo(this.b,a)):new i.LineIntersection(i.LineIntersection.Type.NON_INTERSECTING,void 0)}else e=0===r&&0===o?new i.LineIntersection(i.LineIntersection.Type.COINCIDENT,void 0):new i.LineIntersection(i.LineIntersection.Type.COINCIDENT,void 0);return e},offsetAndGrowBy:function(t,e,n){var r=this.getMidPoint(),i=this.getDirection(),o=i.getPerpendicular();return void 0!==n&&r.sub(n).dot(o)<0&&o.invert(),o.normalizeTo(t),this.a.addSelf(o),this.b.addSelf(o),i.scaleSelf(e),this.a.subSelf(i),this.b.addSelf(i),this},scale:function(t){var e=.5*(1-t),n=this.a.interpolateTo(this.b,e);return this.b.interpolateToSelf(this.a,e),this.a.set(n),this},set:function(t,e){return this.a=t,this.b=e,this},splitIntoSegments:function(t,e,n){return i.splitIntoSegments(this.a,this.b,e,t,n)},toRay2D:function(){var e=t("./Ray2D");return new e(this.a.copy(),this.b.sub(this.a).normalize())}},i.splitIntoSegments=function(t,e,n,r,i){void 0===r&&(r=[]),i&&r.push(t.copy());var o=t.distanceTo(e);if(o>n)for(var a=t.copy(),s=e.sub(t).limit(n);o>n;)a.addSelf(s),r.push(a.copy()),o-=n;return r.push(e.copy()),r},i.LineIntersection=function(t,e){this.type=t,this.pos=e},i.LineIntersection.prototype={getPos:function(){return this.pos.copy()
},getType:function(){return this.type},toString:function(){return"type: "+this.type+" pos: "+this.pos}},i.LineIntersection.Type={COINCIDENT:0,PARALLEL:1,NON_INTERSECTING:2,INTERSECTING:3},n.exports=i}),n("toxi/geom/Rect",["require","exports","module","../internals","./Vec2D","./Line2D","./Polygon2D"],function(t,e,n){var r=t("../internals"),i=t("../math/mathUtils"),o=t("./Vec2D"),a=t("./Line2D"),s=(t("./Polygon2D"),function(t,e,n,i){if(2==arguments.length){if(!r.has.XY(t))throw new Error("Rect received incorrect parameters");this.x=t.x,this.y=t.y,this.width=e.x-this.x,this.height=e.y-this.y}else if(4==arguments.length)this.x=t,this.y=e,this.width=n,this.height=i;else if(1==arguments.length){var o=arguments[0];r.has.XYWidthHeight(o)&&(this.x=o.x,this.y=o.y,this.width=o.width,this.height=o.height)}else if(arguments.length>0)throw new Error("Rect received incorrect parameters")});s.fromCenterExtent=function(t,e){return new s(t.sub(e),t.add(e))},s.getBoundingRect=function(t){for(var e=t[0],n=new s(e.x,e.y,0,0),r=1,i=t.length;i>r;r++)n.growToContainPoint(t[r]);return n},s.prototype={containsPoint:function(t){var e=t.x,n=t.y;return e<this.x||e>=this.x+this.width?!1:n<this.y||n>=this.y+this.height?!1:!0},copy:function(){return new s(this.x,this.y,this.width,this.height)},getArea:function(){return this.width*this.height},getAspect:function(){return this.width/this.height},getBottom:function(){return this.y+this.height},getBottomRight:function(){return new o(this.x+this.width,this.y+this.height)},getCentroid:function(){return new o(this.x+.5*this.width,this.y+.5*this.height)},getDimensions:function(){return new o(this.width,this.height)},getEdge:function(t){var e;switch(t){case 0:e=new a(new o(this.x,this.y),new o(this.x+this.width,this.y));break;case 1:e=new a(new o(this.x+this.width,this.y),new o(this.x+this.width,this.y+this.height));break;case 2:e=new a(new o(this.x,this.y+this.height),new o(this.x+this.width,this.y+this.height));break;case 3:e=new a(new o(this.x,this.y),new o(this.x,this.y+this.height));break;default:throw new Error("edge ID needs to be 0...3")}return e},getLeft:function(){return this.x},getRight:function(){return this.x+this.width},getTop:function(){return this.y},getTopLeft:function(){return new o(this.x,this.y)},growToContainPoint:function(t){return this.containsPoint(t)||(t.x<this.x?(this.width=this.getRight()-t.x,this.x=t.x):t.x>this.getRight()&&(this.width=t.x-this.x),t.y<this.y?(this.height=this.getBottom()-t.y,this.y=t.y):t.y>this.getBottom()&&(this.height=t.y-this.y)),this},intersectsRay:function(t,e,n){var r=t.getDirection().reciprocal(),i=r.x<0,o=r.y<0,a=this.getTopLeft(),s=this.getBottomRight(),h=i?s:a,u=(h.x-t.x)*r.x;h=i?a:s;var c=(h.x-t.x)*r.x;h=o?s:a;var l=(h.y-t.y)*r.y;h=o?a:s;var f=(h.y-t.y)*r.y;return u>f||l>c?void 0:(l>u&&(u=l),c>f&&(c=f),n>u&&c>e?t.getPointAtDistance(u):void 0)},intersectsRect:function(t){return!(this.x>t.x+t.width||this.x+this.width<t.x||this.y>t.y+t.height||this.y+this.height<t.y)},scale:function(t){var e=this.getCentroid();return this.width*=t,this.height*=t,this.x=e.x-.5*this.width,this.y=e.y-.5*this.height,this},set:function(t,e,n,r){if(-1==arguments.length)this.y=t.y,this.width=t.width,this.height=t.height,this.x=t.x;else{if(4!==arguments.length)throw new Error("Rect set() received wrong parameters");this.x=t,this.y=e,this.width=n,this.height=r}},setDimensions:function(t){return 2==arguments.length&&(t={x:arguments[0],y:arguments[1]}),this.width=t.x,this.height=t.y,this},setPosition:function(t){return this.x=t.x,this.y=t.y,this},toPolygon2D:function(){var e=t("./Polygon2D"),n=new e;return n.add(new o(this.x,this.y)),n.add(new o(this.x+this.width,this.y)),n.add(new o(this.x+this.width,this.y+this.height)),n.add(new o(this.x,this.y+this.height)),n},toString:function(){return"rect: {x: "+this.x+", y: "+this.y+", width: "+this.width+", height: "+this.height+"}"},union:function(t){var e=i.max(this.x+this.width,t.x+t.width);return this.x=i.min(this.x,t.x),this.width=e-this.x,e=i.max(this.y+this.height,t.y+t.height),this.y=i.min(this.y,t.y),this.height=e-this.y,this}},n.exports=s}),n("toxi/geom/Polygon2D",["require","exports","module","./Vec2D","./Line2D","./Circle","./Rect","../internals"],function(t,e,n){var r=t("../internals"),i=t("../math/mathUtils"),o=t("./Vec2D"),a=t("./Circle"),s=(t("./Rect"),t("./Line2D")),h=function(){this.vertices=[];var t,e;if(arguments.length>1)for(t=0,e=arguments.length;e>t;t++)this.add(arguments[t].copy());else if(1==arguments.length){var n=arguments[0];if(r.is.Array(n))for(t=0,e=n.length;e>t;t++)this.add(n[t].copy())}};h.prototype={constructor:h,add:function(t){this.vertices.indexOf(t)<0&&this.vertices.push(t)},center:function(t){for(var e=this.getCentroid(),n=void 0!==t?t.sub(e):e.invert(),r=0,i=this.vertices.length;i>r;r++)this.vertices[r].addSelf(n);return this},containsPoint:function(t){var e=this.vertices.length,n=0,r=e-1,i=!1,o=t.x,a=t.y;for(n=0;e>n;n++){var s=this.vertices[n],h=this.vertices[r];(s.y<a&&h.y>=a||h.y<a&&s.y>=a)&&s.x+(a-s.y)/(h.y-s.y)*(h.x-s.x)<o&&(i=!i),r=n}return i},containsPolygon:function(t){for(var e=0,n=t.vertices.length;n>e;e++)if(!this.containsPoint(t.vertices[e]))return!1;return!0},copy:function(){return new h(this.vertices)},flipVertexOrder:function(){return this.vertices.reverse(),this},get:function(t){return 0>t&&(t+=this.vertices.length),this.vertices[t]},getApothem:function(){return this.vertices[0].interpolateTo(this.vertices[1],.5).distanceTo(this.getCentroid())},getArea:function(){for(var t=0,e=this.vertices.length,n=0;e>n;n++){var r=this.vertices[n],i=this.vertices[(n+1)%e];t+=r.x*i.y,t-=r.y*i.x}return t*=.5},getBoundingCircle:function(){var e=t("./Circle");return e.newBoundingCircle(this.vertices)},getBounds:function(){var e=t("./Rect");return e.getBoundingRect(this.vertices)},getCentroid:function(){for(var t=new o,e=this.vertices.length,n=0;e>n;n++){var r=this.vertices[n],i=this.vertices[(n+1)%e],a=r.x*i.y-i.x*r.y;t.x+=(r.x+i.x)*a,t.y+=(r.y+i.y)*a}return t.scale(1/(6*this.getArea()))},getCircumference:function(){for(var t=0,e=0,n=this.vertices.length;n>e;e++)t+=this.vertices[e].distanceTo(this.vertices[(e+1)%n]);return t},getClosestPointTo:function(t){for(var e,n,r,i=Number.MAX_VALUE,o=this.getEdges(),a=0,s=o.length;s>a;a++)n=o[a].closestPointTo(t),r=n.distanceToSquared(t),i>r&&(e=n,i=r);return e},getClosestVertexTo:function(t){for(var e,n,r=Number.MAX_VALUE,i=0,o=this.vertices.length;o>i;i++)n=this.vertices[i].distanceToSquared(t),r>n&&(e=this.vertices[i],r=n);return e},getEdges:function(){for(var t=this.vertices.length,e=[],n=0;t>n;n++)e[n]=new s(this.vertices[n],this.vertices[(n+1)%t]);return e},getNumPoints:function(){return this.getNumVertices()},getNumVertices:function(){return this.vertices.length},getRandomPoint:function(){for(var t,e=this.getEdges(),n=e.length,r=e[i.random(n)];void 0===t||t.equals(r);)t=e[i.random(n)];var o=r.a.interpolateTo(r.b,Math.random());return o.interpolateToSelf(t.a.interpolateTo(t.b,Math.random()),Math.random())},increaseVertexCount:function(t){for(var e,n,r=this.vertices.length,i=0,o=0,a=0;t>r;){for(i=0,o=0,a=0;r>a;a++)e=this.vertices[a].distanceToSquared(this.vertices[(a+1)%r]),e>o&&(i=a,o=e);n=this.vertices[i].add(this.vertices[(i+1)%r]).scaleSelf(.5),this.vertices.splice(i+1,0,n),r++}return this},intersectsPolygon:function(t){for(var e,n,r,i=s.LineIntersection.Type,o=this.getEdges(),a=t.getEdges(),h=0,u=o.length,c=0,l=a.length;u>h;h++)for(e=o[h],c=0;l>c;c++)if(n=a[c],r=e.intersectLine(n).getType(),r===i.INTERSECTING||r==i.COINCIDENT)return!0;return!1},isClockwise:function(){var t=function(t,e,n){var r=(e.x-t.x)*(n.y-t.y)-(n.x-t.x)*(e.y-t.y);return 0>r};return this.vertices.length>2?t(this.vertices[0],this.vertices[1],this.vertices[2]):!1},intersectsPoly:function(t){if(this.containsPolygon(t))return!0;for(var e=this.getEdges(),n=t.getEdges(),r=0,i=e.length;i>r;r++)for(var o=0,a=n.length,h=e[r];a>o;o++)if(h.intersectLine(n[o]).getType()==s.LineIntersection.Type.INTERSECTING)return!0;return!1},removeDuplicates:function(t){for(var e,n,r,i=t?"equalsWithTolerance":"equals",o=0,a=this.vertices.length;a>o;o++)e=this.vertices[o],e[i](n,t)?(this.vertices.splice(o,1),o--,a--):n=e;return a=this.vertices.length,a>0&&(r=this.vertices[a-1],r[i](this.vertices[0],t)&&this.vertices.splice(a-1,1)),this},rotate:function(t){for(var e=0,n=this.vertices.length;n>e;e++)this.vertices[e].rotate(t)},scale:function(){var t,e;if(1==arguments.length){var n=arguments[0];r.has.XY(n)?(t=n.x,e=n.y):(t=n,e=n)}else{if(2!=arguments.length)throw"Invalid argument(s) passed.";t=arguments[0],e=arguments[1]}for(var i=0,o=this.vertices.length;o>i;i++)this.vertices[i].scaleSelf(t,e);return this},translate:function(){var t,e;if(1==arguments.length&&r.has.XY(arguments[0]))t=arguments[0].x,e=arguments[0].y;else{if(2!=arguments.length)throw"Invalid argument(s) passed.";t=arguments[0],e=arguments[1]}for(var n=0,i=this.vertices.length;i>n;n++)this.vertices[n].addSelf(t,e);return this},smooth:function(t,e){for(var n=this.getCentroid(),r=this.vertices.length,i=[],o=0,a=r-1,s=1;r>o;o++){var h=this.vertices[o],u=this.vertices[a].sub(h).addSelf(this.vertices[s].sub(h)).addSelf(h.sub(n).scaleSelf(e));i.push(h.add(u.scaleSelf(t))),a++,a==r&&(a=0),s++,s==r&&(s=0)}return this.vertices=i,this},toString:function(){for(var t="",e=0;e<this.vertices.length;e++)t+=this.vertices[e],e<this.vertices.length-1&&(t+=", ");return t}},h.fromBaseEdge=function(t,e,n){for(var r,o=-(i.PI-i.PI*(n-2)/n),a=e.sub(t),s=e,u=new h(t,e),c=0;n-1>c;c++)r=s.add(a.getRotated(o*c)),u.add(r),s=r;return u},h.fromEdgeLength=function(t,e){return new a(h.getRadiusForEdgeLength(t,e)).toPolygon2D(e)},h.getRadiusForEdgeLength=function(t,e){return t/(2*i.sin(i.PI/e))},n.exports=h}),n("toxi/geom/Ellipse",["require","exports","module","../internals/extend","../internals/has","../internals/is","../math/mathUtils","./Vec2D","./Polygon2D"],function(t,e,n){{var r,i,o=t("../internals/extend"),a=t("../internals/has"),s=t("../internals/is"),h=t("../math/mathUtils"),u=t("./Vec2D");t("./Polygon2D")}r=function(t,e,n,r){this.radius=new u,0===arguments.length?(u.apply(this,[0,0]),this.setRadii(1,1)):a.XY(t)?(u.apply(this,[t.x,t.y]),a.XY(e)?this.setRadii(e.x,e.y):this.setRadii(e,n)):void 0===r?void 0===n?(u.call(this,0,0),this.setRadii(t,e)):(u.call(this,t,e),this.setRadii(n,n)):(u.call(this,t,e),this.setRadii(n,r))},o(r,u),r.prototype.containsPoint=function(t){var e=this.getFoci();return t.distanceTo(e[0])+t.distanceTo(e[1])<2*h.max(this.radius.x,this.radius.y)},r.prototype.getArea=function(){return h.PI*this.radius.x*this.radius.y},r.prototype.getCircumference=function(){return Math.sqrt(.5*this.radius.magSquared())*h.TWO_PI},r.prototype.getFoci=function(){var t=[];return this.radius.x>this.radius.y?(t[0]=this.sub(this.focus,0),t[1]=this.add(this.focus,0)):(t[0]=this.sub(0,this.focus),t[1]=this.add(0,this.focus)),t},r.prototype.getRadii=function(){return this.radius.copy()},r.prototype.setRadii=function(t,e){return a.XY(t)&&(e=t.y,t=t.x),this.radius.set(t,e),this.focus=this.radius.magnitude(),this},r.prototype.toPolygon2D=function(e){for(var n=t("./Polygon2D"),r=new n,i=h.TWO_PI/e,o=0;e>o;o++){var a=u.fromTheta(o*i).scaleSelf(this.radius).addSelf(this);r.add(a)}return r},e=n.exports=r,i=function(t,e,n){1==arguments.length?s.Circle(t)?r.apply(this,[t,t.radius.x]):r.apply(this,[0,0,t]):2==arguments.length?r.apply(this,[t,e]):r.apply(this,[t,e,n,n])},o(i,r),i.from2Points=function(t,e){var n=t.interpolateTo(e,.5),r=n.distanceTo(t);return new i(n,r)},i.from3Points=function(t,e,n){var r,o,a,s=e.sub(t),c=n.sub(e);if(h.abs(s.x)<=1e-7&&h.abs(c.y)<=1e-7)o=new u(e.x+n.x,t.y+e.y).scaleSelf(.5),a=o.distanceTo(t),r=new i(o,a);else{var l=s.y/s.x,f=c.y/c.x;if(h.abs(l-f)>1e-7&&0!==l){var p=(l*f*(t.y-n.y)+f*(t.x+e.x)-l*(e.x+n.x))/(2*(f-l)),d=-(p-(t.x+e.x)/2)/l+(t.y+e.y)/2;o=new u(p,d),a=o.distanceTo(t),r=new i(o,a)}}return r},i.newBoundingCircle=function(t){for(var e=new u,n=0,r=0,o=t.length;o>r;r++)e.addSelf(t[r]);for(e.scaleSelf(1/t.length),r=0;o>r;r++){var a=e.distanceToSquared(t[r]);a>n&&(n=a)}return new i(e,Math.sqrt(n))},i.prototype.containsPoint=function(t){return this.distanceToSquared(t)<=this.radius.x*this.radius.x},i.prototype.getCircumference=function(){return h.TWO_PI*this.radius.x},i.prototype.getRadius=function(){return this.radius.x},i.prototype.getTangentPoints=function(t){var e=this.interpolateTo(t,.5);return this.intersectsCircle(new i(e,e.distanceTo(t)))},i.prototype.intersectsCircle=function(t){var e,n=t.sub(this),r=n.magnitude(),i=this.radius.x,o=t.radius.x;if(i+o>=r&&r>=Math.abs(i-o)){var a=(i*i-o*o+r*r)/(2*r);r=1/r;var s=this.add(n.scale(a*r)),h=Math.sqrt(i*i-a*a);n.perpendicular().scaleSelf(h*r);var u=s.add(n),c=s.sub(n);e=[u,c]}return e},i.prototype.setRadius=function(t){return this.setRadii(t,t),this},e.Circle=i}),n("toxi/geom/Circle",["require","exports","module","./Ellipse"],function(t,e,n){n.exports=t("./Ellipse").Circle}),n("toxi/geom/CircleIntersector",["require","exports","module"],function(t,e,n){var r=function(t){this.circle=t,this.isec=void 0};r.prototype={getIntersectionData:function(){return this.isec},intersectsRay:function(t){this.isec.clear();var e=circle.sub(t),n=e.magSquared(),r=e.dot(t.getDirection()),i=circle.getRadius(),o=i*i-(n-r*r);return o>=0&&(this.isec.isIntersection=!0,this.isec.dist=r-Math.sqrt(o),this.isec.pos=t.getPointAtDistance(isec.dist),this.isec.normal=this.isec.pos.sub(this.circle).normalize()),this.isec.isIntersection}},n.exports=r}),n("toxi/geom/Cone",["require","exports","module","../internals","./Vec3D","./mesh/TriangleMesh"],function(t,e,n){function r(t){throw Error("Missing parameter: "+t)}var i=t("../internals").extend,o=t("./Vec3D"),a=t("./mesh/TriangleMesh"),s=function(t,e,n,i,a){function s(t,e,n,r,i){o.apply(h,[t]),h.dir=e.getNormalized(),h.radiusNorth=n,h.radiusSouth=r,h.length=i}var h=this;"object"==typeof t&&1===arguments.length?s(t.pos||t.position||new o,t.dir||t.direction||r("direction"),t.rNorth||t.radiusNorth||r("radiusNorth"),t.rSouth||t.radiusSouth||r("radiusSouth"),t.len||t.length||r("length")):s(t,e,n,i,a)};i(s,o),s.prototype.toMesh=function(){var t={mesh:void 0,steps:0/0,thetaOffset:0,topClosed:!0,bottomClosed:!0};if(1==arguments.length)if("object"==typeof arguments[0]){var e=arguments[0];t.mesh=e.mesh,t.steps=e.steps||e.resolution||e.res,t.thetaOffset=e.thetaOffset||t.thetaOffset,t.topClosed=e.topClosed||t.topClosed,t.bottomClosed=e.bottomClosed||t.bottomClosed}else t.steps=arguments[0];else 2==arguments.length?(t.steps=arguments[0],t.thetaOffset=arguments[1]):5==arguments.length&&(t.mesh=arguments[0],t.steps=arguments[1],t.thetaOffset=arguments[2],t.topClosed=arguments[3],t.bottomClosed=arguments[4]);var n=this.add(.01,.01,.01),r=n.cross(this.dir.getNormalized()).normalize(),i=this.dir.scale(.5*this.length),o=this.sub(i),s=this.add(i),h=[],u=[],c=2*Math.PI/t.steps,l=0,f=1;for(l=0;l<t.steps;l++){var p=l*c+t.thetaOffset,d=r.getRotatedAroundAxis(this.dir,p);h[l]=d.scale(this.radiusSouth).addSelf(o),u[l]=d.scale(this.radiusNorth).addSelf(s)}var m=2*t.steps+2,g=2*t.steps+(t.topClosed?t.steps:0)+(t.bottomClosed?t.steps:0),v=t.mesh||new a("cone",m,g);for(l=0;l<t.steps;l++,f++)f==t.steps&&(f=0),v.addFace(h[l],u[l],h[f],void 0,void 0,void 0,void 0),v.addFace(h[f],u[l],u[f],void 0,void 0,void 0,void 0),t.bottomClosed&&v.addFace(o,h[l],h[f],void 0,void 0,void 0,void 0),t.topClosed&&v.addFace(u[l],s,u[f],void 0,void 0,void 0,void 0);return v},n.exports=s}),n("toxi/geom/IsectData2D",["require","exports","module","./Vec2D"],function(t,e,n){var r=t("./Vec2D"),i=function(t){void 0!==t?(this.isIntersection=t.isIntersection,this.dist=t.dist,this.pos=t.pos.copy(),this.dir=t.dir.copy(),this.normal=t.normal.copy()):this.clear()};i.prototype={clear:function(){this.isIntersection=!1,this.dist=0,this.pos=new r,this.dir=new r,this.normal=new r},toString:function(){var t="isec: "+this.isIntersection;return this.isIntersection&&(t+=" at:"+this.pos+" dist:"+this.dist+" normal:"+this.normal),t}},n.exports=i}),n("toxi/geom/LineStrip3D",["require","exports","module","./vectors","./Line3D","../internals/has","../internals/Iterator"],function(t,e,n){var r=t("./vectors").Vec3D,i=t("./Line3D"),o=t("../internals/has").XYZ,a=t("../internals/Iterator"),s=function(t){this.vertices=t||[]};s.prototype={constructor:s,add:function(t,e,n){return this.vertices.push(o(t)?new r(t):new r(t,e,n)),this},get:function(t){return 0>t&&(t+=this.vertices.length),this.vertices[t]},getDecimatedVertices:function(t,e){e!==!1&&(e=!0);var n=[];if(this.vertices.length<3){if(2!==this.vertices.length)return;new i(this.vertices[0],this.vertices[1]).splitIntoSegments(n,t,!0),e||n.pop()}var r,o,a,s,h,u,c=this.getEstimatedArcLength(),l=t/c,f=0;for(o=0;1>o;o+=l){for(r=o*c;r>=this.arcLenIndex[f];)f++;a=this.get(f-1),s=this.get(f),h=(r-this.arcLenIndex[f-1])/(this.arcLenIndex[f]-this.arcLenIndex[f-1]),u=a.interpolateTo(s,h),n.push(u)}return e&&n.push(this.get(-1).copy()),n},getEstimatedArcLength:function(){(void 0===this.arcLenIndex||this.arcLenIndex.length!==this.vertices.length)&&(this.arcLenIndex=[0]);for(var t,e,n=0,r=1,i=this.vertices.length;i>r;r++)t=this.vertices[r-1],e=this.vertices[r],n+=t.distanceTo(e),this.arcLenIndex[r]=n;return n},getSegments:function(){for(var t=1,e=this.vertices.length,n=[];e>t;t++)n.push(new i(this.get(t-1),this.get(t)));return n},getVertices:function(){return vertices},iterator:function(){return new a(this.vertices)},setVertices:function(t){this.vertices=t}},n.exports=s}),n("toxi/geom/Plane",["require","exports","module","../internals","../math/mathUtils","./Ray3D","./Vec3D","./mesh/TriangleMesh"],function(t,e,n){var r=t("../internals").extend,i=t("../math/mathUtils"),o=t("./Ray3D"),a=t("./Vec3D"),s=t("./mesh/TriangleMesh"),h=function(){var t,e;0===arguments.length?(t=new a,e=a.Y_AXIS.copy()):1==arguments.length?(t=arguments[0].computeCentroid(),e=arguments[0].computeNormal()):(t=arguments[0],e=arguments[1].getNormalized()),a.apply(this,[t]),this.normal=e};r(h,a),h.Classifier={FRONT:"front",BACK:"back",ON_PLANE:"on plane"},h.XY=new h(new a,a.Z_AXIS),h.XZ=new h(new a,a.Y_AXIS),h.YZ=new h(new a,a.X_AXIS),h.prototype.classifyPoint=function(t,e){var n=this.sub(t).normalize().dot(this.normal);return-e>n?h.Classifier.FRONT:n>e?h.Classifier.BACK:h.Classifier.ON_PLANE},h.prototype.containsPoint=function(t){return this.classifyPoint(t,i.EPS)==h.Classifier.ON_PLANE},h.prototype.getDistanceToPoint=function(t){var e=this.normal.dot(t.sub(this)),n=this.normal.magSquared(),r=t.add(this.normal.scale(e/n));return r.distanceTo(t)},h.prototype.getIntersectionWithRay=function(t){var e,n=this.normal.dot(t.getDirection());return n>i.EPS?(e=this.normal.dot(this.sub(t))/n,t.getPointAtDistance(e)):void 0},h.prototype.getProjectedPoint=function(t){var e,n;return e=this.normal.dot(this.sub(t))<0?this.normal.getInverted():this.normal,n=new o(t,e).getPointAtDistance(this.getDistanceToPoint(t))},h.prototype.intersectRayDistance=function(t){var e=this.normal.dot(this),n=this.normal.dot(t)+e,r=this.normal.dot(t.dir);return i.abs(r)<i.EPS?-1:-(n/r)},h.prototype.toMesh=function(t,e){var n,r,t,e;1==arguments.length?(n=t,r=new s("plane",4,2)):(r=t,n=e)},n.exports=h}),n("toxi/geom/Ray3DIntersector",["require","exports","module","./IsectData3D","../math/mathUtils"],function(t,e,n){var r=t("./IsectData3D"),i=t("../math/mathUtils");Ray3DIntersector=function(t){this.ray=t,this.isec=new r},Ray3DIntersector.prototype={getIntersectionData:function(){return this.isec},intersectsRay:function(t){var e,n=this.ray.dir.cross(t.dir),r=this.ray.sub(t),o=i.abs(n.x),a=i.abs(n.y),s=i.abs(n.z);return e=s>o&&s>a?(r.x*t.dir.y-r.y*t.dir.x)/n.z:o>a?(r.y*t.dir.z-r.z*t.dir.y)/n.x:(r.z*t.dir.x-r.x*t.dir.z)/n.y,this.isec.isIntersection=e<=i.EPS&&!isFinite(e),this.isec.pos=this.ray.getPointAtDistance(-e),this.isec.isIntersection}},n.exports=Ray3DIntersector}),n("toxi/geom/Spline2D",["./Vec2D","../internals/is","./BernsteinPolynomial"],function(t,e,n){var r=function(n,i,o){1===arguments.length&&!e.Array(n)&&e.Object(n)&&(i=i||n.bernsteinPoly,o=o||n.tightness,n=n.points);var a,s=0;if(this.pointList=[],"number"!=typeof o&&(o=r.DEFAULT_TIGHTNESS),this.setTightness(o),this.bernstein=i,void 0!==n)for(s=0,a=n.length;a>s;s++)this.add(n[s].copy());for(this.coeffA=[],this.delta=[],this.bi=[],s=0;s<this.numP;s++)this.coeffA[s]=new t,this.delta[s]=new t,this.bi[s]=0;this.bi=[]};return r.prototype={add:function(t){return this.pointList.push(t.copy()),this.numP=this.pointList.length,this},computeVertices:function(e){this.updateCoefficients(),1>e&&(e=1),e++,(void 0===this.bernstein||this.bernstein.resolution!=e)&&(this.bernstein=new n(e));var r=this.bernstein;this.vertices=[],this.findCPoints();var i=new t,o=new t;e--;for(var a=0;a<this.numP-1;a++){var s=this.points[a],h=this.points[a+1];i.set(this.delta[a]).addSelf(s),o.set(h).subSelf(this.delta[a+1]);for(var u=0;e>u;u++){var c=s.x*r.b0[u]+i.x*r.b1[u]+o.x*r.b2[u]+h.x*r.b3[u],l=s.y*r.b0[u]+i.y*r.b1[u]+o.y*r.b2[u]+h.y*r.b3[u];this.vertices.push(new t(c,l))}}return this.vertices.push(this.points[this.points.length-1].copy()),this.vertices},findCPoints:function(){this.bi[1]=-.25;var t,e,n,r;for(e=this.pointList[0],n=this.pointList[2],r=this.delta[0],this.coeffA[1].set((n.x-e.x-r.x)*this.tightness,(n.y-e.y-r.y)*this.tightness),t=2;t<this.numP-1;t++)this.bi[t]=-1/(this.invTightness+this.bi[t-1]),this.coeffA[t].set(-(this.points[t+1].x-this.points[t-1].x-this.coeffA[t-1].x)*this.bi[t],-(this.points[t+1].y-this.points[t-1].y-this.coeffA[t-1].y)*this.bi[t]);for(t=this.numP-2;t>0;t--)this.delta[t].set(this.coeffA[t].x+this.delta[t+1].x*this.bi[t],this.coeffA[t].y+this.delta[t+1].y*this.bi[t])},getDecimatedVertices:function(t,e){void 0===e&&(e=!0),(void 0===this.vertices||this.vertices.length<2)&&this.computeVertices(r.DEFAULT_RES);for(var n=this.getEstimatedArcLength(),i=[],o=t/n,a=0,s=0;1>s;s+=o){for(var h=s*n;h>=this.arcLenIndex[a];)a++;var u=this.vertices[a-1],c=this.vertices[a],l=(h-this.arcLenIndex[a-1])/(this.arcLenIndex[a]-this.arcLenIndex[a-1]),f=u.interpolateTo(c,l);this.uniform.push(f)}return e&&i.push(this.vertices[this.vertices.length-1]),i},getEstimatedArcLength:function(){(void 0===this.arcLenIndex||void 0!==this.arcLenIndex&&this.arcLenIndex.length!=this.vertices.length)&&(this.arcLenIndex=[]);for(var t=0,e=1;e<this.arcLenIndex.length;e++){var n=this.vertices[e-1],r=this.vertices[e];t+=n.distanceTo(r),this.arcLenIndex[e]=t}return t},getNumPoints:function(){return this.numP},getPointList:function(){return this.pointList},getTightness:function(){return this.tightness},setPointList:function(t){return this.pointList=t.slice(0),this},setTightness:function(t){return this.tightness=t,this.invTightness=1/this.tightness,this},updateCoefficients:function(){if(this.numP=this.pointList.length,void 0===this.points||void 0!==this.points&&this.points.length!=this.numP){this.coeffA=[],this.delta=[],this.bi=[];for(var e=0;e<this.numP;e++)this.coeffA[e]=new t,this.delta[e]=new t;this.setTightness(this.tightness)}this.points=this.pointList.slice(0)}},r.DEFAULT_TIGHTNESS=.25,r.DEFAULT_RES=16,r}),n("toxi/geom/Spline3D",["./Vec3D","../internals/is","./BernsteinPolynomial"],function(t,e,n){var r=function(n,i,o){1===arguments.length&&!e.Array(n)&&e.Object(n)&&(i=i||n.bernsteinPoly,o=o||n.tightness,n=n.points);var a,s=0;if(this.pointList=[],"number"!=typeof o&&(o=r.DEFAULT_TIGHTNESS),this.setTightness(o),this.bernstein=i,void 0!==n)for(s=0,a=n.length;a>s;s++)this.add(n[s].copy());for(this.coeffA=[],this.delta=[],this.bi=[],s=0;s<this.numP;s++)this.coeffA[s]=new t,this.delta[s]=new t,this.bi[s]=0;this.bi=[]};return r.prototype={add:function(t){return this.pointList.push(t.copy()),this.numP=this.pointList.length,this},computeVertices:function(e){this.updateCoefficients(),1>e&&(e=1),e++,(void 0===this.bernstein||this.bernstein.resolution!=e)&&(this.bernstein=new n(e));var r=this.bernstein;this.vertices=[],this.findCPoints();var i=new t,o=new t;e--;for(var a=0;a<this.numP-1;a++){var s=this.points[a],h=this.points[a+1];i.set(this.delta[a]).addSelf(s),o.set(h).subSelf(this.delta[a+1]);for(var u=0;e>u;u++){var c=s.x*r.b0[u]+i.x*r.b1[u]+o.x*r.b2[u]+h.x*r.b3[u],l=s.y*r.b0[u]+i.y*r.b1[u]+o.y*r.b2[u]+h.y*r.b3[u],f=s.z*r.b0[u]+i.z*r.b1[u]+o.z*r.b2[u]+h.z*r.b3[u];this.vertices.push(new t(c,l,f))}}return this.vertices.push(this.points[this.points.length-1].copy()),this.vertices},findCPoints:function(){this.bi[1]=-.25;var t,e,n,r;for(e=this.pointList[0],n=this.pointList[2],r=this.delta[0],this.coeffA[1].set((n.x-e.x-r.x)*this.tightness,(n.y-e.y-r.y)*this.tightness,(n.z-e.z-r.z)*this.tightness),t=2;t<this.numP-1;t++)this.bi[t]=-1/(this.invTightness+this.bi[t-1]),this.coeffA[t].set(-(this.points[t+1].x-this.points[t-1].x-this.coeffA[t-1].x)*this.bi[t],-(this.points[t+1].y-this.points[t-1].y-this.coeffA[t-1].y)*this.bi[t],-(this.points[t+1].z-this.points[t-1].z-this.coeffA[t-1].z)*this.bi[t]);for(t=this.numP-2;t>0;t--)this.delta[t].set(this.coeffA[t].x+this.delta[t+1].x*this.bi[t],this.coeffA[t].y+this.delta[t+1].y*this.bi[t],this.coeffA[t].z+this.delta[t+1].z*this.bi[t])},getDecimatedVertices:function(t,e){void 0===e&&(e=!0),(void 0===this.vertices||this.vertices.length<2)&&this.computeVertices(r.DEFAULT_RES);for(var n=this.getEstimatedArcLength(),i=[],o=t/n,a=0,s=0;1>s;s+=o){for(var h=s*n;h>=this.arcLenIndex[a];)a++;var u=this.vertices[a-1],c=this.vertices[a],l=(h-this.arcLenIndex[a-1])/(this.arcLenIndex[a]-this.arcLenIndex[a-1]),f=u.interpolateTo(c,l);this.uniform.push(f)}return e&&i.push(this.vertices[this.vertices.length-1]),i},getEstimatedArcLength:function(){(void 0===this.arcLenIndex||void 0!==this.arcLenIndex&&this.arcLenIndex.length!=this.vertices.length)&&(this.arcLenIndex=[]);for(var t=0,e=1;e<this.arcLenIndex.length;e++){var n=this.vertices[e-1],r=this.vertices[e];t+=n.distanceTo(r),this.arcLenIndex[e]=t}return t},getNumPoints:function(){return this.numP},getPointList:function(){return this.pointList},getTightness:function(){return this.tightness},setPointList:function(t){return this.pointList=t.slice(0),this},setTightness:function(t){return this.tightness=t,this.invTightness=1/this.tightness,this},updateCoefficients:function(){if(this.numP=this.pointList.length,void 0===this.points||void 0!==this.points&&this.points.length!=this.numP){this.coeffA=[],this.delta=[],this.bi=[];for(var e=0;e<this.numP;e++)this.coeffA[e]=new t,this.delta[e]=new t;this.setTightness(this.tightness)}this.points=this.pointList.slice(0)}},r.DEFAULT_TIGHTNESS=.25,r.DEFAULT_RES=16,r}),n("toxi/geom/SutherlandHodgemanClipper",["require","exports","module","./Polygon2D","./vectors"],function(t,e,n){var r=t("./Polygon2D"),i=t("./vectors").Vec2D,o={0:function(t,e,n){var r=e.x+(t.y-e.y)*(n.x-e.x)/(n.y-e.y);return new i(r,t.y)},1:function(t,e,n){var r=t.x+t.width,o=e.y+(r-e.x)*(n.y-e.y)/(n.x-e.x);return new i(r,o)},2:function(t,e,n){var r=t.y+t.height,o=e.x+(r-e.y)*(n.x-e.x)/(n.y-e.y);return new i(o,r)},3:function(t,e,n){var r=e.y+(t.x-e.x)*(n.y-e.y)/(n.x-e.x);return new i(t.x,r)}},a=function(t,e,n,r){return o[e](t,n,r)},s={0:function(t,e){return e.y>=t.y},1:function(t,e){return e.x<t.x+t.width},2:function(t,e){return e.y<t.y+t.height},3:function(t,e){return e.x>=t.x}},h=function(t,e,n){return s[n](t,e)},u=function(t){this.bounds=t};u.prototype={constructor:u,clipPolygon:function(t){var e,n,i,o=t.vertices.slice(0),s=0,u=0,c=o.length-1;for(o.push(o[0]);4>s;s++){for(u=0,c=o.length-1,e=[];c>u;u++)n=o[u],i=o[u+1],h(this.bounds,n,s)?e.push(h(this.bounds,i,s)?i.copy():a(this.bounds,s,n,i)):h(this.bounds,i,s)&&(e.push(a(this.bounds,s,n,i)),e.push(i.copy()));e.length>0&&e[0]!==e[e.length-1]&&e.push(e[0]),o=e}return new r(o).removeDuplicates(.001)},getBounds:function(){return this.bounds},isKnownVertex:function(t,e){for(var n=0,r=t.length;r>n;n++)if(t[n].equalsWithTolerance(e,1e-4))return!0;return!1},setBounds:function(t){this.bounds=t}},n.exports=u}),n("toxi/geom/Triangle2D",["require","exports","module","./Vec2D","./Line2D","./Rect","./Circle","./Polygon2D","../math/mathUtils"],function(t,e,n){var r=t("./Vec2D"),i=t("./Line2D"),o=t("./Rect"),a=t("./Circle"),s=t("./Polygon2D"),h=t("../math/mathUtils"),u=function(t,e,n){3===arguments.length&&(this.a=t.copy(),this.b=e.copy(),this.c=n.copy())};u.createEquilateralFrom=function(t,e){var n=t.interpolateTo(e,.5),r=t.sub(e),i=r.getPerpendicular();return n.addSelf(i.normalizeTo(r.magnitude()*h.SQRT3/2)),new u(t,e,n)},u.isClockwise=function(t,e,n){var r=(e.x-t.x)*(n.y-t.y)-(n.x-t.x)*(e.y-t.y);return 0>r},u.prototype={adjustTriangleSizeBy:function(t,e,n){1==arguments.length&&(e=t,n=t),this.computeCentroid();var r=new i(this.a.copy(),this.b.copy()).offsetAndGrowBy(t,1e5,this.centroid),o=new i(this.b.copy(),this.c.copy()).offsetAndGrowBy(e,1e5,this.centroid),a=new i(this.c.copy(),this.a.copy()).offsetAndGrowBy(n,1e5,this.centroid);return this.a=r.intersectLine(a).getPos(),this.b=r.intersectLine(o).getPos(),this.c=o.intersectLine(a).getPos(),this.computeCentroid(),this},computeCentroid:function(){return this.centroid=this.a.add(this.b).addSelf(this.c).scaleSelf(1/3),this.centroid},containsPoint:function(t){var e=t.sub(this.a).normalize(),n=t.sub(this.b).normalize(),r=t.sub(this.c).normalize(),i=Math.acos(e.dot(n));return i+=Math.acos(n.dot(r)),i+=Math.acos(r.dot(e)),h.abs(i-h.TWO_PI)<=.01},copy:function(){return new u(this.a.copy(),this.b.copy(),this.c.copy())},flipVertexOrder:function(){var t=this.a;return this.a=this.c,this.c=t,this},getArea:function(){return.5*this.b.sub(this.a).cross(this.c.sub(this.a))},getBounds:function(){return new o(r.min(r.min(this.a,this.b),this.c),r.max(r.max(this.a,this.b),this.c))},getCircumCircle:function(){var t=this.a.bisect(this.b).cross(this.b.bisect(this.c)),e=new r(t.x/t.z,t.y/t.z),n=this.a.distanceTo(this.b),i=this.b.distanceTo(this.c),o=this.c.distanceTo(this.a),s=n*i*o/Math.sqrt((n+i+o)*(-n+i+o)*(n-i+o)*(n+i-o));return new a(e,s)},getCircumference:function(){return this.a.distanceTo(this.b)+this.b.distanceTo(this.c)+this.c.distanceTo(this.a)},getClosestPointTo:function(t){var e=new i(this.a,this.b),n=e.closestPointTo(t),r=e.set(this.b,this.c).closestPointTo(t),o=e.set(this.c,this.a).closestPointTo(t),a=t.sub(n).magSquared(),s=t.sub(r).magSquared(),h=t.sub(o).magSquared(),u=a,c=n;return u>s&&(u=s,c=r),u>h&&(c=o),c},intersectsTriangle:function(t){if(this.containsPoint(t.a)||this.containsPoint(t.b)||this.containsPoint(t.c))return!0;if(t.containsPoint(this.a)||t.containsPoint(this.b)||t.containsPoint(this.c))return!0;for(var e=[new i(this.a,this.b),new i(this.b,this.c),new i(this.c,this.a)],n=[new i(t.a,t.b),new i(t.b,t.c),new i(t.c,t.a)],r=0,o=e.length;o>r;r++)for(var a=e[r],s=0,h=n.length;h>s;s++){var u=n[s],c=a.intersectLine(u).getType();if(c!=i.LineIntersection.Type.NON_INTERSECTING&&c!=i.LineIntersection.Type.PARALLEL)return!0}return!1},isClockwise:function(){return u.isClockwise(this.a,this.b,this.c)},set:function(t,e,n){this.a=t,this.b=e,this.c=n},toPolygon2D:function(){var t=new s;return t.add(this.a.copy()),t.add(this.b.copy()),t.add(this.c.copy()),t},toString:function(){return"Triangle2D: "+this.a+","+this.b+","+this.c}},n.exports=u}),n("toxi/geom/AxisAlignedCylinder",["require","exports","module","./Cone"],function(t,e,n){var r=t("./Cone"),i=function(t,e,n){this.pos=void 0===t?void 0:t.copy(),this.setRadius(e),this.setLength(n)};i.prototype={containsPoint:function(){throw Error("AxisAlignedCylinder.containsPoint(): not implmented")},getLength:function(){return this.length},getMajorAxis:function(){throw Error("AxisAlignedCylinder.getMajorAxis(): not implemented")},getPosition:function(){return this.pos.copy()},getRadius:function(){return this.radius},setLength:function(t){this.length=t},setPosition:function(t){this.pos.set(t)},setRadius:function(t){this.radius=t,this.radiusSquared=t*t},toMesh:function(){var t={mesh:void 0,steps:12,thetaOffset:0};if(1==arguments.length&&"object"==typeof arguments[0])for(var e in arguments[0])t[e]=arguments[0][e];else 2==arguments.length&&(t.steps=arguments[0],t.thetaOffset=arguments[1]);
var n=new r(this.pos,this.getMajorAxis().getVector(),this.radius,this.radius,this.length);return n.toMesh(t.mesh,t.steps,t.thetaOffset,!0,!0)}},n.exports=i}),n("toxi/geom/XAxisCylinder",["require","exports","module","../internals","../math/mathUtils","./Vec3D","./AxisAlignedCylinder"],function(t,e,n){var r=t("../internals").extend,i=t("../math/mathUtils"),o=t("./Vec3D"),a=t("./AxisAlignedCylinder"),s=function(t,e,n){a.apply(this,[t,e,n])};r(s,a),s.prototype.containsPoint=function(t){if(i.abs(t.x-this.pos.x)<.5*this.length){var e=t.y-this.pos.y,n=t.z-this.pos.z;if(Math.abs(n*n+e*e)<this.radiusSquared)return!0}return!1},s.prototype.getMajorAxis=function(){return o.Axis.X},n.exports=s}),n("toxi/geom/YAxisCylinder",["require","exports","module","../internals","../math/mathUtils","./Vec3D","./AxisAlignedCylinder"],function(t,e,n){var r=t("../internals").extend,i=t("../math/mathUtils"),o=t("./Vec3D"),a=t("./AxisAlignedCylinder"),s=function(t,e,n){a.apply(this,[t,e,n])};r(s,a),s.prototype.containsPoint=function(t){if(i.abs(t.y-this.pos.y)<.5*this.length){var e=t.x-this.pos.x,n=t.z-this.pos.z;if(Math.abs(n*n+e*e)<this.radiusSquared)return!0}return!1},s.prototype.getMajorAxis=function(){return o.Axis.Y},n.exports=s}),n("toxi/geom/ZAxisCylinder",["require","exports","module","../internals","../math/mathUtils","./Vec3D","./AxisAlignedCylinder"],function(t,e,n){var r=t("../internals").extend,i=t("../math/mathUtils"),o=t("./Vec3D"),a=t("./AxisAlignedCylinder"),s=function(t,e,n){a.apply(this,[t,e,n])};r(s,a),s.prototype.containsPoint=function(t){if(i.abs(t.z-this.pos.z)<.5*this.length){var e=t.x-this.pos.x,n=t.y-this.pos.y;if(Math.abs(e*e+n*n)<this.radiusSquared)return!0}return!1},s.prototype.getMajorAxis=function(){return o.Axis.Z},n.exports=s}),n("toxi/geom",["require","exports","./geom/mesh","./geom/AABB","./geom/BernsteinPolynomial","./geom/Circle","./geom/CircleIntersector","./geom/Cone","./geom/Ellipse","./geom/IsectData2D","./geom/IsectData3D","./geom/Line2D","./geom/Line3D","./geom/LineStrip3D","./geom/Matrix4x4","./geom/Plane","./geom/Polygon2D","./geom/Quaternion","./geom/Ray2D","./geom/Ray3D","./geom/Ray3DIntersector","./geom/Rect","./geom/Sphere","./geom/Spline2D","./geom/Spline3D","./geom/SutherlandHodgemanClipper","./geom/Triangle2D","./geom/Triangle3D","./geom/Vec2D","./geom/Vec3D","./geom/XAxisCylinder","./geom/YAxisCylinder","./geom/ZAxisCylinder"],function(t,e){e.AABB=t("./geom/AABB"),e.mesh=t("./geom/mesh"),e.BernsteinPolynomial=t("./geom/BernsteinPolynomial"),e.Circle=t("./geom/Circle"),e.CircleIntersector=t("./geom/CircleIntersector"),e.Cone=t("./geom/Cone"),e.Ellipse=t("./geom/Ellipse"),e.IsectData2D=t("./geom/IsectData2D"),e.IsectData3D=t("./geom/IsectData3D"),e.Line2D=t("./geom/Line2D"),e.Line3D=t("./geom/Line3D"),e.LineStrip3D=t("./geom/LineStrip3D"),e.Matrix4x4=t("./geom/Matrix4x4"),e.Plane=t("./geom/Plane"),e.Polygon2D=t("./geom/Polygon2D"),e.Quaternion=t("./geom/Quaternion"),e.Ray2D=t("./geom/Ray2D"),e.Ray3D=t("./geom/Ray3D"),e.Ray3DIntersector=t("./geom/Ray3DIntersector"),e.Rect=t("./geom/Rect"),e.Sphere=t("./geom/Sphere"),e.Spline2D=t("./geom/Spline2D"),e.Spline3D=t("./geom/Spline3D"),e.SutherlandHodgemanClipper=t("./geom/SutherlandHodgemanClipper"),e.Triangle2D=t("./geom/Triangle2D"),e.Triangle3D=t("./geom/Triangle3D"),e.Vec2D=t("./geom/Vec2D"),e.Vec3D=t("./geom/Vec3D"),e.XAxisCylinder=t("./geom/XAxisCylinder"),e.YAxisCylinder=t("./geom/YAxisCylinder"),e.ZAxisCylinder=t("./geom/ZAxisCylinder")}),n("toxi/math/BezierInterpolation",[],function(){var t=function(t,e){this.c1=t,this.c2=e};return t.interpolate=function(t,e,n,r,i){var o=n*n,a=1-n,s=a*a;return t*s*a+3*(r*(e-t)+t)*n*s+3*(i*(e-t)+e)*o*a+e*o*n},t.prototype={interpolate:function(t,e,n){var r=n*n,i=1-n,o=i*i;return t*o*i+3*(this.c1*(e-t)+t)*n*o+3*(this.c2*(e-t)+e)*r*i+e*r*n},setCoefficients:function(t,e){this.c1=t,this.c2=e}},t}),n("toxi/math/CircularInterpolation",[],function(){var t=function(t){void 0===t&&(this.isFlipped=!1)};return t.interpolate=function(t,e,n,r){return r?t-(e-t)*(Math.sqrt(1-n*n)-1):(n=1-n,t+(e-t)*Math.sqrt(1-n*n))},t.prototype.interpolate=function(t,e,n){return this.isFlipped?t-(e-t)*(Math.sqrt(1-n*n)-1):(n=1-n,t+(e-t)*Math.sqrt(1-n*n))},t.prototype.setFlipped=function(t){this.isFlipped=t},t}),n("toxi/math/CosineInterpolation",[],function(){var t=function(){};return t.interpolate=function(t,e,n){return e+(t-e)*(.5+.5*Math.cos(n*Math.PI))},t.prototype.interpolate=t.interpolate,t}),n("toxi/math/DecimatedInterpolation",["./LinearInterpolation"],function(t){var e=function(e,n){if(void 0===e)throw new Error("steps was not passed to constructor");this.numSteps=e,this.strategy=n||new t};return e.prototype={interpolate:function(t,e,n){var r=Math.floor(n*this.numSteps)/this.numSteps;return this.strategy.interpolate(t,e,r)}},e}),n("toxi/math/ExponentialInterpolation",[],function(){var t=function(t){this.exponent=void 0===t?2:t};return t.interpolate=function(t,e,n,r){return t+(e-t)*Math.pow(n,r)},t.prototype.interpolate=function(t,e,n){return t+(e-t)*Math.pow(n,this.exponent)},t}),n("toxi/math/SigmoidInterpolation",[],function(){var t=function(t){void 0===t&&(t=2),this.setSharpness(t)},e=function(t,e,n,r){return n=(2*n-1)*r,n=1/(1+Math.exp(-n)),t+(e-t)*n};return t.prototype={getSharpness:function(){return this.sharpness},interpolate:function(t,n,r){return e(t,n,r,this.sharpPremult)},setSharpness:function(t){this.sharpness=t,this.sharpPremult=5*t}},t.interpolate=e,t}),n("toxi/math/SinCosLUT",["./mathUtils"],function(t){var e=function(t){t||(t=e.DEFAULT_PRECISION),this.precision=t,this.period=360/this.precision,this.quadrant=this.period>>2,this.deg2rad=Math.PI/180*this.precision,this.rad2deg=180/Math.PI/this.precision,this.sinLUT=[];for(var n=0;n<this.period;n++)this.sinLUT[n]=Math.sin(n*this.deg2rad)};return e.prototype={cos:function(e){for(;0>e;)e+=t.TWO_PI;return this.sinLUT[(e*this.rad2deg+this.quadrant)%this.period]},getPeriod:function(){return this.period},getPrecision:function(){return this.precision},getSinLUT:function(){return this.sinLUT},sin:function(e){for(;0>e;)e+=t.TWO_PI;return this.sinLUT[e*this.rad2deg%this.period]}},e.DEFAULT_PRECISION=.25,e.DEFAULT_INSTANCE=void 0,e.getDefaultInstance=function(){return void 0===e.DEFAULT_INSTANCE&&(e.DEFAULT_INSTANCE=new e),e.DEFAULT_INSTANCE},e}),n("toxi/math/ThresholdInterpolation",[],function(){var t=function(t){this.threshold=t},e=function(t,e,n,r){return r>n?t:e};return t.prototype={interpolate:function(t,e,n){return n<this.threshold?t:e}},t.interpolate=e,t}),n("toxi/math/ZoomLensInterpolation",["./mathUtils","./CircularInterpolation"],function(t,e){var n=function(t,n){this.leftImpl=new e,this.rightImpl=new e,this.lensPos=t||.5,this.lensStrength=n||1,this.absStrength=Math.abs(this.lensStrength),this.leftImpl.setFlipped(this.lensStrength>0),this.rightImpl.setFlipped(this.lensStrength<0)};return n.prototype={interpolate:function(t,e,n){var r=t+(e-t)*n;return r+=n<this.lensPos?(this.leftImpl.interpolate(t,t+(e-t)*this.lensPos,n/this.lensPos)-r)*this.absStrength:(this.rightImpl.interpolate(t+(e-t)*this.lensPos,e,(n-this.lensPos)/(1-this.lensPos))-r)*this.absStrength},setLensPos:function(e,n){this.lensPos+=(t.clipNormalized(e)-this.lensPos)*n},setLensStrength:function(e,n){this.lensStrength+=(t.clip(e,-1,1)-this.lensStrength)*n,this.absStrength=t.abs(this.lensStrength),this.leftImpl.setFlipped(this.lensStrength>0),this.rightImpl.setFlipped(this.lensStrength<0)}},n}),n("toxi/math/noise/PerlinNoise",["require","../SinCosLUT","../../internals/has"],function(t){var e=t("../SinCosLUT"),n=t("../../internals/has").typedArrays(),r={};r.pow=Math.pow,r.random=Math.random,function(t,e,n,r,i,o,a){function s(t){var e,r,i=this,o=t.length,a=0,s=i.i=i.j=i.m=0;for(i.S=[],i.c=[],o||(t=[o++]);n>a;)i.S[a]=a++;for(a=0;n>a;a++)e=i.S[a],s=c(s+e+t[a%o]),r=i.S[s],i.S[a]=r,i.S[s]=e;i.g=function(t){var e=i.S,r=c(i.i+1),o=e[r],a=c(i.j+o),s=e[a];e[r]=s,e[a]=o;for(var h=e[c(o+s)];--t;)r=c(r+1),o=e[r],a=c(a+o),s=e[a],e[r]=s,e[a]=o,h=h*n+e[c(o+s)];return i.i=r,i.j=a,h},i.g(n)}function h(t,e,n,r,i){if(n=[],i=typeof t,e&&"object"==i)for(r in t)if(r.indexOf("S")<5)try{n.push(h(t[r],e-1))}catch(o){}return n.length?n:t+("string"!=i?"\x00":"")}function u(t,e,n,r){for(t+="",n=0,r=0;r<t.length;r++)e[c(r)]=c((n^=19*e[c(r)])+t.charCodeAt(r));t="";for(r in e)t+=String.fromCharCode(e[r]);return t}function c(t){return t&n-1}e.seedrandom=function(c,l){var f,p=[];return c=u(h(l?[c,t]:arguments.length?c:[(new Date).getTime(),t,window],3),p),f=new s(p),u(f.S,t),e.random=function(){for(var t=f.g(r),e=a,s=0;i>t;)t=(t+s)*n,e*=n,s=f.g(1);for(;t>=o;)t/=2,e/=2,s>>>=1;return(t+s)/e},c},a=e.pow(n,r),i=e.pow(2,i),o=2*i,u(e.random(),t)}([],r,256,6,52);var i=4,o=1<<i,a=8,s=1<<a,h=4095,u=.001,c=function(t,e){var n=(e+.5)*t._perlin_PI%t._perlin_TWOPI;return.5*(1-t._perlin_cosTable[n])},l=function(){this._perlin_octaves=4,this._perlin_amp_falloff=.5,this._sinCosLUT=e.getDefaultInstance()};return l.prototype={noise:function(t,e,l){var f=0;if(t=t||0,e=e||0,l=l||0,!this._perlin){this._perlin=n?new Float32Array(h):[];for(f=0;h+1>f;f++)this._perlin[f]=r.random()}this._perlin_cosTable=this._sinCosLUT.getSinLUT(),this._perlin_TWOPI=this._perlin_PI=this._sinCosLUT.getPeriod(),this._perlin_PI>>=1,0>t&&(t=-t),0>e&&(e=-e),0>l&&(l=-l);var p,d,m,g,v,y,E=t,x=e,T=l,b=t-E,R=e-x,w=l-T,_=0,H=.5;for(f=0;f<this._perlin_octaves&&(y=E+(x<<i)+(T<<a),p=c(this,b),d=c(this,R),m=this._perlin[y&h],m+=p*(this._perlin[y+1&h]-m),g=this._perlin[y+o&h],g+=p*(this._perlin[y+o+1&h]-g),m+=d*(g-m),y+=s,g=this._perlin[y&h],g+=p*(this._perlin[y+1&h]-g),v=this._perlin[y+o&h],v+=p*(this._perlin[y+o+1&h]-v),g+=d*(v-g),m+=c(this,w)*(g-m),_+=m*H,H*=this._perlin_amp_falloff,!(u>H));f++)E<<=1,b*=2,x<<=1,R*=2,T<<=1,w*=2,b>=1&&(E++,b--),R>=1&&(x++,R--),w>=1&&(T++,w--);return _},noiseDetail:function(t,e){t>0&&(this._perlin_octaves=t),e&&e>0&&(this._perlin_amp_falloff=e)},noiseSeed:function(t){r.seedrandom(t)}},l}),n("toxi/math/noise/simplexNoise",["require","exports","module","../../internals"],function(t,e,n){var r=t("../../internals/each"),i=t("../../internals/has"),o=Math.sqrt(3),a=Math.sqrt(5),s=.5*(o-1),h=(3-o)/6,u=2*h-1,c=1/3,l=1/6,f=(a-1)/4,p=(5-a)/20,d=2*p,m=3*p,g=4*p-1,v=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]],y=[[0,1,1,1],[0,1,1,-1],[0,1,-1,1],[0,1,-1,-1],[0,-1,1,1],[0,-1,1,-1],[0,-1,-1,1],[0,-1,-1,-1],[1,0,1,1],[1,0,1,-1],[1,0,-1,1],[1,0,-1,-1],[-1,0,1,1],[-1,0,1,-1],[-1,0,-1,1],[-1,0,-1,-1],[1,1,0,1],[1,1,0,-1],[1,-1,0,1],[1,-1,0,-1],[-1,1,0,1],[-1,1,0,-1],[-1,-1,0,1],[-1,-1,0,-1],[1,1,1,0],[1,1,-1,0],[1,-1,1,0],[1,-1,-1,0],[-1,1,1,0],[-1,1,-1,0],[-1,-1,1,0],[-1,-1,-1,0]],E=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],x=function(){for(var t=i.typedArrays()?new Int32Array(512):[],e=0;512>e;e++)t[e]=E[255&e];return t}(),T=[[0,1,2,3],[0,1,3,2],[0,0,0,0],[0,2,3,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,3,0],[0,2,1,3],[0,0,0,0],[0,3,1,2],[0,3,2,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,3,2,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,0,3],[0,0,0,0],[1,3,0,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,3,0,1],[2,3,1,0],[1,0,2,3],[1,0,3,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,3,1],[0,0,0,0],[2,1,3,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,1,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,0,1,2],[3,0,2,1],[0,0,0,0],[3,1,2,0],[2,1,0,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,1,0,2],[0,0,0,0],[3,2,0,1],[3,2,1,0]];if(i.typedArrays()){var b=function(t){var e=[];return r(t,function(t){e.push(new Int32Array(t))}),e};v=b(v),y=b(y),E=new Int32Array(E),T=b(T),this.testObjs={_grad3:v,_grad4:y,_p:E,_simplex:T}}var R=function(t,e,n,r,i){var o=t[0]*e+t[1]*n;return r&&(o+=t[2]*r,i&&(o+=t[3]*i)),o},w=function(t){return Math.floor(t>=0?t:t-1)},_={noise:function(t,e,n,r){var i=arguments.length,o=0,a=0,E=0,b=0,_=0,H=function(){switch(i){case 2:return(t+e)*s;case 3:return(t+e+n)*c;case 4:return(t+e+n+r)*f;default:throw new Error("Wrong arguments supplied to SimplexNoise.noise()")}}(),M=w(t+H),S=w(e+H),C=void 0!==n?w(n+H):void 0,A=void 0!==r?w(r+H):void 0,L=function(){switch(i){case 2:return(M+S)*h;case 3:return(M+S+C)*l;case 4:return(M+S+C+A)*p}}(),P=t-(M-L),D=e-(S-L),z=void 0!==n?n-(C-L):void 0,F=void 0!==r?r-(A-L):void 0;return 2==i?function(){var t,e,n,r,i,s,c,l,f,p,d,m,g;P>D?(t=1,e=0):(t=0,e=1),n=P-t+h,r=D-e+h,i=P+u,s=D+u,c=255&M,l=255&S,f=.5-P*P-D*D,f>0&&(f*=f,p=x[c+x[l]]%12,o=f*f*R(v[p],P,D));var y=.5-n*n-r*r;return y>0&&(y*=y,d=x[c+t+x[l+e]]%12,a=y*y*R(v[d],n,r)),g=.5-i*i-s*s,g>0&&(g*=g,m=x[c+1+x[l+1]]%12,E=g*g*R(v[m],i,s)),70*(o+a+E)}():3==i?function(){var t,e,n,r,i,s,h,u,f,p,d,m,g,y,T,w,_,H,A,L,F,k,N,V,I,B;return P>=D?D>=z?(t=1,e=0,n=0,r=1,i=1,s=0):P>=z?(t=1,e=0,n=0,r=1,i=0,s=1):(t=0,e=0,n=1,r=1,i=0,s=1):z>D?(t=0,e=0,n=1,r=0,i=1,s=1):z>P?(t=0,e=1,n=0,r=0,i=1,s=1):(t=0,e=1,n=0,r=1,i=1,s=0),h=P-t+l,u=D-e+l,f=z-n+l,p=P-r+c,d=D-i+c,m=z-s+c,g=P-.5,y=D-.5,T=z-.5,w=255&M,_=255&S,H=255&C,A=.6-P*P-D*D-z*z,A>0&&(A*=A,L=x[w+x[_+x[H]]]%12,o=A*A*R(v[L],P,D,z)),F=.6-h*h-u*u-f*f,F>0&&(F*=F,k=x[w+t+x[_+e+x[H+n]]]%12,a=F*F*R(v[k],h,u,f)),N=.6-p*p-d*d-m*m,N>0&&(N*=N,V=x[w+r+x[_+i+x[H+s]]]%12,E=N*N*R(v[V],p,d,m)),I=.6-g*g-y*y-T*T,I>0&&(I*=I,B=x[w+1+x[_+1+x[H+1]]]%12,b=I*I*R(v[B],g,y,T)),32*(o+a+E+b)}():function(){var t,e,n,r,i,s,h,u,c,l,f,v,w,H,L,k,N,V,I,B,U,O,W,G,j,q,X,Y,Z,K,Q,$,J,te,ee,ne,re,ie,oe,ae,se,he,ue=T[function(){var t=0;return P>D&&(t=32),P>z&&(t|=16),D>z&&(t|=8),P>F&&(t|=4),D>F&&(t|=2),z>F&&(t|=1),t}()];return t=ue[0]>=3?1:0,e=ue[1]>=3?1:0,n=ue[2]>=3?1:0,r=ue[3]>=3?1:0,i=ue[0]>=2?1:0,s=ue[1]>=2?1:0,h=ue[2]>=2?1:0,u=ue[3]>=2?1:0,c=ue[0]>=1?1:0,l=ue[1]>=1?1:0,f=ue[2]>=1?1:0,v=ue[3]>=1?1:0,w=P-t+p,H=D-e+p,L=z-n+p,k=F-r+p,N=P-i+d,V=D-s+d,I=z-h+d,B=F-u+d,U=P-c+m,O=D-l+m,W=z-f+m,G=F-v+m,j=P+g,q=D+g,X=z+g,Y=F+g,Z=255&M,K=255&S,Q=255&C,$=255&A,J=.6-P*P-D*D-z*z-F*F,J>0&&(J*=J,te=x[Z+x[K+x[Q+x[$]]]]%32,o=J*J*R(y[te],P,D,z,F)),ee=.6-w*w-H*H-L*L-k*k,ee>0&&(ee*=ee,ne=x[Z+t+x[K+e+x[Q+n+x[$+r]]]]%32,a=ee*ee*R(y[ne],w,H,L,k)),re=.6-N*N-V*V-I*I-B*B,re>0&&(re*=re,ie=x[Z+i+x[K+s+x[Q+h+x[$+u]]]]%32,E=re*re*R(y[ie],N,V,I,B)),oe=.6-U*U-O*O-W*W-G*G,oe>0&&(oe*=oe,ae=x[Z+c+x[K+l+x[Q+f+x[$+v]]]]%32,b=oe*oe*R(y[ae],U,O,W,G)),se=.6-j*j-q*q-X*X-Y*Y,se>0&&(se*=se,he=x[Z+1+x[K+1+x[Q+1+x[$+1]]]]%32,_=se*se*R(y[he],j,q,X,Y)),27*(o+a+E+b+_)}()}};n.exports=_}),n("toxi/math/noise",["require","exports","module","./noise/PerlinNoise","./noise/simplexNoise"],function(t,e,n){n.exports={PerlinNoise:t("./noise/PerlinNoise"),simplexNoise:t("./noise/simplexNoise")}}),n("toxi/math/waves/WaveState",["require","exports","module"],function(t,e,n){var r=function(t,e,n,r){this.phase=t,this.frequency=e,this.amp=n,this.offset=r};n.exports=r}),n("toxi/math/waves/AbstractWave",["require","exports","module","./WaveState"],function(t,e,n){var r=t("./WaveState"),i=function(t,e){return"number"==typeof t?t:e},o=function(t,e,n,r){1===arguments.length&&"object"==typeof arguments[0]&&(r=t.offset,n=t.amp,e=t.freq,t=t.phase),this.setPhase(i(t,0)),this.frequency=i(e,0),this.amp=i(n,1),this.offset=i(r,0)};o.prototype={cyclePhase:function(t){return void 0===t&&(t=0),this.phase=(this.phase+t)%o.TWO_PI,this.phase<0&&(this.phase+=o.TWO_PI),this.phase},getClass:function(){return"AbstractWave"},pop:function(){if(void 0===this.stateStack||void 0!==this.stateStack&&this.stateStack.length<=0)return console.log(this.toString()),void console.log("no wave states on stack");var t=this.stateStack.pop();this.phase=t.phase,this.frequency=t.frequency,this.amp=t.amp,this.offset=t.offset},push:function(){void 0===this.stateStack&&(this.stateStack=[]),this.stateStack.push(new r(this.phase,this.frequency,this.amp,this.offset))},reset:function(){this.phase=this.origPhase},setPhase:function(t){this.phase=t,this.cyclePhase(),this.origPhase=t},toString:function(){return this.getClass()+" phase:"+this.phase+" frequency: "+this.frequency+" amp: "+this.amp+" offset: "+this.offset},update:function(){console.log(this.getClass()+" this should be overridden")}},o.PI=3.141592653589793,o.TWO_PI=2*o.PI,o.hertzToRadians=function(t,e){return t/e*o.TWO_PI},o.radiansToHertz=function(t,e){return t/o.TWO_PI*e},n.exports=o}),n("toxi/math/waves/AMFMSineWave",["require","exports","module","../../internals","./AbstractWave"],function(t,e,n){var r=t("../../internals").extend,i=t("./AbstractWave"),o=function(t,e,n,r,o){"number"==typeof n?(i.call(this,t,e,1,n),this.amod=r,this.fmod=o):(i.call(this,t,e),this.amod=n,this.fmod=r)};r(o,i),o.prototype.getClass=function(){return"AMFMSineWave"},o.prototype.pop=function(){this.parent.pop.call(this),this.amod.pop(),this.fmod.pop()},o.prototype.push=function(){this.parent.push.call(this),this.amod.push(),this.fmod.push()},o.prototype.reset=function(){this.parent.reset.call(this),this.fmod.reset(),this.amod.reset()},o.prototype.update=function(){return this.amp=this.amod.update(),this.value=this.amp*Math.sin(this.phase)+this.offset,this.cyclePhase(this.frequency+this.fmod.update()),this.value},n.exports=o}),n("toxi/math/waves/ConstantWave",["require","exports","module","../../internals","./AbstractWave"],function(t,e,n){var r=t("../../internals").extend,i=t("./AbstractWave"),o=function(t){i.apply(this),this.value=t};r(o,i),o.prototype.getClass=function(){return"ConstantWave"},o.prototype.update=function(){return this.value},n.exports=o}),n("toxi/math/waves/FMHarmonicSquareWave",["require","exports","module","../../internals","./AbstractWave"],function(t,e,n){var r=t("../../internals").extend,i=t("./AbstractWave"),o=function(t,e,n,r,o){this.maxHarmonics=3,"number"==typeof n?(void 0===o&&(o=new ConstantWave(0)),i.call(this,t,e,n,r),this.fmod=o):(i.call(this,t,e),this.fmod=n)};r(o,i),o.prototype.getClass=function(){return"FMHarmonicSquareWave"},o.prototype.pop=function(){this.parent.pop.call(this),this.fmod.pop()},o.prototype.push=function(){this.parent.push.call(this),this.fmod.push()},o.prototype.reset=function(){this.parent.reset.call(this),this.fmod.reset()},o.prototype.update=function(){this.value=0;for(var t=1;t<=this.maxHarmonics;t+=2)this.value+=1/t*Math.sin(t*this.phase);return this.value*=this.amp,this.value+=this.offset,this.cyclePhase(this.frequency+this.fmod.update()),this.value},n.exports=o}),n("toxi/math/waves/FMSawtoothWave",["require","exports","module","../../internals","./AbstractWave"],function(t,e,n){var r=t("../../internals").extend,i=t("./AbstractWave"),o=function(t,e,n,r,o){"number"==typeof n?(i.call(this,t,e,n,r),this.fmod=o):(i.call(this,t,e),this.fmod=n)};r(o,i),o.prototype.getClass=function(){return"FMSawtoothWave"},o.prototype.pop=function(){this.parent.pop.call(this),this.fmod.pop()},o.prototype.push=function(){this.parent.push.call(this),this.fmod.push()},o.prototype.reset=function(){this.parent.reset.call(this),this.fmod.reset()},o.prototype.update=function(){return this.value=(this.phase/i.TWO_PI*2-1)*this.amp+this.offset,this.cyclePhase(this.frequency+this.fmod.update()),this.value},n.exports=o}),n("toxi/math/waves/FMSineWave",["require","exports","module","../../internals","./AbstractWave"],function(t,e,n){var r=t("../../internals").extend,i=t("./AbstractWave"),o=function(t,e,n,r,o){"number"==typeof n?(i.call(this,t,e,n,r),this.fmod=o):(i.call(this,t,e),this.fmod=n)};r(o,i),o.prototype.getClass=function(){return"FMSineWave"},o.prototype.pop=function(){this.parent.pop.call(this),this.fmod.pop()},o.prototype.push=function(){this.parent.push.call(this),this.fmod.push()},o.prototype.reset=function(){this.parent.reset.call(this),this.fmod.reset()},o.prototype.update=function(){return this.value=Math.sin(this.phase)*this.amp+this.offset,this.cyclePhase(this.frequency+this.fmod.update()),this.value},n.exports=o}),n("toxi/math/waves/FMSquareWave",["require","exports","module","../../internals","./AbstractWave","./ConstantWave"],function(t,e,n){var r=t("../../internals").extend,i=t("./AbstractWave"),o=t("./ConstantWave"),a=function(t,e,n,r,a){"number"==typeof n?void 0===a?i.call(this,t,e,n,r,new o(0)):(i.call(this,t,e,n,r),this.fmod=a):(i.call(this,t,e),this.fmod=n)};r(a,i),a.prototype.getClass=function(){return"FMSquareWave"},a.prototype.pop=function(){this.parent.pop.call(this),this.fmod.pop()},a.prototype.push=function(){this.parent.push.call(this),this.fmod.push()},a.prototype.reset=function(){this.parent.reset.call(this),this.fmod.reset()},a.prototype.update=function(){return this.value=(this.phase/i.TWO_PI<.5?1:-1)*this.amp+this.offset,this.cyclePhase(this.frequency+this.fmod.update()),this.value},n.exports=a}),n("toxi/math/waves/FMTriangleWave",["require","exports","module","../../internals","../mathUtils","./AbstractWave","./ConstantWave"],function(t,e,n){var r=t("../../internals").extend,i=t("../mathUtils"),o=t("./AbstractWave"),a=t("./ConstantWave"),s=function(t,e,n,r,i){"number"==typeof n?void 0!==i?(o.call(this,t,e,n,r),this.fmod=i):o.call(this,t,e,n,r,new a(0)):o.call(this,t,e,1,0)};r(s,o),s.prototype.getClass=function(){return"FMTriangleWave"},s.prototype.pop=function(){this.parent.pop.call(this),this.fmod.pop()},s.prototype.push=function(){this.parent.push.call(this),this.fmod.push()},s.prototype.reset=function(){this.parent.reset.call(this),this.fmod.reset()},s.prototype.update=function(){return this.value=2*this.amp*(Math.abs(o.PI-this.phase)*i.INV_PI-.5)+this.offset,this.cyclePhase(this.frequency+this.fmod.update()),this.value},n.exports=s}),n("toxi/math/waves/SineWave",["require","exports","module","../../internals","./AbstractWave"],function(t,e,n){var r=t("../../internals").extend,i=t("./AbstractWave"),o=function(t,e,n,r){i.call(this,t,e,n,r)};r(o,i),o.prototype.getClass=function(){return"SineWave"},o.prototype.update=function(){return this.value=Math.sin(this.phase)*this.amp+this.offset,this.cyclePhase(this.frequency),this.value},n.exports=o}),n("toxi/math/waves",["require","exports","module","./waves/AbstractWave","./waves/AMFMSineWave","./waves/ConstantWave","./waves/FMHarmonicSquareWave","./waves/FMSawtoothWave","./waves/FMSineWave","./waves/FMSquareWave","./waves/FMTriangleWave","./waves/SineWave","./waves/WaveState"],function(t,e,n){n.exports={AbstractWave:t("./waves/AbstractWave"),AMFMSineWave:t("./waves/AMFMSineWave"),ConstantWave:t("./waves/ConstantWave"),FMHarmonicSquareWave:t("./waves/FMHarmonicSquareWave"),FMSawtoothWave:t("./waves/FMSawtoothWave"),FMSineWave:t("./waves/FMSineWave"),FMSquareWave:t("./waves/FMSquareWave"),FMTriangleWave:t("./waves/FMTriangleWave"),SineWave:t("./waves/SineWave"),WaveState:t("./waves/WaveState")}}),n("toxi/math",["require","exports","module","./math/BezierInterpolation","./math/CircularInterpolation","./math/CosineInterpolation","./math/DecimatedInterpolation","./math/ExponentialInterpolation","./math/Interpolation2D","./math/LinearInterpolation","./math/mathUtils","./math/mathUtils","./math/ScaleMap","./math/SigmoidInterpolation","./math/SinCosLUT","./math/ThresholdInterpolation","./math/ZoomLensInterpolation","./math/noise","./math/waves"],function(t,e,n){n.exports={BezierInterpolation:t("./math/BezierInterpolation"),CircularInterpolation:t("./math/CircularInterpolation"),CosineInterpolation:t("./math/CosineInterpolation"),DecimatedInterpolation:t("./math/DecimatedInterpolation"),ExponentialInterpolation:t("./math/ExponentialInterpolation"),Interpolation2D:t("./math/Interpolation2D"),LinearInterpolation:t("./math/LinearInterpolation"),mathUtils:t("./math/mathUtils"),MathUtils:t("./math/mathUtils"),ScaleMap:t("./math/ScaleMap"),SigmoidInterpolation:t("./math/SigmoidInterpolation"),SinCosLUT:t("./math/SinCosLUT"),ThresholdInterpolation:t("./math/ThresholdInterpolation"),ZoomLensInterpolation:t("./math/ZoomLensInterpolation")},n.exports.noise=t("./math/noise"),n.exports.waves=t("./math/waves")}),n("toxi/physics2d/VerletParticle2D",["require","exports","module","../internals","../geom/Vec2D"],function(t,e,n){var r=t("../internals"),i=t("../geom/Vec2D"),o=function(t,e,n){this.force=new i,r.has.XY(t)&&(r.is.VerletParticle2D(t)?(e=t.y,n=t.weight,t=t.x,this.isLocked=t.isLocked):void 0===e?(e=t.y,n=1,t=t.x):(n=e,e=t.y,t=t.x)),i.call(this,t,e),this.isLocked=!1,this.prev=new i(this),this.temp=new i,n=n||1,this.setWeight(n)};r.extend(o,i),o.prototype.addBehavior=function(t,e){if(void 0===this.behaviors&&(this.behaviors=[]),void 0===t)throw new Error("behavior was undefined");return e=void 0===e?1:e,t.configure(e),this.behaviors.push(t),this},o.prototype.addConstraint=function(t){return void 0===this.constraints&&(this.constraints=[]),this.constraints.push(t),this},o.prototype.addForce=function(t){return this.force.addSelf(t),this},o.prototype.addVelocity=function(t){return this.prev.subSelf(t),this},o.prototype.applyBehaviors=function(){if(void 0!==this.behaviors){var t=0,e=this.behaviors.length;for(t=0;e>t;t++)this.behaviors[t].applyBehavior(this)}},o.prototype.applyConstraints=function(){if(void 0!==this.constraints){var t=0,e=this.constraints.length;for(t=0;e>t;t++)this.constraints[t].applyConstraint(this)}},o.prototype.clearForce=function(){return this.force.clear(),this},o.prototype.clearVelocity=function(){return this.prev.set(this),this},o.prototype.getInvWeight=function(){return this.invWeight},o.prototype.getPreviousPosition=function(){return this.prev},o.prototype.getVelocity=function(){return this.sub(this.prev)},o.prototype.getWeight=function(){return this.weight},o.prototype.lock=function(){return this.isLocked=!0,this},o.prototype.removeAllBehaviors=function(){return this.behaviors=[],this},o.prototype.removeAllConstraints=function(){return this.constraints=[],this},o.prototype.removeBehavior=function(t){return r.removeItemFrom(t,this.behaviors)},o.prototype.removeConstraint=function(t){return r.removeItemFrom(t,this.constraints)},o.prototype.scaleVelocity=function(t){return this.prev.interpolateToSelf(this,1-t),this},o.prototype.setPreviousPosition=function(t){return this.prev.set(t),this},o.prototype.setWeight=function(t){this.weight=t,this.invWeight=0!==t?1/t:0},o.prototype.unlock=function(){return this.clearVelocity(),this.isLocked=!1,this},o.prototype.update=function(){this.isLocked||(this.applyBehaviors(),this.temp.set(this),this.addSelf(this.sub(this.prev).addSelf(this.force.scale(this.weight))),this.prev.set(this.temp),this.force.clear(),this.applyConstraints())},n.exports=o}),n("toxi/physics2d/ParticlePath2D",["require","exports","module","../internals","../geom/Spline2D","./VerletParticle2D"],function(t,e,n){var r=t("../internals"),i=t("../geom/Spline2D"),o=t("./VerletParticle2D"),a=function(t){i.call(this,t),this.particles=[]};r.extend(a,i),a.prototype.createParticles=function(t,e,n,r){this.particles=[],this.computeVertices(e);var i=0,a=this.getDecimatedVertices(n,!0);for(i=0;i<a.length;i++){var s=a[i],h=new o(s,r);this.particles.push(h),t.addParticle(h)}return this.particles},n.exports=a}),n("toxi/physics2d/VerletSpring2D",["require","exports","module"],function(t,e,n){var r=function(t,e,n,r){this.a=t,this.b=e,this.restLength=n,this.strength=r};r.EPS=1e-6,r.prototype={getRestLength:function(){return this.restLength},getStrength:function(){return this.strength},lockA:function(t){return this.isALocked=t,this},lockB:function(t){return this.isBLocked=t,this},setRestLength:function(t){return this.restLength=t,this.restLengthSquared=t*t,this},setStrength:function(t){return this.strength=t,this},update:function(t){var e=this.b.sub(this.a),n=e.magnitude()+r.EPS,i=(n-this.restLength)/(n*(this.a.invWeight+this.b.invWeight))*this.strength;this.a.isLocked||this.isALocked||(this.a.addSelf(e.scale(i*this.a.invWeight)),t&&this.a.applyConstraints()),this.b.isLocked||this.isBLocked||(this.b.addSelf(e.scale(-i*this.b.invWeight)),t&&this.b.applyConstraints())}},n.exports=r}),n("toxi/physics2d/ParticleString2D",["require","exports","module","./VerletParticle2D","./VerletSpring2D"],function(t,e,n){var r=t("./VerletParticle2D"),i=t("./VerletSpring2D"),o=function(){var t={physics:void 0,plist:void 0,pos:void 0,step:void 0,num:void 0,mass:void 0,strength:void 0},e=!1;if(0===arguments.length)throw new Error("Incorrect Parameters");if(1==arguments.length){var n=arguments[0];for(var i in n)t[i]=n[i]}else t.physics=arguments[0],6==arguments.length?(t.pos=arguments[1],t.step=arguments[2],t.num=arguments[3],t.mass=arguments[4],t.strength=arguments[5]):(t.plist=arguments[1],t.strength=arguments[2]);if(void 0!==t.num&&void 0!==t.pos&&void 0!==t.step&&void 0!==t.mass&&(e=!0),!e&&void 0===t.plist)throw new Error("Incorrect Parameters, please supply plist or num, pos, step & mass");this.physics=t.physics,this.links=[];var o,a,s,h,u=0;if(e){var c=t.pos.copy(),l=t.step,f=t.mass,p=l.magnitude();for(this.particles=[],h=t.strength,u=0;u<t.num;u++)a=new r(c.copy(),f),this.particles.push(a),this.physics.particles.push(a),void 0!==o&&(s=this.createSpring(o,a,p,h),this.links.push(s),this.physics.addSpring(s)),o=a,c.addSelf(l)}else for(h=t.strength,this.particles=t.plist||[],u=0;u<this.particles.length;u++)a=this.particles[u],this.physics.addParticle(a),void 0!==o&&(s=this.createSpring(o,a,o.distanceTo(a),h),this.links.push(s),this.physics.addSpring(s)),o=a};o.prototype={clear:function(){for(var t=0,e=this.links.length;e>t;t++)this.physics.removeSpringElements(this.links[t]);this.particles=[],this.links=[]},createSpring:function(t,e,n,r){return new i(t,e,n,r)},getHead:function(){return this.particles[0]},getNumParticles:function(){return this.particles.length},getTail:function(){return this.particles[this.particles.length-1]}},n.exports=o}),n("toxi/physics2d/PullBackString2D",["require","exports","module","../internals","./VerletSpring2D"],function(t,e,n){var r=t("../internals"),i=t("./VerletSpring2D"),o=function(t,e,n){i.apply(this,[t,e,0,n]),t.lock(),this.setRestLength(.5)};r.extend(o,i),o.prototype.update=function(t){this.b.distanceToSquared(this.a)>this.restLengthSquared&&this.parent.update.call(this,t)},n.exports=o}),n("toxi/physics2d/VerletConstrainedSpring2D",["require","exports","module","../internals","./VerletSpring2D"],function(t,e,n){var r=t("../internals"),i=t("./VerletSpring2D"),o=function(t,e,n,r,o){i.call(this,t,e,n,r),this.limit=void 0===o?Number.MAX_VALUE:o};r.extend(o,i),o.update=function(t){var e=this.b.sub(this.a),n=e.magnitude()+i.EPS,r=(n-this.restLength)/(n*(this.a.invWeight+this.b.invWeight))*this.strength;this.a.isLocked||this.isALocked||(this.a.addSelf(e.scale(r*this.a.invWeight).limit(this.limit)),t&&this.a.applyConstraints()),this.b.isLocked||this.isBLocked||(this.b.subSelf(e.scale(r*this.b.invWeight).limit(this.limit)),t&&this.b.applyConstraints())},n.exports=o}),n("toxi/physics2d/VerletMinDistanceSpring2D",["require","exports","module","../internals","./VerletSpring2D"],function(t,e,n){var r=t("../internals"),i=t("./VerletSpring2D"),o=function(t,e,n,r){i.call(this,t,e,n,r),this.setRestLength(n)};r.extend(o,i),o.prototype.update=function(t){this.b.distanceToSquared(this.a)<this.restLengthSquared&&this.parent.update.call(this,t)},n.exports=o}),n("toxi/physics2d/behaviors/ConstantForceBehavior",["require","exports","module","../../geom/Vec2D"],function(t,e,n){var r=t("../../geom/Vec2D"),i=function(t){this.force=t,this.scaledForce=new r,this.timeStep=0};i.prototype={applyBehavior:function(t){t.addForce(this.scaledForce)
},configure:function(t){this.timeStep=t,this.setForce(this.force)},getForce:function(){return this.force},setForce:function(t){this.force=t,this.scaledForce=this.force.scale(this.timeStep)},toString:function(){return"behavior force: "+this.force+" scaledForce: "+this.scaledForce+" timeStep: "+this.timeStep}},n.exports=i}),n("toxi/physics2d/behaviors/GravityBehavior",["require","exports","module","../../internals","./ConstantForceBehavior"],function(t,e,n){var r=t("../../internals"),i=t("./ConstantForceBehavior"),o=function(t){i.call(this,t)};r.extend(o,i),o.prototype.configure=function(t){this.timeStep=t,this.scaledForce=this.force.scale(t*t)},n.exports=o}),n("toxi/physics2d/VerletPhysics2D",["require","exports","module","../internals","./behaviors/GravityBehavior","../geom/Rect","../geom/Vec2D"],function(t,e,n){var r=t("../internals"),i=t("./behaviors/GravityBehavior"),o=t("../geom/Rect"),a=t("../geom/Vec2D"),s=0,h=function(t,e,n,o){var h,u={numIterations:50,drag:0,timeStep:1};1==arguments.length&&(arguments[0].gravity||arguments[0].numIterations||arguments[0].timeStep||arguments[0].drag)?(h=arguments[0],u.gravity=h.gravity,u.numIterations=h.numIterations||u.numIterations,u.drag=h.drag||u.drag,u.timeStep=h.timeStep||u.timeStep):1==arguments.length?u.gravity=t:4==arguments.length&&(u.gravity=t,u.numIterations=e,u.drag=n,u.timeStep=o),this.behaviors=[],this.particles=[],this.springs=[],this.numIterations=u.numIterations,this.timeStep=u.timeStep,this.setDrag(u.drag),u.gravity&&(r.has.XY(u.gravity)&&(u.gravity=new i(new a(u.gravity))),this.addBehavior(u.gravity)),this.id=s++};h.addConstraintToAll=function(t,e){for(var n=0;n<e.length;n++)e[n].addConstraint(t)},h.removeConstraintFromAll=function(t,e){for(var n=0;n<e.length;n++)e[n].removeConstraint(t)},h.prototype={addBehavior:function(t){t.configure(this.timeStep),this.behaviors.push(t)},addParticle:function(t){return this.particles.push(t),this},addSpring:function(t){return void 0===this.getSpring(t.a,t.b)&&this.springs.push(t),this},clear:function(){return this.particles=[],this.springs=[],this},constrainToBounds:function(){var t,e=0,n=this.particles.length;for(e=0;n>e;e++)t=this.particles[e],void 0!==t.bounds&&t.constrain(t.bounds);if(void 0!==this.worldBounds)for(e=0;n>e;e++)t=this.particles[e],t.constrain(this.worldBounds)},getCurrentBounds:function(){for(var t,e=new a(Number.MAX_VALUE,Number.MAX_VALUE),n=new a(Number.MIN_VALUE,Number.MIN_VALUE),r=0,i=this.particles.length;i>r;r++)t=this.particles[r],e.minSelf(t),n.maxSelf(t);return new o(e,n)},getDrag:function(){return 1-this.drag},getNumIterations:function(){return this.numIterations},getSpring:function(t,e){for(var n=0,r=this.springs.length;r>n;n++){var i=this.springs[n];if(i.a===t&&i.b===e||i.a===e&&i.b===e)return i}return void 0},getTimeStep:function(){return this.timeStep},getWorldBounds:function(){return this.worldBounds},removeBehavior:function(t){return r.removeItemFrom(t,this.behaviors)},removeParticle:function(t){return r.removeItemFrom(t,this.particles)},removeSpring:function(t){return r.removeItemFrom(t,this.springs)},removeSpringElements:function(t){return void 0!==this.removeSpring(t)?this.removeParticle(t.a)&&this.removeParticle(t.b):!1},setDrag:function(t){this.drag=1-t},setNumIterations:function(t){this.numIterations=t},setTimeStep:function(t){this.timeStep=t;for(var e=0,n=this.behaviors.length;n>e;e++)this.behaviors[e].configure(t)},setWorldBounds:function(t){return this.worldBounds=t,this},update:function(){return this.updateParticles(),this.updateSprings(),this.constrainToBounds(),this},updateParticles:function(){for(var t,e,n=0,r=0,i=this.behaviors.length,o=this.particles.length;i>n;n++)for(t=this.behaviors[n],r=0;o>r;r++)t.applyBehavior(this.particles[r]);for(r=0;o>r;r++)e=this.particles[r],e.scaleVelocity(this.drag),e.update()},updateSprings:function(){for(var t=this.numIterations,e=this.springs.length,n=0;t>0;t--)for(n=0;e>n;n++)this.springs[n].update(1===t)}},n.exports=h}),n("toxi/physics2d/behaviors/AttractionBehavior",["require","exports","module"],function(t,e,n){var r=function(t,e,n,r){if(arguments.length<3)throw new Error("Constructor received incorrect Parameters");this.jitter=r||0,this.attractor=t,this.strength=n,this.setRadius(e)};r.prototype={applyBehavior:function(t){var e=this.attractor.sub(t),n=e.magSquared();if(n<this.radiusSquared){var r=e.normalizeTo(1-n/this.radiusSquared).jitter(this.jitter).scaleSelf(this.attrStrength);t.addForce(r)}},configure:function(t){this.timeStep=t,this.setStrength(this.strength)},getAttractor:function(){return this.attractor},getJitter:function(){return this.jitter},getRadius:function(){return this.radius},getStrength:function(){return this.strength},setAttractor:function(t){this.attractor=t},setJitter:function(t){this.jitter=t},setRadius:function(t){this.radius=t,this.radiusSquared=t*t},setStrength:function(t){this.strength=t,this.attrStrength=t*this.timeStep}},n.exports=r}),n("toxi/physics2d/behaviors",["exports","./behaviors/AttractionBehavior","./behaviors/ConstantForceBehavior","./behaviors/GravityBehavior"],function(t,e,n,r){t.AttractionBehavior=e,t.ConstantForceBehavior=n,t.GravityBehavior=r}),n("toxi/physics2d/constraints/AngularConstraint",["require","exports","module","../../geom/Vec2D"],function(t,e,n){var r=t("../../geom/Vec2D"),i=function(t,e){arguments.length>1?(this.theta=e,this.rootPos=new r(t)):(this.rootPos=new r,this.theta=t)};i.prototype.applyConstraint=function(t){var e=t.sub(this.rootPos),n=Math.floor(e.heading()/this.theta)*this.theta;t.set(this.rootPos.add(r.fromTheta(n).scaleSelf(e.magnitude())))},n.exports=i}),n("toxi/physics2d/constraints/AxisConstraint",["require","exports","module"],function(t,e,n){var r=function(t,e){this.axis=t,this.constraint=e};r.prototype.applyConstraint=function(t){t.setComponent(this.axis,this.constraint)},n.exports=r}),n("toxi/physics2d/constraints/CircularConstraint",["require","exports","module","../../geom/Circle"],function(t,e,n){var r=t("../../geom/Circle"),i=function(t,e){this.circle=1==arguments.length?t:new r(t,e)};i.prototype.applyConstraint=function(t){this.circle.containsPoint(t)&&t.set(this.circle.add(t.sub(this.circle).normalizeTo(this.circle.getRadius())))},n.exports=i}),n("toxi/physics2d/constraints/MaxConstraint",["require","exports","module"],function(t,e,n){var r=function(t,e){this.axis=t,this.threshold=e};r.prototype.applyConstraint=function(t){t.getComponent(this.axis)>this.threshold&&t.setComponent(this.axis,this.threshold)},n.exports=r}),n("toxi/physics2d/constraints/MinConstraint",["require","exports","module"],function(t,e,n){var r=function(t,e){this.axis=t,this.threshold=e};r.prototype.applyConstraint=function(t){t.getComponent(this.axis)<this.threshold&&t.setComponent(this.axis,this.threshold)},n.exports=r}),n("toxi/physics2d/constraints/RectConstraint",["require","exports","module","../../geom/Vec2D","../../internals/has","../../geom/Ray2D","../../geom/Rect"],function(t,e,n){var r=t("../../geom/Vec2D"),i=t("../../internals/has"),o=t("../../geom/Ray2D"),a=t("../../geom/Rect"),s=function(t,e){if(1==arguments.length?"function"==typeof t.copy?this.rect=t.copy():i.XYWidthHeight(t)&&(this.rect=new a(t)):arguments.length>1&&(this.rect=new a(t,e)),!this.rect)throw new Error("Received Incorrect arguments");this.intersectRay=new o(this.rect.getCentroid(),new r)};s.prototype={applyConstraint:function(t){this.rect.containsPoint(t)&&t.set(this.rect.intersectsRay(this.intersectRay.setDirection(this.intersectRay.sub(t)),0,Number.MAX_VALUE))},getBox:function(){return this.rect.copy()},setBox:function(t){this.rect=t.copy(),this.intersectRay.set(this.rect.getCentroid())}},n.exports=s}),n("toxi/physics2d/constraints",["exports","./constraints/AngularConstraint","./constraints/AxisConstraint","./constraints/CircularConstraint","./constraints/MaxConstraint","./constraints/MinConstraint","./constraints/RectConstraint"],function(t,e,n,r,i,o,a){t.AngularConstraint=e,t.AxisConstraint=n,t.CircularConstraint=r,t.MaxConstraint=i,t.MinConstraint=o,t.RectConstraint=a}),n("toxi/physics2d",["require","exports","module","./physics2d/ParticlePath2D","./physics2d/ParticleString2D","./physics2d/PullBackString2D","./physics2d/VerletConstrainedSpring2D","./physics2d/VerletMinDistanceSpring2D","./physics2d/VerletParticle2D","./physics2d/VerletPhysics2D","./physics2d/VerletSpring2D","./physics2d/behaviors","./physics2d/constraints"],function(t,e,n){n.exports={ParticlePath2D:t("./physics2d/ParticlePath2D"),ParticleString2D:t("./physics2d/ParticleString2D"),PullBackString2D:t("./physics2d/PullBackString2D"),VerletConstrainedSpring2D:t("./physics2d/VerletConstrainedSpring2D"),VerletMinDistanceSpring2D:t("./physics2d/VerletMinDistanceSpring2D"),VerletParticle2D:t("./physics2d/VerletParticle2D"),VerletPhysics2D:t("./physics2d/VerletPhysics2D"),VerletSpring2D:t("./physics2d/VerletSpring2D")},n.exports.behaviors=t("./physics2d/behaviors"),n.exports.constraints=t("./physics2d/constraints")}),n("toxi/processing/ToxiclibsSupport",["require","exports","module","../geom/Matrix4x4","../geom/Vec3D","../geom/mesh/TriangleMesh"],function(t,e,n){var r=t("../geom/Matrix4x4"),i=t("../geom/Vec3D"),o=t("../geom/mesh/TriangleMesh"),a=function(t,e){if("undefined"==typeof Processing)throw new Error("Processing.js has not been loaded");this.sketch=t,this.app=t,this.gfx=void 0!==e?t:this.app,this._normalMap=(new r).translateSelf(128,128,128).scaleSelf(127)};a.prototype={box:function(t,e){var n=t.toMesh();void 0===e&&(e=!1),e&&n.computeVertexNormals(),this.mesh(n,e,0)},circle:function(t,e){this.gfx.ellipse(t.x,t.y,e,e)},cone:function(){var t=arguments[0],e=6,n=0,r=!0,i=!0,a=!1;5==arguments.length?(e=arguments[1],r=arguments[2],i=arguments[3],a=arguments[4]):3==arguments.length&&(e=arguments[1],a=arguments[2]);var s=t.toMesh({mesh:new o,steps:e,thetaOffset:n,topClosed:r,bottomClosed:i});a&&s.computeVertexNormals(),window.mesh=s,this.mesh(s,a,0)},cylinder:function(t,e,n){if(1==arguments.length)this.mesh(t.toMesh(),!1,0);else{var r=t.toMesh(e,0);void 0===n&&(n=!1),n&&r.computeVertexNormals(),this.mesh(r,n,0)}},ellipse:function(t,e){var n=t.getRadii();void 0===e&&(e=this.app.CENTER),e===this.app.CENTER?this.gfx.ellipse(t.x,t.y,2*n.x,2*n.y):e===this.app.RADIUS?this.gfx.ellipse(t.x,t.y,2*n.x,2*n.y):(e===this.app.CORNER||this.gfx.ellipseMode===this.app.CORNERS)&&this.gfx.ellipse(t.x-n.x,t.y-n.y,2*n.x,2*n.y)},getGraphics:function(){return this.gfx},line:function(){var t,e;if(1==arguments.length){var n=arguments[0];t=n.a,e=n.b}else t=arguments[0],e=arguments[1];void 0===t.z?this.gfx.line(t.x,t.y,e.x,e.y):this.gfx.line(t.x,t.y,t.z,e.x,e.y,e.z)},lineStrip2D:function(t){this.processVertices2D(t,this.app.POLYGON,!1)},lineStrip3D:function(t){this.processVertices3D(t,this.app.POLYGON,!1)},mesh:function(t,e,n){void 0===e&&(e=!1),void 0===n&&(n=0),this.gfx.beginShape(this.app.TRIANGLES);var r=0,i=t.faces.length;if(e)for(r=0;i>r;r++){var o=t.faces[r];this.gfx.normal(o.a.normal.x,o.a.normal.y,o.a.normal.z),this.gfx.vertex(o.a.x,o.a.y,o.a.z),this.gfx.normal(o.b.normal.x,o.b.normal.y,o.b.normal.z),this.gfx.vertex(o.b.x,o.b.y,o.b.z),this.gfx.normal(o.c.normal.x,o.c.normal.y,o.c.normal.z),this.gfx.vertex(o.c.x,o.c.y,o.c.z)}else for(var r=0;i>r;r++){var o=t.faces[r];this.gfx.normal(o.normal.x,o.normal.y,o.normal.z),this.gfx.vertex(o.a.x,o.a.y,o.a.z),this.gfx.vertex(o.b.x,o.b.y,o.b.z),this.gfx.vertex(o.c.x,o.c.y,o.c.z)}if(this.gfx.endShape(),n>0){var a=0,s=this.gfx.stroke;if(s&&(a=this.gfx.strokeColor),i=t.vertices.length,e)for(r=0;i>r;r++){var h=t.vertices[r],u=h.add(h.normal.scale(n));p=h.normal.scale(127),this.gfx.stroke(p.x+128,p.y+128,p.z+128),this.gfx.line(h.x,h.y,h.z,u.x,u.y,u.z)}else{var c=1/3;for(i=t.faces.length,r=0;i>r;r++){var o=t.faces[r],l=o.a.add(o.b).addSelf(o.c).scaleSelf(c),f=l.add(o.normal.scale(n)),p=o.normal.scale(127);this.gfx.stroke(p.x+128,p.y+128,p.z+128),this.gfx.line(l.x,l.y,l.z,f.x,f.y,f.z)}}s?this.gfx.stroke(a):this.gfx.noStroke()}},meshNormalMapped:function(t,e,n){this.gfx.beginShape(this.app.TRIANGLES);var r=0,i=t.faces.length;if(e)for(r=0;i>r;r++){var o=t.faces[r],a=this._normalMap.applyTo(o.a.normal);this.gfx.fill(a.x,a.y,a.z),this.gfx.normal(o.a.normal.x,o.a.normal.y,o.a.normal.z),this.gfx.vertex(o.a.x,o.a.y,o.a.z),a=this._normalMap.applyTo(o.b.normal),this.gfx.fill(a.x,a.y,a.z),this.gfx.normal(o.b.normal.x,o.b.normal.y,o.b.normal.z),this.gfx.vertex(o.b.x,o.b.y,o.b.z),a=this._normalMap.applyTo(o.c.nromal),this.gfx.fil(a.x,a.y,a.z),this.gfx.normal(o.c.normal.x,o.c.normal.y,o.c.normal.z),this.gfx.vertex(o.c.x,o.c.y,o.c.z)}else for(r=0;i>r;r++){var o=t.faces[r];this.gfx.normal(o.normal.x,o.normal.y,o.normal.z),this.gfx.vertex(o.a.x,o.a.y,o.a.z),this.gfx.vertex(o.b.x,o.b.y,o.b.z),this.gfx.vertex(o.c.x,o.c.y,o.c.z)}if(this.gfx.endShape(),n>0)if(e)for(i=t.vertices.length,r=0;i>r;r++){var s=t.vertices[r],h=s.add(s.normal.scale(n)),a=s.normal.scale(127);this.gfx.stroke(a.x+128,a.y+128,a.z+128),this.gfx.line(s.x,s.y,s.z,h.x,h.y,h.z)}else for(i=t.faces.length,r=0;i>r;r++){var o=t.faces[r],u=o.getCentroid(),c=u.add(o.normal.scale(n)),a=o.normal.scale(127);this.gfx.stroke(a.x+128,a.y+128,a.z+128),this.gfx.line(u.x,u.y,u.z,c.x,c.y,c.z)}},origin:function(){var t=void 0,e=void 0;1==arguments.length?(e=arguments[0],t=i.ZERO):(t=arguments[0],e=arguments[1]),this.gfx.stroke(255,0,0),this.gfx.line(t.x,t.y,t.z,t.x+e,t.y,t.z),this.gfx.stroke(0,255,0),this.gfx.line(t.x,t.y,t.z,t.x,t.y+e,t.z),this.gfx.stroke(0,0,255),this.gfx.line(t.x,t.y,t.z,t.x,t.y,t.z+e)},plane:function(t,e){this.mesh(t.toMesh(e),!1,0)},point:function(t){void 0===t.z?this.gfx.point(t.x,t.y):this.gfx.point(t.x,t.y,t.z)},points2D:function(t){this.processVertices2D(t,this.app.POINTS,!1)},points3D:function(t){this.processVertices3D(t,this.app.POINTS,!1)},polygon2D:function(t){this.processVertices2D(t.vertices,this.app.POLYGON,!1)},processVertices2D:function(t,e,n){(void 0===t.hasNext||void 0===t.next)&&(t=new this.app.ObjectIterator(t)),this.gfx.beginShape(e);for(var r=void 0;t.hasNext();)this.gfx.vertex(r.x,r.y);n?this.gfx.endShape(this.app.CLOSE):this.gfx.endShape()},processVertices3D:function(t,e,n){(void 0===t.hasNext||void 0===t.next)&&(t=new this.app.ObjectIterator(t)),this.gfx.beginShape(e);for(var r=void 0;t.hasNext();)this.gfx.vertex(r.x,r.y,r.z);n?this.gfx.endShape(this.app.CLOSE):this.gfx.endShape()},ray:function(t,e){var n=t.getPointAtDistance(e);void 0===t.z?this.gfx.line(t.x,t.y,n.x,n.y):this.gfx.line(t.x,t.y,t.z,n.x,n.y,n.z)},rect:function(t,e){if(void 0===e&&(e=this.app.CORNER),e===this.app.CORNER)this.gfx.rect(t.x,t.y,t.width,t.height);else if(e===this.app.CORNERS)this.gfx.rect(t.x,t.y,t.x+t.width,t.y+t.height);else if(e===this.app.CENTER)this.gfx.rect(t.x+.5*t.widt,t.y+.5*t.height,t.width,t.height);else if(e===this.app.RADIUS){var n=.5*t.width,r=.5*t.height;this.gfx.rect(t.x+n,t.y+r,n,r)}},setGraphics:function(t){this.gfx=t},sphere:function(t,e,n){this.mesh(t.toMesh(e),n)},texturedMesh:function(t,e,n){this.gfx.beginShape(this.app.TRIANGLES),this.gfx.texture(e);var r=0,i=t.faces.length;if(n)for(r=0;i>r;r++){var o=t.faces[r];void 0!==o.uvA&&void 0!==o.uvB&&void 0!==o.uvC?(this.gfx.normal(o.a.normal.x,o.a.normal.y,o.a.normal.z),this.gfx.vertex(o.a.x,o.a.y,o.a.z,o.uvA.x,o.uvA.y),this.gfx.normal(o.b.normal.x,o.b.normal.y,o.b.normal.z),this.gfx.vertex(o.b.x,o.b.y,o.b.z,o.uvB.x,o.uvB.y),this.gfx.normal(o.c.normal.x,o.c.normal.y,o.c.normal.z),this.gfx.vertex(o.c.x,o.c.y,o.c.z,o.uvC.x,o.uvC.y)):(this.gfx.vertex(o.a.x,o.a.y,o.a.z),this.gfx.vertex(o.b.x,o.b.y,o.b.z),this.gfx.vertex(o.c.x,o.c.y,o.c.z))}else for(r=0;i>r;r++){var o=t.faces[r];this.gfx.normal(o.normal.x,o.normal.y,o.normal.z),void 0!==o.uvA&&void 0!==o.uvB&&void 0!==o.uvC?(this.gfx.vertex(o.a.x,o.a.y,o.a.z,o.uvA.x,o.uvA.y),this.gfx.vertex(o.b.x,o.b.y,o.b.z,o.uvB.x,o.uvB.y),this.gfx.vertex(o.c.x,o.c.y,o.c.z,o.uvC.x,o.uvC.y)):(this.gfx.vertex(o.a.x,o.a.y,o.a.z),this.gfx.vertex(o.b.x,o.b.y,o.b.z),this.gfx.vertex(o.c.x,o.c.y,o.c.z))}this.gfx.endShape()},triangle:function(t,e){var n=function(){return void 0!==t.a&&void 0!==t.b&&void 0!==t.c?void 0!==t.a.x:!1},r=function(){return n()?void 0!==t.a.z:!1};if((e||void 0===e)&&this.gfx.beginShape(this.app.TRIANGLES),r()){var i=t.computeNormal();this.gfx.normal(i.x,i.y,i.z),this.gfx.vertex(t.a.x,t.a.y,t.a.z),this.gfx.vertex(t.b.x,t.b.y,t.b.z),this.gfx.vertex(t.c.x,t.c.y,t.c.z)}else this.gfx.vertex(t.a.x,t.a.y),this.gfx.vertex(t.b.x,t.b.y),this.gfx.vertex(t.c.x,t.c.y);(e||void 0===e)&&this.gfx.endShape()},vertex:function(t){void 0===t.z?this.gfx.vertex(t.x,t.y):this.gfx.vertex(t.x,t.y,t.z)}},n.exports=a}),n("toxi/processing",["require","exports","module","./processing/ToxiclibsSupport"],function(t,e,n){n.exports={ToxiclibsSupport:t("./processing/ToxiclibsSupport")}}),n("toxi/THREE/ToxiclibsSupport",["../internals/is"],function(t){var e=function(t){if(void 0===THREE)throw new Error("THREE.js has not been loaded");this.scene=t,this.objectDictionary={}};return e.createLineGeometry=function(t,n){return e.createMeshGeometry({vertices:[t.a,t.b]},n)},e.createMeshGeometry=function(e,n){n=n||new THREE.Geometry;var r,i,o,a,s,h={};if(s=t.Array(e)?e:e.vertices,a=s.length,!s)throw new Error("no vertices found");for(i=0;a>i;i++)r=s[i],n.vertices[i]=new THREE.Vector3(r.x,r.y,r.z),h[r.id]=i;if(e.faces)for(a=e.faces.length,i=0;a>i;i++)o=e.faces[i],n.faces[i]=new THREE.Face3(h[o.a.id],h[o.b.id],h[o.c.id],new THREE.Vector3(o.normal.x,o.normal.y,o.normal.z));return n.computeCentroids(),n.computeVertexNormals(),n},e.createMesh=function(t,n){void 0===n&&(n=new THREE.MeshBasicMaterial);var r=e.createMeshGeometry(t);return new THREE.Mesh(r,n)},e.createParticle=function(t,e){var n=new THREE.Particle(e);return n.position.x=t.x,n.position.y=t.y,n.position.z=t.z,n},e.prototype={addLine:function(t,n){void 0===n&&(n=new THREE.LineBasicMaterial);var r=e.createLineGeometry(t),i=new THREE.Line(r,n);return this.scene.add(i),i},addMesh:function(t,e){var n;1==arguments.length?(n=t.geometry,e=t.materials):n=t;var r=this.createMesh(n,e);return this.scene.add(r),r},addParticles:function(e,n){void 0===n&&(n=new THREE.ParticleBasicMaterial),e=t.Array(e)?e:[e];for(var r,i=new THREE.Geometry,o=0,a=e.length;a>o;o++)r=e[o],i.vertices[o]=new THREE.Vector3(r.x,r.y,r.z);var s=new THREE.ParticleSystem(i,n);return this.scene.add(s),i},createMeshGeometry:function(t){return e.createMeshGeometry(t)},createMesh:function(t,n){return e.createMesh(t,n)}},e}),n("toxi/THREE",["require","exports","module","./THREE/ToxiclibsSupport"],function(t,e,n){n.exports={ToxiclibsSupport:t("./THREE/ToxiclibsSupport")}}),n("toxi/util/datatypes/ArraySet",["require","exports","module","../../internals"],function(t,e,n){var r=t("../../internals"),i=function(t){if(Array.apply(this),arguments.length>=1)for(var e=0,n=t.length;n>e;e++){var r=t[e];this.indexOf(r)<0&&this.push(r)}};r.extend(i,Array),r.mixin(i.prototype,{add:function(t){return this.contains(t)?!1:(this.push(t),!0)},addAll:function(t){for(var e=0,n=t.length;n>e;e++)this.push(t[e])},clear:function(){this.retainAll([])},clone:function(){return new i(this)},contains:function(t){return this.indexOf(t)>=0},containsAll:function(t){for(var e=0,n=t.length;n>e;e++){var r=t[e];if(!this.contains(r))return!1}return!0},containsAny:function(t){for(var e=0,n=t.length;n>e;e++)if(this.contains(t[e]))return!0;return!1},equals:function(t){return this===t},get:function(t){return this[t]},iterator:function(){return new r.Iterator(this)},isEmpty:function(){return this.length<1},remove:function(t){var e=this.indexOf(t);return e>=0?(this.splice(e,1),!0):!1},removeAll:function(){this.retainAll([])},retainAll:function(t){for(var e=!1,n=0;n<this.length;n++){var r=this[n];t.indexOf(r)<0&&(this.splice(n,1),e=!0,n--)}return e},size:function(){return this.length},toArray:function(t){t=t||[];for(var e=0;e<this.length;e++)this.hasOwnProperty()&&(t[e]=this[e]);return t}}),n.exports=i}),n("toxi/util/datatypes/UndirectedGraph",["require","exports","module","./ArraySet"],function(t,e,n){var r=t("./ArraySet"),i=function(){this._nodeLinks={},this._nodeIDs=[]};i.prototype={add:function(t){void 0===this._nodeLinks[t]&&(this._nodeLinks[t]=new r,this._nodeIDs.push(t))},connect:function(t,e){if(void 0===this._nodeLinks[t])throw new Error("nodeA has not been added");if(void 0===this._nodeLinks[e])throw new Error("nodeB has not been added");this._nodeLinks[t].push(e),this._nodeLinks[e].push(t)},disconnect:function(t,e){if(void 0===this._nodeLinks[t])throw new Error("nodeA has not been added");if(void 0===this._nodeLinks[e])throw new Error("nodeB has not been added");this._nodeLinks[t].splice(this._nodeLinks[t].indexOf(e),1),this._nodeLinks[e].splice(this._nodeLinks[e].indexOf(t),1)},getConnectedNodesFor:function(t){if(void 0===this._nodeLinks[t])throw new Error("node has not been added");return this._nodeLinks[t]},getNodes:function(){return this._nodeIDs},remove:function(t){var e=this._nodeLinks[t];if(void 0!==e){for(var n=0,r=e.length;r>n;n++){var i=e[n],o=i.indexOf(t);i.splice(o,1)}delete this._nodeLinks[t];var n=this._nodeIDs.indexOf(t);this._nodeIDs.splice(t,1)}}},n.exports=i}),n("toxi/util/datatypes",["require","exports","module","./datatypes/ArraySet","./datatypes/FloatRange","./datatypes/UndirectedGraph"],function(t,e,n){n.exports={ArraySet:t("./datatypes/ArraySet"),FloatRange:t("./datatypes/FloatRange"),UndirectedGraph:t("./datatypes/UndirectedGraph")}}),n("toxi/util",["require","exports","module","./util/datatypes"],function(t,e){e.datatypes=t("./util/datatypes")}),n("toxi/main",["require","exports","./color","./geom","./internals","./math","./physics2d","./processing","./THREE","./util"],function(t,e){e.color=t("./color"),e.geom=t("./geom"),e.internals=t("./internals"),e.math=t("./math"),e.physics2d=t("./physics2d"),e.processing=t("./processing"),e.THREE=t("./THREE"),e.util=t("./util")}),n("toxi",["./toxi/main"],function(t){return t}),n.unordered=!0,toxi=e("toxi"),toxi.VERSION="0.2.7"}();var Delaunay;!function(){"use strict";function t(t){var e,n,r,i,o,a,s=Number.POSITIVE_INFINITY,h=Number.POSITIVE_INFINITY,u=Number.NEGATIVE_INFINITY,c=Number.NEGATIVE_INFINITY;for(e=t.length;e--;)t[e][0]<s&&(s=t[e][0]),t[e][0]>u&&(u=t[e][0]),t[e][1]<h&&(h=t[e][1]),t[e][1]>c&&(c=t[e][1]);return n=u-s,r=c-h,i=Math.max(n,r),o=s+.5*n,a=h+.5*r,[[o-20*i,a-i],[o,a+20*i],[o+20*i,a-i]]}function e(t,e,n,i){var o,a,s,h,u,c,l,f,p,d,m=t[e][0],g=t[e][1],v=t[n][0],y=t[n][1],E=t[i][0],x=t[i][1],T=Math.abs(g-y),b=Math.abs(y-x);if(r>T&&r>b)throw new Error("Eek! Coincident points!");return r>T?(h=-((E-v)/(x-y)),c=(v+E)/2,f=(y+x)/2,o=(v+m)/2,a=h*(o-c)+f):r>b?(s=-((v-m)/(y-g)),u=(m+v)/2,l=(g+y)/2,o=(E+v)/2,a=s*(o-u)+l):(s=-((v-m)/(y-g)),h=-((E-v)/(x-y)),u=(m+v)/2,c=(v+E)/2,l=(g+y)/2,f=(y+x)/2,o=(s*u-h*c+f-l)/(s-h),a=T>b?s*(o-u)+l:h*(o-c)+f),p=v-o,d=y-a,{i:e,j:n,k:i,x:o,y:a,r:p*p+d*d}}function n(t){var e,n,r,i,o,a;for(n=t.length;n;)for(i=t[--n],r=t[--n],e=n;e;)if(a=t[--e],o=t[--e],r===o&&i===a||r===a&&i===o){t.splice(n,2),t.splice(e,2);break}}var r=1/1048576;Delaunay={triangulate:function(i,o){var a,s,h,u,c,l,f,p,d,m,g,v,y=i.length;if(3>y)return[];if(i=i.slice(0),o)for(a=y;a--;)i[a]=i[a][o];for(h=new Array(y),a=y;a--;)h[a]=a;for(h.sort(function(t,e){return i[e][0]-i[t][0]}),u=t(i),i.push(u[0],u[1],u[2]),c=[e(i,y+0,y+1,y+2)],l=[],f=[],a=h.length;a--;f.length=0){for(v=h[a],s=c.length;s--;)p=i[v][0]-c[s].x,p>0&&p*p>c[s].r?(l.push(c[s]),c.splice(s,1)):(d=i[v][1]-c[s].y,p*p+d*d-c[s].r>r||(f.push(c[s].i,c[s].j,c[s].j,c[s].k,c[s].k,c[s].i),c.splice(s,1)));for(n(f),s=f.length;s;)g=f[--s],m=f[--s],c.push(e(i,m,g,v))}for(a=c.length;a--;)l.push(c[a]);for(c.length=0,a=l.length;a--;)l[a].i<y&&l[a].j<y&&l[a].k<y&&c.push(l[a].i,l[a].j,l[a].k);return c},contains:function(t,e){if(e[0]<t[0][0]&&e[0]<t[1][0]&&e[0]<t[2][0]||e[0]>t[0][0]&&e[0]>t[1][0]&&e[0]>t[2][0]||e[1]<t[0][1]&&e[1]<t[1][1]&&e[1]<t[2][1]||e[1]>t[0][1]&&e[1]>t[1][1]&&e[1]>t[2][1])return null;var n=t[1][0]-t[0][0],r=t[2][0]-t[0][0],i=t[1][1]-t[0][1],o=t[2][1]-t[0][1],a=n*o-r*i;if(0===a)return null;var s=(o*(e[0]-t[0][0])-r*(e[1]-t[0][1]))/a,h=(n*(e[1]-t[0][1])-i*(e[0]-t[0][0]))/a;return 0>s||0>h||s+h>1?null:[s,h]}},"undefined"!=typeof module&&(module.exports=Delaunay)}(),!function(){function t(t,e){return e>t?-1:t>e?1:t>=e?0:0/0}function e(t){return null!=t&&!isNaN(t)}function n(t){return{left:function(e,n,r,i){for(arguments.length<3&&(r=0),arguments.length<4&&(i=e.length);i>r;){var o=r+i>>>1;t(e[o],n)<0?r=o+1:i=o}return r},right:function(e,n,r,i){for(arguments.length<3&&(r=0),arguments.length<4&&(i=e.length);i>r;){var o=r+i>>>1;t(e[o],n)>0?i=o:r=o+1}return r}}}function r(t){return t.length}function i(t){for(var e=1;t*e%1;)e*=10;return e}function o(t,e){try{for(var n in e)Object.defineProperty(t.prototype,n,{value:e[n],enumerable:!1})}catch(r){t.prototype=e}}function a(){}function s(t){return as+t in this}function h(t){return t=as+t,t in this&&delete this[t]}function u(){var t=[];return this.forEach(function(e){t.push(e)}),t}function c(){var t=0;for(var e in this)e.charCodeAt(0)===ss&&++t;return t}function l(){for(var t in this)if(t.charCodeAt(0)===ss)return!1;return!0}function f(){}function p(t,e,n){return function(){var r=n.apply(e,arguments);return r===e?t:r}}function d(t,e){if(e in t)return e;e=e.charAt(0).toUpperCase()+e.substring(1);for(var n=0,r=hs.length;r>n;++n){var i=hs[n]+e;if(i in t)return i}}function m(){}function g(){}function v(t){function e(){for(var e,r=n,i=-1,o=r.length;++i<o;)(e=r[i].on)&&e.apply(this,arguments);return t}var n=[],r=new a;return e.on=function(e,i){var o,a=r.get(e);return arguments.length<2?a&&a.on:(a&&(a.on=null,n=n.slice(0,o=n.indexOf(a)).concat(n.slice(o+1)),r.remove(e)),i&&n.push(r.set(e,{on:i})),t)},e}function y(){ja.event.preventDefault()}function E(){for(var t,e=ja.event;t=e.sourceEvent;)e=t;return e}function x(t){for(var e=new g,n=0,r=arguments.length;++n<r;)e[arguments[n]]=v(e);return e.of=function(n,r){return function(i){try{var o=i.sourceEvent=ja.event;i.target=t,ja.event=i,e[i.type].apply(n,r)}finally{ja.event=o}}},e}function T(t){return cs(t,ms),t}function b(t){return"function"==typeof t?t:function(){return ls(t,this)}}function R(t){return"function"==typeof t?t:function(){return fs(t,this)}}function w(t,e){function n(){this.removeAttribute(t)}function r(){this.removeAttributeNS(t.space,t.local)}function i(){this.setAttribute(t,e)}function o(){this.setAttributeNS(t.space,t.local,e)}function a(){var n=e.apply(this,arguments);null==n?this.removeAttribute(t):this.setAttribute(t,n)}function s(){var n=e.apply(this,arguments);null==n?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}return t=ja.ns.qualify(t),null==e?t.local?r:n:"function"==typeof e?t.local?s:a:t.local?o:i}function _(t){return t.trim().replace(/\s+/g," ")}function H(t){return new RegExp("(?:^|\\s+)"+ja.requote(t)+"(?:\\s+|$)","g")}function M(t){return(t+"").trim().split(/^|\s+/)}function S(t,e){function n(){for(var n=-1;++n<i;)t[n](this,e)}function r(){for(var n=-1,r=e.apply(this,arguments);++n<i;)t[n](this,r)}t=M(t).map(C);var i=t.length;return"function"==typeof e?r:n}function C(t){var e=H(t);return function(n,r){if(i=n.classList)return r?i.add(t):i.remove(t);var i=n.getAttribute("class")||"";r?(e.lastIndex=0,e.test(i)||n.setAttribute("class",_(i+" "+t))):n.setAttribute("class",_(i.replace(e," ")))}}function A(t,e,n){function r(){this.style.removeProperty(t)}function i(){this.style.setProperty(t,e,n)}function o(){var r=e.apply(this,arguments);null==r?this.style.removeProperty(t):this.style.setProperty(t,r,n)}return null==e?r:"function"==typeof e?o:i}function L(t,e){function n(){delete this[t]}function r(){this[t]=e}function i(){var n=e.apply(this,arguments);null==n?delete this[t]:this[t]=n}return null==e?n:"function"==typeof e?i:r}function P(t){return"function"==typeof t?t:(t=ja.ns.qualify(t)).local?function(){return this.ownerDocument.createElementNS(t.space,t.local)}:function(){return this.ownerDocument.createElementNS(this.namespaceURI,t)}}function D(t){return{__data__:t}}function z(t){return function(){return ds(this,t)}}function F(e){return arguments.length||(e=t),function(t,n){return t&&n?e(t.__data__,n.__data__):!t-!n}}function k(t,e){for(var n=0,r=t.length;r>n;n++)for(var i,o=t[n],a=0,s=o.length;s>a;a++)(i=o[a])&&e(i,a,n);return t}function N(t){return cs(t,vs),t}function V(t){var e,n;return function(r,i,o){var a,s=t[o].update,h=s.length;for(o!=n&&(n=o,e=0),i>=e&&(e=i+1);!(a=s[e])&&++e<h;);return a}}function I(){var t=this.__transition__;t&&++t.active}function B(t,e,n){function r(){var e=this[a];e&&(this.removeEventListener(t,e,e.$),delete this[a])}function i(){var i=h(e,Xa(arguments));r.call(this),this.addEventListener(t,this[a]=i,i.$=n),i._=e}function o(){var e,n=new RegExp("^__on([^.]+)"+ja.requote(t)+"$");for(var r in this)if(e=r.match(n)){var i=this[r];this.removeEventListener(e[1],i,i.$),delete this[r]}}var a="__on"+t,s=t.indexOf("."),h=U;s>0&&(t=t.substring(0,s));var u=Es.get(t);return u&&(t=u,h=O),s?e?i:r:e?m:o}function U(t,e){return function(n){var r=ja.event;ja.event=n,e[0]=this.__data__;try{t.apply(this,e)}finally{ja.event=r}}}function O(t,e){var n=U(t,e);return function(t){var e=this,r=t.relatedTarget;r&&(r===e||8&r.compareDocumentPosition(e))||n.call(e,t)}}function W(){var t=".dragsuppress-"+ ++Ts,e="click"+t,n=ja.select(Ka).on("touchmove"+t,y).on("dragstart"+t,y).on("selectstart"+t,y);if(xs){var r=Za.style,i=r[xs];r[xs]="none"}return function(o){function a(){n.on(e,null)}n.on(t,null),xs&&(r[xs]=i),o&&(n.on(e,function(){y(),a()},!0),setTimeout(a,0))}}function G(t,e){e.changedTouches&&(e=e.changedTouches[0]);var n=t.ownerSVGElement||t;if(n.createSVGPoint){var r=n.createSVGPoint();if(0>bs&&(Ka.scrollX||Ka.scrollY)){n=ja.select("body").append("svg").style({position:"absolute",top:0,left:0,margin:0,padding:0,border:"none"},"important");var i=n[0][0].getScreenCTM();bs=!(i.f||i.e),n.remove()}return bs?(r.x=e.pageX,r.y=e.pageY):(r.x=e.clientX,r.y=e.clientY),r=r.matrixTransform(t.getScreenCTM().inverse()),[r.x,r.y]}var o=t.getBoundingClientRect();return[e.clientX-o.left-t.clientLeft,e.clientY-o.top-t.clientTop]}function j(){return ja.event.changedTouches[0].identifier}function q(){return ja.event.target}function X(){return Ka}function Y(t){return t>0?1:0>t?-1:0}function Z(t,e,n){return(e[0]-t[0])*(n[1]-t[1])-(e[1]-t[1])*(n[0]-t[0])}function K(t){return t>1?0:-1>t?Rs:Math.acos(t)}function Q(t){return t>1?_s:-1>t?-_s:Math.asin(t)}function $(t){return((t=Math.exp(t))-1/t)/2}function J(t){return((t=Math.exp(t))+1/t)/2}function te(t){return((t=Math.exp(2*t))-1)/(t+1)}function ee(t){return(t=Math.sin(t/2))*t}function ne(){}function re(t,e,n){return this instanceof re?(this.h=+t,this.s=+e,void(this.l=+n)):arguments.length<2?t instanceof re?new re(t.h,t.s,t.l):ve(""+t,ye,re):new re(t,e,n)}function ie(t,e,n){function r(t){return t>360?t-=360:0>t&&(t+=360),60>t?o+(a-o)*t/60:180>t?a:240>t?o+(a-o)*(240-t)/60:o}function i(t){return Math.round(255*r(t))}var o,a;return t=isNaN(t)?0:(t%=360)<0?t+360:t,e=isNaN(e)?0:0>e?0:e>1?1:e,n=0>n?0:n>1?1:n,a=.5>=n?n*(1+e):n+e-n*e,o=2*n-a,new pe(i(t+120),i(t),i(t-120))}function oe(t,e,n){return this instanceof oe?(this.h=+t,this.c=+e,void(this.l=+n)):arguments.length<2?t instanceof oe?new oe(t.h,t.c,t.l):t instanceof se?ue(t.l,t.a,t.b):ue((t=Ee((t=ja.rgb(t)).r,t.g,t.b)).l,t.a,t.b):new oe(t,e,n)}function ae(t,e,n){return isNaN(t)&&(t=0),isNaN(e)&&(e=0),new se(n,Math.cos(t*=Ss)*e,Math.sin(t)*e)}function se(t,e,n){return this instanceof se?(this.l=+t,this.a=+e,void(this.b=+n)):arguments.length<2?t instanceof se?new se(t.l,t.a,t.b):t instanceof oe?ae(t.l,t.c,t.h):Ee((t=pe(t)).r,t.g,t.b):new se(t,e,n)}function he(t,e,n){var r=(t+16)/116,i=r+e/500,o=r-n/200;return i=ce(i)*Is,r=ce(r)*Bs,o=ce(o)*Us,new pe(fe(3.2404542*i-1.5371385*r-.4985314*o),fe(-.969266*i+1.8760108*r+.041556*o),fe(.0556434*i-.2040259*r+1.0572252*o))}function ue(t,e,n){return t>0?new oe(Math.atan2(n,e)*Cs,Math.sqrt(e*e+n*n),t):new oe(0/0,0/0,t)}function ce(t){return t>.206893034?t*t*t:(t-4/29)/7.787037}function le(t){return t>.008856?Math.pow(t,1/3):7.787037*t+4/29
}function fe(t){return Math.round(255*(.00304>=t?12.92*t:1.055*Math.pow(t,1/2.4)-.055))}function pe(t,e,n){return this instanceof pe?(this.r=~~t,this.g=~~e,void(this.b=~~n)):arguments.length<2?t instanceof pe?new pe(t.r,t.g,t.b):ve(""+t,pe,ie):new pe(t,e,n)}function de(t){return new pe(t>>16,255&t>>8,255&t)}function me(t){return de(t)+""}function ge(t){return 16>t?"0"+Math.max(0,t).toString(16):Math.min(255,t).toString(16)}function ve(t,e,n){var r,i,o,a=0,s=0,h=0;if(r=/([a-z]+)\((.*)\)/i.exec(t))switch(i=r[2].split(","),r[1]){case"hsl":return n(parseFloat(i[0]),parseFloat(i[1])/100,parseFloat(i[2])/100);case"rgb":return e(Te(i[0]),Te(i[1]),Te(i[2]))}return(o=Gs.get(t))?e(o.r,o.g,o.b):(null==t||"#"!==t.charAt(0)||isNaN(o=parseInt(t.substring(1),16))||(4===t.length?(a=(3840&o)>>4,a=a>>4|a,s=240&o,s=s>>4|s,h=15&o,h=h<<4|h):7===t.length&&(a=(16711680&o)>>16,s=(65280&o)>>8,h=255&o)),e(a,s,h))}function ye(t,e,n){var r,i,o=Math.min(t/=255,e/=255,n/=255),a=Math.max(t,e,n),s=a-o,h=(a+o)/2;return s?(i=.5>h?s/(a+o):s/(2-a-o),r=t==a?(e-n)/s+(n>e?6:0):e==a?(n-t)/s+2:(t-e)/s+4,r*=60):(r=0/0,i=h>0&&1>h?0:r),new re(r,i,h)}function Ee(t,e,n){t=xe(t),e=xe(e),n=xe(n);var r=le((.4124564*t+.3575761*e+.1804375*n)/Is),i=le((.2126729*t+.7151522*e+.072175*n)/Bs),o=le((.0193339*t+.119192*e+.9503041*n)/Us);return se(116*i-16,500*(r-i),200*(i-o))}function xe(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function Te(t){var e=parseFloat(t);return"%"===t.charAt(t.length-1)?Math.round(2.55*e):e}function be(t){return"function"==typeof t?t:function(){return t}}function Re(t){return t}function we(t){return function(e,n,r){return 2===arguments.length&&"function"==typeof n&&(r=n,n=null),_e(e,n,t,r)}}function _e(t,e,n,r){function i(){var t,e=h.status;if(!e&&h.responseText||e>=200&&300>e||304===e){try{t=n.call(o,h)}catch(r){return void a.error.call(o,r)}a.load.call(o,t)}else a.error.call(o,h)}var o={},a=ja.dispatch("beforesend","progress","load","error"),s={},h=new XMLHttpRequest,u=null;return!Ka.XDomainRequest||"withCredentials"in h||!/^(http(s)?:)?\/\//.test(t)||(h=new XDomainRequest),"onload"in h?h.onload=h.onerror=i:h.onreadystatechange=function(){h.readyState>3&&i()},h.onprogress=function(t){var e=ja.event;ja.event=t;try{a.progress.call(o,h)}finally{ja.event=e}},o.header=function(t,e){return t=(t+"").toLowerCase(),arguments.length<2?s[t]:(null==e?delete s[t]:s[t]=e+"",o)},o.mimeType=function(t){return arguments.length?(e=null==t?null:t+"",o):e},o.responseType=function(t){return arguments.length?(u=t,o):u},o.response=function(t){return n=t,o},["get","post"].forEach(function(t){o[t]=function(){return o.send.apply(o,[t].concat(Xa(arguments)))}}),o.send=function(n,r,i){if(2===arguments.length&&"function"==typeof r&&(i=r,r=null),h.open(n,t,!0),null==e||"accept"in s||(s.accept=e+",*/*"),h.setRequestHeader)for(var c in s)h.setRequestHeader(c,s[c]);return null!=e&&h.overrideMimeType&&h.overrideMimeType(e),null!=u&&(h.responseType=u),null!=i&&o.on("error",i).on("load",function(t){i(null,t)}),a.beforesend.call(o,h),h.send(null==r?null:r),o},o.abort=function(){return h.abort(),o},ja.rebind(o,a,"on"),null==r?o:o.get(He(r))}function He(t){return 1===t.length?function(e,n){t(null==e?n:null)}:t}function Me(){var t=Se(),e=Ce()-t;e>24?(isFinite(e)&&(clearTimeout(Ys),Ys=setTimeout(Me,e)),Xs=0):(Xs=1,Ks(Me))}function Se(){var t=Date.now();for(Zs=js;Zs;)t>=Zs.t&&(Zs.f=Zs.c(t-Zs.t)),Zs=Zs.n;return t}function Ce(){for(var t,e=js,n=1/0;e;)e.f?e=t?t.n=e.n:js=e.n:(e.t<n&&(n=e.t),e=(t=e).n);return qs=t,n}function Ae(t,e){return e-(t?Math.ceil(Math.log(t)/Math.LN10):1)}function Le(t,e){var n=Math.pow(10,3*os(8-e));return{scale:e>8?function(t){return t/n}:function(t){return t*n},symbol:t}}function Pe(t){var e=t.decimal,n=t.thousands,r=t.grouping,i=t.currency,o=r?function(t){for(var e=t.length,i=[],o=0,a=r[0];e>0&&a>0;)i.push(t.substring(e-=a,e+a)),a=r[o=(o+1)%r.length];return i.reverse().join(n)}:Re;return function(t){var n=$s.exec(t),r=n[1]||" ",a=n[2]||">",s=n[3]||"",h=n[4]||"",u=n[5],c=+n[6],l=n[7],f=n[8],p=n[9],d=1,m="",g="",v=!1;switch(f&&(f=+f.substring(1)),(u||"0"===r&&"="===a)&&(u=r="0",a="=",l&&(c-=Math.floor((c-1)/4))),p){case"n":l=!0,p="g";break;case"%":d=100,g="%",p="f";break;case"p":d=100,g="%",p="r";break;case"b":case"o":case"x":case"X":"#"===h&&(m="0"+p.toLowerCase());case"c":case"d":v=!0,f=0;break;case"s":d=-1,p="r"}"$"===h&&(m=i[0],g=i[1]),"r"!=p||f||(p="g"),null!=f&&("g"==p?f=Math.max(1,Math.min(21,f)):("e"==p||"f"==p)&&(f=Math.max(0,Math.min(20,f)))),p=Js.get(p)||De;var y=u&&l;return function(t){var n=g;if(v&&t%1)return"";var i=0>t||0===t&&0>1/t?(t=-t,"-"):s;if(0>d){var h=ja.formatPrefix(t,f);t=h.scale(t),n=h.symbol+g}else t*=d;t=p(t,f);var E=t.lastIndexOf("."),x=0>E?t:t.substring(0,E),T=0>E?"":e+t.substring(E+1);!u&&l&&(x=o(x));var b=m.length+x.length+T.length+(y?0:i.length),R=c>b?new Array(b=c-b+1).join(r):"";return y&&(x=o(R+x)),i+=m,t=x+T,("<"===a?i+t+R:">"===a?R+i+t:"^"===a?R.substring(0,b>>=1)+i+t+R.substring(b):i+(y?t:R+t))+n}}}function De(t){return t+""}function ze(){this._=new Date(arguments.length>1?Date.UTC.apply(this,arguments):arguments[0])}function Fe(t,e,n){function r(e){var n=t(e),r=o(n,1);return r-e>e-n?n:r}function i(n){return e(n=t(new eh(n-1)),1),n}function o(t,n){return e(t=new eh(+t),n),t}function a(t,r,o){var a=i(t),s=[];if(o>1)for(;r>a;)n(a)%o||s.push(new Date(+a)),e(a,1);else for(;r>a;)s.push(new Date(+a)),e(a,1);return s}function s(t,e,n){try{eh=ze;var r=new ze;return r._=t,a(r,e,n)}finally{eh=Date}}t.floor=t,t.round=r,t.ceil=i,t.offset=o,t.range=a;var h=t.utc=ke(t);return h.floor=h,h.round=ke(r),h.ceil=ke(i),h.offset=ke(o),h.range=s,t}function ke(t){return function(e,n){try{eh=ze;var r=new ze;return r._=e,t(r,n)._}finally{eh=Date}}}function Ne(t){function e(t){function e(e){for(var n,i,o,a=[],s=-1,h=0;++s<r;)37===t.charCodeAt(s)&&(a.push(t.substring(h,s)),null!=(i=rh[n=t.charAt(++s)])&&(n=t.charAt(++s)),(o=S[n])&&(n=o(e,null==i?"e"===n?" ":"0":i)),a.push(n),h=s+1);return a.push(t.substring(h,s)),a.join("")}var r=t.length;return e.parse=function(e){var r={y:1900,m:0,d:1,H:0,M:0,S:0,L:0,Z:null},i=n(r,t,e,0);if(i!=e.length)return null;"p"in r&&(r.H=r.H%12+12*r.p);var o=null!=r.Z&&eh!==ze,a=new(o?ze:eh);return"j"in r?a.setFullYear(r.y,0,r.j):"w"in r&&("W"in r||"U"in r)?(a.setFullYear(r.y,0,1),a.setFullYear(r.y,0,"W"in r?(r.w+6)%7+7*r.W-(a.getDay()+5)%7:r.w+7*r.U-(a.getDay()+6)%7)):a.setFullYear(r.y,r.m,r.d),a.setHours(r.H+Math.floor(r.Z/100),r.M+r.Z%100,r.S,r.L),o?a._:a},e.toString=function(){return t},e}function n(t,e,n,r){for(var i,o,a,s=0,h=e.length,u=n.length;h>s;){if(r>=u)return-1;if(i=e.charCodeAt(s++),37===i){if(a=e.charAt(s++),o=C[a in rh?e.charAt(s++):a],!o||(r=o(t,n,r))<0)return-1}else if(i!=n.charCodeAt(r++))return-1}return r}function r(t,e,n){b.lastIndex=0;var r=b.exec(e.substring(n));return r?(t.w=R.get(r[0].toLowerCase()),n+r[0].length):-1}function i(t,e,n){x.lastIndex=0;var r=x.exec(e.substring(n));return r?(t.w=T.get(r[0].toLowerCase()),n+r[0].length):-1}function o(t,e,n){H.lastIndex=0;var r=H.exec(e.substring(n));return r?(t.m=M.get(r[0].toLowerCase()),n+r[0].length):-1}function a(t,e,n){w.lastIndex=0;var r=w.exec(e.substring(n));return r?(t.m=_.get(r[0].toLowerCase()),n+r[0].length):-1}function s(t,e,r){return n(t,S.c.toString(),e,r)}function h(t,e,r){return n(t,S.x.toString(),e,r)}function u(t,e,r){return n(t,S.X.toString(),e,r)}function c(t,e,n){var r=E.get(e.substring(n,n+=2).toLowerCase());return null==r?-1:(t.p=r,n)}var l=t.dateTime,f=t.date,p=t.time,d=t.periods,m=t.days,g=t.shortDays,v=t.months,y=t.shortMonths;e.utc=function(t){function n(t){try{eh=ze;var e=new eh;return e._=t,r(e)}finally{eh=Date}}var r=e(t);return n.parse=function(t){try{eh=ze;var e=r.parse(t);return e&&e._}finally{eh=Date}},n.toString=r.toString,n},e.multi=e.utc.multi=rn;var E=ja.map(),x=Ie(m),T=Be(m),b=Ie(g),R=Be(g),w=Ie(v),_=Be(v),H=Ie(y),M=Be(y);d.forEach(function(t,e){E.set(t.toLowerCase(),e)});var S={a:function(t){return g[t.getDay()]},A:function(t){return m[t.getDay()]},b:function(t){return y[t.getMonth()]},B:function(t){return v[t.getMonth()]},c:e(l),d:function(t,e){return Ve(t.getDate(),e,2)},e:function(t,e){return Ve(t.getDate(),e,2)},H:function(t,e){return Ve(t.getHours(),e,2)},I:function(t,e){return Ve(t.getHours()%12||12,e,2)},j:function(t,e){return Ve(1+th.dayOfYear(t),e,3)},L:function(t,e){return Ve(t.getMilliseconds(),e,3)},m:function(t,e){return Ve(t.getMonth()+1,e,2)},M:function(t,e){return Ve(t.getMinutes(),e,2)},p:function(t){return d[+(t.getHours()>=12)]},S:function(t,e){return Ve(t.getSeconds(),e,2)},U:function(t,e){return Ve(th.sundayOfYear(t),e,2)},w:function(t){return t.getDay()},W:function(t,e){return Ve(th.mondayOfYear(t),e,2)},x:e(f),X:e(p),y:function(t,e){return Ve(t.getFullYear()%100,e,2)},Y:function(t,e){return Ve(t.getFullYear()%1e4,e,4)},Z:en,"%":function(){return"%"}},C={a:r,A:i,b:o,B:a,c:s,d:Ze,e:Ze,H:Qe,I:Qe,j:Ke,L:tn,m:Ye,M:$e,p:c,S:Je,U:Oe,w:Ue,W:We,x:h,X:u,y:je,Y:Ge,Z:qe,"%":nn};return e}function Ve(t,e,n){var r=0>t?"-":"",i=(r?-t:t)+"",o=i.length;return r+(n>o?new Array(n-o+1).join(e)+i:i)}function Ie(t){return new RegExp("^(?:"+t.map(ja.requote).join("|")+")","i")}function Be(t){for(var e=new a,n=-1,r=t.length;++n<r;)e.set(t[n].toLowerCase(),n);return e}function Ue(t,e,n){ih.lastIndex=0;var r=ih.exec(e.substring(n,n+1));return r?(t.w=+r[0],n+r[0].length):-1}function Oe(t,e,n){ih.lastIndex=0;var r=ih.exec(e.substring(n));return r?(t.U=+r[0],n+r[0].length):-1}function We(t,e,n){ih.lastIndex=0;var r=ih.exec(e.substring(n));return r?(t.W=+r[0],n+r[0].length):-1}function Ge(t,e,n){ih.lastIndex=0;var r=ih.exec(e.substring(n,n+4));return r?(t.y=+r[0],n+r[0].length):-1}function je(t,e,n){ih.lastIndex=0;var r=ih.exec(e.substring(n,n+2));return r?(t.y=Xe(+r[0]),n+r[0].length):-1}function qe(t,e,n){return/^[+-]\d{4}$/.test(e=e.substring(n,n+5))?(t.Z=-e,n+5):-1}function Xe(t){return t+(t>68?1900:2e3)}function Ye(t,e,n){ih.lastIndex=0;var r=ih.exec(e.substring(n,n+2));return r?(t.m=r[0]-1,n+r[0].length):-1}function Ze(t,e,n){ih.lastIndex=0;var r=ih.exec(e.substring(n,n+2));return r?(t.d=+r[0],n+r[0].length):-1}function Ke(t,e,n){ih.lastIndex=0;var r=ih.exec(e.substring(n,n+3));return r?(t.j=+r[0],n+r[0].length):-1}function Qe(t,e,n){ih.lastIndex=0;var r=ih.exec(e.substring(n,n+2));return r?(t.H=+r[0],n+r[0].length):-1}function $e(t,e,n){ih.lastIndex=0;var r=ih.exec(e.substring(n,n+2));return r?(t.M=+r[0],n+r[0].length):-1}function Je(t,e,n){ih.lastIndex=0;var r=ih.exec(e.substring(n,n+2));return r?(t.S=+r[0],n+r[0].length):-1}function tn(t,e,n){ih.lastIndex=0;var r=ih.exec(e.substring(n,n+3));return r?(t.L=+r[0],n+r[0].length):-1}function en(t){var e=t.getTimezoneOffset(),n=e>0?"-":"+",r=~~(os(e)/60),i=os(e)%60;return n+Ve(r,"0",2)+Ve(i,"0",2)}function nn(t,e,n){oh.lastIndex=0;var r=oh.exec(e.substring(n,n+1));return r?n+r[0].length:-1}function rn(t){for(var e=t.length,n=-1;++n<e;)t[n][0]=this(t[n][0]);return function(e){for(var n=0,r=t[n];!r[1](e);)r=t[++n];return r[0](e)}}function on(){}function an(t,e,n){var r=n.s=t+e,i=r-t,o=r-i;n.t=t-o+(e-i)}function sn(t,e){t&&uh.hasOwnProperty(t.type)&&uh[t.type](t,e)}function hn(t,e,n){var r,i=-1,o=t.length-n;for(e.lineStart();++i<o;)r=t[i],e.point(r[0],r[1],r[2]);e.lineEnd()}function un(t,e){var n=-1,r=t.length;for(e.polygonStart();++n<r;)hn(t[n],e,1);e.polygonEnd()}function cn(){function t(t,e){t*=Ss,e=e*Ss/2+Rs/4;var n=t-r,a=n>=0?1:-1,s=a*n,h=Math.cos(e),u=Math.sin(e),c=o*u,l=i*h+c*Math.cos(s),f=c*a*Math.sin(s);lh.add(Math.atan2(f,l)),r=t,i=h,o=u}var e,n,r,i,o;fh.point=function(a,s){fh.point=t,r=(e=a)*Ss,i=Math.cos(s=(n=s)*Ss/2+Rs/4),o=Math.sin(s)},fh.lineEnd=function(){t(e,n)}}function ln(t){var e=t[0],n=t[1],r=Math.cos(n);return[r*Math.cos(e),r*Math.sin(e),Math.sin(n)]}function fn(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function pn(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}function dn(t,e){t[0]+=e[0],t[1]+=e[1],t[2]+=e[2]}function mn(t,e){return[t[0]*e,t[1]*e,t[2]*e]}function gn(t){var e=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]/=e,t[1]/=e,t[2]/=e}function vn(t){return[Math.atan2(t[1],t[0]),Q(t[2])]}function yn(t,e){return os(t[0]-e[0])<Hs&&os(t[1]-e[1])<Hs}function En(t,e){t*=Ss;var n=Math.cos(e*=Ss);xn(n*Math.cos(t),n*Math.sin(t),Math.sin(e))}function xn(t,e,n){++ph,mh+=(t-mh)/ph,gh+=(e-gh)/ph,vh+=(n-vh)/ph}function Tn(){function t(t,i){t*=Ss;var o=Math.cos(i*=Ss),a=o*Math.cos(t),s=o*Math.sin(t),h=Math.sin(i),u=Math.atan2(Math.sqrt((u=n*h-r*s)*u+(u=r*a-e*h)*u+(u=e*s-n*a)*u),e*a+n*s+r*h);dh+=u,yh+=u*(e+(e=a)),Eh+=u*(n+(n=s)),xh+=u*(r+(r=h)),xn(e,n,r)}var e,n,r;wh.point=function(i,o){i*=Ss;var a=Math.cos(o*=Ss);e=a*Math.cos(i),n=a*Math.sin(i),r=Math.sin(o),wh.point=t,xn(e,n,r)}}function bn(){wh.point=En}function Rn(){function t(t,e){t*=Ss;var n=Math.cos(e*=Ss),a=n*Math.cos(t),s=n*Math.sin(t),h=Math.sin(e),u=i*h-o*s,c=o*a-r*h,l=r*s-i*a,f=Math.sqrt(u*u+c*c+l*l),p=r*a+i*s+o*h,d=f&&-K(p)/f,m=Math.atan2(f,p);Th+=d*u,bh+=d*c,Rh+=d*l,dh+=m,yh+=m*(r+(r=a)),Eh+=m*(i+(i=s)),xh+=m*(o+(o=h)),xn(r,i,o)}var e,n,r,i,o;wh.point=function(a,s){e=a,n=s,wh.point=t,a*=Ss;var h=Math.cos(s*=Ss);r=h*Math.cos(a),i=h*Math.sin(a),o=Math.sin(s),xn(r,i,o)},wh.lineEnd=function(){t(e,n),wh.lineEnd=bn,wh.point=En}}function wn(){return!0}function _n(t,e,n,r,i){var o=[],a=[];if(t.forEach(function(t){if(!((e=t.length-1)<=0)){var e,n=t[0],r=t[e];if(yn(n,r)){i.lineStart();for(var s=0;e>s;++s)i.point((n=t[s])[0],n[1]);return void i.lineEnd()}var h=new Mn(n,t,null,!0),u=new Mn(n,null,h,!1);h.o=u,o.push(h),a.push(u),h=new Mn(r,t,null,!1),u=new Mn(r,null,h,!0),h.o=u,o.push(h),a.push(u)}}),a.sort(e),Hn(o),Hn(a),o.length){for(var s=0,h=n,u=a.length;u>s;++s)a[s].e=h=!h;for(var c,l,f=o[0];;){for(var p=f,d=!0;p.v;)if((p=p.n)===f)return;c=p.z,i.lineStart();do{if(p.v=p.o.v=!0,p.e){if(d)for(var s=0,u=c.length;u>s;++s)i.point((l=c[s])[0],l[1]);else r(p.x,p.n.x,1,i);p=p.n}else{if(d){c=p.p.z;for(var s=c.length-1;s>=0;--s)i.point((l=c[s])[0],l[1])}else r(p.x,p.p.x,-1,i);p=p.p}p=p.o,c=p.z,d=!d}while(!p.v);i.lineEnd()}}}function Hn(t){if(e=t.length){for(var e,n,r=0,i=t[0];++r<e;)i.n=n=t[r],n.p=i,i=n;i.n=n=t[0],n.p=i}}function Mn(t,e,n,r){this.x=t,this.z=e,this.o=n,this.e=r,this.v=!1,this.n=this.p=null}function Sn(t,e,n,r){return function(i,o){function a(e,n){var r=i(e,n);t(e=r[0],n=r[1])&&o.point(e,n)}function s(t,e){var n=i(t,e);g.point(n[0],n[1])}function h(){y.point=s,g.lineStart()}function u(){y.point=a,g.lineEnd()}function c(t,e){m.push([t,e]);var n=i(t,e);x.point(n[0],n[1])}function l(){x.lineStart(),m=[]}function f(){c(m[0][0],m[0][1]),x.lineEnd();var t,e=x.clean(),n=E.buffer(),r=n.length;if(m.pop(),d.push(m),m=null,r)if(1&e){t=n[0];var i,r=t.length-1,a=-1;if(r>0){for(T||(o.polygonStart(),T=!0),o.lineStart();++a<r;)o.point((i=t[a])[0],i[1]);o.lineEnd()}}else r>1&&2&e&&n.push(n.pop().concat(n.shift())),p.push(n.filter(Cn))}var p,d,m,g=e(o),v=i.invert(r[0],r[1]),y={point:a,lineStart:h,lineEnd:u,polygonStart:function(){y.point=c,y.lineStart=l,y.lineEnd=f,p=[],d=[]},polygonEnd:function(){y.point=a,y.lineStart=h,y.lineEnd=u,p=ja.merge(p);var t=Pn(v,d);p.length?(T||(o.polygonStart(),T=!0),_n(p,Ln,t,n,o)):t&&(T||(o.polygonStart(),T=!0),o.lineStart(),n(null,null,1,o),o.lineEnd()),T&&(o.polygonEnd(),T=!1),p=d=null},sphere:function(){o.polygonStart(),o.lineStart(),n(null,null,1,o),o.lineEnd(),o.polygonEnd()}},E=An(),x=e(E),T=!1;return y}}function Cn(t){return t.length>1}function An(){var t,e=[];return{lineStart:function(){e.push(t=[])},point:function(e,n){t.push([e,n])},lineEnd:m,buffer:function(){var n=e;return e=[],t=null,n},rejoin:function(){e.length>1&&e.push(e.pop().concat(e.shift()))}}}function Ln(t,e){return((t=t.x)[0]<0?t[1]-_s-Hs:_s-t[1])-((e=e.x)[0]<0?e[1]-_s-Hs:_s-e[1])}function Pn(t,e){var n=t[0],r=t[1],i=[Math.sin(n),-Math.cos(n),0],o=0,a=0;lh.reset();for(var s=0,h=e.length;h>s;++s){var u=e[s],c=u.length;if(c)for(var l=u[0],f=l[0],p=l[1]/2+Rs/4,d=Math.sin(p),m=Math.cos(p),g=1;;){g===c&&(g=0),t=u[g];var v=t[0],y=t[1]/2+Rs/4,E=Math.sin(y),x=Math.cos(y),T=v-f,b=T>=0?1:-1,R=b*T,w=R>Rs,_=d*E;if(lh.add(Math.atan2(_*b*Math.sin(R),m*x+_*Math.cos(R))),o+=w?T+b*ws:T,w^f>=n^v>=n){var H=pn(ln(l),ln(t));gn(H);var M=pn(i,H);gn(M);var S=(w^T>=0?-1:1)*Q(M[2]);(r>S||r===S&&(H[0]||H[1]))&&(a+=w^T>=0?1:-1)}if(!g++)break;f=v,d=E,m=x,l=t}}return(-Hs>o||Hs>o&&0>lh)^1&a}function Dn(t){var e,n=0/0,r=0/0,i=0/0;return{lineStart:function(){t.lineStart(),e=1},point:function(o,a){var s=o>0?Rs:-Rs,h=os(o-n);os(h-Rs)<Hs?(t.point(n,r=(r+a)/2>0?_s:-_s),t.point(i,r),t.lineEnd(),t.lineStart(),t.point(s,r),t.point(o,r),e=0):i!==s&&h>=Rs&&(os(n-i)<Hs&&(n-=i*Hs),os(o-s)<Hs&&(o-=s*Hs),r=zn(n,r,o,a),t.point(i,r),t.lineEnd(),t.lineStart(),t.point(s,r),e=0),t.point(n=o,r=a),i=s},lineEnd:function(){t.lineEnd(),n=r=0/0},clean:function(){return 2-e}}}function zn(t,e,n,r){var i,o,a=Math.sin(t-n);return os(a)>Hs?Math.atan((Math.sin(e)*(o=Math.cos(r))*Math.sin(n)-Math.sin(r)*(i=Math.cos(e))*Math.sin(t))/(i*o*a)):(e+r)/2}function Fn(t,e,n,r){var i;if(null==t)i=n*_s,r.point(-Rs,i),r.point(0,i),r.point(Rs,i),r.point(Rs,0),r.point(Rs,-i),r.point(0,-i),r.point(-Rs,-i),r.point(-Rs,0),r.point(-Rs,i);else if(os(t[0]-e[0])>Hs){var o=t[0]<e[0]?Rs:-Rs;i=n*o/2,r.point(-o,i),r.point(0,i),r.point(o,i)}else r.point(e[0],e[1])}function kn(t){function e(t,e){return Math.cos(t)*Math.cos(e)>o}function n(t){var n,o,h,u,c;return{lineStart:function(){u=h=!1,c=1},point:function(l,f){var p,d=[l,f],m=e(l,f),g=a?m?0:i(l,f):m?i(l+(0>l?Rs:-Rs),f):0;if(!n&&(u=h=m)&&t.lineStart(),m!==h&&(p=r(n,d),(yn(n,p)||yn(d,p))&&(d[0]+=Hs,d[1]+=Hs,m=e(d[0],d[1]))),m!==h)c=0,m?(t.lineStart(),p=r(d,n),t.point(p[0],p[1])):(p=r(n,d),t.point(p[0],p[1]),t.lineEnd()),n=p;else if(s&&n&&a^m){var v;g&o||!(v=r(d,n,!0))||(c=0,a?(t.lineStart(),t.point(v[0][0],v[0][1]),t.point(v[1][0],v[1][1]),t.lineEnd()):(t.point(v[1][0],v[1][1]),t.lineEnd(),t.lineStart(),t.point(v[0][0],v[0][1])))}!m||n&&yn(n,d)||t.point(d[0],d[1]),n=d,h=m,o=g},lineEnd:function(){h&&t.lineEnd(),n=null},clean:function(){return c|(u&&h)<<1}}}function r(t,e,n){var r=ln(t),i=ln(e),a=[1,0,0],s=pn(r,i),h=fn(s,s),u=s[0],c=h-u*u;if(!c)return!n&&t;var l=o*h/c,f=-o*u/c,p=pn(a,s),d=mn(a,l),m=mn(s,f);dn(d,m);var g=p,v=fn(d,g),y=fn(g,g),E=v*v-y*(fn(d,d)-1);if(!(0>E)){var x=Math.sqrt(E),T=mn(g,(-v-x)/y);if(dn(T,d),T=vn(T),!n)return T;var b,R=t[0],w=e[0],_=t[1],H=e[1];R>w&&(b=R,R=w,w=b);var M=w-R,S=os(M-Rs)<Hs,C=S||Hs>M;if(!S&&_>H&&(b=_,_=H,H=b),C?S?_+H>0^T[1]<(os(T[0]-R)<Hs?_:H):_<=T[1]&&T[1]<=H:M>Rs^(R<=T[0]&&T[0]<=w)){var A=mn(g,(-v+x)/y);return dn(A,d),[T,vn(A)]}}}function i(e,n){var r=a?t:Rs-t,i=0;return-r>e?i|=1:e>r&&(i|=2),-r>n?i|=4:n>r&&(i|=8),i}var o=Math.cos(t),a=o>0,s=os(o)>Hs,h=cr(t,6*Ss);return Sn(e,n,h,a?[0,-t]:[-Rs,t-Rs])}function Nn(t,e,n,r){return function(i){var o,a=i.a,s=i.b,h=a.x,u=a.y,c=s.x,l=s.y,f=0,p=1,d=c-h,m=l-u;if(o=t-h,d||!(o>0)){if(o/=d,0>d){if(f>o)return;p>o&&(p=o)}else if(d>0){if(o>p)return;o>f&&(f=o)}if(o=n-h,d||!(0>o)){if(o/=d,0>d){if(o>p)return;o>f&&(f=o)}else if(d>0){if(f>o)return;p>o&&(p=o)}if(o=e-u,m||!(o>0)){if(o/=m,0>m){if(f>o)return;p>o&&(p=o)}else if(m>0){if(o>p)return;o>f&&(f=o)}if(o=r-u,m||!(0>o)){if(o/=m,0>m){if(o>p)return;o>f&&(f=o)}else if(m>0){if(f>o)return;p>o&&(p=o)}return f>0&&(i.a={x:h+f*d,y:u+f*m}),1>p&&(i.b={x:h+p*d,y:u+p*m}),i}}}}}}function Vn(t,e,n,r){function i(r,i){return os(r[0]-t)<Hs?i>0?0:3:os(r[0]-n)<Hs?i>0?2:1:os(r[1]-e)<Hs?i>0?1:0:i>0?3:2}function o(t,e){return a(t.x,e.x)}function a(t,e){var n=i(t,1),r=i(e,1);return n!==r?n-r:0===n?e[1]-t[1]:1===n?t[0]-e[0]:2===n?t[1]-e[1]:e[0]-t[0]}return function(s){function h(t){for(var e=0,n=g.length,r=t[1],i=0;n>i;++i)for(var o,a=1,s=g[i],h=s.length,u=s[0];h>a;++a)o=s[a],u[1]<=r?o[1]>r&&Z(u,o,t)>0&&++e:o[1]<=r&&Z(u,o,t)<0&&--e,u=o;return 0!==e}function u(o,s,h,u){var c=0,l=0;if(null==o||(c=i(o,h))!==(l=i(s,h))||a(o,s)<0^h>0){do u.point(0===c||3===c?t:n,c>1?r:e);while((c=(c+h+4)%4)!==l)}else u.point(s[0],s[1])}function c(i,o){return i>=t&&n>=i&&o>=e&&r>=o}function l(t,e){c(t,e)&&s.point(t,e)}function f(){C.point=d,g&&g.push(v=[]),w=!0,R=!1,T=b=0/0}function p(){m&&(d(y,E),x&&R&&M.rejoin(),m.push(M.buffer())),C.point=l,R&&s.lineEnd()}function d(t,e){t=Math.max(-Hh,Math.min(Hh,t)),e=Math.max(-Hh,Math.min(Hh,e));var n=c(t,e);if(g&&v.push([t,e]),w)y=t,E=e,x=n,w=!1,n&&(s.lineStart(),s.point(t,e));else if(n&&R)s.point(t,e);else{var r={a:{x:T,y:b},b:{x:t,y:e}};S(r)?(R||(s.lineStart(),s.point(r.a.x,r.a.y)),s.point(r.b.x,r.b.y),n||s.lineEnd(),_=!1):n&&(s.lineStart(),s.point(t,e),_=!1)}T=t,b=e,R=n}var m,g,v,y,E,x,T,b,R,w,_,H=s,M=An(),S=Nn(t,e,n,r),C={point:l,lineStart:f,lineEnd:p,polygonStart:function(){s=M,m=[],g=[],_=!0},polygonEnd:function(){s=H,m=ja.merge(m);var e=h([t,r]),n=_&&e,i=m.length;(n||i)&&(s.polygonStart(),n&&(s.lineStart(),u(null,null,1,s),s.lineEnd()),i&&_n(m,o,e,u,s),s.polygonEnd()),m=g=v=null}};return C}}function In(t,e){function n(n,r){return n=t(n,r),e(n[0],n[1])}return t.invert&&e.invert&&(n.invert=function(n,r){return n=e.invert(n,r),n&&t.invert(n[0],n[1])}),n}function Bn(t){var e=0,n=Rs/3,r=nr(t),i=r(e,n);return i.parallels=function(t){return arguments.length?r(e=t[0]*Rs/180,n=t[1]*Rs/180):[180*(e/Rs),180*(n/Rs)]},i}function Un(t,e){function n(t,e){var n=Math.sqrt(o-2*i*Math.sin(e))/i;return[n*Math.sin(t*=i),a-n*Math.cos(t)]}var r=Math.sin(t),i=(r+Math.sin(e))/2,o=1+r*(2*i-r),a=Math.sqrt(o)/i;return n.invert=function(t,e){var n=a-e;return[Math.atan2(t,n)/i,Q((o-(t*t+n*n)*i*i)/(2*i))]},n}function On(){function t(t,e){Sh+=i*t-r*e,r=t,i=e}var e,n,r,i;Dh.point=function(o,a){Dh.point=t,e=r=o,n=i=a},Dh.lineEnd=function(){t(e,n)}}function Wn(t,e){Ch>t&&(Ch=t),t>Lh&&(Lh=t),Ah>e&&(Ah=e),e>Ph&&(Ph=e)}function Gn(){function t(t,e){a.push("M",t,",",e,o)}function e(t,e){a.push("M",t,",",e),s.point=n}function n(t,e){a.push("L",t,",",e)}function r(){s.point=t}function i(){a.push("Z")}var o=jn(4.5),a=[],s={point:t,lineStart:function(){s.point=e},lineEnd:r,polygonStart:function(){s.lineEnd=i},polygonEnd:function(){s.lineEnd=r,s.point=t},pointRadius:function(t){return o=jn(t),s},result:function(){if(a.length){var t=a.join("");return a=[],t}}};return s}function jn(t){return"m0,"+t+"a"+t+","+t+" 0 1,1 0,"+-2*t+"a"+t+","+t+" 0 1,1 0,"+2*t+"z"}function qn(t,e){mh+=t,gh+=e,++vh}function Xn(){function t(t,r){var i=t-e,o=r-n,a=Math.sqrt(i*i+o*o);yh+=a*(e+t)/2,Eh+=a*(n+r)/2,xh+=a,qn(e=t,n=r)}var e,n;Fh.point=function(r,i){Fh.point=t,qn(e=r,n=i)}}function Yn(){Fh.point=qn}function Zn(){function t(t,e){var n=t-r,o=e-i,a=Math.sqrt(n*n+o*o);yh+=a*(r+t)/2,Eh+=a*(i+e)/2,xh+=a,a=i*t-r*e,Th+=a*(r+t),bh+=a*(i+e),Rh+=3*a,qn(r=t,i=e)}var e,n,r,i;Fh.point=function(o,a){Fh.point=t,qn(e=r=o,n=i=a)},Fh.lineEnd=function(){t(e,n)}}function Kn(t){function e(e,n){t.moveTo(e,n),t.arc(e,n,a,0,ws)}function n(e,n){t.moveTo(e,n),s.point=r}function r(e,n){t.lineTo(e,n)}function i(){s.point=e}function o(){t.closePath()}var a=4.5,s={point:e,lineStart:function(){s.point=n},lineEnd:i,polygonStart:function(){s.lineEnd=o},polygonEnd:function(){s.lineEnd=i,s.point=e},pointRadius:function(t){return a=t,s},result:m};return s}function Qn(t){function e(t){return(s?r:n)(t)}function n(e){return tr(e,function(n,r){n=t(n,r),e.point(n[0],n[1])})}function r(e){function n(n,r){n=t(n,r),e.point(n[0],n[1])}function r(){E=0/0,w.point=o,e.lineStart()}function o(n,r){var o=ln([n,r]),a=t(n,r);i(E,x,y,T,b,R,E=a[0],x=a[1],y=n,T=o[0],b=o[1],R=o[2],s,e),e.point(E,x)}function a(){w.point=n,e.lineEnd()}function h(){r(),w.point=u,w.lineEnd=c}function u(t,e){o(l=t,f=e),p=E,d=x,m=T,g=b,v=R,w.point=o}function c(){i(E,x,y,T,b,R,p,d,l,m,g,v,s,e),w.lineEnd=a,a()}var l,f,p,d,m,g,v,y,E,x,T,b,R,w={point:n,lineStart:r,lineEnd:a,polygonStart:function(){e.polygonStart(),w.lineStart=h},polygonEnd:function(){e.polygonEnd(),w.lineStart=r}};return w}function i(e,n,r,s,h,u,c,l,f,p,d,m,g,v){var y=c-e,E=l-n,x=y*y+E*E;if(x>4*o&&g--){var T=s+p,b=h+d,R=u+m,w=Math.sqrt(T*T+b*b+R*R),_=Math.asin(R/=w),H=os(os(R)-1)<Hs||os(r-f)<Hs?(r+f)/2:Math.atan2(b,T),M=t(H,_),S=M[0],C=M[1],A=S-e,L=C-n,P=E*A-y*L;(P*P/x>o||os((y*A+E*L)/x-.5)>.3||a>s*p+h*d+u*m)&&(i(e,n,r,s,h,u,S,C,H,T/=w,b/=w,R,g,v),v.point(S,C),i(S,C,H,T,b,R,c,l,f,p,d,m,g,v))}}var o=.5,a=Math.cos(30*Ss),s=16;return e.precision=function(t){return arguments.length?(s=(o=t*t)>0&&16,e):Math.sqrt(o)},e}function $n(t){var e=Qn(function(e,n){return t([e*Cs,n*Cs])});return function(t){return rr(e(t))}}function Jn(t){this.stream=t}function tr(t,e){return{point:e,sphere:function(){t.sphere()},lineStart:function(){t.lineStart()},lineEnd:function(){t.lineEnd()},polygonStart:function(){t.polygonStart()},polygonEnd:function(){t.polygonEnd()}}}function er(t){return nr(function(){return t})()}function nr(t){function e(t){return t=s(t[0]*Ss,t[1]*Ss),[t[0]*f+h,u-t[1]*f]}function n(t){return t=s.invert((t[0]-h)/f,(u-t[1])/f),t&&[t[0]*Cs,t[1]*Cs]}function r(){s=In(a=ar(v,y,E),o);var t=o(m,g);return h=p-t[0]*f,u=d+t[1]*f,i()}function i(){return c&&(c.valid=!1,c=null),e}var o,a,s,h,u,c,l=Qn(function(t,e){return t=o(t,e),[t[0]*f+h,u-t[1]*f]}),f=150,p=480,d=250,m=0,g=0,v=0,y=0,E=0,x=_h,T=Re,b=null,R=null;return e.stream=function(t){return c&&(c.valid=!1),c=rr(x(a,l(T(t)))),c.valid=!0,c},e.clipAngle=function(t){return arguments.length?(x=null==t?(b=t,_h):kn((b=+t)*Ss),i()):b},e.clipExtent=function(t){return arguments.length?(R=t,T=t?Vn(t[0][0],t[0][1],t[1][0],t[1][1]):Re,i()):R},e.scale=function(t){return arguments.length?(f=+t,r()):f},e.translate=function(t){return arguments.length?(p=+t[0],d=+t[1],r()):[p,d]},e.center=function(t){return arguments.length?(m=t[0]%360*Ss,g=t[1]%360*Ss,r()):[m*Cs,g*Cs]},e.rotate=function(t){return arguments.length?(v=t[0]%360*Ss,y=t[1]%360*Ss,E=t.length>2?t[2]%360*Ss:0,r()):[v*Cs,y*Cs,E*Cs]},ja.rebind(e,l,"precision"),function(){return o=t.apply(this,arguments),e.invert=o.invert&&n,r()}}function rr(t){return tr(t,function(e,n){t.point(e*Ss,n*Ss)})}function ir(t,e){return[t,e]}function or(t,e){return[t>Rs?t-ws:-Rs>t?t+ws:t,e]}function ar(t,e,n){return t?e||n?In(hr(t),ur(e,n)):hr(t):e||n?ur(e,n):or}function sr(t){return function(e,n){return e+=t,[e>Rs?e-ws:-Rs>e?e+ws:e,n]}}function hr(t){var e=sr(t);return e.invert=sr(-t),e}function ur(t,e){function n(t,e){var n=Math.cos(e),s=Math.cos(t)*n,h=Math.sin(t)*n,u=Math.sin(e),c=u*r+s*i;return[Math.atan2(h*o-c*a,s*r-u*i),Q(c*o+h*a)]}var r=Math.cos(t),i=Math.sin(t),o=Math.cos(e),a=Math.sin(e);return n.invert=function(t,e){var n=Math.cos(e),s=Math.cos(t)*n,h=Math.sin(t)*n,u=Math.sin(e),c=u*o-h*a;return[Math.atan2(h*o+u*a,s*r+c*i),Q(c*r-s*i)]},n}function cr(t,e){var n=Math.cos(t),r=Math.sin(t);return function(i,o,a,s){var h=a*e;null!=i?(i=lr(n,i),o=lr(n,o),(a>0?o>i:i>o)&&(i+=a*ws)):(i=t+a*ws,o=t-.5*h);for(var u,c=i;a>0?c>o:o>c;c-=h)s.point((u=vn([n,-r*Math.cos(c),-r*Math.sin(c)]))[0],u[1])}}function lr(t,e){var n=ln(e);n[0]-=t,gn(n);var r=K(-n[1]);return((-n[2]<0?-r:r)+2*Math.PI-Hs)%(2*Math.PI)}function fr(t,e,n){var r=ja.range(t,e-Hs,n).concat(e);return function(t){return r.map(function(e){return[t,e]})}}function pr(t,e,n){var r=ja.range(t,e-Hs,n).concat(e);return function(t){return r.map(function(e){return[e,t]})}}function dr(t){return t.source}function mr(t){return t.target}function gr(t,e,n,r){var i=Math.cos(e),o=Math.sin(e),a=Math.cos(r),s=Math.sin(r),h=i*Math.cos(t),u=i*Math.sin(t),c=a*Math.cos(n),l=a*Math.sin(n),f=2*Math.asin(Math.sqrt(ee(r-e)+i*a*ee(n-t))),p=1/Math.sin(f),d=f?function(t){var e=Math.sin(t*=f)*p,n=Math.sin(f-t)*p,r=n*h+e*c,i=n*u+e*l,a=n*o+e*s;return[Math.atan2(i,r)*Cs,Math.atan2(a,Math.sqrt(r*r+i*i))*Cs]}:function(){return[t*Cs,e*Cs]};return d.distance=f,d}function vr(){function t(t,i){var o=Math.sin(i*=Ss),a=Math.cos(i),s=os((t*=Ss)-e),h=Math.cos(s);kh+=Math.atan2(Math.sqrt((s=a*Math.sin(s))*s+(s=r*o-n*a*h)*s),n*o+r*a*h),e=t,n=o,r=a}var e,n,r;Nh.point=function(i,o){e=i*Ss,n=Math.sin(o*=Ss),r=Math.cos(o),Nh.point=t},Nh.lineEnd=function(){Nh.point=Nh.lineEnd=m}}function yr(t,e){function n(e,n){var r=Math.cos(e),i=Math.cos(n),o=t(r*i);return[o*i*Math.sin(e),o*Math.sin(n)]}return n.invert=function(t,n){var r=Math.sqrt(t*t+n*n),i=e(r),o=Math.sin(i),a=Math.cos(i);return[Math.atan2(t*o,r*a),Math.asin(r&&n*o/r)]},n}function Er(t,e){function n(t,e){a>0?-_s+Hs>e&&(e=-_s+Hs):e>_s-Hs&&(e=_s-Hs);var n=a/Math.pow(i(e),o);return[n*Math.sin(o*t),a-n*Math.cos(o*t)]}var r=Math.cos(t),i=function(t){return Math.tan(Rs/4+t/2)},o=t===e?Math.sin(t):Math.log(r/Math.cos(e))/Math.log(i(e)/i(t)),a=r*Math.pow(i(t),o)/o;return o?(n.invert=function(t,e){var n=a-e,r=Y(o)*Math.sqrt(t*t+n*n);return[Math.atan2(t,n)/o,2*Math.atan(Math.pow(a/r,1/o))-_s]},n):Tr}function xr(t,e){function n(t,e){var n=o-e;return[n*Math.sin(i*t),o-n*Math.cos(i*t)]}var r=Math.cos(t),i=t===e?Math.sin(t):(r-Math.cos(e))/(e-t),o=r/i+t;return os(i)<Hs?ir:(n.invert=function(t,e){var n=o-e;return[Math.atan2(t,n)/i,o-Y(i)*Math.sqrt(t*t+n*n)]},n)}function Tr(t,e){return[t,Math.log(Math.tan(Rs/4+e/2))]}function br(t){var e,n=er(t),r=n.scale,i=n.translate,o=n.clipExtent;return n.scale=function(){var t=r.apply(n,arguments);return t===n?e?n.clipExtent(null):n:t},n.translate=function(){var t=i.apply(n,arguments);return t===n?e?n.clipExtent(null):n:t},n.clipExtent=function(t){var a=o.apply(n,arguments);if(a===n){if(e=null==t){var s=Rs*r(),h=i();o([[h[0]-s,h[1]-s],[h[0]+s,h[1]+s]])}}else e&&(a=null);return a},n.clipExtent(null)}function Rr(t,e){return[Math.log(Math.tan(Rs/4+e/2)),-t]}function wr(t){return t[0]}function _r(t){return t[1]}function Hr(t){for(var e=t.length,n=[0,1],r=2,i=2;e>i;i++){for(;r>1&&Z(t[n[r-2]],t[n[r-1]],t[i])<=0;)--r;n[r++]=i}return n.slice(0,r)}function Mr(t,e){return t[0]-e[0]||t[1]-e[1]}function Sr(t,e,n){return(n[0]-e[0])*(t[1]-e[1])<(n[1]-e[1])*(t[0]-e[0])}function Cr(t,e,n,r){var i=t[0],o=n[0],a=e[0]-i,s=r[0]-o,h=t[1],u=n[1],c=e[1]-h,l=r[1]-u,f=(s*(h-u)-l*(i-o))/(l*a-s*c);return[i+f*a,h+f*c]}function Ar(t){var e=t[0],n=t[t.length-1];return!(e[0]-n[0]||e[1]-n[1])}function Lr(){$r(this),this.edge=this.site=this.circle=null}function Pr(t){var e=Zh.pop()||new Lr;return e.site=t,e}function Dr(t){Wr(t),qh.remove(t),Zh.push(t),$r(t)}function zr(t){var e=t.circle,n=e.x,r=e.cy,i={x:n,y:r},o=t.P,a=t.N,s=[t];Dr(t);for(var h=o;h.circle&&os(n-h.circle.x)<Hs&&os(r-h.circle.cy)<Hs;)o=h.P,s.unshift(h),Dr(h),h=o;s.unshift(h),Wr(h);for(var u=a;u.circle&&os(n-u.circle.x)<Hs&&os(r-u.circle.cy)<Hs;)a=u.N,s.push(u),Dr(u),u=a;s.push(u),Wr(u);var c,l=s.length;for(c=1;l>c;++c)u=s[c],h=s[c-1],Zr(u.edge,h.site,u.site,i);h=s[0],u=s[l-1],u.edge=Xr(h.site,u.site,null,i),Or(h),Or(u)}function Fr(t){for(var e,n,r,i,o=t.x,a=t.y,s=qh._;s;)if(r=kr(s,a)-o,r>Hs)s=s.L;else{if(i=o-Nr(s,a),!(i>Hs)){r>-Hs?(e=s.P,n=s):i>-Hs?(e=s,n=s.N):e=n=s;break}if(!s.R){e=s;break}s=s.R}var h=Pr(t);if(qh.insert(e,h),e||n){if(e===n)return Wr(e),n=Pr(e.site),qh.insert(h,n),h.edge=n.edge=Xr(e.site,h.site),Or(e),void Or(n);if(!n)return void(h.edge=Xr(e.site,h.site));Wr(e),Wr(n);var u=e.site,c=u.x,l=u.y,f=t.x-c,p=t.y-l,d=n.site,m=d.x-c,g=d.y-l,v=2*(f*g-p*m),y=f*f+p*p,E=m*m+g*g,x={x:(g*y-p*E)/v+c,y:(f*E-m*y)/v+l};Zr(n.edge,u,d,x),h.edge=Xr(u,t,null,x),n.edge=Xr(t,d,null,x),Or(e),Or(n)}}function kr(t,e){var n=t.site,r=n.x,i=n.y,o=i-e;if(!o)return r;var a=t.P;if(!a)return-1/0;n=a.site;var s=n.x,h=n.y,u=h-e;if(!u)return s;var c=s-r,l=1/o-1/u,f=c/u;return l?(-f+Math.sqrt(f*f-2*l*(c*c/(-2*u)-h+u/2+i-o/2)))/l+r:(r+s)/2}function Nr(t,e){var n=t.N;if(n)return kr(n,e);var r=t.site;return r.y===e?r.x:1/0}function Vr(t){this.site=t,this.edges=[]}function Ir(t){for(var e,n,r,i,o,a,s,h,u,c,l=t[0][0],f=t[1][0],p=t[0][1],d=t[1][1],m=jh,g=m.length;g--;)if(o=m[g],o&&o.prepare())for(s=o.edges,h=s.length,a=0;h>a;)c=s[a].end(),r=c.x,i=c.y,u=s[++a%h].start(),e=u.x,n=u.y,(os(r-e)>Hs||os(i-n)>Hs)&&(s.splice(a,0,new Kr(Yr(o.site,c,os(r-l)<Hs&&d-i>Hs?{x:l,y:os(e-l)<Hs?n:d}:os(i-d)<Hs&&f-r>Hs?{x:os(n-d)<Hs?e:f,y:d}:os(r-f)<Hs&&i-p>Hs?{x:f,y:os(e-f)<Hs?n:p}:os(i-p)<Hs&&r-l>Hs?{x:os(n-p)<Hs?e:l,y:p}:null),o.site,null)),++h)}function Br(t,e){return e.angle-t.angle}function Ur(){$r(this),this.x=this.y=this.arc=this.site=this.cy=null}function Or(t){var e=t.P,n=t.N;if(e&&n){var r=e.site,i=t.site,o=n.site;
if(r!==o){var a=i.x,s=i.y,h=r.x-a,u=r.y-s,c=o.x-a,l=o.y-s,f=2*(h*l-u*c);if(!(f>=-Ms)){var p=h*h+u*u,d=c*c+l*l,m=(l*p-u*d)/f,g=(h*d-c*p)/f,l=g+s,v=Kh.pop()||new Ur;v.arc=t,v.site=i,v.x=m+a,v.y=l+Math.sqrt(m*m+g*g),v.cy=l,t.circle=v;for(var y=null,E=Yh._;E;)if(v.y<E.y||v.y===E.y&&v.x<=E.x){if(!E.L){y=E.P;break}E=E.L}else{if(!E.R){y=E;break}E=E.R}Yh.insert(y,v),y||(Xh=v)}}}}function Wr(t){var e=t.circle;e&&(e.P||(Xh=e.N),Yh.remove(e),Kh.push(e),$r(e),t.circle=null)}function Gr(t){for(var e,n=Gh,r=Nn(t[0][0],t[0][1],t[1][0],t[1][1]),i=n.length;i--;)e=n[i],(!jr(e,t)||!r(e)||os(e.a.x-e.b.x)<Hs&&os(e.a.y-e.b.y)<Hs)&&(e.a=e.b=null,n.splice(i,1))}function jr(t,e){var n=t.b;if(n)return!0;var r,i,o=t.a,a=e[0][0],s=e[1][0],h=e[0][1],u=e[1][1],c=t.l,l=t.r,f=c.x,p=c.y,d=l.x,m=l.y,g=(f+d)/2,v=(p+m)/2;if(m===p){if(a>g||g>=s)return;if(f>d){if(o){if(o.y>=u)return}else o={x:g,y:h};n={x:g,y:u}}else{if(o){if(o.y<h)return}else o={x:g,y:u};n={x:g,y:h}}}else if(r=(f-d)/(m-p),i=v-r*g,-1>r||r>1)if(f>d){if(o){if(o.y>=u)return}else o={x:(h-i)/r,y:h};n={x:(u-i)/r,y:u}}else{if(o){if(o.y<h)return}else o={x:(u-i)/r,y:u};n={x:(h-i)/r,y:h}}else if(m>p){if(o){if(o.x>=s)return}else o={x:a,y:r*a+i};n={x:s,y:r*s+i}}else{if(o){if(o.x<a)return}else o={x:s,y:r*s+i};n={x:a,y:r*a+i}}return t.a=o,t.b=n,!0}function qr(t,e){this.l=t,this.r=e,this.a=this.b=null}function Xr(t,e,n,r){var i=new qr(t,e);return Gh.push(i),n&&Zr(i,t,e,n),r&&Zr(i,e,t,r),jh[t.i].edges.push(new Kr(i,t,e)),jh[e.i].edges.push(new Kr(i,e,t)),i}function Yr(t,e,n){var r=new qr(t,null);return r.a=e,r.b=n,Gh.push(r),r}function Zr(t,e,n,r){t.a||t.b?t.l===n?t.b=r:t.a=r:(t.a=r,t.l=e,t.r=n)}function Kr(t,e,n){var r=t.a,i=t.b;this.edge=t,this.site=e,this.angle=n?Math.atan2(n.y-e.y,n.x-e.x):t.l===e?Math.atan2(i.x-r.x,r.y-i.y):Math.atan2(r.x-i.x,i.y-r.y)}function Qr(){this._=null}function $r(t){t.U=t.C=t.L=t.R=t.P=t.N=null}function Jr(t,e){var n=e,r=e.R,i=n.U;i?i.L===n?i.L=r:i.R=r:t._=r,r.U=i,n.U=r,n.R=r.L,n.R&&(n.R.U=n),r.L=n}function ti(t,e){var n=e,r=e.L,i=n.U;i?i.L===n?i.L=r:i.R=r:t._=r,r.U=i,n.U=r,n.L=r.R,n.L&&(n.L.U=n),r.R=n}function ei(t){for(;t.L;)t=t.L;return t}function ni(t,e){var n,r,i,o=t.sort(ri).pop();for(Gh=[],jh=new Array(t.length),qh=new Qr,Yh=new Qr;;)if(i=Xh,o&&(!i||o.y<i.y||o.y===i.y&&o.x<i.x))(o.x!==n||o.y!==r)&&(jh[o.i]=new Vr(o),Fr(o),n=o.x,r=o.y),o=t.pop();else{if(!i)break;zr(i.arc)}e&&(Gr(e),Ir(e));var a={cells:jh,edges:Gh};return qh=Yh=Gh=jh=null,a}function ri(t,e){return e.y-t.y||e.x-t.x}function ii(t,e,n){return(t.x-n.x)*(e.y-t.y)-(t.x-e.x)*(n.y-t.y)}function oi(t){return t.x}function ai(t){return t.y}function si(){return{leaf:!0,nodes:[],point:null,x:null,y:null}}function hi(t,e,n,r,i,o){if(!t(e,n,r,i,o)){var a=.5*(n+i),s=.5*(r+o),h=e.nodes;h[0]&&hi(t,h[0],n,r,a,s),h[1]&&hi(t,h[1],a,r,i,s),h[2]&&hi(t,h[2],n,s,a,o),h[3]&&hi(t,h[3],a,s,i,o)}}function ui(t,e){t=ja.rgb(t),e=ja.rgb(e);var n=t.r,r=t.g,i=t.b,o=e.r-n,a=e.g-r,s=e.b-i;return function(t){return"#"+ge(Math.round(n+o*t))+ge(Math.round(r+a*t))+ge(Math.round(i+s*t))}}function ci(t,e){var n,r={},i={};for(n in t)n in e?r[n]=pi(t[n],e[n]):i[n]=t[n];for(n in e)n in t||(i[n]=e[n]);return function(t){for(n in r)i[n]=r[n](t);return i}}function li(t,e){return e-=t=+t,function(n){return t+e*n}}function fi(t,e){var n,r,i,o=$h.lastIndex=Jh.lastIndex=0,a=-1,s=[],h=[];for(t+="",e+="";(n=$h.exec(t))&&(r=Jh.exec(e));)(i=r.index)>o&&(i=e.substring(o,i),s[a]?s[a]+=i:s[++a]=i),(n=n[0])===(r=r[0])?s[a]?s[a]+=r:s[++a]=r:(s[++a]=null,h.push({i:a,x:li(n,r)})),o=Jh.lastIndex;return o<e.length&&(i=e.substring(o),s[a]?s[a]+=i:s[++a]=i),s.length<2?h[0]?(e=h[0].x,function(t){return e(t)+""}):function(){return e}:(e=h.length,function(t){for(var n,r=0;e>r;++r)s[(n=h[r]).i]=n.x(t);return s.join("")})}function pi(t,e){for(var n,r=ja.interpolators.length;--r>=0&&!(n=ja.interpolators[r](t,e)););return n}function di(t,e){var n,r=[],i=[],o=t.length,a=e.length,s=Math.min(t.length,e.length);for(n=0;s>n;++n)r.push(pi(t[n],e[n]));for(;o>n;++n)i[n]=t[n];for(;a>n;++n)i[n]=e[n];return function(t){for(n=0;s>n;++n)i[n]=r[n](t);return i}}function mi(t){return function(e){return 0>=e?0:e>=1?1:t(e)}}function gi(t){return function(e){return 1-t(1-e)}}function vi(t){return function(e){return.5*(.5>e?t(2*e):2-t(2-2*e))}}function yi(t){return t*t}function Ei(t){return t*t*t}function xi(t){if(0>=t)return 0;if(t>=1)return 1;var e=t*t,n=e*t;return 4*(.5>t?n:3*(t-e)+n-.75)}function Ti(t){return function(e){return Math.pow(e,t)}}function bi(t){return 1-Math.cos(t*_s)}function Ri(t){return Math.pow(2,10*(t-1))}function wi(t){return 1-Math.sqrt(1-t*t)}function _i(t,e){var n;return arguments.length<2&&(e=.45),arguments.length?n=e/ws*Math.asin(1/t):(t=1,n=e/4),function(r){return 1+t*Math.pow(2,-10*r)*Math.sin((r-n)*ws/e)}}function Hi(t){return t||(t=1.70158),function(e){return e*e*((t+1)*e-t)}}function Mi(t){return 1/2.75>t?7.5625*t*t:2/2.75>t?7.5625*(t-=1.5/2.75)*t+.75:2.5/2.75>t?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375}function Si(t,e){t=ja.hcl(t),e=ja.hcl(e);var n=t.h,r=t.c,i=t.l,o=e.h-n,a=e.c-r,s=e.l-i;return isNaN(a)&&(a=0,r=isNaN(r)?e.c:r),isNaN(o)?(o=0,n=isNaN(n)?e.h:n):o>180?o-=360:-180>o&&(o+=360),function(t){return ae(n+o*t,r+a*t,i+s*t)+""}}function Ci(t,e){t=ja.hsl(t),e=ja.hsl(e);var n=t.h,r=t.s,i=t.l,o=e.h-n,a=e.s-r,s=e.l-i;return isNaN(a)&&(a=0,r=isNaN(r)?e.s:r),isNaN(o)?(o=0,n=isNaN(n)?e.h:n):o>180?o-=360:-180>o&&(o+=360),function(t){return ie(n+o*t,r+a*t,i+s*t)+""}}function Ai(t,e){t=ja.lab(t),e=ja.lab(e);var n=t.l,r=t.a,i=t.b,o=e.l-n,a=e.a-r,s=e.b-i;return function(t){return he(n+o*t,r+a*t,i+s*t)+""}}function Li(t,e){return e-=t,function(n){return Math.round(t+e*n)}}function Pi(t){var e=[t.a,t.b],n=[t.c,t.d],r=zi(e),i=Di(e,n),o=zi(Fi(n,e,-i))||0;e[0]*n[1]<n[0]*e[1]&&(e[0]*=-1,e[1]*=-1,r*=-1,i*=-1),this.rotate=(r?Math.atan2(e[1],e[0]):Math.atan2(-n[0],n[1]))*Cs,this.translate=[t.e,t.f],this.scale=[r,o],this.skew=o?Math.atan2(i,o)*Cs:0}function Di(t,e){return t[0]*e[0]+t[1]*e[1]}function zi(t){var e=Math.sqrt(Di(t,t));return e&&(t[0]/=e,t[1]/=e),e}function Fi(t,e,n){return t[0]+=n*e[0],t[1]+=n*e[1],t}function ki(t,e){var n,r=[],i=[],o=ja.transform(t),a=ja.transform(e),s=o.translate,h=a.translate,u=o.rotate,c=a.rotate,l=o.skew,f=a.skew,p=o.scale,d=a.scale;return s[0]!=h[0]||s[1]!=h[1]?(r.push("translate(",null,",",null,")"),i.push({i:1,x:li(s[0],h[0])},{i:3,x:li(s[1],h[1])})):r.push(h[0]||h[1]?"translate("+h+")":""),u!=c?(u-c>180?c+=360:c-u>180&&(u+=360),i.push({i:r.push(r.pop()+"rotate(",null,")")-2,x:li(u,c)})):c&&r.push(r.pop()+"rotate("+c+")"),l!=f?i.push({i:r.push(r.pop()+"skewX(",null,")")-2,x:li(l,f)}):f&&r.push(r.pop()+"skewX("+f+")"),p[0]!=d[0]||p[1]!=d[1]?(n=r.push(r.pop()+"scale(",null,",",null,")"),i.push({i:n-4,x:li(p[0],d[0])},{i:n-2,x:li(p[1],d[1])})):(1!=d[0]||1!=d[1])&&r.push(r.pop()+"scale("+d+")"),n=i.length,function(t){for(var e,o=-1;++o<n;)r[(e=i[o]).i]=e.x(t);return r.join("")}}function Ni(t,e){return e=e-(t=+t)?1/(e-t):0,function(n){return(n-t)*e}}function Vi(t,e){return e=e-(t=+t)?1/(e-t):0,function(n){return Math.max(0,Math.min(1,(n-t)*e))}}function Ii(t){for(var e=t.source,n=t.target,r=Ui(e,n),i=[e];e!==r;)e=e.parent,i.push(e);for(var o=i.length;n!==r;)i.splice(o,0,n),n=n.parent;return i}function Bi(t){for(var e=[],n=t.parent;null!=n;)e.push(t),t=n,n=n.parent;return e.push(t),e}function Ui(t,e){if(t===e)return t;for(var n=Bi(t),r=Bi(e),i=n.pop(),o=r.pop(),a=null;i===o;)a=i,i=n.pop(),o=r.pop();return a}function Oi(t){t.fixed|=2}function Wi(t){t.fixed&=-7}function Gi(t){t.fixed|=4,t.px=t.x,t.py=t.y}function ji(t){t.fixed&=-5}function qi(t,e,n){var r=0,i=0;if(t.charge=0,!t.leaf)for(var o,a=t.nodes,s=a.length,h=-1;++h<s;)o=a[h],null!=o&&(qi(o,e,n),t.charge+=o.charge,r+=o.charge*o.cx,i+=o.charge*o.cy);if(t.point){t.leaf||(t.point.x+=Math.random()-.5,t.point.y+=Math.random()-.5);var u=e*n[t.point.index];t.charge+=t.pointCharge=u,r+=u*t.point.x,i+=u*t.point.y}t.cx=r/t.charge,t.cy=i/t.charge}function Xi(t,e){return ja.rebind(t,e,"sort","children","value"),t.nodes=t,t.links=Ji,t}function Yi(t,e){for(var n=[t];null!=(t=n.pop());)if(e(t),(i=t.children)&&(r=i.length))for(var r,i;--r>=0;)n.push(i[r])}function Zi(t,e){for(var n=[t],r=[];null!=(t=n.pop());)if(r.push(t),(o=t.children)&&(i=o.length))for(var i,o,a=-1;++a<i;)n.push(o[a]);for(;null!=(t=r.pop());)e(t)}function Ki(t){return t.children}function Qi(t){return t.value}function $i(t,e){return e.value-t.value}function Ji(t){return ja.merge(t.map(function(t){return(t.children||[]).map(function(e){return{source:t,target:e}})}))}function to(t){return t.x}function eo(t){return t.y}function no(t,e,n){t.y0=e,t.y=n}function ro(t){return ja.range(t.length)}function io(t){for(var e=-1,n=t[0].length,r=[];++e<n;)r[e]=0;return r}function oo(t){for(var e,n=1,r=0,i=t[0][1],o=t.length;o>n;++n)(e=t[n][1])>i&&(r=n,i=e);return r}function ao(t){return t.reduce(so,0)}function so(t,e){return t+e[1]}function ho(t,e){return uo(t,Math.ceil(Math.log(e.length)/Math.LN2+1))}function uo(t,e){for(var n=-1,r=+t[0],i=(t[1]-r)/e,o=[];++n<=e;)o[n]=i*n+r;return o}function co(t){return[ja.min(t),ja.max(t)]}function lo(t,e){return t.value-e.value}function fo(t,e){var n=t._pack_next;t._pack_next=e,e._pack_prev=t,e._pack_next=n,n._pack_prev=e}function po(t,e){t._pack_next=e,e._pack_prev=t}function mo(t,e){var n=e.x-t.x,r=e.y-t.y,i=t.r+e.r;return.999*i*i>n*n+r*r}function go(t){function e(t){c=Math.min(t.x-t.r,c),l=Math.max(t.x+t.r,l),f=Math.min(t.y-t.r,f),p=Math.max(t.y+t.r,p)}if((n=t.children)&&(u=n.length)){var n,r,i,o,a,s,h,u,c=1/0,l=-1/0,f=1/0,p=-1/0;if(n.forEach(vo),r=n[0],r.x=-r.r,r.y=0,e(r),u>1&&(i=n[1],i.x=i.r,i.y=0,e(i),u>2))for(o=n[2],xo(r,i,o),e(o),fo(r,o),r._pack_prev=o,fo(o,i),i=r._pack_next,a=3;u>a;a++){xo(r,i,o=n[a]);var d=0,m=1,g=1;for(s=i._pack_next;s!==i;s=s._pack_next,m++)if(mo(s,o)){d=1;break}if(1==d)for(h=r._pack_prev;h!==s._pack_prev&&!mo(h,o);h=h._pack_prev,g++);d?(g>m||m==g&&i.r<r.r?po(r,i=s):po(r=h,i),a--):(fo(r,o),i=o,e(o))}var v=(c+l)/2,y=(f+p)/2,E=0;for(a=0;u>a;a++)o=n[a],o.x-=v,o.y-=y,E=Math.max(E,o.r+Math.sqrt(o.x*o.x+o.y*o.y));t.r=E,n.forEach(yo)}}function vo(t){t._pack_next=t._pack_prev=t}function yo(t){delete t._pack_next,delete t._pack_prev}function Eo(t,e,n,r){var i=t.children;if(t.x=e+=r*t.x,t.y=n+=r*t.y,t.r*=r,i)for(var o=-1,a=i.length;++o<a;)Eo(i[o],e,n,r)}function xo(t,e,n){var r=t.r+n.r,i=e.x-t.x,o=e.y-t.y;if(r&&(i||o)){var a=e.r+n.r,s=i*i+o*o;a*=a,r*=r;var h=.5+(r-a)/(2*s),u=Math.sqrt(Math.max(0,2*a*(r+s)-(r-=s)*r-a*a))/(2*s);n.x=t.x+h*i+u*o,n.y=t.y+h*o-u*i}else n.x=t.x+r,n.y=t.y}function To(t,e){return t.parent==e.parent?1:2}function bo(t){var e=t.children;return e.length?e[0]:t.t}function Ro(t){var e,n=t.children;return(e=n.length)?n[e-1]:t.t}function wo(t,e,n){var r=n/(e.i-t.i);e.c-=r,e.s+=n,t.c+=r,e.z+=n,e.m+=n}function _o(t){for(var e,n=0,r=0,i=t.children,o=i.length;--o>=0;)e=i[o],e.z+=n,e.m+=n,n+=e.s+(r+=e.c)}function Ho(t,e,n){return t.a.parent===e.parent?t.a:n}function Mo(t){return 1+ja.max(t,function(t){return t.y})}function So(t){return t.reduce(function(t,e){return t+e.x},0)/t.length}function Co(t){var e=t.children;return e&&e.length?Co(e[0]):t}function Ao(t){var e,n=t.children;return n&&(e=n.length)?Ao(n[e-1]):t}function Lo(t){return{x:t.x,y:t.y,dx:t.dx,dy:t.dy}}function Po(t,e){var n=t.x+e[3],r=t.y+e[0],i=t.dx-e[1]-e[3],o=t.dy-e[0]-e[2];return 0>i&&(n+=i/2,i=0),0>o&&(r+=o/2,o=0),{x:n,y:r,dx:i,dy:o}}function Do(t){var e=t[0],n=t[t.length-1];return n>e?[e,n]:[n,e]}function zo(t){return t.rangeExtent?t.rangeExtent():Do(t.range())}function Fo(t,e,n,r){var i=n(t[0],t[1]),o=r(e[0],e[1]);return function(t){return o(i(t))}}function ko(t,e){var n,r=0,i=t.length-1,o=t[r],a=t[i];return o>a&&(n=r,r=i,i=n,n=o,o=a,a=n),t[r]=e.floor(o),t[i]=e.ceil(a),t}function No(t){return t?{floor:function(e){return Math.floor(e/t)*t},ceil:function(e){return Math.ceil(e/t)*t}}:cu}function Vo(t,e,n,r){var i=[],o=[],a=0,s=Math.min(t.length,e.length)-1;for(t[s]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++a<=s;)i.push(n(t[a-1],t[a])),o.push(r(e[a-1],e[a]));return function(e){var n=ja.bisect(t,e,1,s)-1;return o[n](i[n](e))}}function Io(t,e,n,r){function i(){var i=Math.min(t.length,e.length)>2?Vo:Fo,h=r?Vi:Ni;return a=i(t,e,h,n),s=i(e,t,h,pi),o}function o(t){return a(t)}var a,s;return o.invert=function(t){return s(t)},o.domain=function(e){return arguments.length?(t=e.map(Number),i()):t},o.range=function(t){return arguments.length?(e=t,i()):e},o.rangeRound=function(t){return o.range(t).interpolate(Li)},o.clamp=function(t){return arguments.length?(r=t,i()):r},o.interpolate=function(t){return arguments.length?(n=t,i()):n},o.ticks=function(e){return Wo(t,e)},o.tickFormat=function(e,n){return Go(t,e,n)},o.nice=function(e){return Uo(t,e),i()},o.copy=function(){return Io(t,e,n,r)},i()}function Bo(t,e){return ja.rebind(t,e,"range","rangeRound","interpolate","clamp")}function Uo(t,e){return ko(t,No(Oo(t,e)[2]))}function Oo(t,e){null==e&&(e=10);var n=Do(t),r=n[1]-n[0],i=Math.pow(10,Math.floor(Math.log(r/e)/Math.LN10)),o=e/r*i;return.15>=o?i*=10:.35>=o?i*=5:.75>=o&&(i*=2),n[0]=Math.ceil(n[0]/i)*i,n[1]=Math.floor(n[1]/i)*i+.5*i,n[2]=i,n}function Wo(t,e){return ja.range.apply(ja,Oo(t,e))}function Go(t,e,n){var r=Oo(t,e);if(n){var i=$s.exec(n);if(i.shift(),"s"===i[8]){var o=ja.formatPrefix(Math.max(os(r[0]),os(r[1])));return i[7]||(i[7]="."+jo(o.scale(r[2]))),i[8]="f",n=ja.format(i.join("")),function(t){return n(o.scale(t))+o.symbol}}i[7]||(i[7]="."+qo(i[8],r)),n=i.join("")}else n=",."+jo(r[2])+"f";return ja.format(n)}function jo(t){return-Math.floor(Math.log(t)/Math.LN10+.01)}function qo(t,e){var n=jo(e[2]);return t in lu?Math.abs(n-jo(Math.max(os(e[0]),os(e[1]))))+ +("e"!==t):n-2*("%"===t)}function Xo(t,e,n,r){function i(t){return(n?Math.log(0>t?0:t):-Math.log(t>0?0:-t))/Math.log(e)}function o(t){return n?Math.pow(e,t):-Math.pow(e,-t)}function a(e){return t(i(e))}return a.invert=function(e){return o(t.invert(e))},a.domain=function(e){return arguments.length?(n=e[0]>=0,t.domain((r=e.map(Number)).map(i)),a):r},a.base=function(n){return arguments.length?(e=+n,t.domain(r.map(i)),a):e},a.nice=function(){var e=ko(r.map(i),n?Math:pu);return t.domain(e),r=e.map(o),a},a.ticks=function(){var t=Do(r),a=[],s=t[0],h=t[1],u=Math.floor(i(s)),c=Math.ceil(i(h)),l=e%1?2:e;if(isFinite(c-u)){if(n){for(;c>u;u++)for(var f=1;l>f;f++)a.push(o(u)*f);a.push(o(u))}else for(a.push(o(u));u++<c;)for(var f=l-1;f>0;f--)a.push(o(u)*f);for(u=0;a[u]<s;u++);for(c=a.length;a[c-1]>h;c--);a=a.slice(u,c)}return a},a.tickFormat=function(t,e){if(!arguments.length)return fu;arguments.length<2?e=fu:"function"!=typeof e&&(e=ja.format(e));var r,s=Math.max(.1,t/a.ticks().length),h=n?(r=1e-12,Math.ceil):(r=-1e-12,Math.floor);return function(t){return t/o(h(i(t)+r))<=s?e(t):""}},a.copy=function(){return Xo(t.copy(),e,n,r)},Bo(a,t)}function Yo(t,e,n){function r(e){return t(i(e))}var i=Zo(e),o=Zo(1/e);return r.invert=function(e){return o(t.invert(e))},r.domain=function(e){return arguments.length?(t.domain((n=e.map(Number)).map(i)),r):n},r.ticks=function(t){return Wo(n,t)},r.tickFormat=function(t,e){return Go(n,t,e)},r.nice=function(t){return r.domain(Uo(n,t))},r.exponent=function(a){return arguments.length?(i=Zo(e=a),o=Zo(1/e),t.domain(n.map(i)),r):e},r.copy=function(){return Yo(t.copy(),e,n)},Bo(r,t)}function Zo(t){return function(e){return 0>e?-Math.pow(-e,t):Math.pow(e,t)}}function Ko(t,e){function n(n){return o[((i.get(n)||("range"===e.t?i.set(n,t.push(n)):0/0))-1)%o.length]}function r(e,n){return ja.range(t.length).map(function(t){return e+n*t})}var i,o,s;return n.domain=function(r){if(!arguments.length)return t;t=[],i=new a;for(var o,s=-1,h=r.length;++s<h;)i.has(o=r[s])||i.set(o,t.push(o));return n[e.t].apply(n,e.a)},n.range=function(t){return arguments.length?(o=t,s=0,e={t:"range",a:arguments},n):o},n.rangePoints=function(i,a){arguments.length<2&&(a=0);var h=i[0],u=i[1],c=(u-h)/(Math.max(1,t.length-1)+a);return o=r(t.length<2?(h+u)/2:h+c*a/2,c),s=0,e={t:"rangePoints",a:arguments},n},n.rangeBands=function(i,a,h){arguments.length<2&&(a=0),arguments.length<3&&(h=a);var u=i[1]<i[0],c=i[u-0],l=i[1-u],f=(l-c)/(t.length-a+2*h);return o=r(c+f*h,f),u&&o.reverse(),s=f*(1-a),e={t:"rangeBands",a:arguments},n},n.rangeRoundBands=function(i,a,h){arguments.length<2&&(a=0),arguments.length<3&&(h=a);var u=i[1]<i[0],c=i[u-0],l=i[1-u],f=Math.floor((l-c)/(t.length-a+2*h)),p=l-c-(t.length-a)*f;return o=r(c+Math.round(p/2),f),u&&o.reverse(),s=Math.round(f*(1-a)),e={t:"rangeRoundBands",a:arguments},n},n.rangeBand=function(){return s},n.rangeExtent=function(){return Do(e.a[0])},n.copy=function(){return Ko(t,e)},n.domain(t)}function Qo(n,r){function i(){var t=0,e=r.length;for(a=[];++t<e;)a[t-1]=ja.quantile(n,t/e);return o}function o(t){return isNaN(t=+t)?void 0:r[ja.bisect(a,t)]}var a;return o.domain=function(r){return arguments.length?(n=r.filter(e).sort(t),i()):n},o.range=function(t){return arguments.length?(r=t,i()):r},o.quantiles=function(){return a},o.invertExtent=function(t){return t=r.indexOf(t),0>t?[0/0,0/0]:[t>0?a[t-1]:n[0],t<a.length?a[t]:n[n.length-1]]},o.copy=function(){return Qo(n,r)},i()}function $o(t,e,n){function r(e){return n[Math.max(0,Math.min(a,Math.floor(o*(e-t))))]}function i(){return o=n.length/(e-t),a=n.length-1,r}var o,a;return r.domain=function(n){return arguments.length?(t=+n[0],e=+n[n.length-1],i()):[t,e]},r.range=function(t){return arguments.length?(n=t,i()):n},r.invertExtent=function(e){return e=n.indexOf(e),e=0>e?0/0:e/o+t,[e,e+1/o]},r.copy=function(){return $o(t,e,n)},i()}function Jo(t,e){function n(n){return n>=n?e[ja.bisect(t,n)]:void 0}return n.domain=function(e){return arguments.length?(t=e,n):t},n.range=function(t){return arguments.length?(e=t,n):e},n.invertExtent=function(n){return n=e.indexOf(n),[t[n-1],t[n]]},n.copy=function(){return Jo(t,e)},n}function ta(t){function e(t){return+t}return e.invert=e,e.domain=e.range=function(n){return arguments.length?(t=n.map(e),e):t},e.ticks=function(e){return Wo(t,e)},e.tickFormat=function(e,n){return Go(t,e,n)},e.copy=function(){return ta(t)},e}function ea(t){return t.innerRadius}function na(t){return t.outerRadius}function ra(t){return t.startAngle}function ia(t){return t.endAngle}function oa(t){function e(e){function a(){u.push("M",o(t(c),s))}for(var h,u=[],c=[],l=-1,f=e.length,p=be(n),d=be(r);++l<f;)i.call(this,h=e[l],l)?c.push([+p.call(this,h,l),+d.call(this,h,l)]):c.length&&(a(),c=[]);return c.length&&a(),u.length?u.join(""):null}var n=wr,r=_r,i=wn,o=aa,a=o.key,s=.7;return e.x=function(t){return arguments.length?(n=t,e):n},e.y=function(t){return arguments.length?(r=t,e):r},e.defined=function(t){return arguments.length?(i=t,e):i},e.interpolate=function(t){return arguments.length?(a="function"==typeof t?o=t:(o=xu.get(t)||aa).key,e):a},e.tension=function(t){return arguments.length?(s=t,e):s},e}function aa(t){return t.join("L")}function sa(t){return aa(t)+"Z"}function ha(t){for(var e=0,n=t.length,r=t[0],i=[r[0],",",r[1]];++e<n;)i.push("H",(r[0]+(r=t[e])[0])/2,"V",r[1]);return n>1&&i.push("H",r[0]),i.join("")}function ua(t){for(var e=0,n=t.length,r=t[0],i=[r[0],",",r[1]];++e<n;)i.push("V",(r=t[e])[1],"H",r[0]);return i.join("")}function ca(t){for(var e=0,n=t.length,r=t[0],i=[r[0],",",r[1]];++e<n;)i.push("H",(r=t[e])[0],"V",r[1]);return i.join("")}function la(t,e){return t.length<4?aa(t):t[1]+da(t.slice(1,t.length-1),ma(t,e))}function fa(t,e){return t.length<3?aa(t):t[0]+da((t.push(t[0]),t),ma([t[t.length-2]].concat(t,[t[1]]),e))}function pa(t,e){return t.length<3?aa(t):t[0]+da(t,ma(t,e))}function da(t,e){if(e.length<1||t.length!=e.length&&t.length!=e.length+2)return aa(t);var n=t.length!=e.length,r="",i=t[0],o=t[1],a=e[0],s=a,h=1;if(n&&(r+="Q"+(o[0]-2*a[0]/3)+","+(o[1]-2*a[1]/3)+","+o[0]+","+o[1],i=t[1],h=2),e.length>1){s=e[1],o=t[h],h++,r+="C"+(i[0]+a[0])+","+(i[1]+a[1])+","+(o[0]-s[0])+","+(o[1]-s[1])+","+o[0]+","+o[1];for(var u=2;u<e.length;u++,h++)o=t[h],s=e[u],r+="S"+(o[0]-s[0])+","+(o[1]-s[1])+","+o[0]+","+o[1]}if(n){var c=t[h];r+="Q"+(o[0]+2*s[0]/3)+","+(o[1]+2*s[1]/3)+","+c[0]+","+c[1]}return r}function ma(t,e){for(var n,r=[],i=(1-e)/2,o=t[0],a=t[1],s=1,h=t.length;++s<h;)n=o,o=a,a=t[s],r.push([i*(a[0]-n[0]),i*(a[1]-n[1])]);return r}function ga(t){if(t.length<3)return aa(t);var e=1,n=t.length,r=t[0],i=r[0],o=r[1],a=[i,i,i,(r=t[1])[0]],s=[o,o,o,r[1]],h=[i,",",o,"L",xa(Ru,a),",",xa(Ru,s)];for(t.push(t[n-1]);++e<=n;)r=t[e],a.shift(),a.push(r[0]),s.shift(),s.push(r[1]),Ta(h,a,s);return t.pop(),h.push("L",r),h.join("")}function va(t){if(t.length<4)return aa(t);for(var e,n=[],r=-1,i=t.length,o=[0],a=[0];++r<3;)e=t[r],o.push(e[0]),a.push(e[1]);for(n.push(xa(Ru,o)+","+xa(Ru,a)),--r;++r<i;)e=t[r],o.shift(),o.push(e[0]),a.shift(),a.push(e[1]),Ta(n,o,a);return n.join("")}function ya(t){for(var e,n,r=-1,i=t.length,o=i+4,a=[],s=[];++r<4;)n=t[r%i],a.push(n[0]),s.push(n[1]);for(e=[xa(Ru,a),",",xa(Ru,s)],--r;++r<o;)n=t[r%i],a.shift(),a.push(n[0]),s.shift(),s.push(n[1]),Ta(e,a,s);return e.join("")}function Ea(t,e){var n=t.length-1;if(n)for(var r,i,o=t[0][0],a=t[0][1],s=t[n][0]-o,h=t[n][1]-a,u=-1;++u<=n;)r=t[u],i=u/n,r[0]=e*r[0]+(1-e)*(o+i*s),r[1]=e*r[1]+(1-e)*(a+i*h);return ga(t)}function xa(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function Ta(t,e,n){t.push("C",xa(Tu,e),",",xa(Tu,n),",",xa(bu,e),",",xa(bu,n),",",xa(Ru,e),",",xa(Ru,n))}function ba(t,e){return(e[1]-t[1])/(e[0]-t[0])}function Ra(t){for(var e=0,n=t.length-1,r=[],i=t[0],o=t[1],a=r[0]=ba(i,o);++e<n;)r[e]=(a+(a=ba(i=o,o=t[e+1])))/2;return r[e]=a,r}function wa(t){for(var e,n,r,i,o=[],a=Ra(t),s=-1,h=t.length-1;++s<h;)e=ba(t[s],t[s+1]),os(e)<Hs?a[s]=a[s+1]=0:(n=a[s]/e,r=a[s+1]/e,i=n*n+r*r,i>9&&(i=3*e/Math.sqrt(i),a[s]=i*n,a[s+1]=i*r));for(s=-1;++s<=h;)i=(t[Math.min(h,s+1)][0]-t[Math.max(0,s-1)][0])/(6*(1+a[s]*a[s])),o.push([i||0,a[s]*i||0]);return o}function _a(t){return t.length<3?aa(t):t[0]+da(t,wa(t))}function Ha(t){for(var e,n,r,i=-1,o=t.length;++i<o;)e=t[i],n=e[0],r=e[1]+yu,e[0]=n*Math.cos(r),e[1]=n*Math.sin(r);return t}function Ma(t){function e(e){function h(){m.push("M",s(t(v),l),c,u(t(g.reverse()),l),"Z")}for(var f,p,d,m=[],g=[],v=[],y=-1,E=e.length,x=be(n),T=be(i),b=n===r?function(){return p}:be(r),R=i===o?function(){return d}:be(o);++y<E;)a.call(this,f=e[y],y)?(g.push([p=+x.call(this,f,y),d=+T.call(this,f,y)]),v.push([+b.call(this,f,y),+R.call(this,f,y)])):g.length&&(h(),g=[],v=[]);return g.length&&h(),m.length?m.join(""):null}var n=wr,r=wr,i=0,o=_r,a=wn,s=aa,h=s.key,u=s,c="L",l=.7;return e.x=function(t){return arguments.length?(n=r=t,e):r},e.x0=function(t){return arguments.length?(n=t,e):n},e.x1=function(t){return arguments.length?(r=t,e):r},e.y=function(t){return arguments.length?(i=o=t,e):o},e.y0=function(t){return arguments.length?(i=t,e):i},e.y1=function(t){return arguments.length?(o=t,e):o},e.defined=function(t){return arguments.length?(a=t,e):a},e.interpolate=function(t){return arguments.length?(h="function"==typeof t?s=t:(s=xu.get(t)||aa).key,u=s.reverse||s,c=s.closed?"M":"L",e):h},e.tension=function(t){return arguments.length?(l=t,e):l},e}function Sa(t){return t.radius}function Ca(t){return[t.x,t.y]}function Aa(t){return function(){var e=t.apply(this,arguments),n=e[0],r=e[1]+yu;return[n*Math.cos(r),n*Math.sin(r)]}}function La(){return 64}function Pa(){return"circle"}function Da(t){var e=Math.sqrt(t/Rs);return"M0,"+e+"A"+e+","+e+" 0 1,1 0,"+-e+"A"+e+","+e+" 0 1,1 0,"+e+"Z"}function za(t,e){return cs(t,Cu),t.id=e,t}function Fa(t,e,n,r){var i=t.id;return k(t,"function"==typeof n?function(t,o,a){t.__transition__[i].tween.set(e,r(n.call(t,t.__data__,o,a)))}:(n=r(n),function(t){t.__transition__[i].tween.set(e,n)}))}function ka(t){return null==t&&(t=""),function(){this.textContent=t}}function Na(t,e,n,r){var i=t.__transition__||(t.__transition__={active:0,count:0}),o=i[n];if(!o){var s=r.time;o=i[n]={tween:new a,time:s,ease:r.ease,delay:r.delay,duration:r.duration},++i.count,ja.timer(function(r){function a(r){return i.active>n?u():(i.active=n,o.event&&o.event.start.call(t,c,e),o.tween.forEach(function(n,r){(r=r.call(t,c,e))&&m.push(r)}),void ja.timer(function(){return d.c=h(r||1)?wn:h,1},0,s))}function h(r){if(i.active!==n)return u();for(var a=r/p,s=l(a),h=m.length;h>0;)m[--h].call(t,s);return a>=1?(o.event&&o.event.end.call(t,c,e),u()):void 0}function u(){return--i.count?delete i[n]:delete t.__transition__,1}var c=t.__data__,l=o.ease,f=o.delay,p=o.duration,d=Zs,m=[];return d.t=f+s,r>=f?a(r-f):void(d.c=a)},0,s)}}function Va(t,e){t.attr("transform",function(t){return"translate("+e(t)+",0)"})}function Ia(t,e){t.attr("transform",function(t){return"translate(0,"+e(t)+")"})}function Ba(t){return t.toISOString()}function Ua(t,e,n){function r(e){return t(e)}function i(t,n){var r=t[1]-t[0],i=r/n,o=ja.bisect(Vu,i);return o==Vu.length?[e.year,Oo(t.map(function(t){return t/31536e6}),n)[2]]:o?e[i/Vu[o-1]<Vu[o]/i?o-1:o]:[Uu,Oo(t,n)[2]]}return r.invert=function(e){return Oa(t.invert(e))},r.domain=function(e){return arguments.length?(t.domain(e),r):t.domain().map(Oa)},r.nice=function(t,e){function n(n){return!isNaN(n)&&!t.range(n,Oa(+n+1),e).length}var o=r.domain(),a=Do(o),s=null==t?i(a,10):"number"==typeof t&&i(a,t);return s&&(t=s[0],e=s[1]),r.domain(ko(o,e>1?{floor:function(e){for(;n(e=t.floor(e));)e=Oa(e-1);return e},ceil:function(e){for(;n(e=t.ceil(e));)e=Oa(+e+1);return e}}:t))},r.ticks=function(t,e){var n=Do(r.domain()),o=null==t?i(n,10):"number"==typeof t?i(n,t):!t.range&&[{range:t},e];return o&&(t=o[0],e=o[1]),t.range(n[0],Oa(+n[1]+1),1>e?1:e)},r.tickFormat=function(){return n},r.copy=function(){return Ua(t.copy(),e,n)},Bo(r,t)}function Oa(t){return new Date(t)}function Wa(t){return JSON.parse(t.responseText)}function Ga(t){var e=Ya.createRange();return e.selectNode(Ya.body),e.createContextualFragment(t.responseText)}var ja={version:"3.4.11"};Date.now||(Date.now=function(){return+new Date});var qa=[].slice,Xa=function(t){return qa.call(t)},Ya=document,Za=Ya.documentElement,Ka=window;try{Xa(Za.childNodes)[0].nodeType}catch(Qa){Xa=function(t){for(var e=t.length,n=new Array(e);e--;)n[e]=t[e];return n}}try{Ya.createElement("div").style.setProperty("opacity",0,"")}catch($a){var Ja=Ka.Element.prototype,ts=Ja.setAttribute,es=Ja.setAttributeNS,ns=Ka.CSSStyleDeclaration.prototype,rs=ns.setProperty;Ja.setAttribute=function(t,e){ts.call(this,t,e+"")},Ja.setAttributeNS=function(t,e,n){es.call(this,t,e,n+"")},ns.setProperty=function(t,e,n){rs.call(this,t,e+"",n)}}ja.ascending=t,ja.descending=function(t,e){return t>e?-1:e>t?1:e>=t?0:0/0},ja.min=function(t,e){var n,r,i=-1,o=t.length;if(1===arguments.length){for(;++i<o&&!(null!=(n=t[i])&&n>=n);)n=void 0;for(;++i<o;)null!=(r=t[i])&&n>r&&(n=r)}else{for(;++i<o&&!(null!=(n=e.call(t,t[i],i))&&n>=n);)n=void 0;for(;++i<o;)null!=(r=e.call(t,t[i],i))&&n>r&&(n=r)}return n},ja.max=function(t,e){var n,r,i=-1,o=t.length;if(1===arguments.length){for(;++i<o&&!(null!=(n=t[i])&&n>=n);)n=void 0;for(;++i<o;)null!=(r=t[i])&&r>n&&(n=r)}else{for(;++i<o&&!(null!=(n=e.call(t,t[i],i))&&n>=n);)n=void 0;for(;++i<o;)null!=(r=e.call(t,t[i],i))&&r>n&&(n=r)}return n},ja.extent=function(t,e){var n,r,i,o=-1,a=t.length;if(1===arguments.length){for(;++o<a&&!(null!=(n=i=t[o])&&n>=n);)n=i=void 0;for(;++o<a;)null!=(r=t[o])&&(n>r&&(n=r),r>i&&(i=r))}else{for(;++o<a&&!(null!=(n=i=e.call(t,t[o],o))&&n>=n);)n=void 0;for(;++o<a;)null!=(r=e.call(t,t[o],o))&&(n>r&&(n=r),r>i&&(i=r))}return[n,i]},ja.sum=function(t,e){var n,r=0,i=t.length,o=-1;if(1===arguments.length)for(;++o<i;)isNaN(n=+t[o])||(r+=n);else for(;++o<i;)isNaN(n=+e.call(t,t[o],o))||(r+=n);return r},ja.mean=function(t,n){var r,i=0,o=t.length,a=-1,s=o;if(1===arguments.length)for(;++a<o;)e(r=t[a])?i+=r:--s;else for(;++a<o;)e(r=n.call(t,t[a],a))?i+=r:--s;return s?i/s:void 0},ja.quantile=function(t,e){var n=(t.length-1)*e+1,r=Math.floor(n),i=+t[r-1],o=n-r;return o?i+o*(t[r]-i):i},ja.median=function(n,r){return arguments.length>1&&(n=n.map(r)),n=n.filter(e),n.length?ja.quantile(n.sort(t),.5):void 0};var is=n(t);ja.bisectLeft=is.left,ja.bisect=ja.bisectRight=is.right,ja.bisector=function(e){return n(1===e.length?function(n,r){return t(e(n),r)}:e)},ja.shuffle=function(t){for(var e,n,r=t.length;r;)n=0|Math.random()*r--,e=t[r],t[r]=t[n],t[n]=e;return t},ja.permute=function(t,e){for(var n=e.length,r=new Array(n);n--;)r[n]=t[e[n]];return r},ja.pairs=function(t){for(var e,n=0,r=t.length-1,i=t[0],o=new Array(0>r?0:r);r>n;)o[n]=[e=i,i=t[++n]];return o},ja.zip=function(){if(!(i=arguments.length))return[];for(var t=-1,e=ja.min(arguments,r),n=new Array(e);++t<e;)for(var i,o=-1,a=n[t]=new Array(i);++o<i;)a[o]=arguments[o][t];return n},ja.transpose=function(t){return ja.zip.apply(ja,t)},ja.keys=function(t){var e=[];for(var n in t)e.push(n);return e},ja.values=function(t){var e=[];for(var n in t)e.push(t[n]);return e},ja.entries=function(t){var e=[];for(var n in t)e.push({key:n,value:t[n]});return e},ja.merge=function(t){for(var e,n,r,i=t.length,o=-1,a=0;++o<i;)a+=t[o].length;for(n=new Array(a);--i>=0;)for(r=t[i],e=r.length;--e>=0;)n[--a]=r[e];return n};var os=Math.abs;ja.range=function(t,e,n){if(arguments.length<3&&(n=1,arguments.length<2&&(e=t,t=0)),1/0===(e-t)/n)throw new Error("infinite range");var r,o=[],a=i(os(n)),s=-1;if(t*=a,e*=a,n*=a,0>n)for(;(r=t+n*++s)>e;)o.push(r/a);else for(;(r=t+n*++s)<e;)o.push(r/a);return o},ja.map=function(t){var e=new a;if(t instanceof a)t.forEach(function(t,n){e.set(t,n)});else for(var n in t)e.set(n,t[n]);return e},o(a,{has:s,get:function(t){return this[as+t]},set:function(t,e){return this[as+t]=e},remove:h,keys:u,values:function(){var t=[];return this.forEach(function(e,n){t.push(n)}),t},entries:function(){var t=[];return this.forEach(function(e,n){t.push({key:e,value:n})}),t},size:c,empty:l,forEach:function(t){for(var e in this)e.charCodeAt(0)===ss&&t.call(this,e.substring(1),this[e])}});var as="\x00",ss=as.charCodeAt(0);ja.nest=function(){function t(e,s,h){if(h>=o.length)return r?r.call(i,s):n?s.sort(n):s;for(var u,c,l,f,p=-1,d=s.length,m=o[h++],g=new a;++p<d;)(f=g.get(u=m(c=s[p])))?f.push(c):g.set(u,[c]);return e?(c=e(),l=function(n,r){c.set(n,t(e,r,h))}):(c={},l=function(n,r){c[n]=t(e,r,h)}),g.forEach(l),c}function e(t,n){if(n>=o.length)return t;var r=[],i=s[n++];return t.forEach(function(t,i){r.push({key:t,values:e(i,n)})}),i?r.sort(function(t,e){return i(t.key,e.key)}):r}var n,r,i={},o=[],s=[];return i.map=function(e,n){return t(n,e,0)},i.entries=function(n){return e(t(ja.map,n,0),0)},i.key=function(t){return o.push(t),i},i.sortKeys=function(t){return s[o.length-1]=t,i},i.sortValues=function(t){return n=t,i},i.rollup=function(t){return r=t,i},i},ja.set=function(t){var e=new f;if(t)for(var n=0,r=t.length;r>n;++n)e.add(t[n]);return e},o(f,{has:s,add:function(t){return this[as+t]=!0,t},remove:function(t){return t=as+t,t in this&&delete this[t]},values:u,size:c,empty:l,forEach:function(t){for(var e in this)e.charCodeAt(0)===ss&&t.call(this,e.substring(1))}}),ja.behavior={},ja.rebind=function(t,e){for(var n,r=1,i=arguments.length;++r<i;)t[n=arguments[r]]=p(t,e,e[n]);return t};var hs=["webkit","ms","moz","Moz","o","O"];ja.dispatch=function(){for(var t=new g,e=-1,n=arguments.length;++e<n;)t[arguments[e]]=v(t);return t},g.prototype.on=function(t,e){var n=t.indexOf("."),r="";if(n>=0&&(r=t.substring(n+1),t=t.substring(0,n)),t)return arguments.length<2?this[t].on(r):this[t].on(r,e);if(2===arguments.length){if(null==e)for(t in this)this.hasOwnProperty(t)&&this[t].on(r,null);return this}},ja.event=null,ja.requote=function(t){return t.replace(us,"\\$&")};var us=/[\\\^\$\*\+\?\|\[\]\(\)\.\{\}]/g,cs={}.__proto__?function(t,e){t.__proto__=e}:function(t,e){for(var n in e)t[n]=e[n]},ls=function(t,e){return e.querySelector(t)},fs=function(t,e){return e.querySelectorAll(t)},ps=Za.matches||Za[d(Za,"matchesSelector")],ds=function(t,e){return ps.call(t,e)};"function"==typeof Sizzle&&(ls=function(t,e){return Sizzle(t,e)[0]||null},fs=Sizzle,ds=Sizzle.matchesSelector),ja.selection=function(){return ys};var ms=ja.selection.prototype=[];ms.select=function(t){var e,n,r,i,o=[];t=b(t);for(var a=-1,s=this.length;++a<s;){o.push(e=[]),e.parentNode=(r=this[a]).parentNode;
for(var h=-1,u=r.length;++h<u;)(i=r[h])?(e.push(n=t.call(i,i.__data__,h,a)),n&&"__data__"in i&&(n.__data__=i.__data__)):e.push(null)}return T(o)},ms.selectAll=function(t){var e,n,r=[];t=R(t);for(var i=-1,o=this.length;++i<o;)for(var a=this[i],s=-1,h=a.length;++s<h;)(n=a[s])&&(r.push(e=Xa(t.call(n,n.__data__,s,i))),e.parentNode=n);return T(r)};var gs={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};ja.ns={prefix:gs,qualify:function(t){var e=t.indexOf(":"),n=t;return e>=0&&(n=t.substring(0,e),t=t.substring(e+1)),gs.hasOwnProperty(n)?{space:gs[n],local:t}:t}},ms.attr=function(t,e){if(arguments.length<2){if("string"==typeof t){var n=this.node();return t=ja.ns.qualify(t),t.local?n.getAttributeNS(t.space,t.local):n.getAttribute(t)}for(e in t)this.each(w(e,t[e]));return this}return this.each(w(t,e))},ms.classed=function(t,e){if(arguments.length<2){if("string"==typeof t){var n=this.node(),r=(t=M(t)).length,i=-1;if(e=n.classList){for(;++i<r;)if(!e.contains(t[i]))return!1}else for(e=n.getAttribute("class");++i<r;)if(!H(t[i]).test(e))return!1;return!0}for(e in t)this.each(S(e,t[e]));return this}return this.each(S(t,e))},ms.style=function(t,e,n){var r=arguments.length;if(3>r){if("string"!=typeof t){2>r&&(e="");for(n in t)this.each(A(n,t[n],e));return this}if(2>r)return Ka.getComputedStyle(this.node(),null).getPropertyValue(t);n=""}return this.each(A(t,e,n))},ms.property=function(t,e){if(arguments.length<2){if("string"==typeof t)return this.node()[t];for(e in t)this.each(L(e,t[e]));return this}return this.each(L(t,e))},ms.text=function(t){return arguments.length?this.each("function"==typeof t?function(){var e=t.apply(this,arguments);this.textContent=null==e?"":e}:null==t?function(){this.textContent=""}:function(){this.textContent=t}):this.node().textContent},ms.html=function(t){return arguments.length?this.each("function"==typeof t?function(){var e=t.apply(this,arguments);this.innerHTML=null==e?"":e}:null==t?function(){this.innerHTML=""}:function(){this.innerHTML=t}):this.node().innerHTML},ms.append=function(t){return t=P(t),this.select(function(){return this.appendChild(t.apply(this,arguments))})},ms.insert=function(t,e){return t=P(t),e=b(e),this.select(function(){return this.insertBefore(t.apply(this,arguments),e.apply(this,arguments)||null)})},ms.remove=function(){return this.each(function(){var t=this.parentNode;t&&t.removeChild(this)})},ms.data=function(t,e){function n(t,n){var r,i,o,s=t.length,l=n.length,f=Math.min(s,l),p=new Array(l),d=new Array(l),m=new Array(s);if(e){var g,v=new a,y=new a,E=[];for(r=-1;++r<s;)g=e.call(i=t[r],i.__data__,r),v.has(g)?m[r]=i:v.set(g,i),E.push(g);for(r=-1;++r<l;)g=e.call(n,o=n[r],r),(i=v.get(g))?(p[r]=i,i.__data__=o):y.has(g)||(d[r]=D(o)),y.set(g,o),v.remove(g);for(r=-1;++r<s;)v.has(E[r])&&(m[r]=t[r])}else{for(r=-1;++r<f;)i=t[r],o=n[r],i?(i.__data__=o,p[r]=i):d[r]=D(o);for(;l>r;++r)d[r]=D(n[r]);for(;s>r;++r)m[r]=t[r]}d.update=p,d.parentNode=p.parentNode=m.parentNode=t.parentNode,h.push(d),u.push(p),c.push(m)}var r,i,o=-1,s=this.length;if(!arguments.length){for(t=new Array(s=(r=this[0]).length);++o<s;)(i=r[o])&&(t[o]=i.__data__);return t}var h=N([]),u=T([]),c=T([]);if("function"==typeof t)for(;++o<s;)n(r=this[o],t.call(r,r.parentNode.__data__,o));else for(;++o<s;)n(r=this[o],t);return u.enter=function(){return h},u.exit=function(){return c},u},ms.datum=function(t){return arguments.length?this.property("__data__",t):this.property("__data__")},ms.filter=function(t){var e,n,r,i=[];"function"!=typeof t&&(t=z(t));for(var o=0,a=this.length;a>o;o++){i.push(e=[]),e.parentNode=(n=this[o]).parentNode;for(var s=0,h=n.length;h>s;s++)(r=n[s])&&t.call(r,r.__data__,s,o)&&e.push(r)}return T(i)},ms.order=function(){for(var t=-1,e=this.length;++t<e;)for(var n,r=this[t],i=r.length-1,o=r[i];--i>=0;)(n=r[i])&&(o&&o!==n.nextSibling&&o.parentNode.insertBefore(n,o),o=n);return this},ms.sort=function(t){t=F.apply(this,arguments);for(var e=-1,n=this.length;++e<n;)this[e].sort(t);return this.order()},ms.each=function(t){return k(this,function(e,n,r){t.call(e,e.__data__,n,r)})},ms.call=function(t){var e=Xa(arguments);return t.apply(e[0]=this,e),this},ms.empty=function(){return!this.node()},ms.node=function(){for(var t=0,e=this.length;e>t;t++)for(var n=this[t],r=0,i=n.length;i>r;r++){var o=n[r];if(o)return o}return null},ms.size=function(){var t=0;return this.each(function(){++t}),t};var vs=[];ja.selection.enter=N,ja.selection.enter.prototype=vs,vs.append=ms.append,vs.empty=ms.empty,vs.node=ms.node,vs.call=ms.call,vs.size=ms.size,vs.select=function(t){for(var e,n,r,i,o,a=[],s=-1,h=this.length;++s<h;){r=(i=this[s]).update,a.push(e=[]),e.parentNode=i.parentNode;for(var u=-1,c=i.length;++u<c;)(o=i[u])?(e.push(r[u]=n=t.call(i.parentNode,o.__data__,u,s)),n.__data__=o.__data__):e.push(null)}return T(a)},vs.insert=function(t,e){return arguments.length<2&&(e=V(this)),ms.insert.call(this,t,e)},ms.transition=function(){for(var t,e,n=_u||++Au,r=[],i=Hu||{time:Date.now(),ease:xi,delay:0,duration:250},o=-1,a=this.length;++o<a;){r.push(t=[]);for(var s=this[o],h=-1,u=s.length;++h<u;)(e=s[h])&&Na(e,h,n,i),t.push(e)}return za(r,n)},ms.interrupt=function(){return this.each(I)},ja.select=function(t){var e=["string"==typeof t?ls(t,Ya):t];return e.parentNode=Za,T([e])},ja.selectAll=function(t){var e=Xa("string"==typeof t?fs(t,Ya):t);return e.parentNode=Za,T([e])};var ys=ja.select(Za);ms.on=function(t,e,n){var r=arguments.length;if(3>r){if("string"!=typeof t){2>r&&(e=!1);for(n in t)this.each(B(n,t[n],e));return this}if(2>r)return(r=this.node()["__on"+t])&&r._;n=!1}return this.each(B(t,e,n))};var Es=ja.map({mouseenter:"mouseover",mouseleave:"mouseout"});Es.forEach(function(t){"on"+t in Ya&&Es.remove(t)});var xs="onselectstart"in Ya?null:d(Za.style,"userSelect"),Ts=0;ja.mouse=function(t){return G(t,E())};var bs=/WebKit/.test(Ka.navigator.userAgent)?-1:0;ja.touches=function(t,e){return arguments.length<2&&(e=E().touches),e?Xa(e).map(function(e){var n=G(t,e);return n.identifier=e.identifier,n}):[]},ja.behavior.drag=function(){function t(){this.on("mousedown.drag",i).on("touchstart.drag",o)}function e(t,e,i,o,a){return function(){function s(){var t,n,r=e(f,m);r&&(t=r[0]-E[0],n=r[1]-E[1],d|=t|n,E=r,p({type:"drag",x:r[0]+u[0],y:r[1]+u[1],dx:t,dy:n}))}function h(){e(f,m)&&(v.on(o+g,null).on(a+g,null),y(d&&ja.event.target===l),p({type:"dragend"}))}var u,c=this,l=ja.event.target,f=c.parentNode,p=n.of(c,arguments),d=0,m=t(),g=".drag"+(null==m?"":"-"+m),v=ja.select(i()).on(o+g,s).on(a+g,h),y=W(),E=e(f,m);r?(u=r.apply(c,arguments),u=[u.x-E[0],u.y-E[1]]):u=[0,0],p({type:"dragstart"})}}var n=x(t,"drag","dragstart","dragend"),r=null,i=e(m,ja.mouse,X,"mousemove","mouseup"),o=e(j,ja.touch,q,"touchmove","touchend");return t.origin=function(e){return arguments.length?(r=e,t):r},ja.rebind(t,n,"on")};var Rs=Math.PI,ws=2*Rs,_s=Rs/2,Hs=1e-6,Ms=Hs*Hs,Ss=Rs/180,Cs=180/Rs,As=Math.SQRT2,Ls=2,Ps=4;ja.interpolateZoom=function(t,e){function n(t){var e=t*y;if(v){var n=J(m),a=o/(Ls*f)*(n*te(As*e+m)-$(m));return[r+a*u,i+a*c,o*n/J(As*e+m)]}return[r+t*u,i+t*c,o*Math.exp(As*e)]}var r=t[0],i=t[1],o=t[2],a=e[0],s=e[1],h=e[2],u=a-r,c=s-i,l=u*u+c*c,f=Math.sqrt(l),p=(h*h-o*o+Ps*l)/(2*o*Ls*f),d=(h*h-o*o-Ps*l)/(2*h*Ls*f),m=Math.log(Math.sqrt(p*p+1)-p),g=Math.log(Math.sqrt(d*d+1)-d),v=g-m,y=(v||Math.log(h/o))/As;return n.duration=1e3*y,n},ja.behavior.zoom=function(){function t(t){t.on(M,u).on(Fs+".zoom",l).on("dblclick.zoom",f).on(A,c)}function e(t){return[(t[0]-w.x)/w.k,(t[1]-w.y)/w.k]}function n(t){return[t[0]*w.k+w.x,t[1]*w.k+w.y]}function r(t){w.k=Math.max(H[0],Math.min(H[1],t))}function i(t,e){e=n(e),w.x+=t[0]-e[0],w.y+=t[1]-e[1]}function o(){T&&T.domain(E.range().map(function(t){return(t-w.x)/w.k}).map(E.invert)),R&&R.domain(b.range().map(function(t){return(t-w.y)/w.k}).map(b.invert))}function a(t){t({type:"zoomstart"})}function s(t){o(),t({type:"zoom",scale:w.k,translate:[w.x,w.y]})}function h(t){t({type:"zoomend"})}function u(){function t(){c=1,i(ja.mouse(r),f),s(u)}function n(){l.on(S,null).on(C,null),p(c&&ja.event.target===o),h(u)}var r=this,o=ja.event.target,u=L.of(r,arguments),c=0,l=ja.select(Ka).on(S,t).on(C,n),f=e(ja.mouse(r)),p=W();I.call(r),a(u)}function c(){function t(){var t=ja.touches(p);return f=w.k,t.forEach(function(t){t.identifier in m&&(m[t.identifier]=e(t))}),t}function n(){var e=ja.event.target;ja.select(e).on(x,o).on(T,l),b.push(e);for(var n=ja.event.changedTouches,a=0,h=n.length;h>a;++a)m[n[a].identifier]=null;var u=t(),c=Date.now();if(1===u.length){if(500>c-v){var f=u[0],p=m[f.identifier];r(2*w.k),i(f,p),y(),s(d)}v=c}else if(u.length>1){var f=u[0],E=u[1],R=f[0]-E[0],_=f[1]-E[1];g=R*R+_*_}}function o(){for(var t,e,n,o,a=ja.touches(p),h=0,u=a.length;u>h;++h,o=null)if(n=a[h],o=m[n.identifier]){if(e)break;t=n,e=o}if(o){var c=(c=n[0]-t[0])*c+(c=n[1]-t[1])*c,l=g&&Math.sqrt(c/g);t=[(t[0]+n[0])/2,(t[1]+n[1])/2],e=[(e[0]+o[0])/2,(e[1]+o[1])/2],r(l*f)}v=null,i(t,e),s(d)}function l(){if(ja.event.touches.length){for(var e=ja.event.changedTouches,n=0,r=e.length;r>n;++n)delete m[e[n].identifier];for(var i in m)return void t()}ja.selectAll(b).on(E,null),R.on(M,u).on(A,c),_(),h(d)}var f,p=this,d=L.of(p,arguments),m={},g=0,E=".zoom-"+ja.event.changedTouches[0].identifier,x="touchmove"+E,T="touchend"+E,b=[],R=ja.select(p).on(M,null).on(A,n),_=W();I.call(p),n(),a(d)}function l(){var t=L.of(this,arguments);g?clearTimeout(g):(p=e(d=m||ja.mouse(this)),I.call(this),a(t)),g=setTimeout(function(){g=null,h(t)},50),y(),r(Math.pow(2,.002*Ds())*w.k),i(d,p),s(t)}function f(){var t=L.of(this,arguments),n=ja.mouse(this),o=e(n),u=Math.log(w.k)/Math.LN2;a(t),r(Math.pow(2,ja.event.shiftKey?Math.ceil(u)-1:Math.floor(u)+1)),i(n,o),s(t),h(t)}var p,d,m,g,v,E,T,b,R,w={x:0,y:0,k:1},_=[960,500],H=zs,M="mousedown.zoom",S="mousemove.zoom",C="mouseup.zoom",A="touchstart.zoom",L=x(t,"zoomstart","zoom","zoomend");return t.event=function(t){t.each(function(){var t=L.of(this,arguments),e=w;_u?ja.select(this).transition().each("start.zoom",function(){w=this.__chart__||{x:0,y:0,k:1},a(t)}).tween("zoom:zoom",function(){var n=_[0],r=_[1],i=n/2,o=r/2,a=ja.interpolateZoom([(i-w.x)/w.k,(o-w.y)/w.k,n/w.k],[(i-e.x)/e.k,(o-e.y)/e.k,n/e.k]);return function(e){var r=a(e),h=n/r[2];this.__chart__=w={x:i-r[0]*h,y:o-r[1]*h,k:h},s(t)}}).each("end.zoom",function(){h(t)}):(this.__chart__=w,a(t),s(t),h(t))})},t.translate=function(e){return arguments.length?(w={x:+e[0],y:+e[1],k:w.k},o(),t):[w.x,w.y]},t.scale=function(e){return arguments.length?(w={x:w.x,y:w.y,k:+e},o(),t):w.k},t.scaleExtent=function(e){return arguments.length?(H=null==e?zs:[+e[0],+e[1]],t):H},t.center=function(e){return arguments.length?(m=e&&[+e[0],+e[1]],t):m},t.size=function(e){return arguments.length?(_=e&&[+e[0],+e[1]],t):_},t.x=function(e){return arguments.length?(T=e,E=e.copy(),w={x:0,y:0,k:1},t):T},t.y=function(e){return arguments.length?(R=e,b=e.copy(),w={x:0,y:0,k:1},t):R},ja.rebind(t,L,"on")};var Ds,zs=[0,1/0],Fs="onwheel"in Ya?(Ds=function(){return-ja.event.deltaY*(ja.event.deltaMode?120:1)},"wheel"):"onmousewheel"in Ya?(Ds=function(){return ja.event.wheelDelta},"mousewheel"):(Ds=function(){return-ja.event.detail},"MozMousePixelScroll");ja.color=ne,ne.prototype.toString=function(){return this.rgb()+""},ja.hsl=re;var ks=re.prototype=new ne;ks.brighter=function(t){return t=Math.pow(.7,arguments.length?t:1),new re(this.h,this.s,this.l/t)},ks.darker=function(t){return t=Math.pow(.7,arguments.length?t:1),new re(this.h,this.s,t*this.l)},ks.rgb=function(){return ie(this.h,this.s,this.l)},ja.hcl=oe;var Ns=oe.prototype=new ne;Ns.brighter=function(t){return new oe(this.h,this.c,Math.min(100,this.l+Vs*(arguments.length?t:1)))},Ns.darker=function(t){return new oe(this.h,this.c,Math.max(0,this.l-Vs*(arguments.length?t:1)))},Ns.rgb=function(){return ae(this.h,this.c,this.l).rgb()},ja.lab=se;var Vs=18,Is=.95047,Bs=1,Us=1.08883,Os=se.prototype=new ne;Os.brighter=function(t){return new se(Math.min(100,this.l+Vs*(arguments.length?t:1)),this.a,this.b)},Os.darker=function(t){return new se(Math.max(0,this.l-Vs*(arguments.length?t:1)),this.a,this.b)},Os.rgb=function(){return he(this.l,this.a,this.b)},ja.rgb=pe;var Ws=pe.prototype=new ne;Ws.brighter=function(t){t=Math.pow(.7,arguments.length?t:1);var e=this.r,n=this.g,r=this.b,i=30;return e||n||r?(e&&i>e&&(e=i),n&&i>n&&(n=i),r&&i>r&&(r=i),new pe(Math.min(255,e/t),Math.min(255,n/t),Math.min(255,r/t))):new pe(i,i,i)},Ws.darker=function(t){return t=Math.pow(.7,arguments.length?t:1),new pe(t*this.r,t*this.g,t*this.b)},Ws.hsl=function(){return ye(this.r,this.g,this.b)},Ws.toString=function(){return"#"+ge(this.r)+ge(this.g)+ge(this.b)};var Gs=ja.map({aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074});Gs.forEach(function(t,e){Gs.set(t,de(e))}),ja.functor=be,ja.xhr=we(Re),ja.dsv=function(t,e){function n(t,n,o){arguments.length<3&&(o=n,n=null);var a=_e(t,e,null==n?r:i(n),o);return a.row=function(t){return arguments.length?a.response(null==(n=t)?r:i(t)):n},a}function r(t){return n.parse(t.responseText)}function i(t){return function(e){return n.parse(e.responseText,t)}}function o(e){return e.map(a).join(t)}function a(t){return s.test(t)?'"'+t.replace(/\"/g,'""')+'"':t}var s=new RegExp('["'+t+"\n]"),h=t.charCodeAt(0);return n.parse=function(t,e){var r;return n.parseRows(t,function(t,n){if(r)return r(t,n-1);var i=new Function("d","return {"+t.map(function(t,e){return JSON.stringify(t)+": d["+e+"]"}).join(",")+"}");r=e?function(t,n){return e(i(t),n)}:i})},n.parseRows=function(t,e){function n(){if(c>=u)return a;if(i)return i=!1,o;var e=c;if(34===t.charCodeAt(e)){for(var n=e;n++<u;)if(34===t.charCodeAt(n)){if(34!==t.charCodeAt(n+1))break;++n}c=n+2;var r=t.charCodeAt(n+1);return 13===r?(i=!0,10===t.charCodeAt(n+2)&&++c):10===r&&(i=!0),t.substring(e+1,n).replace(/""/g,'"')}for(;u>c;){var r=t.charCodeAt(c++),s=1;if(10===r)i=!0;else if(13===r)i=!0,10===t.charCodeAt(c)&&(++c,++s);else if(r!==h)continue;return t.substring(e,c-s)}return t.substring(e)}for(var r,i,o={},a={},s=[],u=t.length,c=0,l=0;(r=n())!==a;){for(var f=[];r!==o&&r!==a;)f.push(r),r=n();(!e||(f=e(f,l++)))&&s.push(f)}return s},n.format=function(e){if(Array.isArray(e[0]))return n.formatRows(e);var r=new f,i=[];return e.forEach(function(t){for(var e in t)r.has(e)||i.push(r.add(e))}),[i.map(a).join(t)].concat(e.map(function(e){return i.map(function(t){return a(e[t])}).join(t)})).join("\n")},n.formatRows=function(t){return t.map(o).join("\n")},n},ja.csv=ja.dsv(",","text/csv"),ja.tsv=ja.dsv("	","text/tab-separated-values"),ja.touch=function(t,e,n){if(arguments.length<3&&(n=e,e=E().changedTouches),e)for(var r,i=0,o=e.length;o>i;++i)if((r=e[i]).identifier===n)return G(t,r)};var js,qs,Xs,Ys,Zs,Ks=Ka[d(Ka,"requestAnimationFrame")]||function(t){setTimeout(t,17)};ja.timer=function(t,e,n){var r=arguments.length;2>r&&(e=0),3>r&&(n=Date.now());var i=n+e,o={c:t,t:i,f:!1,n:null};qs?qs.n=o:js=o,qs=o,Xs||(Ys=clearTimeout(Ys),Xs=1,Ks(Me))},ja.timer.flush=function(){Se(),Ce()},ja.round=function(t,e){return e?Math.round(t*(e=Math.pow(10,e)))/e:Math.round(t)};var Qs=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"].map(Le);ja.formatPrefix=function(t,e){var n=0;return t&&(0>t&&(t*=-1),e&&(t=ja.round(t,Ae(t,e))),n=1+Math.floor(1e-12+Math.log(t)/Math.LN10),n=Math.max(-24,Math.min(24,3*Math.floor((n-1)/3)))),Qs[8+n/3]};var $s=/(?:([^{])?([<>=^]))?([+\- ])?([$#])?(0)?(\d+)?(,)?(\.-?\d+)?([a-z%])?/i,Js=ja.map({b:function(t){return t.toString(2)},c:function(t){return String.fromCharCode(t)},o:function(t){return t.toString(8)},x:function(t){return t.toString(16)},X:function(t){return t.toString(16).toUpperCase()},g:function(t,e){return t.toPrecision(e)},e:function(t,e){return t.toExponential(e)},f:function(t,e){return t.toFixed(e)},r:function(t,e){return(t=ja.round(t,Ae(t,e))).toFixed(Math.max(0,Math.min(20,Ae(t*(1+1e-15),e))))}}),th=ja.time={},eh=Date;ze.prototype={getDate:function(){return this._.getUTCDate()},getDay:function(){return this._.getUTCDay()},getFullYear:function(){return this._.getUTCFullYear()},getHours:function(){return this._.getUTCHours()},getMilliseconds:function(){return this._.getUTCMilliseconds()},getMinutes:function(){return this._.getUTCMinutes()},getMonth:function(){return this._.getUTCMonth()},getSeconds:function(){return this._.getUTCSeconds()},getTime:function(){return this._.getTime()},getTimezoneOffset:function(){return 0},valueOf:function(){return this._.valueOf()},setDate:function(){nh.setUTCDate.apply(this._,arguments)},setDay:function(){nh.setUTCDay.apply(this._,arguments)},setFullYear:function(){nh.setUTCFullYear.apply(this._,arguments)},setHours:function(){nh.setUTCHours.apply(this._,arguments)},setMilliseconds:function(){nh.setUTCMilliseconds.apply(this._,arguments)},setMinutes:function(){nh.setUTCMinutes.apply(this._,arguments)},setMonth:function(){nh.setUTCMonth.apply(this._,arguments)},setSeconds:function(){nh.setUTCSeconds.apply(this._,arguments)},setTime:function(){nh.setTime.apply(this._,arguments)}};var nh=Date.prototype;th.year=Fe(function(t){return t=th.day(t),t.setMonth(0,1),t},function(t,e){t.setFullYear(t.getFullYear()+e)},function(t){return t.getFullYear()}),th.years=th.year.range,th.years.utc=th.year.utc.range,th.day=Fe(function(t){var e=new eh(2e3,0);return e.setFullYear(t.getFullYear(),t.getMonth(),t.getDate()),e},function(t,e){t.setDate(t.getDate()+e)},function(t){return t.getDate()-1}),th.days=th.day.range,th.days.utc=th.day.utc.range,th.dayOfYear=function(t){var e=th.year(t);return Math.floor((t-e-6e4*(t.getTimezoneOffset()-e.getTimezoneOffset()))/864e5)},["sunday","monday","tuesday","wednesday","thursday","friday","saturday"].forEach(function(t,e){e=7-e;var n=th[t]=Fe(function(t){return(t=th.day(t)).setDate(t.getDate()-(t.getDay()+e)%7),t},function(t,e){t.setDate(t.getDate()+7*Math.floor(e))},function(t){var n=th.year(t).getDay();return Math.floor((th.dayOfYear(t)+(n+e)%7)/7)-(n!==e)});th[t+"s"]=n.range,th[t+"s"].utc=n.utc.range,th[t+"OfYear"]=function(t){var n=th.year(t).getDay();return Math.floor((th.dayOfYear(t)+(n+e)%7)/7)}}),th.week=th.sunday,th.weeks=th.sunday.range,th.weeks.utc=th.sunday.utc.range,th.weekOfYear=th.sundayOfYear;var rh={"-":"",_:" ",0:"0"},ih=/^\s*\d+/,oh=/^%/;ja.locale=function(t){return{numberFormat:Pe(t),timeFormat:Ne(t)}};var ah=ja.locale({decimal:".",thousands:",",grouping:[3],currency:["$",""],dateTime:"%a %b %e %X %Y",date:"%m/%d/%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});ja.format=ah.numberFormat,ja.geo={},on.prototype={s:0,t:0,add:function(t){an(t,this.t,sh),an(sh.s,this.s,this),this.s?this.t+=sh.t:this.s=sh.t},reset:function(){this.s=this.t=0},valueOf:function(){return this.s}};var sh=new on;ja.geo.stream=function(t,e){t&&hh.hasOwnProperty(t.type)?hh[t.type](t,e):sn(t,e)};var hh={Feature:function(t,e){sn(t.geometry,e)},FeatureCollection:function(t,e){for(var n=t.features,r=-1,i=n.length;++r<i;)sn(n[r].geometry,e)}},uh={Sphere:function(t,e){e.sphere()},Point:function(t,e){t=t.coordinates,e.point(t[0],t[1],t[2])},MultiPoint:function(t,e){for(var n=t.coordinates,r=-1,i=n.length;++r<i;)t=n[r],e.point(t[0],t[1],t[2])},LineString:function(t,e){hn(t.coordinates,e,0)},MultiLineString:function(t,e){for(var n=t.coordinates,r=-1,i=n.length;++r<i;)hn(n[r],e,0)},Polygon:function(t,e){un(t.coordinates,e)},MultiPolygon:function(t,e){for(var n=t.coordinates,r=-1,i=n.length;++r<i;)un(n[r],e)},GeometryCollection:function(t,e){for(var n=t.geometries,r=-1,i=n.length;++r<i;)sn(n[r],e)}};ja.geo.area=function(t){return ch=0,ja.geo.stream(t,fh),ch};var ch,lh=new on,fh={sphere:function(){ch+=4*Rs},point:m,lineStart:m,lineEnd:m,polygonStart:function(){lh.reset(),fh.lineStart=cn},polygonEnd:function(){var t=2*lh;ch+=0>t?4*Rs+t:t,fh.lineStart=fh.lineEnd=fh.point=m}};ja.geo.bounds=function(){function t(t,e){E.push(x=[c=t,f=t]),l>e&&(l=e),e>p&&(p=e)}function e(e,n){var r=ln([e*Ss,n*Ss]);if(v){var i=pn(v,r),o=[i[1],-i[0],0],a=pn(o,i);gn(a),a=vn(a);var h=e-d,u=h>0?1:-1,m=a[0]*Cs*u,g=os(h)>180;if(g^(m>u*d&&u*e>m)){var y=a[1]*Cs;y>p&&(p=y)}else if(m=(m+360)%360-180,g^(m>u*d&&u*e>m)){var y=-a[1]*Cs;l>y&&(l=y)}else l>n&&(l=n),n>p&&(p=n);g?d>e?s(c,e)>s(c,f)&&(f=e):s(e,f)>s(c,f)&&(c=e):f>=c?(c>e&&(c=e),e>f&&(f=e)):e>d?s(c,e)>s(c,f)&&(f=e):s(e,f)>s(c,f)&&(c=e)}else t(e,n);v=r,d=e}function n(){T.point=e}function r(){x[0]=c,x[1]=f,T.point=t,v=null}function i(t,n){if(v){var r=t-d;y+=os(r)>180?r+(r>0?360:-360):r}else m=t,g=n;fh.point(t,n),e(t,n)}function o(){fh.lineStart()}function a(){i(m,g),fh.lineEnd(),os(y)>Hs&&(c=-(f=180)),x[0]=c,x[1]=f,v=null}function s(t,e){return(e-=t)<0?e+360:e}function h(t,e){return t[0]-e[0]}function u(t,e){return e[0]<=e[1]?e[0]<=t&&t<=e[1]:t<e[0]||e[1]<t}var c,l,f,p,d,m,g,v,y,E,x,T={point:t,lineStart:n,lineEnd:r,polygonStart:function(){T.point=i,T.lineStart=o,T.lineEnd=a,y=0,fh.polygonStart()},polygonEnd:function(){fh.polygonEnd(),T.point=t,T.lineStart=n,T.lineEnd=r,0>lh?(c=-(f=180),l=-(p=90)):y>Hs?p=90:-Hs>y&&(l=-90),x[0]=c,x[1]=f}};return function(t){p=f=-(c=l=1/0),E=[],ja.geo.stream(t,T);var e=E.length;if(e){E.sort(h);for(var n,r=1,i=E[0],o=[i];e>r;++r)n=E[r],u(n[0],i)||u(n[1],i)?(s(i[0],n[1])>s(i[0],i[1])&&(i[1]=n[1]),s(n[0],i[1])>s(i[0],i[1])&&(i[0]=n[0])):o.push(i=n);for(var a,n,d=-1/0,e=o.length-1,r=0,i=o[e];e>=r;i=n,++r)n=o[r],(a=s(i[1],n[0]))>d&&(d=a,c=n[0],f=i[1])}return E=x=null,1/0===c||1/0===l?[[0/0,0/0],[0/0,0/0]]:[[c,l],[f,p]]}}(),ja.geo.centroid=function(t){ph=dh=mh=gh=vh=yh=Eh=xh=Th=bh=Rh=0,ja.geo.stream(t,wh);var e=Th,n=bh,r=Rh,i=e*e+n*n+r*r;return Ms>i&&(e=yh,n=Eh,r=xh,Hs>dh&&(e=mh,n=gh,r=vh),i=e*e+n*n+r*r,Ms>i)?[0/0,0/0]:[Math.atan2(n,e)*Cs,Q(r/Math.sqrt(i))*Cs]};var ph,dh,mh,gh,vh,yh,Eh,xh,Th,bh,Rh,wh={sphere:m,point:En,lineStart:Tn,lineEnd:bn,polygonStart:function(){wh.lineStart=Rn},polygonEnd:function(){wh.lineStart=Tn}},_h=Sn(wn,Dn,Fn,[-Rs,-Rs/2]),Hh=1e9;ja.geo.clipExtent=function(){var t,e,n,r,i,o,a={stream:function(t){return i&&(i.valid=!1),i=o(t),i.valid=!0,i},extent:function(s){return arguments.length?(o=Vn(t=+s[0][0],e=+s[0][1],n=+s[1][0],r=+s[1][1]),i&&(i.valid=!1,i=null),a):[[t,e],[n,r]]}};return a.extent([[0,0],[960,500]])},(ja.geo.conicEqualArea=function(){return Bn(Un)}).raw=Un,ja.geo.albers=function(){return ja.geo.conicEqualArea().rotate([96,0]).center([-.6,38.7]).parallels([29.5,45.5]).scale(1070)},ja.geo.albersUsa=function(){function t(t){var o=t[0],a=t[1];return e=null,n(o,a),e||(r(o,a),e)||i(o,a),e}var e,n,r,i,o=ja.geo.albers(),a=ja.geo.conicEqualArea().rotate([154,0]).center([-2,58.5]).parallels([55,65]),s=ja.geo.conicEqualArea().rotate([157,0]).center([-3,19.9]).parallels([8,18]),h={point:function(t,n){e=[t,n]}};return t.invert=function(t){var e=o.scale(),n=o.translate(),r=(t[0]-n[0])/e,i=(t[1]-n[1])/e;return(i>=.12&&.234>i&&r>=-.425&&-.214>r?a:i>=.166&&.234>i&&r>=-.214&&-.115>r?s:o).invert(t)},t.stream=function(t){var e=o.stream(t),n=a.stream(t),r=s.stream(t);return{point:function(t,i){e.point(t,i),n.point(t,i),r.point(t,i)},sphere:function(){e.sphere(),n.sphere(),r.sphere()},lineStart:function(){e.lineStart(),n.lineStart(),r.lineStart()},lineEnd:function(){e.lineEnd(),n.lineEnd(),r.lineEnd()},polygonStart:function(){e.polygonStart(),n.polygonStart(),r.polygonStart()},polygonEnd:function(){e.polygonEnd(),n.polygonEnd(),r.polygonEnd()}}},t.precision=function(e){return arguments.length?(o.precision(e),a.precision(e),s.precision(e),t):o.precision()},t.scale=function(e){return arguments.length?(o.scale(e),a.scale(.35*e),s.scale(e),t.translate(o.translate())):o.scale()},t.translate=function(e){if(!arguments.length)return o.translate();var u=o.scale(),c=+e[0],l=+e[1];return n=o.translate(e).clipExtent([[c-.455*u,l-.238*u],[c+.455*u,l+.238*u]]).stream(h).point,r=a.translate([c-.307*u,l+.201*u]).clipExtent([[c-.425*u+Hs,l+.12*u+Hs],[c-.214*u-Hs,l+.234*u-Hs]]).stream(h).point,i=s.translate([c-.205*u,l+.212*u]).clipExtent([[c-.214*u+Hs,l+.166*u+Hs],[c-.115*u-Hs,l+.234*u-Hs]]).stream(h).point,t},t.scale(1070)};var Mh,Sh,Ch,Ah,Lh,Ph,Dh={point:m,lineStart:m,lineEnd:m,polygonStart:function(){Sh=0,Dh.lineStart=On},polygonEnd:function(){Dh.lineStart=Dh.lineEnd=Dh.point=m,Mh+=os(Sh/2)}},zh={point:Wn,lineStart:m,lineEnd:m,polygonStart:m,polygonEnd:m},Fh={point:qn,lineStart:Xn,lineEnd:Yn,polygonStart:function(){Fh.lineStart=Zn},polygonEnd:function(){Fh.point=qn,Fh.lineStart=Xn,Fh.lineEnd=Yn}};ja.geo.path=function(){function t(t){return t&&("function"==typeof s&&o.pointRadius(+s.apply(this,arguments)),a&&a.valid||(a=i(o)),ja.geo.stream(t,a)),o.result()}function e(){return a=null,t}var n,r,i,o,a,s=4.5;return t.area=function(t){return Mh=0,ja.geo.stream(t,i(Dh)),Mh},t.centroid=function(t){return mh=gh=vh=yh=Eh=xh=Th=bh=Rh=0,ja.geo.stream(t,i(Fh)),Rh?[Th/Rh,bh/Rh]:xh?[yh/xh,Eh/xh]:vh?[mh/vh,gh/vh]:[0/0,0/0]},t.bounds=function(t){return Lh=Ph=-(Ch=Ah=1/0),ja.geo.stream(t,i(zh)),[[Ch,Ah],[Lh,Ph]]},t.projection=function(t){return arguments.length?(i=(n=t)?t.stream||$n(t):Re,e()):n},t.context=function(t){return arguments.length?(o=null==(r=t)?new Gn:new Kn(t),"function"!=typeof s&&o.pointRadius(s),e()):r},t.pointRadius=function(e){return arguments.length?(s="function"==typeof e?e:(o.pointRadius(+e),+e),t):s},t.projection(ja.geo.albersUsa()).context(null)},ja.geo.transform=function(t){return{stream:function(e){var n=new Jn(e);for(var r in t)n[r]=t[r];return n}}},Jn.prototype={point:function(t,e){this.stream.point(t,e)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}},ja.geo.projection=er,ja.geo.projectionMutator=nr,(ja.geo.equirectangular=function(){return er(ir)}).raw=ir.invert=ir,ja.geo.rotation=function(t){function e(e){return e=t(e[0]*Ss,e[1]*Ss),e[0]*=Cs,e[1]*=Cs,e}return t=ar(t[0]%360*Ss,t[1]*Ss,t.length>2?t[2]*Ss:0),e.invert=function(e){return e=t.invert(e[0]*Ss,e[1]*Ss),e[0]*=Cs,e[1]*=Cs,e},e},or.invert=ir,ja.geo.circle=function(){function t(){var t="function"==typeof r?r.apply(this,arguments):r,e=ar(-t[0]*Ss,-t[1]*Ss,0).invert,i=[];return n(null,null,1,{point:function(t,n){i.push(t=e(t,n)),t[0]*=Cs,t[1]*=Cs}}),{type:"Polygon",coordinates:[i]}}var e,n,r=[0,0],i=6;return t.origin=function(e){return arguments.length?(r=e,t):r},t.angle=function(r){return arguments.length?(n=cr((e=+r)*Ss,i*Ss),t):e},t.precision=function(r){return arguments.length?(n=cr(e*Ss,(i=+r)*Ss),t):i},t.angle(90)},ja.geo.distance=function(t,e){var n,r=(e[0]-t[0])*Ss,i=t[1]*Ss,o=e[1]*Ss,a=Math.sin(r),s=Math.cos(r),h=Math.sin(i),u=Math.cos(i),c=Math.sin(o),l=Math.cos(o);return Math.atan2(Math.sqrt((n=l*a)*n+(n=u*c-h*l*s)*n),h*c+u*l*s)},ja.geo.graticule=function(){function t(){return{type:"MultiLineString",coordinates:e()}}function e(){return ja.range(Math.ceil(o/g)*g,i,g).map(f).concat(ja.range(Math.ceil(u/v)*v,h,v).map(p)).concat(ja.range(Math.ceil(r/d)*d,n,d).filter(function(t){return os(t%g)>Hs}).map(c)).concat(ja.range(Math.ceil(s/m)*m,a,m).filter(function(t){return os(t%v)>Hs}).map(l))}var n,r,i,o,a,s,h,u,c,l,f,p,d=10,m=d,g=90,v=360,y=2.5;return t.lines=function(){return e().map(function(t){return{type:"LineString",coordinates:t}})},t.outline=function(){return{type:"Polygon",coordinates:[f(o).concat(p(h).slice(1),f(i).reverse().slice(1),p(u).reverse().slice(1))]}},t.extent=function(e){return arguments.length?t.majorExtent(e).minorExtent(e):t.minorExtent()},t.majorExtent=function(e){return arguments.length?(o=+e[0][0],i=+e[1][0],u=+e[0][1],h=+e[1][1],o>i&&(e=o,o=i,i=e),u>h&&(e=u,u=h,h=e),t.precision(y)):[[o,u],[i,h]]},t.minorExtent=function(e){return arguments.length?(r=+e[0][0],n=+e[1][0],s=+e[0][1],a=+e[1][1],r>n&&(e=r,r=n,n=e),s>a&&(e=s,s=a,a=e),t.precision(y)):[[r,s],[n,a]]},t.step=function(e){return arguments.length?t.majorStep(e).minorStep(e):t.minorStep()},t.majorStep=function(e){return arguments.length?(g=+e[0],v=+e[1],t):[g,v]},t.minorStep=function(e){return arguments.length?(d=+e[0],m=+e[1],t):[d,m]},t.precision=function(e){return arguments.length?(y=+e,c=fr(s,a,90),l=pr(r,n,y),f=fr(u,h,90),p=pr(o,i,y),t):y},t.majorExtent([[-180,-90+Hs],[180,90-Hs]]).minorExtent([[-180,-80-Hs],[180,80+Hs]])},ja.geo.greatArc=function(){function t(){return{type:"LineString",coordinates:[e||r.apply(this,arguments),n||i.apply(this,arguments)]}}var e,n,r=dr,i=mr;return t.distance=function(){return ja.geo.distance(e||r.apply(this,arguments),n||i.apply(this,arguments))},t.source=function(n){return arguments.length?(r=n,e="function"==typeof n?null:n,t):r},t.target=function(e){return arguments.length?(i=e,n="function"==typeof e?null:e,t):i},t.precision=function(){return arguments.length?t:0},t},ja.geo.interpolate=function(t,e){return gr(t[0]*Ss,t[1]*Ss,e[0]*Ss,e[1]*Ss)},ja.geo.length=function(t){return kh=0,ja.geo.stream(t,Nh),kh};var kh,Nh={sphere:m,point:m,lineStart:vr,lineEnd:m,polygonStart:m,polygonEnd:m},Vh=yr(function(t){return Math.sqrt(2/(1+t))},function(t){return 2*Math.asin(t/2)});(ja.geo.azimuthalEqualArea=function(){return er(Vh)}).raw=Vh;var Ih=yr(function(t){var e=Math.acos(t);
return e&&e/Math.sin(e)},Re);(ja.geo.azimuthalEquidistant=function(){return er(Ih)}).raw=Ih,(ja.geo.conicConformal=function(){return Bn(Er)}).raw=Er,(ja.geo.conicEquidistant=function(){return Bn(xr)}).raw=xr;var Bh=yr(function(t){return 1/t},Math.atan);(ja.geo.gnomonic=function(){return er(Bh)}).raw=Bh,Tr.invert=function(t,e){return[t,2*Math.atan(Math.exp(e))-_s]},(ja.geo.mercator=function(){return br(Tr)}).raw=Tr;var Uh=yr(function(){return 1},Math.asin);(ja.geo.orthographic=function(){return er(Uh)}).raw=Uh;var Oh=yr(function(t){return 1/(1+t)},function(t){return 2*Math.atan(t)});(ja.geo.stereographic=function(){return er(Oh)}).raw=Oh,Rr.invert=function(t,e){return[-e,2*Math.atan(Math.exp(t))-_s]},(ja.geo.transverseMercator=function(){var t=br(Rr),e=t.center,n=t.rotate;return t.center=function(t){return t?e([-t[1],t[0]]):(t=e(),[t[1],-t[0]])},t.rotate=function(t){return t?n([t[0],t[1],t.length>2?t[2]+90:90]):(t=n(),[t[0],t[1],t[2]-90])},n([0,0,90])}).raw=Rr,ja.geom={},ja.geom.hull=function(t){function e(t){if(t.length<3)return[];var e,i=be(n),o=be(r),a=t.length,s=[],h=[];for(e=0;a>e;e++)s.push([+i.call(this,t[e],e),+o.call(this,t[e],e),e]);for(s.sort(Mr),e=0;a>e;e++)h.push([s[e][0],-s[e][1]]);var u=Hr(s),c=Hr(h),l=c[0]===u[0],f=c[c.length-1]===u[u.length-1],p=[];for(e=u.length-1;e>=0;--e)p.push(t[s[u[e]][2]]);for(e=+l;e<c.length-f;++e)p.push(t[s[c[e]][2]]);return p}var n=wr,r=_r;return arguments.length?e(t):(e.x=function(t){return arguments.length?(n=t,e):n},e.y=function(t){return arguments.length?(r=t,e):r},e)},ja.geom.polygon=function(t){return cs(t,Wh),t};var Wh=ja.geom.polygon.prototype=[];Wh.area=function(){for(var t,e=-1,n=this.length,r=this[n-1],i=0;++e<n;)t=r,r=this[e],i+=t[1]*r[0]-t[0]*r[1];return.5*i},Wh.centroid=function(t){var e,n,r=-1,i=this.length,o=0,a=0,s=this[i-1];for(arguments.length||(t=-1/(6*this.area()));++r<i;)e=s,s=this[r],n=e[0]*s[1]-s[0]*e[1],o+=(e[0]+s[0])*n,a+=(e[1]+s[1])*n;return[o*t,a*t]},Wh.clip=function(t){for(var e,n,r,i,o,a,s=Ar(t),h=-1,u=this.length-Ar(this),c=this[u-1];++h<u;){for(e=t.slice(),t.length=0,i=this[h],o=e[(r=e.length-s)-1],n=-1;++n<r;)a=e[n],Sr(a,c,i)?(Sr(o,c,i)||t.push(Cr(o,a,c,i)),t.push(a)):Sr(o,c,i)&&t.push(Cr(o,a,c,i)),o=a;s&&t.push(t[0]),c=i}return t};var Gh,jh,qh,Xh,Yh,Zh=[],Kh=[];Vr.prototype.prepare=function(){for(var t,e=this.edges,n=e.length;n--;)t=e[n].edge,t.b&&t.a||e.splice(n,1);return e.sort(Br),e.length},Kr.prototype={start:function(){return this.edge.l===this.site?this.edge.a:this.edge.b},end:function(){return this.edge.l===this.site?this.edge.b:this.edge.a}},Qr.prototype={insert:function(t,e){var n,r,i;if(t){if(e.P=t,e.N=t.N,t.N&&(t.N.P=e),t.N=e,t.R){for(t=t.R;t.L;)t=t.L;t.L=e}else t.R=e;n=t}else this._?(t=ei(this._),e.P=null,e.N=t,t.P=t.L=e,n=t):(e.P=e.N=null,this._=e,n=null);for(e.L=e.R=null,e.U=n,e.C=!0,t=e;n&&n.C;)r=n.U,n===r.L?(i=r.R,i&&i.C?(n.C=i.C=!1,r.C=!0,t=r):(t===n.R&&(Jr(this,n),t=n,n=t.U),n.C=!1,r.C=!0,ti(this,r))):(i=r.L,i&&i.C?(n.C=i.C=!1,r.C=!0,t=r):(t===n.L&&(ti(this,n),t=n,n=t.U),n.C=!1,r.C=!0,Jr(this,r))),n=t.U;this._.C=!1},remove:function(t){t.N&&(t.N.P=t.P),t.P&&(t.P.N=t.N),t.N=t.P=null;var e,n,r,i=t.U,o=t.L,a=t.R;if(n=o?a?ei(a):o:a,i?i.L===t?i.L=n:i.R=n:this._=n,o&&a?(r=n.C,n.C=t.C,n.L=o,o.U=n,n!==a?(i=n.U,n.U=t.U,t=n.R,i.L=t,n.R=a,a.U=n):(n.U=i,i=n,t=n.R)):(r=t.C,t=n),t&&(t.U=i),!r){if(t&&t.C)return void(t.C=!1);do{if(t===this._)break;if(t===i.L){if(e=i.R,e.C&&(e.C=!1,i.C=!0,Jr(this,i),e=i.R),e.L&&e.L.C||e.R&&e.R.C){e.R&&e.R.C||(e.L.C=!1,e.C=!0,ti(this,e),e=i.R),e.C=i.C,i.C=e.R.C=!1,Jr(this,i),t=this._;break}}else if(e=i.L,e.C&&(e.C=!1,i.C=!0,ti(this,i),e=i.L),e.L&&e.L.C||e.R&&e.R.C){e.L&&e.L.C||(e.R.C=!1,e.C=!0,Jr(this,e),e=i.L),e.C=i.C,i.C=e.L.C=!1,ti(this,i),t=this._;break}e.C=!0,t=i,i=i.U}while(!t.C);t&&(t.C=!1)}}},ja.geom.voronoi=function(t){function e(t){var e=new Array(t.length),r=s[0][0],i=s[0][1],o=s[1][0],a=s[1][1];return ni(n(t),s).cells.forEach(function(n,s){var h=n.edges,u=n.site,c=e[s]=h.length?h.map(function(t){var e=t.start();return[e.x,e.y]}):u.x>=r&&u.x<=o&&u.y>=i&&u.y<=a?[[r,a],[o,a],[o,i],[r,i]]:[];c.point=t[s]}),e}function n(t){return t.map(function(t,e){return{x:Math.round(o(t,e)/Hs)*Hs,y:Math.round(a(t,e)/Hs)*Hs,i:e}})}var r=wr,i=_r,o=r,a=i,s=Qh;return t?e(t):(e.links=function(t){return ni(n(t)).edges.filter(function(t){return t.l&&t.r}).map(function(e){return{source:t[e.l.i],target:t[e.r.i]}})},e.triangles=function(t){var e=[];return ni(n(t)).cells.forEach(function(n,r){for(var i,o,a=n.site,s=n.edges.sort(Br),h=-1,u=s.length,c=s[u-1].edge,l=c.l===a?c.r:c.l;++h<u;)i=c,o=l,c=s[h].edge,l=c.l===a?c.r:c.l,r<o.i&&r<l.i&&ii(a,o,l)<0&&e.push([t[r],t[o.i],t[l.i]])}),e},e.x=function(t){return arguments.length?(o=be(r=t),e):r},e.y=function(t){return arguments.length?(a=be(i=t),e):i},e.clipExtent=function(t){return arguments.length?(s=null==t?Qh:t,e):s===Qh?null:s},e.size=function(t){return arguments.length?e.clipExtent(t&&[[0,0],t]):s===Qh?null:s&&s[1]},e)};var Qh=[[-1e6,-1e6],[1e6,1e6]];ja.geom.delaunay=function(t){return ja.geom.voronoi().triangles(t)},ja.geom.quadtree=function(t,e,n,r,i){function o(t){function o(t,e,n,r,i,o,a,s){if(!isNaN(n)&&!isNaN(r))if(t.leaf){var h=t.x,c=t.y;if(null!=h)if(os(h-n)+os(c-r)<.01)u(t,e,n,r,i,o,a,s);else{var l=t.point;t.x=t.y=t.point=null,u(t,l,h,c,i,o,a,s),u(t,e,n,r,i,o,a,s)}else t.x=n,t.y=r,t.point=e}else u(t,e,n,r,i,o,a,s)}function u(t,e,n,r,i,a,s,h){var u=.5*(i+s),c=.5*(a+h),l=n>=u,f=r>=c,p=(f<<1)+l;t.leaf=!1,t=t.nodes[p]||(t.nodes[p]=si()),l?i=u:s=u,f?a=c:h=c,o(t,e,n,r,i,a,s,h)}var c,l,f,p,d,m,g,v,y,E=be(s),x=be(h);if(null!=e)m=e,g=n,v=r,y=i;else if(v=y=-(m=g=1/0),l=[],f=[],d=t.length,a)for(p=0;d>p;++p)c=t[p],c.x<m&&(m=c.x),c.y<g&&(g=c.y),c.x>v&&(v=c.x),c.y>y&&(y=c.y),l.push(c.x),f.push(c.y);else for(p=0;d>p;++p){var T=+E(c=t[p],p),b=+x(c,p);m>T&&(m=T),g>b&&(g=b),T>v&&(v=T),b>y&&(y=b),l.push(T),f.push(b)}var R=v-m,w=y-g;R>w?y=g+R:v=m+w;var _=si();if(_.add=function(t){o(_,t,+E(t,++p),+x(t,p),m,g,v,y)},_.visit=function(t){hi(t,_,m,g,v,y)},p=-1,null==e){for(;++p<d;)o(_,t[p],l[p],f[p],m,g,v,y);--p}else t.forEach(_.add);return l=f=t=c=null,_}var a,s=wr,h=_r;return(a=arguments.length)?(s=oi,h=ai,3===a&&(i=n,r=e,n=e=0),o(t)):(o.x=function(t){return arguments.length?(s=t,o):s},o.y=function(t){return arguments.length?(h=t,o):h},o.extent=function(t){return arguments.length?(null==t?e=n=r=i=null:(e=+t[0][0],n=+t[0][1],r=+t[1][0],i=+t[1][1]),o):null==e?null:[[e,n],[r,i]]},o.size=function(t){return arguments.length?(null==t?e=n=r=i=null:(e=n=0,r=+t[0],i=+t[1]),o):null==e?null:[r-e,i-n]},o)},ja.interpolateRgb=ui,ja.interpolateObject=ci,ja.interpolateNumber=li,ja.interpolateString=fi;var $h=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Jh=new RegExp($h.source,"g");ja.interpolate=pi,ja.interpolators=[function(t,e){var n=typeof e;return("string"===n?Gs.has(e)||/^(#|rgb\(|hsl\()/.test(e)?ui:fi:e instanceof ne?ui:Array.isArray(e)?di:"object"===n&&isNaN(e)?ci:li)(t,e)}],ja.interpolateArray=di;var tu=function(){return Re},eu=ja.map({linear:tu,poly:Ti,quad:function(){return yi},cubic:function(){return Ei},sin:function(){return bi},exp:function(){return Ri},circle:function(){return wi},elastic:_i,back:Hi,bounce:function(){return Mi}}),nu=ja.map({"in":Re,out:gi,"in-out":vi,"out-in":function(t){return vi(gi(t))}});ja.ease=function(t){var e=t.indexOf("-"),n=e>=0?t.substring(0,e):t,r=e>=0?t.substring(e+1):"in";return n=eu.get(n)||tu,r=nu.get(r)||Re,mi(r(n.apply(null,qa.call(arguments,1))))},ja.interpolateHcl=Si,ja.interpolateHsl=Ci,ja.interpolateLab=Ai,ja.interpolateRound=Li,ja.transform=function(t){var e=Ya.createElementNS(ja.ns.prefix.svg,"g");return(ja.transform=function(t){if(null!=t){e.setAttribute("transform",t);var n=e.transform.baseVal.consolidate()}return new Pi(n?n.matrix:ru)})(t)},Pi.prototype.toString=function(){return"translate("+this.translate+")rotate("+this.rotate+")skewX("+this.skew+")scale("+this.scale+")"};var ru={a:1,b:0,c:0,d:1,e:0,f:0};ja.interpolateTransform=ki,ja.layout={},ja.layout.bundle=function(){return function(t){for(var e=[],n=-1,r=t.length;++n<r;)e.push(Ii(t[n]));return e}},ja.layout.chord=function(){function t(){var t,u,l,f,p,d={},m=[],g=ja.range(o),v=[];for(n=[],r=[],t=0,f=-1;++f<o;){for(u=0,p=-1;++p<o;)u+=i[f][p];m.push(u),v.push(ja.range(o)),t+=u}for(a&&g.sort(function(t,e){return a(m[t],m[e])}),s&&v.forEach(function(t,e){t.sort(function(t,n){return s(i[e][t],i[e][n])})}),t=(ws-c*o)/t,u=0,f=-1;++f<o;){for(l=u,p=-1;++p<o;){var y=g[f],E=v[y][p],x=i[y][E],T=u,b=u+=x*t;d[y+"-"+E]={index:y,subindex:E,startAngle:T,endAngle:b,value:x}}r[y]={index:y,startAngle:l,endAngle:u,value:(u-l)/t},u+=c}for(f=-1;++f<o;)for(p=f-1;++p<o;){var R=d[f+"-"+p],w=d[p+"-"+f];(R.value||w.value)&&n.push(R.value<w.value?{source:w,target:R}:{source:R,target:w})}h&&e()}function e(){n.sort(function(t,e){return h((t.source.value+t.target.value)/2,(e.source.value+e.target.value)/2)})}var n,r,i,o,a,s,h,u={},c=0;return u.matrix=function(t){return arguments.length?(o=(i=t)&&i.length,n=r=null,u):i},u.padding=function(t){return arguments.length?(c=t,n=r=null,u):c},u.sortGroups=function(t){return arguments.length?(a=t,n=r=null,u):a},u.sortSubgroups=function(t){return arguments.length?(s=t,n=null,u):s},u.sortChords=function(t){return arguments.length?(h=t,n&&e(),u):h},u.chords=function(){return n||t(),n},u.groups=function(){return r||t(),r},u},ja.layout.force=function(){function t(t){return function(e,n,r,i){if(e.point!==t){var o=e.cx-t.x,a=e.cy-t.y,s=i-n,h=o*o+a*a;if(h>s*s/g){if(d>h){var u=e.charge/h;t.px-=o*u,t.py-=a*u}return!0}if(e.point&&h&&d>h){var u=e.pointCharge/h;t.px-=o*u,t.py-=a*u}}return!e.charge}}function e(t){t.px=ja.event.x,t.py=ja.event.y,s.resume()}var n,r,i,o,a,s={},h=ja.dispatch("start","tick","end"),u=[1,1],c=.9,l=iu,f=ou,p=-30,d=au,m=.1,g=.64,v=[],y=[];return s.tick=function(){if((r*=.99)<.005)return h.end({type:"end",alpha:r=0}),!0;var e,n,s,l,f,d,g,E,x,T=v.length,b=y.length;for(n=0;b>n;++n)s=y[n],l=s.source,f=s.target,E=f.x-l.x,x=f.y-l.y,(d=E*E+x*x)&&(d=r*o[n]*((d=Math.sqrt(d))-i[n])/d,E*=d,x*=d,f.x-=E*(g=l.weight/(f.weight+l.weight)),f.y-=x*g,l.x+=E*(g=1-g),l.y+=x*g);if((g=r*m)&&(E=u[0]/2,x=u[1]/2,n=-1,g))for(;++n<T;)s=v[n],s.x+=(E-s.x)*g,s.y+=(x-s.y)*g;if(p)for(qi(e=ja.geom.quadtree(v),r,a),n=-1;++n<T;)(s=v[n]).fixed||e.visit(t(s));for(n=-1;++n<T;)s=v[n],s.fixed?(s.x=s.px,s.y=s.py):(s.x-=(s.px-(s.px=s.x))*c,s.y-=(s.py-(s.py=s.y))*c);h.tick({type:"tick",alpha:r})},s.nodes=function(t){return arguments.length?(v=t,s):v},s.links=function(t){return arguments.length?(y=t,s):y},s.size=function(t){return arguments.length?(u=t,s):u},s.linkDistance=function(t){return arguments.length?(l="function"==typeof t?t:+t,s):l},s.distance=s.linkDistance,s.linkStrength=function(t){return arguments.length?(f="function"==typeof t?t:+t,s):f},s.friction=function(t){return arguments.length?(c=+t,s):c},s.charge=function(t){return arguments.length?(p="function"==typeof t?t:+t,s):p},s.chargeDistance=function(t){return arguments.length?(d=t*t,s):Math.sqrt(d)},s.gravity=function(t){return arguments.length?(m=+t,s):m},s.theta=function(t){return arguments.length?(g=t*t,s):Math.sqrt(g)},s.alpha=function(t){return arguments.length?(t=+t,r?r=t>0?t:0:t>0&&(h.start({type:"start",alpha:r=t}),ja.timer(s.tick)),s):r},s.start=function(){function t(t,r){if(!n){for(n=new Array(h),s=0;h>s;++s)n[s]=[];for(s=0;u>s;++s){var i=y[s];n[i.source.index].push(i.target),n[i.target.index].push(i.source)}}for(var o,a=n[e],s=-1,u=a.length;++s<u;)if(!isNaN(o=a[s][t]))return o;return Math.random()*r}var e,n,r,h=v.length,c=y.length,d=u[0],m=u[1];for(e=0;h>e;++e)(r=v[e]).index=e,r.weight=0;for(e=0;c>e;++e)r=y[e],"number"==typeof r.source&&(r.source=v[r.source]),"number"==typeof r.target&&(r.target=v[r.target]),++r.source.weight,++r.target.weight;for(e=0;h>e;++e)r=v[e],isNaN(r.x)&&(r.x=t("x",d)),isNaN(r.y)&&(r.y=t("y",m)),isNaN(r.px)&&(r.px=r.x),isNaN(r.py)&&(r.py=r.y);if(i=[],"function"==typeof l)for(e=0;c>e;++e)i[e]=+l.call(this,y[e],e);else for(e=0;c>e;++e)i[e]=l;if(o=[],"function"==typeof f)for(e=0;c>e;++e)o[e]=+f.call(this,y[e],e);else for(e=0;c>e;++e)o[e]=f;if(a=[],"function"==typeof p)for(e=0;h>e;++e)a[e]=+p.call(this,v[e],e);else for(e=0;h>e;++e)a[e]=p;return s.resume()},s.resume=function(){return s.alpha(.1)},s.stop=function(){return s.alpha(0)},s.drag=function(){return n||(n=ja.behavior.drag().origin(Re).on("dragstart.force",Oi).on("drag.force",e).on("dragend.force",Wi)),arguments.length?void this.on("mouseover.force",Gi).on("mouseout.force",ji).call(n):n},ja.rebind(s,h,"on")};var iu=20,ou=1,au=1/0;ja.layout.hierarchy=function(){function t(i){var o,a=[i],s=[];for(i.depth=0;null!=(o=a.pop());)if(s.push(o),(u=n.call(t,o,o.depth))&&(h=u.length)){for(var h,u,c;--h>=0;)a.push(c=u[h]),c.parent=o,c.depth=o.depth+1;r&&(o.value=0),o.children=u}else r&&(o.value=+r.call(t,o,o.depth)||0),delete o.children;return Zi(i,function(t){var n,i;e&&(n=t.children)&&n.sort(e),r&&(i=t.parent)&&(i.value+=t.value)}),s}var e=$i,n=Ki,r=Qi;return t.sort=function(n){return arguments.length?(e=n,t):e},t.children=function(e){return arguments.length?(n=e,t):n},t.value=function(e){return arguments.length?(r=e,t):r},t.revalue=function(e){return r&&(Yi(e,function(t){t.children&&(t.value=0)}),Zi(e,function(e){var n;e.children||(e.value=+r.call(t,e,e.depth)||0),(n=e.parent)&&(n.value+=e.value)})),e},t},ja.layout.partition=function(){function t(e,n,r,i){var o=e.children;if(e.x=n,e.y=e.depth*i,e.dx=r,e.dy=i,o&&(a=o.length)){var a,s,h,u=-1;for(r=e.value?r/e.value:0;++u<a;)t(s=o[u],n,h=s.value*r,i),n+=h}}function e(t){var n=t.children,r=0;if(n&&(i=n.length))for(var i,o=-1;++o<i;)r=Math.max(r,e(n[o]));return 1+r}function n(n,o){var a=r.call(this,n,o);return t(a[0],0,i[0],i[1]/e(a[0])),a}var r=ja.layout.hierarchy(),i=[1,1];return n.size=function(t){return arguments.length?(i=t,n):i},Xi(n,r)},ja.layout.pie=function(){function t(o){var a=o.map(function(n,r){return+e.call(t,n,r)}),s=+("function"==typeof r?r.apply(this,arguments):r),h=(("function"==typeof i?i.apply(this,arguments):i)-s)/ja.sum(a),u=ja.range(o.length);null!=n&&u.sort(n===su?function(t,e){return a[e]-a[t]}:function(t,e){return n(o[t],o[e])});var c=[];return u.forEach(function(t){var e;c[t]={data:o[t],value:e=a[t],startAngle:s,endAngle:s+=e*h}}),c}var e=Number,n=su,r=0,i=ws;return t.value=function(n){return arguments.length?(e=n,t):e},t.sort=function(e){return arguments.length?(n=e,t):n},t.startAngle=function(e){return arguments.length?(r=e,t):r},t.endAngle=function(e){return arguments.length?(i=e,t):i},t};var su={};ja.layout.stack=function(){function t(s,h){var u=s.map(function(n,r){return e.call(t,n,r)}),c=u.map(function(e){return e.map(function(e,n){return[o.call(t,e,n),a.call(t,e,n)]})}),l=n.call(t,c,h);u=ja.permute(u,l),c=ja.permute(c,l);var f,p,d,m=r.call(t,c,h),g=u.length,v=u[0].length;for(p=0;v>p;++p)for(i.call(t,u[0][p],d=m[p],c[0][p][1]),f=1;g>f;++f)i.call(t,u[f][p],d+=c[f-1][p][1],c[f][p][1]);return s}var e=Re,n=ro,r=io,i=no,o=to,a=eo;return t.values=function(n){return arguments.length?(e=n,t):e},t.order=function(e){return arguments.length?(n="function"==typeof e?e:hu.get(e)||ro,t):n},t.offset=function(e){return arguments.length?(r="function"==typeof e?e:uu.get(e)||io,t):r},t.x=function(e){return arguments.length?(o=e,t):o},t.y=function(e){return arguments.length?(a=e,t):a},t.out=function(e){return arguments.length?(i=e,t):i},t};var hu=ja.map({"inside-out":function(t){var e,n,r=t.length,i=t.map(oo),o=t.map(ao),a=ja.range(r).sort(function(t,e){return i[t]-i[e]}),s=0,h=0,u=[],c=[];for(e=0;r>e;++e)n=a[e],h>s?(s+=o[n],u.push(n)):(h+=o[n],c.push(n));return c.reverse().concat(u)},reverse:function(t){return ja.range(t.length).reverse()},"default":ro}),uu=ja.map({silhouette:function(t){var e,n,r,i=t.length,o=t[0].length,a=[],s=0,h=[];for(n=0;o>n;++n){for(e=0,r=0;i>e;e++)r+=t[e][n][1];r>s&&(s=r),a.push(r)}for(n=0;o>n;++n)h[n]=(s-a[n])/2;return h},wiggle:function(t){var e,n,r,i,o,a,s,h,u,c=t.length,l=t[0],f=l.length,p=[];for(p[0]=h=u=0,n=1;f>n;++n){for(e=0,i=0;c>e;++e)i+=t[e][n][1];for(e=0,o=0,s=l[n][0]-l[n-1][0];c>e;++e){for(r=0,a=(t[e][n][1]-t[e][n-1][1])/(2*s);e>r;++r)a+=(t[r][n][1]-t[r][n-1][1])/s;o+=a*t[e][n][1]}p[n]=h-=i?o/i*s:0,u>h&&(u=h)}for(n=0;f>n;++n)p[n]-=u;return p},expand:function(t){var e,n,r,i=t.length,o=t[0].length,a=1/i,s=[];for(n=0;o>n;++n){for(e=0,r=0;i>e;e++)r+=t[e][n][1];if(r)for(e=0;i>e;e++)t[e][n][1]/=r;else for(e=0;i>e;e++)t[e][n][1]=a}for(n=0;o>n;++n)s[n]=0;return s},zero:io});ja.layout.histogram=function(){function t(t,o){for(var a,s,h=[],u=t.map(n,this),c=r.call(this,u,o),l=i.call(this,c,u,o),o=-1,f=u.length,p=l.length-1,d=e?1:1/f;++o<p;)a=h[o]=[],a.dx=l[o+1]-(a.x=l[o]),a.y=0;if(p>0)for(o=-1;++o<f;)s=u[o],s>=c[0]&&s<=c[1]&&(a=h[ja.bisect(l,s,1,p)-1],a.y+=d,a.push(t[o]));return h}var e=!0,n=Number,r=co,i=ho;return t.value=function(e){return arguments.length?(n=e,t):n},t.range=function(e){return arguments.length?(r=be(e),t):r},t.bins=function(e){return arguments.length?(i="number"==typeof e?function(t){return uo(t,e)}:be(e),t):i},t.frequency=function(n){return arguments.length?(e=!!n,t):e},t},ja.layout.pack=function(){function t(t,o){var a=n.call(this,t,o),s=a[0],h=i[0],u=i[1],c=null==e?Math.sqrt:"function"==typeof e?e:function(){return e};if(s.x=s.y=0,Zi(s,function(t){t.r=+c(t.value)}),Zi(s,go),r){var l=r*(e?1:Math.max(2*s.r/h,2*s.r/u))/2;Zi(s,function(t){t.r+=l}),Zi(s,go),Zi(s,function(t){t.r-=l})}return Eo(s,h/2,u/2,e?1:1/Math.max(2*s.r/h,2*s.r/u)),a}var e,n=ja.layout.hierarchy().sort(lo),r=0,i=[1,1];return t.size=function(e){return arguments.length?(i=e,t):i},t.radius=function(n){return arguments.length?(e=null==n||"function"==typeof n?n:+n,t):e},t.padding=function(e){return arguments.length?(r=+e,t):r},Xi(t,n)},ja.layout.tree=function(){function t(t,i){var c=a.call(this,t,i),l=c[0],f=e(l);if(Zi(f,n),f.parent.m=-f.z,Yi(f,r),u)Yi(l,o);else{var p=l,d=l,m=l;Yi(l,function(t){t.x<p.x&&(p=t),t.x>d.x&&(d=t),t.depth>m.depth&&(m=t)});var g=s(p,d)/2-p.x,v=h[0]/(d.x+s(d,p)/2+g),y=h[1]/(m.depth||1);Yi(l,function(t){t.x=(t.x+g)*v,t.y=t.depth*y})}return c}function e(t){for(var e,n={A:null,children:[t]},r=[n];null!=(e=r.pop());)for(var i,o=e.children,a=0,s=o.length;s>a;++a)r.push((o[a]=i={_:o[a],parent:e,children:(i=o[a].children)&&i.slice()||[],A:null,a:null,z:0,m:0,c:0,s:0,t:null,i:a}).a=i);return n.children[0]}function n(t){var e=t.children,n=t.parent.children,r=t.i?n[t.i-1]:null;if(e.length){_o(t);var o=(e[0].z+e[e.length-1].z)/2;r?(t.z=r.z+s(t._,r._),t.m=t.z-o):t.z=o}else r&&(t.z=r.z+s(t._,r._));t.parent.A=i(t,r,t.parent.A||n[0])}function r(t){t._.x=t.z+t.parent.m,t.m+=t.parent.m}function i(t,e,n){if(e){for(var r,i=t,o=t,a=e,h=i.parent.children[0],u=i.m,c=o.m,l=a.m,f=h.m;a=Ro(a),i=bo(i),a&&i;)h=bo(h),o=Ro(o),o.a=t,r=a.z+l-i.z-u+s(a._,i._),r>0&&(wo(Ho(a,t,n),t,r),u+=r,c+=r),l+=a.m,u+=i.m,f+=h.m,c+=o.m;a&&!Ro(o)&&(o.t=a,o.m+=l-c),i&&!bo(h)&&(h.t=i,h.m+=u-f,n=t)}return n}function o(t){t.x*=h[0],t.y=t.depth*h[1]}var a=ja.layout.hierarchy().sort(null).value(null),s=To,h=[1,1],u=null;return t.separation=function(e){return arguments.length?(s=e,t):s},t.size=function(e){return arguments.length?(u=null==(h=e)?o:null,t):u?null:h},t.nodeSize=function(e){return arguments.length?(u=null==(h=e)?null:o,t):u?h:null},Xi(t,a)},ja.layout.cluster=function(){function t(t,o){var a,s=e.call(this,t,o),h=s[0],u=0;Zi(h,function(t){var e=t.children;e&&e.length?(t.x=So(e),t.y=Mo(e)):(t.x=a?u+=n(t,a):0,t.y=0,a=t)});var c=Co(h),l=Ao(h),f=c.x-n(c,l)/2,p=l.x+n(l,c)/2;return Zi(h,i?function(t){t.x=(t.x-h.x)*r[0],t.y=(h.y-t.y)*r[1]}:function(t){t.x=(t.x-f)/(p-f)*r[0],t.y=(1-(h.y?t.y/h.y:1))*r[1]}),s}var e=ja.layout.hierarchy().sort(null).value(null),n=To,r=[1,1],i=!1;return t.separation=function(e){return arguments.length?(n=e,t):n},t.size=function(e){return arguments.length?(i=null==(r=e),t):i?null:r},t.nodeSize=function(e){return arguments.length?(i=null!=(r=e),t):i?r:null},Xi(t,e)},ja.layout.treemap=function(){function t(t,e){for(var n,r,i=-1,o=t.length;++i<o;)r=(n=t[i]).value*(0>e?0:e),n.area=isNaN(r)||0>=r?0:r}function e(n){var o=n.children;if(o&&o.length){var a,s,h,u=l(n),c=[],f=o.slice(),d=1/0,m="slice"===p?u.dx:"dice"===p?u.dy:"slice-dice"===p?1&n.depth?u.dy:u.dx:Math.min(u.dx,u.dy);for(t(f,u.dx*u.dy/n.value),c.area=0;(h=f.length)>0;)c.push(a=f[h-1]),c.area+=a.area,"squarify"!==p||(s=r(c,m))<=d?(f.pop(),d=s):(c.area-=c.pop().area,i(c,m,u,!1),m=Math.min(u.dx,u.dy),c.length=c.area=0,d=1/0);c.length&&(i(c,m,u,!0),c.length=c.area=0),o.forEach(e)}}function n(e){var r=e.children;if(r&&r.length){var o,a=l(e),s=r.slice(),h=[];for(t(s,a.dx*a.dy/e.value),h.area=0;o=s.pop();)h.push(o),h.area+=o.area,null!=o.z&&(i(h,o.z?a.dx:a.dy,a,!s.length),h.length=h.area=0);r.forEach(n)}}function r(t,e){for(var n,r=t.area,i=0,o=1/0,a=-1,s=t.length;++a<s;)(n=t[a].area)&&(o>n&&(o=n),n>i&&(i=n));return r*=r,e*=e,r?Math.max(e*i*d/r,r/(e*o*d)):1/0}function i(t,e,n,r){var i,o=-1,a=t.length,s=n.x,u=n.y,c=e?h(t.area/e):0;if(e==n.dx){for((r||c>n.dy)&&(c=n.dy);++o<a;)i=t[o],i.x=s,i.y=u,i.dy=c,s+=i.dx=Math.min(n.x+n.dx-s,c?h(i.area/c):0);i.z=!0,i.dx+=n.x+n.dx-s,n.y+=c,n.dy-=c}else{for((r||c>n.dx)&&(c=n.dx);++o<a;)i=t[o],i.x=s,i.y=u,i.dx=c,u+=i.dy=Math.min(n.y+n.dy-u,c?h(i.area/c):0);i.z=!1,i.dy+=n.y+n.dy-u,n.x+=c,n.dx-=c}}function o(r){var i=a||s(r),o=i[0];return o.x=0,o.y=0,o.dx=u[0],o.dy=u[1],a&&s.revalue(o),t([o],o.dx*o.dy/o.value),(a?n:e)(o),f&&(a=i),i}var a,s=ja.layout.hierarchy(),h=Math.round,u=[1,1],c=null,l=Lo,f=!1,p="squarify",d=.5*(1+Math.sqrt(5));return o.size=function(t){return arguments.length?(u=t,o):u},o.padding=function(t){function e(e){var n=t.call(o,e,e.depth);return null==n?Lo(e):Po(e,"number"==typeof n?[n,n,n,n]:n)}function n(e){return Po(e,t)}if(!arguments.length)return c;var r;return l=null==(c=t)?Lo:"function"==(r=typeof t)?e:"number"===r?(t=[t,t,t,t],n):n,o},o.round=function(t){return arguments.length?(h=t?Math.round:Number,o):h!=Number},o.sticky=function(t){return arguments.length?(f=t,a=null,o):f},o.ratio=function(t){return arguments.length?(d=t,o):d},o.mode=function(t){return arguments.length?(p=t+"",o):p},Xi(o,s)},ja.random={normal:function(t,e){var n=arguments.length;return 2>n&&(e=1),1>n&&(t=0),function(){var n,r,i;do n=2*Math.random()-1,r=2*Math.random()-1,i=n*n+r*r;while(!i||i>1);return t+e*n*Math.sqrt(-2*Math.log(i)/i)}},logNormal:function(){var t=ja.random.normal.apply(ja,arguments);return function(){return Math.exp(t())}},bates:function(t){var e=ja.random.irwinHall(t);return function(){return e()/t}},irwinHall:function(t){return function(){for(var e=0,n=0;t>n;n++)e+=Math.random();return e}}},ja.scale={};var cu={floor:Re,ceil:Re};ja.scale.linear=function(){return Io([0,1],[0,1],pi,!1)};var lu={s:1,g:1,p:1,r:1,e:1};ja.scale.log=function(){return Xo(ja.scale.linear().domain([0,1]),10,!0,[1,10])};var fu=ja.format(".0e"),pu={floor:function(t){return-Math.ceil(-t)},ceil:function(t){return-Math.floor(-t)}};ja.scale.pow=function(){return Yo(ja.scale.linear(),1,[0,1])},ja.scale.sqrt=function(){return ja.scale.pow().exponent(.5)},ja.scale.ordinal=function(){return Ko([],{t:"range",a:[[]]})},ja.scale.category10=function(){return ja.scale.ordinal().range(du)},ja.scale.category20=function(){return ja.scale.ordinal().range(mu)},ja.scale.category20b=function(){return ja.scale.ordinal().range(gu)},ja.scale.category20c=function(){return ja.scale.ordinal().range(vu)};var du=[2062260,16744206,2924588,14034728,9725885,9197131,14907330,8355711,12369186,1556175].map(me),mu=[2062260,11454440,16744206,16759672,2924588,10018698,14034728,16750742,9725885,12955861,9197131,12885140,14907330,16234194,8355711,13092807,12369186,14408589,1556175,10410725].map(me),gu=[3750777,5395619,7040719,10264286,6519097,9216594,11915115,13556636,9202993,12426809,15186514,15190932,8666169,11356490,14049643,15177372,8077683,10834324,13528509,14589654].map(me),vu=[3244733,7057110,10406625,13032431,15095053,16616764,16625259,16634018,3253076,7652470,10607003,13101504,7695281,10394312,12369372,14342891,6513507,9868950,12434877,14277081].map(me);ja.scale.quantile=function(){return Qo([],[])},ja.scale.quantize=function(){return $o(0,1,[0,1])},ja.scale.threshold=function(){return Jo([.5],[0,1])},ja.scale.identity=function(){return ta([0,1])},ja.svg={},ja.svg.arc=function(){function t(){var t=e.apply(this,arguments),o=n.apply(this,arguments),a=r.apply(this,arguments)+yu,s=i.apply(this,arguments)+yu,h=(a>s&&(h=a,a=s,s=h),s-a),u=Rs>h?"0":"1",c=Math.cos(a),l=Math.sin(a),f=Math.cos(s),p=Math.sin(s);return h>=Eu?t?"M0,"+o+"A"+o+","+o+" 0 1,1 0,"+-o+"A"+o+","+o+" 0 1,1 0,"+o+"M0,"+t+"A"+t+","+t+" 0 1,0 0,"+-t+"A"+t+","+t+" 0 1,0 0,"+t+"Z":"M0,"+o+"A"+o+","+o+" 0 1,1 0,"+-o+"A"+o+","+o+" 0 1,1 0,"+o+"Z":t?"M"+o*c+","+o*l+"A"+o+","+o+" 0 "+u+",1 "+o*f+","+o*p+"L"+t*f+","+t*p+"A"+t+","+t+" 0 "+u+",0 "+t*c+","+t*l+"Z":"M"+o*c+","+o*l+"A"+o+","+o+" 0 "+u+",1 "+o*f+","+o*p+"L0,0Z"}var e=ea,n=na,r=ra,i=ia;return t.innerRadius=function(n){return arguments.length?(e=be(n),t):e},t.outerRadius=function(e){return arguments.length?(n=be(e),t):n},t.startAngle=function(e){return arguments.length?(r=be(e),t):r},t.endAngle=function(e){return arguments.length?(i=be(e),t):i},t.centroid=function(){var t=(e.apply(this,arguments)+n.apply(this,arguments))/2,o=(r.apply(this,arguments)+i.apply(this,arguments))/2+yu;return[Math.cos(o)*t,Math.sin(o)*t]},t};var yu=-_s,Eu=ws-Hs;ja.svg.line=function(){return oa(Re)};var xu=ja.map({linear:aa,"linear-closed":sa,step:ha,"step-before":ua,"step-after":ca,basis:ga,"basis-open":va,"basis-closed":ya,bundle:Ea,cardinal:pa,"cardinal-open":la,"cardinal-closed":fa,monotone:_a});xu.forEach(function(t,e){e.key=t,e.closed=/-closed$/.test(t)});var Tu=[0,2/3,1/3,0],bu=[0,1/3,2/3,0],Ru=[0,1/6,2/3,1/6];ja.svg.line.radial=function(){var t=oa(Ha);return t.radius=t.x,delete t.x,t.angle=t.y,delete t.y,t},ua.reverse=ca,ca.reverse=ua,ja.svg.area=function(){return Ma(Re)},ja.svg.area.radial=function(){var t=Ma(Ha);return t.radius=t.x,delete t.x,t.innerRadius=t.x0,delete t.x0,t.outerRadius=t.x1,delete t.x1,t.angle=t.y,delete t.y,t.startAngle=t.y0,delete t.y0,t.endAngle=t.y1,delete t.y1,t},ja.svg.chord=function(){function t(t,s){var h=e(this,o,t,s),u=e(this,a,t,s);return"M"+h.p0+r(h.r,h.p1,h.a1-h.a0)+(n(h,u)?i(h.r,h.p1,h.r,h.p0):i(h.r,h.p1,u.r,u.p0)+r(u.r,u.p1,u.a1-u.a0)+i(u.r,u.p1,h.r,h.p0))+"Z"}function e(t,e,n,r){var i=e.call(t,n,r),o=s.call(t,i,r),a=h.call(t,i,r)+yu,c=u.call(t,i,r)+yu;return{r:o,a0:a,a1:c,p0:[o*Math.cos(a),o*Math.sin(a)],p1:[o*Math.cos(c),o*Math.sin(c)]}}function n(t,e){return t.a0==e.a0&&t.a1==e.a1}function r(t,e,n){return"A"+t+","+t+" 0 "+ +(n>Rs)+",1 "+e}function i(t,e,n,r){return"Q 0,0 "+r}var o=dr,a=mr,s=Sa,h=ra,u=ia;return t.radius=function(e){return arguments.length?(s=be(e),t):s},t.source=function(e){return arguments.length?(o=be(e),t):o},t.target=function(e){return arguments.length?(a=be(e),t):a},t.startAngle=function(e){return arguments.length?(h=be(e),t):h},t.endAngle=function(e){return arguments.length?(u=be(e),t):u},t},ja.svg.diagonal=function(){function t(t,i){var o=e.call(this,t,i),a=n.call(this,t,i),s=(o.y+a.y)/2,h=[o,{x:o.x,y:s},{x:a.x,y:s},a];return h=h.map(r),"M"+h[0]+"C"+h[1]+" "+h[2]+" "+h[3]}var e=dr,n=mr,r=Ca;return t.source=function(n){return arguments.length?(e=be(n),t):e},t.target=function(e){return arguments.length?(n=be(e),t):n},t.projection=function(e){return arguments.length?(r=e,t):r},t},ja.svg.diagonal.radial=function(){var t=ja.svg.diagonal(),e=Ca,n=t.projection;return t.projection=function(t){return arguments.length?n(Aa(e=t)):e},t},ja.svg.symbol=function(){function t(t,r){return(wu.get(e.call(this,t,r))||Da)(n.call(this,t,r))}var e=Pa,n=La;return t.type=function(n){return arguments.length?(e=be(n),t):e},t.size=function(e){return arguments.length?(n=be(e),t):n},t};var wu=ja.map({circle:Da,cross:function(t){var e=Math.sqrt(t/5)/2;return"M"+-3*e+","+-e+"H"+-e+"V"+-3*e+"H"+e+"V"+-e+"H"+3*e+"V"+e+"H"+e+"V"+3*e+"H"+-e+"V"+e+"H"+-3*e+"Z"},diamond:function(t){var e=Math.sqrt(t/(2*Su)),n=e*Su;return"M0,"+-e+"L"+n+",0 0,"+e+" "+-n+",0Z"},square:function(t){var e=Math.sqrt(t)/2;return"M"+-e+","+-e+"L"+e+","+-e+" "+e+","+e+" "+-e+","+e+"Z"},"triangle-down":function(t){var e=Math.sqrt(t/Mu),n=e*Mu/2;return"M0,"+n+"L"+e+","+-n+" "+-e+","+-n+"Z"},"triangle-up":function(t){var e=Math.sqrt(t/Mu),n=e*Mu/2;return"M0,"+-n+"L"+e+","+n+" "+-e+","+n+"Z"}});ja.svg.symbolTypes=wu.keys();var _u,Hu,Mu=Math.sqrt(3),Su=Math.tan(30*Ss),Cu=[],Au=0;Cu.call=ms.call,Cu.empty=ms.empty,Cu.node=ms.node,Cu.size=ms.size,ja.transition=function(t){return arguments.length?_u?t.transition():t:ys.transition()},ja.transition.prototype=Cu,Cu.select=function(t){var e,n,r,i=this.id,o=[];t=b(t);for(var a=-1,s=this.length;++a<s;){o.push(e=[]);for(var h=this[a],u=-1,c=h.length;++u<c;)(r=h[u])&&(n=t.call(r,r.__data__,u,a))?("__data__"in r&&(n.__data__=r.__data__),Na(n,u,i,r.__transition__[i]),e.push(n)):e.push(null)}return za(o,i)},Cu.selectAll=function(t){var e,n,r,i,o,a=this.id,s=[];t=R(t);for(var h=-1,u=this.length;++h<u;)for(var c=this[h],l=-1,f=c.length;++l<f;)if(r=c[l]){o=r.__transition__[a],n=t.call(r,r.__data__,l,h),s.push(e=[]);for(var p=-1,d=n.length;++p<d;)(i=n[p])&&Na(i,p,a,o),e.push(i)}return za(s,a)},Cu.filter=function(t){var e,n,r,i=[];"function"!=typeof t&&(t=z(t));for(var o=0,a=this.length;a>o;o++){i.push(e=[]);for(var n=this[o],s=0,h=n.length;h>s;s++)(r=n[s])&&t.call(r,r.__data__,s,o)&&e.push(r)}return za(i,this.id)},Cu.tween=function(t,e){var n=this.id;return arguments.length<2?this.node().__transition__[n].tween.get(t):k(this,null==e?function(e){e.__transition__[n].tween.remove(t)}:function(r){r.__transition__[n].tween.set(t,e)})},Cu.attr=function(t,e){function n(){this.removeAttribute(s)}function r(){this.removeAttributeNS(s.space,s.local)}function i(t){return null==t?n:(t+="",function(){var e,n=this.getAttribute(s);return n!==t&&(e=a(n,t),function(t){this.setAttribute(s,e(t))})})}function o(t){return null==t?r:(t+="",function(){var e,n=this.getAttributeNS(s.space,s.local);return n!==t&&(e=a(n,t),function(t){this.setAttributeNS(s.space,s.local,e(t))})})}if(arguments.length<2){for(e in t)this.attr(e,t[e]);return this}var a="transform"==t?ki:pi,s=ja.ns.qualify(t);return Fa(this,"attr."+t,e,s.local?o:i)},Cu.attrTween=function(t,e){function n(t,n){var r=e.call(this,t,n,this.getAttribute(i));return r&&function(t){this.setAttribute(i,r(t))}}function r(t,n){var r=e.call(this,t,n,this.getAttributeNS(i.space,i.local));return r&&function(t){this.setAttributeNS(i.space,i.local,r(t))}}var i=ja.ns.qualify(t);return this.tween("attr."+t,i.local?r:n)},Cu.style=function(t,e,n){function r(){this.style.removeProperty(t)}function i(e){return null==e?r:(e+="",function(){var r,i=Ka.getComputedStyle(this,null).getPropertyValue(t);return i!==e&&(r=pi(i,e),function(e){this.style.setProperty(t,r(e),n)})})}var o=arguments.length;if(3>o){if("string"!=typeof t){2>o&&(e="");for(n in t)this.style(n,t[n],e);return this}n=""}return Fa(this,"style."+t,e,i)},Cu.styleTween=function(t,e,n){function r(r,i){var o=e.call(this,r,i,Ka.getComputedStyle(this,null).getPropertyValue(t));return o&&function(e){this.style.setProperty(t,o(e),n)}}return arguments.length<3&&(n=""),this.tween("style."+t,r)},Cu.text=function(t){return Fa(this,"text",t,ka)},Cu.remove=function(){return this.each("end.transition",function(){var t;this.__transition__.count<2&&(t=this.parentNode)&&t.removeChild(this)})},Cu.ease=function(t){var e=this.id;return arguments.length<1?this.node().__transition__[e].ease:("function"!=typeof t&&(t=ja.ease.apply(ja,arguments)),k(this,function(n){n.__transition__[e].ease=t}))},Cu.delay=function(t){var e=this.id;return arguments.length<1?this.node().__transition__[e].delay:k(this,"function"==typeof t?function(n,r,i){n.__transition__[e].delay=+t.call(n,n.__data__,r,i)}:(t=+t,function(n){n.__transition__[e].delay=t}))},Cu.duration=function(t){var e=this.id;return arguments.length<1?this.node().__transition__[e].duration:k(this,"function"==typeof t?function(n,r,i){n.__transition__[e].duration=Math.max(1,t.call(n,n.__data__,r,i))}:(t=Math.max(1,t),function(n){n.__transition__[e].duration=t
}))},Cu.each=function(t,e){var n=this.id;if(arguments.length<2){var r=Hu,i=_u;_u=n,k(this,function(e,r,i){Hu=e.__transition__[n],t.call(e,e.__data__,r,i)}),Hu=r,_u=i}else k(this,function(r){var i=r.__transition__[n];(i.event||(i.event=ja.dispatch("start","end"))).on(t,e)});return this},Cu.transition=function(){for(var t,e,n,r,i=this.id,o=++Au,a=[],s=0,h=this.length;h>s;s++){a.push(t=[]);for(var e=this[s],u=0,c=e.length;c>u;u++)(n=e[u])&&(r=Object.create(n.__transition__[i]),r.delay+=r.duration,Na(n,u,o,r)),t.push(n)}return za(a,o)},ja.svg.axis=function(){function t(t){t.each(function(){var t,u=ja.select(this),c=this.__chart__||n,l=this.__chart__=n.copy(),f=null==h?l.ticks?l.ticks.apply(l,s):l.domain():h,p=null==e?l.tickFormat?l.tickFormat.apply(l,s):Re:e,d=u.selectAll(".tick").data(f,l),m=d.enter().insert("g",".domain").attr("class","tick").style("opacity",Hs),g=ja.transition(d.exit()).style("opacity",Hs).remove(),v=ja.transition(d.order()).style("opacity",1),y=zo(l),E=u.selectAll(".domain").data([0]),x=(E.enter().append("path").attr("class","domain"),ja.transition(E));m.append("line"),m.append("text");var T=m.select("line"),b=v.select("line"),R=d.select("text").text(p),w=m.select("text"),_=v.select("text");switch(r){case"bottom":t=Va,T.attr("y2",i),w.attr("y",Math.max(i,0)+a),b.attr("x2",0).attr("y2",i),_.attr("x",0).attr("y",Math.max(i,0)+a),R.attr("dy",".71em").style("text-anchor","middle"),x.attr("d","M"+y[0]+","+o+"V0H"+y[1]+"V"+o);break;case"top":t=Va,T.attr("y2",-i),w.attr("y",-(Math.max(i,0)+a)),b.attr("x2",0).attr("y2",-i),_.attr("x",0).attr("y",-(Math.max(i,0)+a)),R.attr("dy","0em").style("text-anchor","middle"),x.attr("d","M"+y[0]+","+-o+"V0H"+y[1]+"V"+-o);break;case"left":t=Ia,T.attr("x2",-i),w.attr("x",-(Math.max(i,0)+a)),b.attr("x2",-i).attr("y2",0),_.attr("x",-(Math.max(i,0)+a)).attr("y",0),R.attr("dy",".32em").style("text-anchor","end"),x.attr("d","M"+-o+","+y[0]+"H0V"+y[1]+"H"+-o);break;case"right":t=Ia,T.attr("x2",i),w.attr("x",Math.max(i,0)+a),b.attr("x2",i).attr("y2",0),_.attr("x",Math.max(i,0)+a).attr("y",0),R.attr("dy",".32em").style("text-anchor","start"),x.attr("d","M"+o+","+y[0]+"H0V"+y[1]+"H"+o)}if(l.rangeBand){var H=l,M=H.rangeBand()/2;c=l=function(t){return H(t)+M}}else c.rangeBand?c=l:g.call(t,l);m.call(t,c),v.call(t,l)})}var e,n=ja.scale.linear(),r=Lu,i=6,o=6,a=3,s=[10],h=null;return t.scale=function(e){return arguments.length?(n=e,t):n},t.orient=function(e){return arguments.length?(r=e in Pu?e+"":Lu,t):r},t.ticks=function(){return arguments.length?(s=arguments,t):s},t.tickValues=function(e){return arguments.length?(h=e,t):h},t.tickFormat=function(n){return arguments.length?(e=n,t):e},t.tickSize=function(e){var n=arguments.length;return n?(i=+e,o=+arguments[n-1],t):i},t.innerTickSize=function(e){return arguments.length?(i=+e,t):i},t.outerTickSize=function(e){return arguments.length?(o=+e,t):o},t.tickPadding=function(e){return arguments.length?(a=+e,t):a},t.tickSubdivide=function(){return arguments.length&&t},t};var Lu="bottom",Pu={top:1,right:1,bottom:1,left:1};ja.svg.brush=function(){function t(o){o.each(function(){var o=ja.select(this).style("pointer-events","all").style("-webkit-tap-highlight-color","rgba(0,0,0,0)").on("mousedown.brush",i).on("touchstart.brush",i),a=o.selectAll(".background").data([0]);a.enter().append("rect").attr("class","background").style("visibility","hidden").style("cursor","crosshair"),o.selectAll(".extent").data([0]).enter().append("rect").attr("class","extent").style("cursor","move");var s=o.selectAll(".resize").data(d,Re);s.exit().remove(),s.enter().append("g").attr("class",function(t){return"resize "+t}).style("cursor",function(t){return Du[t]}).append("rect").attr("x",function(t){return/[ew]$/.test(t)?-3:null}).attr("y",function(t){return/^[ns]/.test(t)?-3:null}).attr("width",6).attr("height",6).style("visibility","hidden"),s.style("display",t.empty()?"none":null);var c,l=ja.transition(o),f=ja.transition(a);h&&(c=zo(h),f.attr("x",c[0]).attr("width",c[1]-c[0]),n(l)),u&&(c=zo(u),f.attr("y",c[0]).attr("height",c[1]-c[0]),r(l)),e(l)})}function e(t){t.selectAll(".resize").attr("transform",function(t){return"translate("+c[+/e$/.test(t)]+","+l[+/^s/.test(t)]+")"})}function n(t){t.select(".extent").attr("x",c[0]),t.selectAll(".extent,.n>rect,.s>rect").attr("width",c[1]-c[0])}function r(t){t.select(".extent").attr("y",l[0]),t.selectAll(".extent,.e>rect,.w>rect").attr("height",l[1]-l[0])}function i(){function i(){32==ja.event.keyCode&&(S||(E=null,A[0]-=c[1],A[1]-=l[1],S=2),y())}function d(){32==ja.event.keyCode&&2==S&&(A[0]+=c[1],A[1]+=l[1],S=0,y())}function m(){var t=ja.mouse(T),i=!1;x&&(t[0]+=x[0],t[1]+=x[1]),S||(ja.event.altKey?(E||(E=[(c[0]+c[1])/2,(l[0]+l[1])/2]),A[0]=c[+(t[0]<E[0])],A[1]=l[+(t[1]<E[1])]):E=null),H&&g(t,h,0)&&(n(w),i=!0),M&&g(t,u,1)&&(r(w),i=!0),i&&(e(w),R({type:"brush",mode:S?"move":"resize"}))}function g(t,e,n){var r,i,s=zo(e),h=s[0],u=s[1],d=A[n],m=n?l:c,g=m[1]-m[0];return S&&(h-=d,u-=g+d),r=(n?p:f)?Math.max(h,Math.min(u,t[n])):t[n],S?i=(r+=d)+g:(E&&(d=Math.max(h,Math.min(u,2*E[n]-r))),r>d?(i=r,r=d):i=d),m[0]!=r||m[1]!=i?(n?a=null:o=null,m[0]=r,m[1]=i,!0):void 0}function v(){m(),w.style("pointer-events","all").selectAll(".resize").style("display",t.empty()?"none":null),ja.select("body").style("cursor",null),L.on("mousemove.brush",null).on("mouseup.brush",null).on("touchmove.brush",null).on("touchend.brush",null).on("keydown.brush",null).on("keyup.brush",null),C(),R({type:"brushend"})}var E,x,T=this,b=ja.select(ja.event.target),R=s.of(T,arguments),w=ja.select(T),_=b.datum(),H=!/^(n|s)$/.test(_)&&h,M=!/^(e|w)$/.test(_)&&u,S=b.classed("extent"),C=W(),A=ja.mouse(T),L=ja.select(Ka).on("keydown.brush",i).on("keyup.brush",d);if(ja.event.changedTouches?L.on("touchmove.brush",m).on("touchend.brush",v):L.on("mousemove.brush",m).on("mouseup.brush",v),w.interrupt().selectAll("*").interrupt(),S)A[0]=c[0]-A[0],A[1]=l[0]-A[1];else if(_){var P=+/w$/.test(_),D=+/^n/.test(_);x=[c[1-P]-A[0],l[1-D]-A[1]],A[0]=c[P],A[1]=l[D]}else ja.event.altKey&&(E=A.slice());w.style("pointer-events","none").selectAll(".resize").style("display",null),ja.select("body").style("cursor",b.style("cursor")),R({type:"brushstart"}),m()}var o,a,s=x(t,"brushstart","brush","brushend"),h=null,u=null,c=[0,0],l=[0,0],f=!0,p=!0,d=zu[0];return t.event=function(t){t.each(function(){var t=s.of(this,arguments),e={x:c,y:l,i:o,j:a},n=this.__chart__||e;this.__chart__=e,_u?ja.select(this).transition().each("start.brush",function(){o=n.i,a=n.j,c=n.x,l=n.y,t({type:"brushstart"})}).tween("brush:brush",function(){var n=di(c,e.x),r=di(l,e.y);return o=a=null,function(i){c=e.x=n(i),l=e.y=r(i),t({type:"brush",mode:"resize"})}}).each("end.brush",function(){o=e.i,a=e.j,t({type:"brush",mode:"resize"}),t({type:"brushend"})}):(t({type:"brushstart"}),t({type:"brush",mode:"resize"}),t({type:"brushend"}))})},t.x=function(e){return arguments.length?(h=e,d=zu[!h<<1|!u],t):h},t.y=function(e){return arguments.length?(u=e,d=zu[!h<<1|!u],t):u},t.clamp=function(e){return arguments.length?(h&&u?(f=!!e[0],p=!!e[1]):h?f=!!e:u&&(p=!!e),t):h&&u?[f,p]:h?f:u?p:null},t.extent=function(e){var n,r,i,s,f;return arguments.length?(h&&(n=e[0],r=e[1],u&&(n=n[0],r=r[0]),o=[n,r],h.invert&&(n=h(n),r=h(r)),n>r&&(f=n,n=r,r=f),(n!=c[0]||r!=c[1])&&(c=[n,r])),u&&(i=e[0],s=e[1],h&&(i=i[1],s=s[1]),a=[i,s],u.invert&&(i=u(i),s=u(s)),i>s&&(f=i,i=s,s=f),(i!=l[0]||s!=l[1])&&(l=[i,s])),t):(h&&(o?(n=o[0],r=o[1]):(n=c[0],r=c[1],h.invert&&(n=h.invert(n),r=h.invert(r)),n>r&&(f=n,n=r,r=f))),u&&(a?(i=a[0],s=a[1]):(i=l[0],s=l[1],u.invert&&(i=u.invert(i),s=u.invert(s)),i>s&&(f=i,i=s,s=f))),h&&u?[[n,i],[r,s]]:h?[n,r]:u&&[i,s])},t.clear=function(){return t.empty()||(c=[0,0],l=[0,0],o=a=null),t},t.empty=function(){return!!h&&c[0]==c[1]||!!u&&l[0]==l[1]},ja.rebind(t,s,"on")};var Du={n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},zu=[["n","e","s","w","nw","ne","se","sw"],["e","w"],["n","s"],[]],Fu=th.format=ah.timeFormat,ku=Fu.utc,Nu=ku("%Y-%m-%dT%H:%M:%S.%LZ");Fu.iso=Date.prototype.toISOString&&+new Date("2000-01-01T00:00:00.000Z")?Ba:Nu,Ba.parse=function(t){var e=new Date(t);return isNaN(e)?null:e},Ba.toString=Nu.toString,th.second=Fe(function(t){return new eh(1e3*Math.floor(t/1e3))},function(t,e){t.setTime(t.getTime()+1e3*Math.floor(e))},function(t){return t.getSeconds()}),th.seconds=th.second.range,th.seconds.utc=th.second.utc.range,th.minute=Fe(function(t){return new eh(6e4*Math.floor(t/6e4))},function(t,e){t.setTime(t.getTime()+6e4*Math.floor(e))},function(t){return t.getMinutes()}),th.minutes=th.minute.range,th.minutes.utc=th.minute.utc.range,th.hour=Fe(function(t){var e=t.getTimezoneOffset()/60;return new eh(36e5*(Math.floor(t/36e5-e)+e))},function(t,e){t.setTime(t.getTime()+36e5*Math.floor(e))},function(t){return t.getHours()}),th.hours=th.hour.range,th.hours.utc=th.hour.utc.range,th.month=Fe(function(t){return t=th.day(t),t.setDate(1),t},function(t,e){t.setMonth(t.getMonth()+e)},function(t){return t.getMonth()}),th.months=th.month.range,th.months.utc=th.month.utc.range;var Vu=[1e3,5e3,15e3,3e4,6e4,3e5,9e5,18e5,36e5,108e5,216e5,432e5,864e5,1728e5,6048e5,2592e6,7776e6,31536e6],Iu=[[th.second,1],[th.second,5],[th.second,15],[th.second,30],[th.minute,1],[th.minute,5],[th.minute,15],[th.minute,30],[th.hour,1],[th.hour,3],[th.hour,6],[th.hour,12],[th.day,1],[th.day,2],[th.week,1],[th.month,1],[th.month,3],[th.year,1]],Bu=Fu.multi([[".%L",function(t){return t.getMilliseconds()}],[":%S",function(t){return t.getSeconds()}],["%I:%M",function(t){return t.getMinutes()}],["%I %p",function(t){return t.getHours()}],["%a %d",function(t){return t.getDay()&&1!=t.getDate()}],["%b %d",function(t){return 1!=t.getDate()}],["%B",function(t){return t.getMonth()}],["%Y",wn]]),Uu={range:function(t,e,n){return ja.range(Math.ceil(t/n)*n,+e,n).map(Oa)},floor:Re,ceil:Re};Iu.year=th.year,th.scale=function(){return Ua(ja.scale.linear(),Iu,Bu)};var Ou=Iu.map(function(t){return[t[0].utc,t[1]]}),Wu=ku.multi([[".%L",function(t){return t.getUTCMilliseconds()}],[":%S",function(t){return t.getUTCSeconds()}],["%I:%M",function(t){return t.getUTCMinutes()}],["%I %p",function(t){return t.getUTCHours()}],["%a %d",function(t){return t.getUTCDay()&&1!=t.getUTCDate()}],["%b %d",function(t){return 1!=t.getUTCDate()}],["%B",function(t){return t.getUTCMonth()}],["%Y",wn]]);Ou.year=th.year.utc,th.scale.utc=function(){return Ua(ja.scale.linear(),Ou,Wu)},ja.text=we(function(t){return t.responseText}),ja.json=function(t,e){return _e(t,"application/json",Wa,e)},ja.html=function(t,e){return _e(t,"text/html",Ga,e)},ja.xml=we(function(t){return t.responseXML}),"function"==typeof define&&define.amd?define(ja):"object"==typeof module&&module.exports&&(module.exports=ja),this.d3=ja}(),function(){function t(t){function r(){for(;s=c<u.length&&t>l;){var e=c++,r=u[e],o=n.call(r,1);o.push(i(e)),++l,r[0].apply(null,o)}}function i(t){return function(e,n){--l,null==p&&(null!=e?(p=e,c=f=0/0,o()):(u[t]=n,--f?s||r():o()))}}function o(){null!=p?d(p):h?d(p,u):d.apply(null,[p].concat(u))}var a,s,h,u=[],c=0,l=0,f=0,p=null,d=e;return t||(t=1/0),a={defer:function(){return p||(u.push(arguments),++f,r()),a},await:function(t){return d=t,h=!1,f||o(),a},awaitAll:function(t){return d=t,h=!0,f||o(),a}}}function e(){}var n=[].slice;t.version="1.0.7","function"==typeof define&&define.amd?define(function(){return t}):"object"==typeof module&&module.exports?module.exports=t:this.queue=t}(),function(){function t(t,e,n){for(var r=(n||0)-1,i=t?t.length:0;++r<i;)if(t[r]===e)return r;return-1}function e(e,n){var r=typeof n;if(e=e.cache,"boolean"==r||null==n)return e[n]?0:-1;"number"!=r&&"string"!=r&&(r="object");var i="number"==r?n:v+n;return e=(e=e[r])&&e[i],"object"==r?e&&t(e,n)>-1?0:-1:e?0:-1}function n(t){var e=this.cache,n=typeof t;if("boolean"==n||null==t)e[t]=!0;else{"number"!=n&&"string"!=n&&(n="object");var r="number"==n?t:v+t,i=e[n]||(e[n]={});"object"==n?(i[r]||(i[r]=[])).push(t):i[r]=!0}}function r(t){return t.charCodeAt(0)}function i(t,e){for(var n=t.criteria,r=e.criteria,i=-1,o=n.length;++i<o;){var a=n[i],s=r[i];if(a!==s){if(a>s||"undefined"==typeof a)return 1;if(s>a||"undefined"==typeof s)return-1}}return t.index-e.index}function o(t){var e=-1,r=t.length,i=t[0],o=t[r/2|0],a=t[r-1];if(i&&"object"==typeof i&&o&&"object"==typeof o&&a&&"object"==typeof a)return!1;var s=h();s["false"]=s["null"]=s["true"]=s.undefined=!1;var u=h();for(u.array=t,u.cache=s,u.push=n;++e<r;)u.push(t[e]);return u}function a(t){return"\\"+X[t]}function s(){return d.pop()||[]}function h(){return m.pop()||{array:null,cache:null,criteria:null,"false":!1,index:0,"null":!1,number:null,object:null,push:null,string:null,"true":!1,undefined:!1,value:null}}function u(t){t.length=0,d.length<E&&d.push(t)}function c(t){var e=t.cache;e&&c(e),t.array=t.cache=t.criteria=t.object=t.number=t.string=t.value=null,m.length<E&&m.push(t)}function l(t,e,n){e||(e=0),"undefined"==typeof n&&(n=t?t.length:0);for(var r=-1,i=n-e||0,o=Array(0>i?0:i);++r<i;)o[r]=t[e+r];return o}function f(n){function d(t){return t&&"object"==typeof t&&!$r(t)&&zr.call(t,"__wrapped__")?t:new m(t)}function m(t,e){this.__chain__=!!e,this.__wrapped__=t}function E(t){function e(){if(r){var t=l(r);Fr.apply(t,arguments)}if(this instanceof e){var o=Z(n.prototype),a=n.apply(o,t||arguments);return Ae(a)?a:o}return n.apply(i,t||arguments)}var n=t[0],r=t[2],i=t[4];return Qr(e,t),e}function X(t,e,n,r,i){if(n){var o=n(t);if("undefined"!=typeof o)return o}var a=Ae(t);if(!a)return t;var h=Mr.call(t);if(!W[h])return t;var c=Zr[h];switch(h){case k:case N:return new c(+t);case I:case O:return new c(t);case U:return o=c(t.source,_.exec(t)),o.lastIndex=t.lastIndex,o}var f=$r(t);if(e){var p=!r;r||(r=s()),i||(i=s());for(var d=r.length;d--;)if(r[d]==t)return i[d];o=f?c(t.length):{}}else o=f?l(t):oi({},t);return f&&(zr.call(t,"index")&&(o.index=t.index),zr.call(t,"input")&&(o.input=t.input)),e?(r.push(t),i.push(o),(f?Ke:hi)(t,function(t,a){o[a]=X(t,e,n,r,i)}),p&&(u(r),u(i)),o):o}function Z(t){return Ae(t)?Br(t):{}}function K(t,e,n){if("function"!=typeof t)return $n;if("undefined"==typeof e||!("prototype"in t))return t;var r=t.__bindData__;if("undefined"==typeof r&&(Kr.funcNames&&(r=!t.name),r=r||!Kr.funcDecomp,!r)){var i=Pr.call(t);Kr.funcNames||(r=!H.test(i)),r||(r=A.test(i),Qr(t,r))}if(r===!1||r!==!0&&1&r[1])return t;switch(n){case 1:return function(n){return t.call(e,n)};case 2:return function(n,r){return t.call(e,n,r)};case 3:return function(n,r,i){return t.call(e,n,r,i)};case 4:return function(n,r,i,o){return t.call(e,n,r,i,o)}}return Fn(t,e)}function Q(t){function e(){var t=h?a:this;if(i){var d=l(i);Fr.apply(d,arguments)}if((o||c)&&(d||(d=l(arguments)),o&&Fr.apply(d,o),c&&d.length<s))return r|=16,Q([n,f?r:-4&r,d,null,a,s]);if(d||(d=arguments),u&&(n=t[p]),this instanceof e){t=Z(n.prototype);var m=n.apply(t,d);return Ae(m)?m:t}return n.apply(t,d)}var n=t[0],r=t[1],i=t[2],o=t[3],a=t[4],s=t[5],h=1&r,u=2&r,c=4&r,f=8&r,p=n;return Qr(e,t),e}function $(n,r){var i=-1,a=he(),s=n?n.length:0,h=s>=y&&a===t,u=[];if(h){var l=o(r);l?(a=e,r=l):h=!1}for(;++i<s;){var f=n[i];a(r,f)<0&&u.push(f)}return h&&c(r),u}function te(t,e,n,r){for(var i=(r||0)-1,o=t?t.length:0,a=[];++i<o;){var s=t[i];if(s&&"object"==typeof s&&"number"==typeof s.length&&($r(s)||fe(s))){e||(s=te(s,e,n));var h=-1,u=s.length,c=a.length;for(a.length+=u;++h<u;)a[c++]=s[h]}else n||a.push(s)}return a}function ee(t,e,n,r,i,o){if(n){var a=n(t,e);if("undefined"!=typeof a)return!!a}if(t===e)return 0!==t||1/t==1/e;var h=typeof t,c=typeof e;if(!(t!==t||t&&q[h]||e&&q[c]))return!1;if(null==t||null==e)return t===e;var l=Mr.call(t),f=Mr.call(e);if(l==z&&(l=B),f==z&&(f=B),l!=f)return!1;switch(l){case k:case N:return+t==+e;case I:return t!=+t?e!=+e:0==t?1/t==1/e:t==+e;case U:case O:return t==br(e)}var p=l==F;if(!p){var d=zr.call(t,"__wrapped__"),m=zr.call(e,"__wrapped__");if(d||m)return ee(d?t.__wrapped__:t,m?e.__wrapped__:e,n,r,i,o);if(l!=B)return!1;var g=t.constructor,v=e.constructor;if(g!=v&&!(Ce(g)&&g instanceof g&&Ce(v)&&v instanceof v)&&"constructor"in t&&"constructor"in e)return!1}var y=!i;i||(i=s()),o||(o=s());for(var E=i.length;E--;)if(i[E]==t)return o[E]==e;var x=0;if(a=!0,i.push(t),o.push(e),p){if(E=t.length,x=e.length,a=x==E,a||r)for(;x--;){var T=E,b=e[x];if(r)for(;T--&&!(a=ee(t[T],b,n,r,i,o)););else if(!(a=ee(t[x],b,n,r,i,o)))break}}else si(e,function(e,s,h){return zr.call(h,s)?(x++,a=zr.call(t,s)&&ee(t[s],e,n,r,i,o)):void 0}),a&&!r&&si(t,function(t,e,n){return zr.call(n,e)?a=--x>-1:void 0});return i.pop(),o.pop(),y&&(u(i),u(o)),a}function ne(t,e,n,r,i){($r(e)?Ke:hi)(e,function(e,o){var a,s,h=e,u=t[o];if(e&&((s=$r(e))||ui(e))){for(var c=r.length;c--;)if(a=r[c]==e){u=i[c];break}if(!a){var l;n&&(h=n(u,e),(l="undefined"!=typeof h)&&(u=h)),l||(u=s?$r(u)?u:[]:ui(u)?u:{}),r.push(e),i.push(u),l||ne(u,e,n,r,i)}}else n&&(h=n(u,e),"undefined"==typeof h&&(h=e)),"undefined"!=typeof h&&(u=h);t[o]=u})}function re(t,e){return t+Lr(Yr()*(e-t+1))}function ie(n,r,i){var a=-1,h=he(),l=n?n.length:0,f=[],p=!r&&l>=y&&h===t,d=i||p?s():f;if(p){var m=o(d);h=e,d=m}for(;++a<l;){var g=n[a],v=i?i(g,a,n):g;(r?!a||d[d.length-1]!==v:h(d,v)<0)&&((i||p)&&d.push(v),f.push(g))}return p?(u(d.array),c(d)):i&&u(d),f}function oe(t){return function(e,n,r){var i={};n=d.createCallback(n,r,3);var o=-1,a=e?e.length:0;if("number"==typeof a)for(;++o<a;){var s=e[o];t(i,s,n(s,o,e),e)}else hi(e,function(e,r,o){t(i,e,n(e,r,o),o)});return i}}function ae(t,e,n,r,i,o){var a=1&e,s=2&e,h=4&e,u=16&e,c=32&e;if(!s&&!Ce(t))throw new Rr;u&&!n.length&&(e&=-17,u=n=!1),c&&!r.length&&(e&=-33,c=r=!1);var f=t&&t.__bindData__;if(f&&f!==!0)return f=l(f),f[2]&&(f[2]=l(f[2])),f[3]&&(f[3]=l(f[3])),!a||1&f[1]||(f[4]=i),!a&&1&f[1]&&(e|=8),!h||4&f[1]||(f[5]=o),u&&Fr.apply(f[2]||(f[2]=[]),n),c&&Vr.apply(f[3]||(f[3]=[]),r),f[1]|=e,ae.apply(null,f);var p=1==e||17===e?E:Q;return p([t,e,n,r,i,o])}function se(t){return ei[t]}function he(){var e=(e=d.indexOf)===yn?t:e;return e}function ue(t){return"function"==typeof t&&Sr.test(t)}function ce(t){var e,n;return t&&Mr.call(t)==B&&(e=t.constructor,!Ce(e)||e instanceof e)?(si(t,function(t,e){n=e}),"undefined"==typeof n||zr.call(t,n)):!1}function le(t){return ni[t]}function fe(t){return t&&"object"==typeof t&&"number"==typeof t.length&&Mr.call(t)==z||!1}function pe(t,e,n,r){return"boolean"!=typeof e&&null!=e&&(r=n,n=e,e=!1),X(t,e,"function"==typeof n&&K(n,r,1))}function de(t,e,n){return X(t,!0,"function"==typeof e&&K(e,n,1))}function me(t,e){var n=Z(t);return e?oi(n,e):n}function ge(t,e,n){var r;return e=d.createCallback(e,n,3),hi(t,function(t,n,i){return e(t,n,i)?(r=n,!1):void 0}),r}function ve(t,e,n){var r;return e=d.createCallback(e,n,3),Ee(t,function(t,n,i){return e(t,n,i)?(r=n,!1):void 0}),r}function ye(t,e,n){var r=[];si(t,function(t,e){r.push(e,t)});var i=r.length;for(e=K(e,n,3);i--&&e(r[i--],r[i],t)!==!1;);return t}function Ee(t,e,n){var r=ti(t),i=r.length;for(e=K(e,n,3);i--;){var o=r[i];if(e(t[o],o,t)===!1)break}return t}function xe(t){var e=[];return si(t,function(t,n){Ce(t)&&e.push(n)}),e.sort()}function Te(t,e){return t?zr.call(t,e):!1}function be(t){for(var e=-1,n=ti(t),r=n.length,i={};++e<r;){var o=n[e];i[t[o]]=o}return i}function Re(t){return t===!0||t===!1||t&&"object"==typeof t&&Mr.call(t)==k||!1}function we(t){return t&&"object"==typeof t&&Mr.call(t)==N||!1}function _e(t){return t&&1===t.nodeType||!1}function He(t){var e=!0;if(!t)return e;var n=Mr.call(t),r=t.length;return n==F||n==O||n==z||n==B&&"number"==typeof r&&Ce(t.splice)?!r:(hi(t,function(){return e=!1}),e)}function Me(t,e,n,r){return ee(t,e,"function"==typeof n&&K(n,r,2))}function Se(t){return Or(t)&&!Wr(parseFloat(t))}function Ce(t){return"function"==typeof t}function Ae(t){return!(!t||!q[typeof t])}function Le(t){return De(t)&&t!=+t}function Pe(t){return null===t}function De(t){return"number"==typeof t||t&&"object"==typeof t&&Mr.call(t)==I||!1}function ze(t){return t&&"object"==typeof t&&Mr.call(t)==U||!1}function Fe(t){return"string"==typeof t||t&&"object"==typeof t&&Mr.call(t)==O||!1}function ke(t){return"undefined"==typeof t}function Ne(t,e,n){var r={};return e=d.createCallback(e,n,3),hi(t,function(t,n,i){r[n]=e(t,n,i)}),r}function Ve(t){var e=arguments,n=2;if(!Ae(t))return t;if("number"!=typeof e[2]&&(n=e.length),n>3&&"function"==typeof e[n-2])var r=K(e[--n-1],e[n--],2);else n>2&&"function"==typeof e[n-1]&&(r=e[--n]);for(var i=l(arguments,1,n),o=-1,a=s(),h=s();++o<n;)ne(t,i[o],r,a,h);return u(a),u(h),t}function Ie(t,e,n){var r={};if("function"!=typeof e){var i=[];si(t,function(t,e){i.push(e)}),i=$(i,te(arguments,!0,!1,1));for(var o=-1,a=i.length;++o<a;){var s=i[o];r[s]=t[s]}}else e=d.createCallback(e,n,3),si(t,function(t,n,i){e(t,n,i)||(r[n]=t)});return r}function Be(t){for(var e=-1,n=ti(t),r=n.length,i=dr(r);++e<r;){var o=n[e];i[e]=[o,t[o]]}return i}function Ue(t,e,n){var r={};if("function"!=typeof e)for(var i=-1,o=te(arguments,!0,!1,1),a=Ae(t)?o.length:0;++i<a;){var s=o[i];s in t&&(r[s]=t[s])}else e=d.createCallback(e,n,3),si(t,function(t,n,i){e(t,n,i)&&(r[n]=t)});return r}function Oe(t,e,n,r){var i=$r(t);if(null==n)if(i)n=[];else{var o=t&&t.constructor,a=o&&o.prototype;n=Z(a)}return e&&(e=d.createCallback(e,r,4),(i?Ke:hi)(t,function(t,r,i){return e(n,t,r,i)})),n}function We(t){for(var e=-1,n=ti(t),r=n.length,i=dr(r);++e<r;)i[e]=t[n[e]];return i}function Ge(t){for(var e=arguments,n=-1,r=te(e,!0,!1,1),i=e[2]&&e[2][e[1]]===t?1:r.length,o=dr(i);++n<i;)o[n]=t[r[n]];return o}function je(t,e,n){var r=-1,i=he(),o=t?t.length:0,a=!1;return n=(0>n?jr(0,o+n):n)||0,$r(t)?a=i(t,e,n)>-1:"number"==typeof o?a=(Fe(t)?t.indexOf(e,n):i(t,e,n))>-1:hi(t,function(t){return++r>=n?!(a=t===e):void 0}),a}function qe(t,e,n){var r=!0;e=d.createCallback(e,n,3);var i=-1,o=t?t.length:0;if("number"==typeof o)for(;++i<o&&(r=!!e(t[i],i,t)););else hi(t,function(t,n,i){return r=!!e(t,n,i)});return r}function Xe(t,e,n){var r=[];e=d.createCallback(e,n,3);var i=-1,o=t?t.length:0;if("number"==typeof o)for(;++i<o;){var a=t[i];e(a,i,t)&&r.push(a)}else hi(t,function(t,n,i){e(t,n,i)&&r.push(t)});return r}function Ye(t,e,n){e=d.createCallback(e,n,3);var r=-1,i=t?t.length:0;if("number"!=typeof i){var o;return hi(t,function(t,n,r){return e(t,n,r)?(o=t,!1):void 0}),o}for(;++r<i;){var a=t[r];if(e(a,r,t))return a}}function Ze(t,e,n){var r;return e=d.createCallback(e,n,3),Qe(t,function(t,n,i){return e(t,n,i)?(r=t,!1):void 0}),r}function Ke(t,e,n){var r=-1,i=t?t.length:0;if(e=e&&"undefined"==typeof n?e:K(e,n,3),"number"==typeof i)for(;++r<i&&e(t[r],r,t)!==!1;);else hi(t,e);return t}function Qe(t,e,n){var r=t?t.length:0;if(e=e&&"undefined"==typeof n?e:K(e,n,3),"number"==typeof r)for(;r--&&e(t[r],r,t)!==!1;);else{var i=ti(t);r=i.length,hi(t,function(t,n,o){return n=i?i[--r]:--r,e(o[n],n,o)})}return t}function $e(t,e){var n=l(arguments,2),r=-1,i="function"==typeof e,o=t?t.length:0,a=dr("number"==typeof o?o:0);return Ke(t,function(t){a[++r]=(i?e:t[e]).apply(t,n)}),a}function Je(t,e,n){var r=-1,i=t?t.length:0;if(e=d.createCallback(e,n,3),"number"==typeof i)for(var o=dr(i);++r<i;)o[r]=e(t[r],r,t);else o=[],hi(t,function(t,n,i){o[++r]=e(t,n,i)});return o}function tn(t,e,n){var i=-1/0,o=i;if("function"!=typeof e&&n&&n[e]===t&&(e=null),null==e&&$r(t))for(var a=-1,s=t.length;++a<s;){var h=t[a];h>o&&(o=h)}else e=null==e&&Fe(t)?r:d.createCallback(e,n,3),Ke(t,function(t,n,r){var a=e(t,n,r);a>i&&(i=a,o=t)});return o}function en(t,e,n){var i=1/0,o=i;if("function"!=typeof e&&n&&n[e]===t&&(e=null),null==e&&$r(t))for(var a=-1,s=t.length;++a<s;){var h=t[a];o>h&&(o=h)}else e=null==e&&Fe(t)?r:d.createCallback(e,n,3),Ke(t,function(t,n,r){var a=e(t,n,r);i>a&&(i=a,o=t)});return o}function nn(t,e,n,r){if(!t)return n;var i=arguments.length<3;e=d.createCallback(e,r,4);var o=-1,a=t.length;if("number"==typeof a)for(i&&(n=t[++o]);++o<a;)n=e(n,t[o],o,t);else hi(t,function(t,r,o){n=i?(i=!1,t):e(n,t,r,o)});return n}function rn(t,e,n,r){var i=arguments.length<3;return e=d.createCallback(e,r,4),Qe(t,function(t,r,o){n=i?(i=!1,t):e(n,t,r,o)}),n}function on(t,e,n){return e=d.createCallback(e,n,3),Xe(t,function(t,n,r){return!e(t,n,r)})}function an(t,e,n){if(t&&"number"!=typeof t.length&&(t=We(t)),null==e||n)return t?t[re(0,t.length-1)]:p;var r=sn(t);return r.length=qr(jr(0,e),r.length),r}function sn(t){var e=-1,n=t?t.length:0,r=dr("number"==typeof n?n:0);return Ke(t,function(t){var n=re(0,++e);r[e]=r[n],r[n]=t}),r}function hn(t){var e=t?t.length:0;return"number"==typeof e?e:ti(t).length}function un(t,e,n){var r;e=d.createCallback(e,n,3);var i=-1,o=t?t.length:0;if("number"==typeof o)for(;++i<o&&!(r=e(t[i],i,t)););else hi(t,function(t,n,i){return!(r=e(t,n,i))});return!!r}function cn(t,e,n){var r=-1,o=$r(e),a=t?t.length:0,l=dr("number"==typeof a?a:0);for(o||(e=d.createCallback(e,n,3)),Ke(t,function(t,n,i){var a=l[++r]=h();o?a.criteria=Je(e,function(e){return t[e]}):(a.criteria=s())[0]=e(t,n,i),a.index=r,a.value=t}),a=l.length,l.sort(i);a--;){var f=l[a];l[a]=f.value,o||u(f.criteria),c(f)}return l}function ln(t){return t&&"number"==typeof t.length?l(t):We(t)}function fn(t){for(var e=-1,n=t?t.length:0,r=[];++e<n;){var i=t[e];i&&r.push(i)}return r}function pn(t){return $(t,te(arguments,!0,!0,1))}function dn(t,e,n){var r=-1,i=t?t.length:0;for(e=d.createCallback(e,n,3);++r<i;)if(e(t[r],r,t))return r;return-1}function mn(t,e,n){var r=t?t.length:0;for(e=d.createCallback(e,n,3);r--;)if(e(t[r],r,t))return r;return-1}function gn(t,e,n){var r=0,i=t?t.length:0;if("number"!=typeof e&&null!=e){var o=-1;for(e=d.createCallback(e,n,3);++o<i&&e(t[o],o,t);)r++}else if(r=e,null==r||n)return t?t[0]:p;return l(t,0,qr(jr(0,r),i))}function vn(t,e,n,r){return"boolean"!=typeof e&&null!=e&&(r=n,n="function"!=typeof e&&r&&r[e]===t?null:e,e=!1),null!=n&&(t=Je(t,n,r)),te(t,e)}function yn(e,n,r){if("number"==typeof r){var i=e?e.length:0;r=0>r?jr(0,i+r):r||0}else if(r){var o=Mn(e,n);return e[o]===n?o:-1}return t(e,n,r)}function En(t,e,n){var r=0,i=t?t.length:0;if("number"!=typeof e&&null!=e){var o=i;for(e=d.createCallback(e,n,3);o--&&e(t[o],o,t);)r++}else r=null==e||n?1:e||r;return l(t,0,qr(jr(0,i-r),i))}function xn(){for(var n=[],r=-1,i=arguments.length,a=s(),h=he(),l=h===t,f=s();++r<i;){var p=arguments[r];($r(p)||fe(p))&&(n.push(p),a.push(l&&p.length>=y&&o(r?n[r]:f)))}var d=n[0],m=-1,g=d?d.length:0,v=[];t:for(;++m<g;){var E=a[0];if(p=d[m],(E?e(E,p):h(f,p))<0){for(r=i,(E||f).push(p);--r;)if(E=a[r],(E?e(E,p):h(n[r],p))<0)continue t;v.push(p)}}for(;i--;)E=a[i],E&&c(E);return u(a),u(f),v}function Tn(t,e,n){var r=0,i=t?t.length:0;if("number"!=typeof e&&null!=e){var o=i;for(e=d.createCallback(e,n,3);o--&&e(t[o],o,t);)r++}else if(r=e,null==r||n)return t?t[i-1]:p;return l(t,jr(0,i-r))}function bn(t,e,n){var r=t?t.length:0;for("number"==typeof n&&(r=(0>n?jr(0,r+n):qr(n,r-1))+1);r--;)if(t[r]===e)return r;return-1}function Rn(t){for(var e=arguments,n=0,r=e.length,i=t?t.length:0;++n<r;)for(var o=-1,a=e[n];++o<i;)t[o]===a&&(Nr.call(t,o--,1),i--);return t}function wn(t,e,n){t=+t||0,n="number"==typeof n?n:+n||1,null==e&&(e=t,t=0);for(var r=-1,i=jr(0,Cr((e-t)/(n||1))),o=dr(i);++r<i;)o[r]=t,t+=n;return o}function _n(t,e,n){var r=-1,i=t?t.length:0,o=[];for(e=d.createCallback(e,n,3);++r<i;){var a=t[r];e(a,r,t)&&(o.push(a),Nr.call(t,r--,1),i--)}return o}function Hn(t,e,n){if("number"!=typeof e&&null!=e){var r=0,i=-1,o=t?t.length:0;for(e=d.createCallback(e,n,3);++i<o&&e(t[i],i,t);)r++}else r=null==e||n?1:jr(0,e);return l(t,r)}function Mn(t,e,n,r){var i=0,o=t?t.length:i;for(n=n?d.createCallback(n,r,1):$n,e=n(e);o>i;){var a=i+o>>>1;n(t[a])<e?i=a+1:o=a}return i}function Sn(){return ie(te(arguments,!0,!0))}function Cn(t,e,n,r){return"boolean"!=typeof e&&null!=e&&(r=n,n="function"!=typeof e&&r&&r[e]===t?null:e,e=!1),null!=n&&(n=d.createCallback(n,r,3)),ie(t,e,n)}function An(t){return $(t,l(arguments,1))}function Ln(){for(var t=-1,e=arguments.length;++t<e;){var n=arguments[t];if($r(n)||fe(n))var r=r?ie($(r,n).concat($(n,r))):n}return r||[]}function Pn(){for(var t=arguments.length>1?arguments:arguments[0],e=-1,n=t?tn(pi(t,"length")):0,r=dr(0>n?0:n);++e<n;)r[e]=pi(t,e);return r}function Dn(t,e){var n=-1,r=t?t.length:0,i={};for(e||!r||$r(t[0])||(e=[]);++n<r;){var o=t[n];e?i[o]=e[n]:o&&(i[o[0]]=o[1])}return i}function zn(t,e){if(!Ce(e))throw new Rr;return function(){return--t<1?e.apply(this,arguments):void 0}}function Fn(t,e){return arguments.length>2?ae(t,17,l(arguments,2),null,e):ae(t,1,null,null,e)}function kn(t){for(var e=arguments.length>1?te(arguments,!0,!1,1):xe(t),n=-1,r=e.length;++n<r;){var i=e[n];t[i]=ae(t[i],1,null,null,t)}return t}function Nn(t,e){return arguments.length>2?ae(e,19,l(arguments,2),null,t):ae(e,3,null,null,t)}function Vn(){for(var t=arguments,e=t.length;e--;)if(!Ce(t[e]))throw new Rr;return function(){for(var e=arguments,n=t.length;n--;)e=[t[n].apply(this,e)];return e[0]}}function In(t,e){return e="number"==typeof e?e:+e||t.length,ae(t,4,null,null,null,e)}function Bn(t,e,n){var r,i,o,a,s,h,u,c=0,l=!1,f=!0;if(!Ce(t))throw new Rr;if(e=jr(0,e)||0,n===!0){var d=!0;f=!1}else Ae(n)&&(d=n.leading,l="maxWait"in n&&(jr(e,n.maxWait)||0),f="trailing"in n?n.trailing:f);var m=function(){var n=e-(mi()-a);if(0>=n){i&&Ar(i);var l=u;i=h=u=p,l&&(c=mi(),o=t.apply(s,r),h||i||(r=s=null))}else h=kr(m,n)},g=function(){h&&Ar(h),i=h=u=p,(f||l!==e)&&(c=mi(),o=t.apply(s,r),h||i||(r=s=null))};return function(){if(r=arguments,a=mi(),s=this,u=f&&(h||!d),l===!1)var n=d&&!h;else{i||d||(c=a);var p=l-(a-c),v=0>=p;v?(i&&(i=Ar(i)),c=a,o=t.apply(s,r)):i||(i=kr(g,p))}return v&&h?h=Ar(h):h||e===l||(h=kr(m,e)),n&&(v=!0,o=t.apply(s,r)),!v||h||i||(r=s=null),o}}function Un(t){if(!Ce(t))throw new Rr;var e=l(arguments,1);return kr(function(){t.apply(p,e)},1)}function On(t,e){if(!Ce(t))throw new Rr;var n=l(arguments,2);return kr(function(){t.apply(p,n)},e)}function Wn(t,e){if(!Ce(t))throw new Rr;var n=function(){var r=n.cache,i=e?e.apply(this,arguments):v+arguments[0];return zr.call(r,i)?r[i]:r[i]=t.apply(this,arguments)};return n.cache={},n}function Gn(t){var e,n;if(!Ce(t))throw new Rr;return function(){return e?n:(e=!0,n=t.apply(this,arguments),t=null,n)}}function jn(t){return ae(t,16,l(arguments,1))}function qn(t){return ae(t,32,null,l(arguments,1))}function Xn(t,e,n){var r=!0,i=!0;if(!Ce(t))throw new Rr;return n===!1?r=!1:Ae(n)&&(r="leading"in n?n.leading:r,i="trailing"in n?n.trailing:i),G.leading=r,G.maxWait=e,G.trailing=i,Bn(t,e,G)}function Yn(t,e){return ae(e,16,[t])}function Zn(t){return function(){return t}}function Kn(t,e,n){var r=typeof t;if(null==t||"function"==r)return K(t,e,n);if("object"!=r)return nr(t);var i=ti(t),o=i[0],a=t[o];return 1!=i.length||a!==a||Ae(a)?function(e){for(var n=i.length,r=!1;n--&&(r=ee(e[i[n]],t[i[n]],null,!0)););return r}:function(t){var e=t[o];return a===e&&(0!==a||1/a==1/e)}}function Qn(t){return null==t?"":br(t).replace(ii,se)}function $n(t){return t}function Jn(t,e,n){var r=!0,i=e&&xe(e);e&&(n||i.length)||(null==n&&(n=e),o=m,e=t,t=d,i=xe(e)),n===!1?r=!1:Ae(n)&&"chain"in n&&(r=n.chain);var o=t,a=Ce(o);Ke(i,function(n){var i=t[n]=e[n];a&&(o.prototype[n]=function(){var e=this.__chain__,n=this.__wrapped__,a=[n];Fr.apply(a,arguments);var s=i.apply(t,a);if(r||e){if(n===s&&Ae(s))return this;s=new o(s),s.__chain__=e}return s})})}function tr(){return n._=Hr,this}function er(){}function nr(t){return function(e){return e[t]}}function rr(t,e,n){var r=null==t,i=null==e;if(null==n&&("boolean"==typeof t&&i?(n=t,t=1):i||"boolean"!=typeof e||(n=e,i=!0)),r&&i&&(e=1),t=+t||0,i?(e=t,t=0):e=+e||0,n||t%1||e%1){var o=Yr();return qr(t+o*(e-t+parseFloat("1e-"+((o+"").length-1))),e)}return re(t,e)}function ir(t,e){if(t){var n=t[e];return Ce(n)?t[e]():n}}function or(t,e,n){var r=d.templateSettings;t=br(t||""),n=ai({},n,r);var i,o=ai({},n.imports,r.imports),s=ti(o),h=We(o),u=0,c=n.interpolate||C,l="__p += '",f=Tr((n.escape||C).source+"|"+c.source+"|"+(c===M?w:C).source+"|"+(n.evaluate||C).source+"|$","g");t.replace(f,function(e,n,r,o,s,h){return r||(r=o),l+=t.slice(u,h).replace(L,a),n&&(l+="' +\n__e("+n+") +\n'"),s&&(i=!0,l+="';\n"+s+";\n__p += '"),r&&(l+="' +\n((__t = ("+r+")) == null ? '' : __t) +\n'"),u=h+e.length,e
}),l+="';\n";var m=n.variable,g=m;g||(m="obj",l="with ("+m+") {\n"+l+"\n}\n"),l=(i?l.replace(T,""):l).replace(b,"$1").replace(R,"$1;"),l="function("+m+") {\n"+(g?"":m+" || ("+m+" = {});\n")+"var __t, __p = '', __e = _.escape"+(i?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+l+"return __p\n}";var v="\n/*\n//# sourceURL="+(n.sourceURL||"/lodash/template/source["+D++ +"]")+"\n*/";try{var y=vr(s,"return "+l+v).apply(p,h)}catch(E){throw E.source=l,E}return e?y(e):(y.source=l,y)}function ar(t,e,n){t=(t=+t)>-1?t:0;var r=-1,i=dr(t);for(e=K(e,n,1);++r<t;)i[r]=e(r);return i}function sr(t){return null==t?"":br(t).replace(ri,le)}function hr(t){var e=++g;return br(null==t?"":t)+e}function ur(t){return t=new m(t),t.__chain__=!0,t}function cr(t,e){return e(t),t}function lr(){return this.__chain__=!0,this}function fr(){return br(this.__wrapped__)}function pr(){return this.__wrapped__}n=n?J.defaults(Y.Object(),n,J.pick(Y,P)):Y;var dr=n.Array,mr=n.Boolean,gr=n.Date,vr=n.Function,yr=n.Math,Er=n.Number,xr=n.Object,Tr=n.RegExp,br=n.String,Rr=n.TypeError,wr=[],_r=xr.prototype,Hr=n._,Mr=_r.toString,Sr=Tr("^"+br(Mr).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$"),Cr=yr.ceil,Ar=n.clearTimeout,Lr=yr.floor,Pr=vr.prototype.toString,Dr=ue(Dr=xr.getPrototypeOf)&&Dr,zr=_r.hasOwnProperty,Fr=wr.push,kr=n.setTimeout,Nr=wr.splice,Vr=wr.unshift,Ir=function(){try{var t={},e=ue(e=xr.defineProperty)&&e,n=e(t,t,t)&&e}catch(r){}return n}(),Br=ue(Br=xr.create)&&Br,Ur=ue(Ur=dr.isArray)&&Ur,Or=n.isFinite,Wr=n.isNaN,Gr=ue(Gr=xr.keys)&&Gr,jr=yr.max,qr=yr.min,Xr=n.parseInt,Yr=yr.random,Zr={};Zr[F]=dr,Zr[k]=mr,Zr[N]=gr,Zr[V]=vr,Zr[B]=xr,Zr[I]=Er,Zr[U]=Tr,Zr[O]=br,m.prototype=d.prototype;var Kr=d.support={};Kr.funcDecomp=!ue(n.WinRTError)&&A.test(f),Kr.funcNames="string"==typeof vr.name,d.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:M,variable:"",imports:{_:d}},Br||(Z=function(){function t(){}return function(e){if(Ae(e)){t.prototype=e;var r=new t;t.prototype=null}return r||n.Object()}}());var Qr=Ir?function(t,e){j.value=e,Ir(t,"__bindData__",j)}:er,$r=Ur||function(t){return t&&"object"==typeof t&&"number"==typeof t.length&&Mr.call(t)==F||!1},Jr=function(t){var e,n=t,r=[];if(!n)return r;if(!q[typeof t])return r;for(e in n)zr.call(n,e)&&r.push(e);return r},ti=Gr?function(t){return Ae(t)?Gr(t):[]}:Jr,ei={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},ni=be(ei),ri=Tr("("+ti(ni).join("|")+")","g"),ii=Tr("["+ti(ei).join("")+"]","g"),oi=function(t,e,n){var r,i=t,o=i;if(!i)return o;var a=arguments,s=0,h="number"==typeof n?2:a.length;if(h>3&&"function"==typeof a[h-2])var u=K(a[--h-1],a[h--],2);else h>2&&"function"==typeof a[h-1]&&(u=a[--h]);for(;++s<h;)if(i=a[s],i&&q[typeof i])for(var c=-1,l=q[typeof i]&&ti(i),f=l?l.length:0;++c<f;)r=l[c],o[r]=u?u(o[r],i[r]):i[r];return o},ai=function(t,e,n){var r,i=t,o=i;if(!i)return o;for(var a=arguments,s=0,h="number"==typeof n?2:a.length;++s<h;)if(i=a[s],i&&q[typeof i])for(var u=-1,c=q[typeof i]&&ti(i),l=c?c.length:0;++u<l;)r=c[u],"undefined"==typeof o[r]&&(o[r]=i[r]);return o},si=function(t,e,n){var r,i=t,o=i;if(!i)return o;if(!q[typeof i])return o;e=e&&"undefined"==typeof n?e:K(e,n,3);for(r in i)if(e(i[r],r,t)===!1)return o;return o},hi=function(t,e,n){var r,i=t,o=i;if(!i)return o;if(!q[typeof i])return o;e=e&&"undefined"==typeof n?e:K(e,n,3);for(var a=-1,s=q[typeof i]&&ti(i),h=s?s.length:0;++a<h;)if(r=s[a],e(i[r],r,t)===!1)return o;return o},ui=Dr?function(t){if(!t||Mr.call(t)!=B)return!1;var e=t.valueOf,n=ue(e)&&(n=Dr(e))&&Dr(n);return n?t==n||Dr(t)==n:ce(t)}:ce,ci=oe(function(t,e,n){zr.call(t,n)?t[n]++:t[n]=1}),li=oe(function(t,e,n){(zr.call(t,n)?t[n]:t[n]=[]).push(e)}),fi=oe(function(t,e,n){t[n]=e}),pi=Je,di=Xe,mi=ue(mi=gr.now)&&mi||function(){return(new gr).getTime()},gi=8==Xr(x+"08")?Xr:function(t,e){return Xr(Fe(t)?t.replace(S,""):t,e||0)};return d.after=zn,d.assign=oi,d.at=Ge,d.bind=Fn,d.bindAll=kn,d.bindKey=Nn,d.chain=ur,d.compact=fn,d.compose=Vn,d.constant=Zn,d.countBy=ci,d.create=me,d.createCallback=Kn,d.curry=In,d.debounce=Bn,d.defaults=ai,d.defer=Un,d.delay=On,d.difference=pn,d.filter=Xe,d.flatten=vn,d.forEach=Ke,d.forEachRight=Qe,d.forIn=si,d.forInRight=ye,d.forOwn=hi,d.forOwnRight=Ee,d.functions=xe,d.groupBy=li,d.indexBy=fi,d.initial=En,d.intersection=xn,d.invert=be,d.invoke=$e,d.keys=ti,d.map=Je,d.mapValues=Ne,d.max=tn,d.memoize=Wn,d.merge=Ve,d.min=en,d.omit=Ie,d.once=Gn,d.pairs=Be,d.partial=jn,d.partialRight=qn,d.pick=Ue,d.pluck=pi,d.property=nr,d.pull=Rn,d.range=wn,d.reject=on,d.remove=_n,d.rest=Hn,d.shuffle=sn,d.sortBy=cn,d.tap=cr,d.throttle=Xn,d.times=ar,d.toArray=ln,d.transform=Oe,d.union=Sn,d.uniq=Cn,d.values=We,d.where=di,d.without=An,d.wrap=Yn,d.xor=Ln,d.zip=Pn,d.zipObject=Dn,d.collect=Je,d.drop=Hn,d.each=Ke,d.eachRight=Qe,d.extend=oi,d.methods=xe,d.object=Dn,d.select=Xe,d.tail=Hn,d.unique=Cn,d.unzip=Pn,Jn(d),d.clone=pe,d.cloneDeep=de,d.contains=je,d.escape=Qn,d.every=qe,d.find=Ye,d.findIndex=dn,d.findKey=ge,d.findLast=Ze,d.findLastIndex=mn,d.findLastKey=ve,d.has=Te,d.identity=$n,d.indexOf=yn,d.isArguments=fe,d.isArray=$r,d.isBoolean=Re,d.isDate=we,d.isElement=_e,d.isEmpty=He,d.isEqual=Me,d.isFinite=Se,d.isFunction=Ce,d.isNaN=Le,d.isNull=Pe,d.isNumber=De,d.isObject=Ae,d.isPlainObject=ui,d.isRegExp=ze,d.isString=Fe,d.isUndefined=ke,d.lastIndexOf=bn,d.mixin=Jn,d.noConflict=tr,d.noop=er,d.now=mi,d.parseInt=gi,d.random=rr,d.reduce=nn,d.reduceRight=rn,d.result=ir,d.runInContext=f,d.size=hn,d.some=un,d.sortedIndex=Mn,d.template=or,d.unescape=sr,d.uniqueId=hr,d.all=qe,d.any=un,d.detect=Ye,d.findWhere=Ye,d.foldl=nn,d.foldr=rn,d.include=je,d.inject=nn,Jn(function(){var t={};return hi(d,function(e,n){d.prototype[n]||(t[n]=e)}),t}(),!1),d.first=gn,d.last=Tn,d.sample=an,d.take=gn,d.head=gn,hi(d,function(t,e){var n="sample"!==e;d.prototype[e]||(d.prototype[e]=function(e,r){var i=this.__chain__,o=t(this.__wrapped__,e,r);return i||null!=e&&(!r||n&&"function"==typeof e)?new m(o,i):o})}),d.VERSION="2.4.1",d.prototype.chain=lr,d.prototype.toString=fr,d.prototype.value=pr,d.prototype.valueOf=pr,Ke(["join","pop","shift"],function(t){var e=wr[t];d.prototype[t]=function(){var t=this.__chain__,n=e.apply(this.__wrapped__,arguments);return t?new m(n,t):n}}),Ke(["push","reverse","sort","unshift"],function(t){var e=wr[t];d.prototype[t]=function(){return e.apply(this.__wrapped__,arguments),this}}),Ke(["concat","slice","splice"],function(t){var e=wr[t];d.prototype[t]=function(){return new m(e.apply(this.__wrapped__,arguments),this.__chain__)}}),d}var p,d=[],m=[],g=0,v=+new Date+"",y=75,E=40,x=" 	\f ﻿\n\r\u2028\u2029 ᠎             　",T=/\b__p \+= '';/g,b=/\b(__p \+=) '' \+/g,R=/(__e\(.*?\)|\b__t\)) \+\n'';/g,w=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,_=/\w*$/,H=/^\s*function[ \n\r\t]+\w/,M=/<%=([\s\S]+?)%>/g,S=RegExp("^["+x+"]*0+(?=.$)"),C=/($^)/,A=/\bthis\b/,L=/['\n\r\t\u2028\u2029\\]/g,P=["Array","Boolean","Date","Function","Math","Number","Object","RegExp","String","_","attachEvent","clearTimeout","isFinite","isNaN","parseInt","setTimeout"],D=0,z="[object Arguments]",F="[object Array]",k="[object Boolean]",N="[object Date]",V="[object Function]",I="[object Number]",B="[object Object]",U="[object RegExp]",O="[object String]",W={};W[V]=!1,W[z]=W[F]=W[k]=W[N]=W[I]=W[B]=W[U]=W[O]=!0;var G={leading:!1,maxWait:0,trailing:!1},j={configurable:!1,enumerable:!1,value:null,writable:!1},q={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},X={"\\":"\\","'":"'","\n":"n","\r":"r","	":"t","\u2028":"u2028","\u2029":"u2029"},Y=q[typeof window]&&window||this,Z=q[typeof exports]&&exports&&!exports.nodeType&&exports,K=q[typeof module]&&module&&!module.nodeType&&module,Q=K&&K.exports===Z&&Z,$=q[typeof global]&&global;!$||$.global!==$&&$.window!==$||(Y=$);var J=f();"function"==typeof define&&"object"==typeof define.amd&&define.amd?(Y._=J,define(function(){return J})):Z&&K?Q?(K.exports=J)._=J:Z._=J:Y._=J}.call(this),!function(t,e,n,r,i,o,a,s,h,u,c){function l(n,i,a,s){var h,l=u.innerWidth,p=u.innerHeight,d=40,x=l/p,T=.1,b=2e4;k=a.filter(function(t){return"2012"===t.YEAR}),N=o.max(a,function(t){return parseFloat(t[c])}),V=o.min(a,function(t){return parseFloat(t[c])}),I=o.scale.linear().domain([V,N]).range([0,1]),P=new t.Scene,D=new t.PerspectiveCamera(d,x,T,b),P.add(D),D.position.set(-300,300,-300),D.lookAt(P.position),z=r.webgl?new t.WebGLRenderer({antialias:!0,precision:"highp"}):new t.CanvasRenderer,z.setSize(l,p),L=document.getElementById("container"),L.appendChild(z.domElement),e.WindowResize(z,D),F=new t.TrackballControls(D,z.domElement),m(),h=new t.AxisHelper(200),v(),y(i.features),E(i.features),g(s),f()}function f(){requestAnimationFrame(f),d(),p()}function p(){F.update()}function d(){z.render(P,D)}function m(){var e=new t.HemisphereLight(16777215,16777215,.6);e.position.set(0,500,0);var n=new t.DirectionalLight(16777215,.9);n.position.set(-1,.75,1),n.position.multiplyScalar(50),n.name="dirlight",n.castShadow=!0,n.shadowMapWidth=n.shadowMapHeight=2048;var r=300;n.shadowCameraLeft=-r,n.shadowCameraRight=r,n.shadowCameraTop=r,n.shadowCameraBottom=-r,n.shadowCameraFar=3500,n.shadowBias=-1e-4,n.shadowDarkness=.35,P.add(e),P.add(n)}function g(t){t.forEach(function(t){var e=M(t[0],t[1]),n=new THREE.Geometry;n.vertices=e.getPoints(200),n.computeLineDistances();var r=new THREE.LineBasicMaterial;r.color=new THREE.Color(1048560),r.linewidth=3;var i=new THREE.Line(n,r);P.add(i)})}function v(){var e=new t.SphereGeometry(B,64,64),n=new t.Mesh(e,new t.MeshLambertMaterial({color:6711039}));n.position=new t.Vector3(0,0,0),P.add(n);var r=3,i=new t.MeshLambertMaterial({color:14540270,side:t.BackSide}),o=new t.SphereGeometry(B+r,64+r,64+r),a=new t.Mesh(o,i);a.position=new t.Vector3(0,0,0),P.add(a)}function y(t){t.forEach(function(t){"Polygon"===t.geometry.type?w(t.geometry.coordinates[0],65280):t.geometry.coordinates.forEach(function(t){w(t[0],65280)})})}function E(t){t.forEach(function(t){"Polygon"===t.geometry.type?x(t.geometry.coordinates[0],t.id):t.geometry.coordinates.forEach(function(e){x(e[0],t.id)})})}function x(t,e){for(var n=b(t),r=R(n),h=a.triangulate(r.map(function(t){return[t.x,t.y]})),u=[],c=0;c<h.length-2;c+=3)u.push([h[c],h[c+1],h[c+2]]);u=s.remove(u,function(t){var e=new i.geom.Vec2D({x:o.mean(t,function(t){return r[t].x}),y:o.mean(t,function(t){return r[t].y})});return n.containsPoint(e)});var l=r.map(function(t){return C(t.x,t.y,U)});u.length&&u.length>0&&l.length&&l.length>2&&_(l,u,T(e))}function T(e){var n=s.find(k,function(t){return e===t.COUNTRY});return"undefined"!=typeof n?new t.Color(I(parseFloat(n[c])),0,0):new t.Color(0,0,0)}function b(t){var e=new i.geom.Polygon2D;return t.forEach(function(t){var n=new i.geom.Vec2D({x:t[0],y:t[1]});e.add(n)}),e}function R(t){var e=t.getBounds(),n=new Array;t.vertices.forEach(function(t){n.push(t)});for(var r=3,o=parseInt(e.x);o<=parseInt(e.x+e.width+.5);o+=r)for(var a=parseInt(e.y);a<=parseInt(e.y+e.height+.5);a+=r){var s=new i.geom.Vec2D({x:o,y:a});t.containsPoint(s)&&n.push(s)}return n}function w(t,e){var n=H(t),r=new THREE.Geometry;r.vertices=n.getPoints(500),r.computeLineDistances();var i=new THREE.LineBasicMaterial;i.color=new THREE.Color(e),i.linewidth=1;var o=new THREE.Line(r,i);P.add(o)}function _(e,n,r){var i,o=new t.Geometry,a=new t.MeshBasicMaterial({color:r});a.side=t.DoubleSide,o.vertices=e,n.forEach(function(e){o.faces.push(new t.Face3(e[0],e[1],e[2]))}),i=new t.Mesh(o,a),P.add(i)}function H(e){for(var n,r,i,o=new t.CurvePath,a=0;a<e.length-1;a++)r=C(e[a][0],e[a][1],O),i=C(e[a+1][0],e[a+1][1],O),n=S(r,i),o.add(n);return o.closePath(),o}function M(e,n){var r=new t.CurvePath,i=o.geo.distance(e,n),a=o.scale.linear().domain([0,2]).range([1.1,2.5]),s=new t.QuadraticBezierCurve3(C(e[0],e[1],U),C((e[0]+n[0])/2,(e[1]+n[1])/2,U*a(i)),C(n[0],n[1],U));return r.add(s),r}function S(e,n){var r=new t.Curve,i=e.angleTo(n);return r.getPoint=function(r){return(new t.Vector3).addVectors(e.clone().multiplyScalar(Math.sin((1-r)*i)),n.clone().multiplyScalar(Math.sin(r*i))).divideScalar(Math.sin(i))},r}function C(e,n,r){return e=A(e),n=A(-n),new t.Vector3(-r*Math.cos(n)*Math.cos(e),-r*Math.sin(n),r*Math.cos(n)*Math.sin(e))}function A(t){return 2*Math.PI*t/360}var L,P,D,z,F,k,N,V,I,B=100,U=101,O=101.2;h().defer(o.json,"data/countries.geo.json").defer(o.csv,"data/life_expectancy.csv").defer(o.json,"data/latlong.json").await(l)}(THREE,THREEx,jQuery,Detector,toxi,d3,Delaunay,_,queue,window,"Numeric");